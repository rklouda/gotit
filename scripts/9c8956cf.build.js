/* q-municate - v1.10.0 - 2017-03-03 */
function ProgressBar(a,b){var c=ProgressBar.OPTION_NAME,d=ProgressBar.OPTION_VALUE,e=ProgressBar.DEFAULT_VALUE,f=ProgressBar.EVENT,g=a,h=document.getElementById(g),i=[],j=[],k="",l="",m="",n="",o=100,p=1,q={},r=this,s=function(){b=b||{},a&&(r.setWidth(b.width||e.WIDTH),r.setHeight(b.height||e.HEIGHT),h.innerHTML="",h.setAttribute("class","progressbar-control"))},t=function(){if(1==i.length){var a=t,b=0,d=i[b],e=r.getOptionValue(c.SPACE),f=0==e?100-r.getOptionValue(c.PERCENT):0;r.setOptionValue(c.SPACE,f,d[c.ITEM_ID]),_initialModeTimer=setTimeout(function(){a()},700)}},u=function(a){if(a&&a==m)return n;var b=0;if(1!=i.length)if(0==i.length)r.createItem({itemID:a});else if(i.length>1){if(!a)return 0;for(var d=0,e=i.length;d<e;d++)if(i[d][c.ITEM_ID]==a)return m=a,n=d,d}return b},v=function(a,b){if(a<0)return 0;var e=i[b],g=0,j=0;switch(e[c.POSITION]){case d.POSITION.RELATIVE:for(var k=0,l=i.length;k<l;k++)k!=b&&i[k][c.POSITION]==d.POSITION.RELATIVE&&(g+=i[k][c.PERCENT]);j=100-g,a>=j&&setTimeout(function(){h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e.itemID,me:r}}))},500);break;case d.POSITION.ABSOLUTE:j=100-e[c.SPACE]}return a<=j?a:j};this.getElement=function(){return h},this.getWidth=function(){return k},this.setWidth=function(a){return k=h.style.width=a,!0},this.getHeight=function(){return l},this.setHeight=function(a){return l=h.style.height=a,!0},this.createItem=function(a){if("string"==typeof a){var b=a;a={},a[c.ITEM_ID]=b}a=a||{};var f=h.appendChild(document.createElement("div")),b=a[c.ITEM_ID]=a[c.ITEM_ID]||"";if(i.length>0&&""==b)return!1;switch(a[c.TYPE]=a[c.TYPE]||e.TYPE,a[c.PERCENT]=a[c.PERCENT]||e.PERCENT,a[c.ALIGN]=a[c.ALIGN]||e.ALIGN,a[c.SPACE]?a[c.POSITION]=d.POSITION.ABSOLUTE:(a[c.SPACE]=e.SPACE,a[c.POSITION]=a[c.POSITION]||d.POSITION.RELATIVE),a[c.TYPE]){case d.TYPE.BAR:a[c.COLOR_ID]=a[c.COLOR_ID]||e.COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.OPACITY;break;case d.TYPE.LINE:a[c.COLOR_ID]=a[c.COLOR_ID]||e.LINE_COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.LINE_OPACITY,a[c.POSITION]=d.POSITION.ABSOLUTE,a[c.SPACE]=a[c.PERCENT]}return i.push(a),j.push(f),f.style.opacity=0,f.classList.add("item-"+a[c.TYPE]),this.setOptionValue(c.COLOR_ID,a[c.COLOR_ID],b),this.setOptionValue(c.ALIGN,a[c.ALIGN],b),this.setOptionValue(c.POSITION,a[c.POSITION],b),this.setOptionValue(c.PERCENT,a[c.PERCENT],b),!0},this.removeItem=function(a){var b=u(a),c=j[b];return null!=c&&(c.parentNode.removeChild(c),i.splice(b,1),j.splice(b,1),!0)},this.removeAll=function(){return!!h&&(h.innerHTML="",i=[],j=[],!0)},this.getMaxValue=function(){return o},this.setMaxValue=function(a){return o!=a&&a&&(p=100/a,o=a),p},this.getExValue=function(a){a=a||"first";var b=q[a]||0;return b},this.getPercentByValue=function(a,b,c){c&&c!=this.getMaxValue()&&this.setMaxValue(c),a<0&&(a=0),a>this.getMaxValue()&&(a=this.getMaxValue()),b=b||"first",q[b]=a;var d=c?a*this.getMaxValue(c):a*p;return parseInt(d)},this.getOptionValue=function(a,b){var c=u(b);return i[c][a]},this.setOptionValue=function(a,b,e){var g=u(e),k=j[g],l=i[g];switch(a){case c.ITEM_ID:return!1;case c.TYPE:return!1;case c.PERCENT:var m=this;setTimeout(function(){switch(b=parseInt(b)||0,l[c.TYPE]){case d.TYPE.BAR:b=v(b,g),k.style.width=b+"%",l[c.PERCENT]=b;break;case d.TYPE.LINE:m.setOptionValue(c.SPACE,b,e)}var a=0==b?0:l[c.OPACITY];k.style.opacity=a,setTimeout(function(){switch(h.dispatchEvent(new CustomEvent(f.CHANGED,{detail:{itemID:e,me:m}})),b){case 0:h.dispatchEvent(new CustomEvent(f.STARTING,{detail:{itemID:e,me:m}}));break;case 100:h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e,me:m}}))}},240)},10);break;case c.COLOR_ID:k.classList.remove(l[c.COLOR_ID]),k.classList.add(b),l[c.COLOR_ID]=b;break;case c.OPACITY:l[c.PERCENT]&&(k.style.opacity=b),l[c.OPACITY]=b;break;case c.ALIGN:k.style.cssFloat=b,l[c.ALIGN]=b,l[c.POSITION]==d.POSITION.ABSOLUTE&&this.setOptionValue(c.SPACE,l[c.SPACE],e);break;case c.SPACE:l[c.TYPE]==d.TYPE.LINE&&(b<0&&(b=0),b>100&&(b=100),l[c.PERCENT]=b),l[c.POSITION]!=d.POSITION.ABSOLUTE&&this.setOptionValue(c.POSITION,d.POSITION.ABSOLUTE,e),k.style.left="",k.style.right="",k.style[l[c.ALIGN]]=b+"%",l[c.SPACE]=b,l[c.TYPE]==d.TYPE.BAR&&this.setOptionValue(c.PERCENT,l[c.PERCENT],e);break;case c.POSITION:switch(l[c.TYPE]){case d.TYPE.BAR:b==d.POSITION.RELATIVE&&(k.style.left="",k.style.right="",l[c.SPACE]=0),k.style.position=b,l[c.POSITION]=b;break;case d.TYPE.LINE:b=d.POSITION.ABSOLUTE,k.style.position=b,l[c.POSITION]=b}}return!0},this.getPercent=function(a){return this.getOptionValue(c.PERCENT,a)},this.setPercent=function(a,b){return this.setOptionValue(c.PERCENT,a,b)},this.initialMode=function(a){if(a){this.removeAll(),this.setPercent(25),this.setOptionValue(c.COLOR_ID,d.COLOR_ID.WHITE);setTimeout(function(){t()},50)}else clearTimeout(_initialModeTimer),this.removeAll()},s()}var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):a.indexOf("!")===-1?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){try{e=u.execCb(c,f,d,e)}catch(g){a=g}if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a);"undefined"!=typeof console&&console.error?console.error(a):req.onError(a)}}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var h=[];each(this.depMaps,function(a){h.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,h)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return e!==-1&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((h.indexOf("?")===-1?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){return a.id===b.id&&c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),e.onNodeCreated&&e.onNodeCreated(d,e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b="length"in a&&a.length,c=_.type(a);return"function"!==c&&!_.isWindow(a)&&(!(1!==a.nodeType||!b)||("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a))}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(ha.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=oa[a]={};return _.each(a.match(na)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+h.uid++}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ua,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c||"false"!==c&&("null"===c?null:+c+""===c?+c:ta.test(c)?_.parseJSON(c):c)}catch(e){}sa.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Ka.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;c<d;c++)ra.set(a[c],"globalEval",!b||ra.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(ra.hasData(a)&&(f=ra.access(a),g=ra.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;c<d;c++)_.event.add(b,e,j[e][c])}sa.hasData(a)&&(h=sa.access(a),i=_.extend({},h),sa.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ya.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Oa[a];return c||(c=t(a,b),"none"!==c&&c||(Na=(Na||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Na[0].contentDocument,b.write(),b.close(),c=t(a,b),Na.detach()),Oa[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qa.test(g)&&Pa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xa.length;e--;)if(b=Xa[e]+c,b in a)return b;return d}function y(a,b,c){var d=Ta.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;f<4;f+=2)"margin"===c&&(g+=_.css(a,c+wa[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wa[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wa[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wa[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wa[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(e<=0||null==e){if(e=v(a,b,f),(e<0||null==e)&&(e=a.style[b]),Qa.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;g<h;g++)d=a[g],d.style&&(f[g]=ra.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xa(d)&&(f[g]=ra.access(d,"olddisplay",u(d.nodeName)))):(e=xa(d),"none"===c&&e||ra.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;g<h;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Ya=void 0}),Ya=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;d<4;d+=2-b)c=wa[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cb[b]||[]).concat(cb["*"]),f=0,g=e.length;f<g;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xa(a),p=ra.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?ra.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$a.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=ra.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;ra.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bb.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Ya||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;g<i;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),f<1&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ya||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;c<d;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);f<g;f++)if(d=bb[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(na)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===tb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}if(f)return f!==i[0]&&i.unshift(f),c[f]}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||yb.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.4",_=function(a,b){return new _.fn.init(a,b)},aa=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ba=/^-ms-/,ca=/-([\da-z])/gi,da=function(a,b){return b.toUpperCase()};_.fn=_.prototype={
jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?a<0?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(a<0?b:0);return this.pushStack(c>=0&&c<b?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);h<i;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"===_.type(a)&&!a.nodeType&&!_.isWindow(a)&&!(a.constructor&&!X.call(a.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(ba,"ms-").replace(ca,da)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;f<g&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;f<g&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(aa,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;d<c;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;f<g;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;f<g;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;if("string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a))return d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var ea=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],h=b.nodeType,"string"!=typeof a||!a||1!==h&&9!==h&&11!==h)return c;if(!d&&I){if(11!==h&&(e=sa.exec(a)))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return $.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName)return $.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=1!==h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ua,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=ta.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return $.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ia,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";b<c;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;e<f;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;h<i;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?aa(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return aa(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];h<e;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;d<e&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ia,"$1"),c,h<d&&s(a.slice(h,d)),d<e&&s(a=a.slice(d)),d<e&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,aa=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},ba="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ca="[\\x20\\t\\r\\n\\f]",da="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ea=da.replace("w","w#"),fa="\\["+ca+"*("+da+")(?:"+ca+"*([*^$|!~]?=)"+ca+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ea+"))|)"+ca+"*\\]",ga=":("+da+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+fa+")*)|.*)\\)|)",ha=new RegExp(ca+"+","g"),ia=new RegExp("^"+ca+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ca+"+$","g"),ja=new RegExp("^"+ca+"*,"+ca+"*"),ka=new RegExp("^"+ca+"*([>+~]|"+ca+")"+ca+"*"),la=new RegExp("="+ca+"*([^\\]'\"]*?)"+ca+"*\\]","g"),ma=new RegExp(ga),na=new RegExp("^"+ea+"$"),oa={ID:new RegExp("^#("+da+")"),CLASS:new RegExp("^\\.("+da+")"),TAG:new RegExp("^("+da.replace("w","w*")+")"),ATTR:new RegExp("^"+fa),PSEUDO:new RegExp("^"+ga),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ca+"*(even|odd|(([+-]|)(\\d*)n|)"+ca+"*(?:([+-]|)"+ca+"*(\\d+)|))"+ca+"*\\)|)","i"),bool:new RegExp("^(?:"+ba+")$","i"),needsContext:new RegExp("^"+ca+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ca+"*((?:-\\d)?\\d*)"+ca+"*\\)|)(?=[^-]|$)","i")},pa=/^(?:input|select|textarea|button)$/i,qa=/^h\d$/i,ra=/^[^{]+\{\s*\[native \w/,sa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ta=/[+~]/,ua=/'|\\/g,va=new RegExp("\\\\([\\da-f]{1,6}"+ca+"?|("+ca+")|.)","ig"),wa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:d<0?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},xa=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(ya){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=d.documentElement,c=d.defaultView,c&&c!==c.top&&(c.addEventListener?c.addEventListener("unload",xa,!1):c.attachEvent&&c.attachEvent("onunload",xa)),I=!y(d),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=ra.test(d.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!d.getElementsByName||!d.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){if(I)return b.getElementsByClassName(a)},K=[],J=[],(v.qsa=ra.test(d.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+ca+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+ca+"*(?:value|"+ba+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=d.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+ca+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=ra.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",ga)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=ra.test(H.compareDocumentPosition),M=b||ra.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===d||a.ownerDocument===O&&M(O,a)?-1:b===d||b.ownerDocument===O&&M(O,b)?1:D?aa(D,a)-aa(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===d?-1:b===d?1:f?-1:h?1:D?aa(D,a)-aa(D,b):0;if(f===h)return g(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},d):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(la,"='$1']"),v.matchesSelector&&I&&(!K||!K.test(c))&&(!J||!J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:oa,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(va,wa),a[3]=(a[3]||a[4]||a[5]||"").replace(va,wa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return oa.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ma.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(va,wa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+ca+")"+a+"("+ca+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:!c||(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ha," ")+" ").indexOf(d)>-1:"|="===c&&(f===d||f.slice(0,d.length+1)===d+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=aa(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ia,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(va,wa),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return na.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(va,wa).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qa.test(a.nodeName)},input:function(a){return pa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[c<0?c+b:c]}),even:j(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){d&&!(e=ja.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ka.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ia," ")}),h=h.slice(d.length));for(g in w.filter)!(e=oa[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(va,wa),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=oa.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(va,wa),ta.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,ta.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){if(!c)return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){if(!c&&"input"===a.nodeName.toLowerCase())return a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(ba,function(a,b,c){var d;if(!c)return a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=ea,_.expr=ea.selectors,_.expr[":"]=_.expr.pseudos,_.unique=ea.uniqueSort,_.text=ea.getText,_.isXMLDoc=ea.isXML,_.contains=ea.contains;var fa=_.expr.match.needsContext,ga=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ha=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;b<c;b++)if(_.contains(e[b],this))return!0}));for(b=0;b<c;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fa.test(a)?_(a):a||[],!1).length}});var ia,ja=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ka=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:ja.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ia).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),ga.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ia.ready?ia.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};ka.prototype=_.fn,ia=_(Z);var la=/^(?:parents|prev(?:Until|All))/,ma={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;a<c;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fa.test(a)||"string"!=typeof a?_(a,b||this.context):0;d<e;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(ma[a]||_.unique(e),la.test(a)&&e.reverse()),this.pushStack(e)}});var na=/\S+/g,oa={};_.Callbacks=function(a){a="string"==typeof a?oa[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&h<g;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(c<=g&&g--,c<=h&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);e<g;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pa;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pa.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pa||(pa=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pa.promise(b)},_.ready.promise();var qa=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;h<i;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(na)||[])),c=d.length;for(;c--;)delete g[d[c]]}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var ra=new h,sa=new h,ta=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ua=/([A-Z])/g;_.extend({hasData:function(a){return sa.hasData(a)||ra.hasData(a)},data:function(a,b,c){return sa.access(a,b,c)},removeData:function(a,b){sa.remove(a,b)},_data:function(a,b,c){return ra.access(a,b,c)},_removeData:function(a,b){ra.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sa.get(f),1===f.nodeType&&!ra.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));ra.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sa.set(this,a)}):qa(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sa.get(f,a),void 0!==c)return c;if(c=sa.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sa.get(this,d);sa.set(this,d,b),a.indexOf("-")!==-1&&void 0!==c&&sa.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sa.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=ra.get(a,b),c&&(!d||_.isArray(c)?d=ra.access(a,b,_.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return ra.get(a,c)||ra.access(a,c,{empty:_.Callbacks("once memory").add(function(){ra.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);
_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=ra.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var va=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wa=["Top","Right","Bottom","Left"],xa=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},ya=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var za="undefined";Y.focusinBubbles="onfocusin"in a;var Aa=/^key/,Ba=/^(?:mouse|pointer|contextmenu)|click/,Ca=/^(?:focusinfocus|focusoutblur)$/,Da=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==za&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(na)||[""],j=b.length;j--;)h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.hasData(a)&&ra.get(a);if(q&&(i=q.events)){for(b=(b||"").match(na)||[""],j=b.length;j--;)if(h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,ra.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Ca.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Ca.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(ra.get(g,"events")||{})[b.type]&&ra.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(ra.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)a.namespace_re&&!a.namespace_re.test(f.namespace)||(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;c<h;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Ba.test(e)?this.mouseHooks:Aa.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==l()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===l()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&_.nodeName(this,"input"))return this.click(),!1},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||_.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=ra.access(d,b);e||d.addEventListener(a,c,!0),ra.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=ra.access(d,b)-1;e?ra.access(d,b,e):(d.removeEventListener(a,c,!0),ra.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];if(c)return _.event.trigger(a,b,c,!0)}});var Ea=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fa=/<([\w:]+)/,Ga=/<|&#?\w+;/,Ha=/<(?:script|style|link)/i,Ia=/checked\s*(?:[^=]|=\s*.checked.)/i,Ja=/^$|\/(?:java|ecma)script/i,Ka=/^true\/(.*)/,La=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ma.optgroup=Ma.option,Ma.tbody=Ma.tfoot=Ma.colgroup=Ma.caption=Ma.thead,Ma.th=Ma.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;d<e;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;d<e;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;m<n;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Ga.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fa.exec(e)||["",""])[1].toLowerCase(),h=Ma[g]||Ma._default,f.innerHTML=h[1]+e.replace(Ea,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||_.inArray(e,d)===-1)&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Ja.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[ra.expando],e&&(b=ra.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);ra.cache[e]&&delete ra.cache[e]}delete sa.cache[c[sa.expando]]}}}),_.fn.extend({text:function(a){return qa(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qa(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Ha.test(a)&&!Ma[(Fa.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ea,"<$1></$2>");try{for(;c<d;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ia.test(m))return this.each(function(c){var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;i<j;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;i<f;i++)g=e[i],Ja.test(g.type||"")&&!ra.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(La,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;g<=f;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Na,Oa={},Pa=/^margin/,Qa=new RegExp("^("+va+")(?!px)[a-z%]+$","i"),Ra=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.removeChild(c),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sa=/^(none|table(?!-c[ea]).+)/,Ta=new RegExp("^("+va+")(.*)$","i"),Ua=new RegExp("^([+-])=("+va+")","i"),Va={position:"absolute",visibility:"hidden",display:"block"},Wa={letterSpacing:"0",fontWeight:"400"},Xa=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ua.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wa&&(e=Wa[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){if(c)return Sa.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Va,function(){return A(a,b,d)}):A(a,b,d)},set:function(a,c,d){var e=d&&Ra(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){if(b)return _.swap(a,{display:"inline-block"},v,[a,"marginRight"])}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];d<4;d++)e[a+wa[d]+b]=f[d]||f[d-2]||f[0];return e}},Pa.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qa(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Ra(a),e=b.length;g<e;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xa(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.options.duration?this.pos=b=_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Ya,Za,$a=/^(?:toggle|show|hide)$/,_a=new RegExp("^(?:([+-])=|)("+va+")([a-z%]*)$","i"),ab=/queueHooks$/,bb=[G],cb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_a.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_a.exec(_.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],cb[c]=cb[c]||[],cb[c].unshift(b)},prefilter:function(a,b){b?bb.unshift(a):bb.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xa).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||ra.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=ra.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=ra.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;b<g;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Ya=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Ya=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Za||(Za=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Za),Za=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var db,eb,fb=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qa(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===za?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?eb:db)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(na);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),eb={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fb[b]||_.find.attr;fb[b]=function(a,b,d){var e,f;return d||(f=fb[b],fb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fb[b]=f),e}});var gb=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qa(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hb=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];i<j;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];i<j;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):_.isFunction(a)?this.each(function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(na)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else c!==za&&"boolean"!==c||(this.className&&ra.set(this,"__className__",this.className),this.className=this.className||a===!1?"":ra.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;c<d;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hb," ").indexOf(b)>=0)return!0;return!1}});var ib=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ib,""):null==c?"":c)}}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||e<0,g=f?null:[],h=f?e+1:d.length,i=e<0?h:f?e:0;i<h;i++)if(c=d[i],(c.selected||i===e)&&(Y.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){if(_.isArray(b))return a.checked=_.inArray(_(a).val(),b)>=0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jb=_.now(),kb=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return b&&!b.getElementsByTagName("parsererror").length||_.error("Invalid XML: "+a),b};var lb=/#.*$/,mb=/([?&])_=[^&]*/,nb=/^(.*?):[ \t]*([^\r\n]*)$/gm,ob=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pb=/^(?:GET|HEAD)$/,qb=/^\/\//,rb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,sb={},tb={},ub="*/".concat("*"),vb=a.location.href,wb=rb.exec(vb.toLowerCase())||[];_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vb,type:"GET",isLocal:ob.test(wb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)},ajaxPrefilter:J(sb),ajaxTransport:J(tb),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&a<300||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,!a&&w||(w="error",a<0&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=nb.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this;
},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(t<2)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||vb)+"").replace(lb,"").replace(qb,wb[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(na)||[""],null==l.crossDomain&&(i=rb.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===wb[1]&&i[2]===wb[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(wb[3]||("http:"===wb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(sb,l,b,v),2===t)return v;j=_.event&&l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!pb.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kb.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mb.test(e)?e.replace(mb,"$1_="+jb++):e+(kb.test(e)?"&":"?")+"_="+jb++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+ub+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(tb,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(t<2))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return _.isFunction(a)?this.each(function(b){_(this).wrapInner(a.call(this,b))}):this.each(function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var xb=/%20/g,yb=/\[\]$/,zb=/\r?\n/g,Ab=/^(?:submit|button|image|reset|file)$/i,Bb=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);return d.join("&").replace(xb,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Bb.test(this.nodeName)&&!Ab.test(a)&&(this.checked||!ya.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(zb,"\r\n")}}):{name:b.name,value:c.replace(zb,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cb=0,Db={},Eb={0:200,1223:204},Fb=_.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Db)Db[a]()}),Y.cors=!!Fb&&"withCredentials"in Fb,Y.ajax=Fb=!!Fb,_.ajaxTransport(function(a){var b;if(Y.cors||Fb&&!a.crossDomain)return{send:function(c,d){var e,f=a.xhr(),g=++Cb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Db[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Eb[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Db[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gb=[],Hb=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gb.pop()||_.expando+"_"+jb++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hb.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hb.test(b.data)&&"data");if(h||"jsonp"===b.dataTypes[0])return e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hb,"$1"+e):b.jsonp!==!1&&(b.url+=(kb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gb.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=ga.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Ib=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Ib)return Ib.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Jb=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==za&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Jb;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Jb})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qa(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){if(c)return c=v(a,b),Qa.test(c)?_(a).position()[b]+"px":c})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qa(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var Kb=a.jQuery,Lb=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Lb),b&&a.jQuery===_&&(a.jQuery=Kb),_},typeof b===za&&(a.jQuery=a.$=_),_}),define("config",[],function(){var a={qbAccount:{appId:51994,authKey:"WnF8-gpP7CHRy94",authSecret:"BcPszAStfMYqCdV"},fbAccount:{appId:"229627770822723",scope:"email,user_friends"},debug:!0,notification:{timeout:7},defAvatar:{url:"images/ava-single.svg",url_png:"images/ava-single.png",group_url:"images/ava-group.svg",group_url_png:"images/ava-group.png",caption:"Choose user picture"},stackMessages:50,maxLimitFile:10,maxVideoSize:100,patterns:{name:".{3,50}",password:".{8,40}"},errors:{session:"The QB application credentials you entered are incorrect",invalidName:"Name mustn't contain '<', '>' and ';' characters",shortName:"Name must be more than 2 characters",bigName:"Name mustn't be more than 50 characters",invalidEmail:"Please enter a valid Email address",invalidPhone:"Phone mustn't contain letters",oldPass:"Old password is incorrect",invalidPass:"Password mustn't contain non-Latin characters and spaces",shortPass:"Password must be more than 7 characters",bigPass:"Password mustn't be more than 40 characters",avatarType:"Avatar must be image",fileName:"File name mustn't be more than 100 characters",fileSize:"File mustn't be more than 10 MB",videoSize:"File mustn't be more than 100 MB",emailExists:"The email has already been taken",unauthorized:"The email or password is incorrect",notFoundEmail:"The email you entered wasn't found",crashFBToken:"Sorry, we noticed that you had logged out from Facebook so we need to recreate your FB token now. Please click the Connect with FB button again",FBAccountExists:"This FB user already has an account in the Q-municate. You can't combine two Q-municate users"},QBconf:{chatProtocol:{active:2},debug:{mode:1,file:null},webrtc:{answerTimeInterval:45,statsReportTimeInterval:5}}};return a}),function(){function a(a){for(var b="",c=0;c<a.length;c++)b+="\\u"+("000"+a[c].charCodeAt(0).toString(16)).substr(-4);return b}var b={"👩‍👩‍👦‍👦":964,"👨‍👩‍👦‍👦":959,"👨‍👨‍👦‍👦":955,"👨‍👨‍👧‍👦":957,"👩‍👩‍👧‍👧":967,"👨‍👨‍👧‍👧":958,"👩‍❤️‍💋‍👩":1091,"👨‍❤️‍💋‍👨":1090,"👩‍👩‍👧‍👦":966,"👨‍👩‍👧‍👦":961,"👨‍👩‍👧‍👧":962,"👩‍❤️‍👩":1095,"👩👩👦👦":964,"👨‍❤️‍👨":1094,"👨👨👧👧":958,"👨👨👧👦":957,"👩👩👧👦":966,"👨‍👨‍👧":956,"👨‍👨‍👦":954,"👨‍👩‍👧":960,"👩‍👩‍👧":965,"👩👩👧👧":967,"👨👩👧👦":961,"👩‍👩‍👦":963,"👨👩👦👦":959,"👨👨👦👦":955,"👨👩👧👧":962,"👨❤💋👨":1090,"👩❤💋👩":1091,"👨👩👧":960,"👩👩👧":965,"👩👩👦":963,"👨👨👦":954,"👨👨👧":956,"️👆🏽":845,"️👆🏿":847,"️👆🏾":846,"️👌🏻":879,"👨❤👨":1094,"👩❤👩":1095,"️👆🏼":844,"️👆🏻":843,"️👌🏿":883,"️👌🏾":882,"️👌🏽":881,"️👌🏼":880,"👁‍🗨":827,"🇬🇱":306,"👌🏻":879,"🙌🏼":1457,"👌🏼":880,"🙌🏽":1458,"👌🏽":881,"🙌🏾":1459,"👌🏾":882,"🙌🏿":1460,"👌🏿":883,"🇫🇮":292,"🇫🇯":293,"🇫🇴":296,"🇫🇰":294,"🇪🇺":291,"👐🏻":903,"👐🏼":904,"👐🏽":905,"👐🏾":906,"👐🏿":907,"💪🏻":1121,"💪🏼":1122,"💪🏽":1123,"💪🏾":1124,"💪🏿":1125,"🙏🏻":1474,"🙏🏼":1475,"🙏🏽":1476,"🙏🏾":1477,"🙏🏿":1478,"🇿🇼":469,"☝️🏻":64,"🇪🇹":290,"☝️🏼":65,"🇪🇪":285,"☝️🏽":66,"🇪🇷":288,"☝️🏾":67,"🇬🇶":310,"☝️🏿":68,"🇸🇻":430,"🇪🇬":286,"👏🏻":897,"👆🏻":843,"👏🏼":898,"👆🏼":844,"👏🏽":899,"👆🏽":845,"👏🏾":900,"👆🏾":846,"👏🏿":901,"👆🏿":847,"👇🏻":849,"👇🏼":850,"👇🏽":851,"👇🏾":852,"👇🏿":853,"👈🏻":855,"👈🏼":856,"👈🏽":857,"👈🏾":858,"👈🏿":859,"👉🏻":861,"👉🏼":862,"👉🏽":863,"👉🏾":864,"👉🏿":865,"🖕🏻":1323,"🖕🏼":1324,"🖕🏽":1325,"🖕🏾":1326,"🖕🏿":1327,"🖐🏻":1317,"🖐🏼":1318,"🖐🏽":1319,"🖐🏾":1320,"🖐🏿":1321,"🤘🏻":1600,"🤘🏼":1601,"🤘🏽":1602,"🤘🏾":1603,"🤘🏿":1604,"🖖🏻":1329,"🖖🏼":1330,"🖖🏽":1331,"🖖🏾":1332,"🖖🏿":1333,"🇿🇲":468,"🇪🇨":284,"🇩🇴":282,"🇩🇲":281,"🇩🇯":279,"🇩🇰":280,"💅🏻":1065,"💅🏼":1066,"💅🏽":1067,"💅🏾":1068,"💅🏿":1069,"👂🏻":829,"👂🏼":830,"👂🏽":831,"👂🏾":832,"👂🏿":833,"👃🏻":835,"👃🏼":836,"👃🏽":837,"👃🏾":838,"👃🏿":839,"👶🏻":1015,"👶🏼":1016,"👶🏽":1017,"👶🏾":1018,"👶🏿":1019,"👦🏻":930,"👦🏼":931,"👦🏽":932,"👦🏾":933,"👦🏿":934,"👧🏻":936,"👧🏼":937,"👧🏽":938,"👧🏾":939,"👧🏿":940,"👨🏻":942,"👨🏼":943,"👨🏽":944,"👨🏾":945,"👨🏿":946,"👩🏻":948,"👩🏼":949,"👩🏽":950,"👩🏾":951,"👩🏿":952,"👱🏻":985,"👱🏼":986,"👱🏽":987,"👱🏾":988,"👱🏿":989,"👴🏻":1003,"👴🏼":1004,"👴🏽":1005,"👴🏾":1006,"👴🏿":1007,"👵🏻":1009,"👵🏼":1010,"👵🏽":1011,"👵🏾":1012,"👵🏿":1013,"👲🏻":991,"👲🏼":992,"👲🏽":993,"👲🏾":994,"👲🏿":995,"👳🏻":997,"👳🏼":998,"👳🏽":999,"👳🏾":1e3,"👳🏿":1001,"👮🏻":972,"👮🏼":973,"👮🏽":974,"👮🏾":975,"👮🏿":976,"👷🏻":1021,"👷🏼":1022,"👷🏽":1023,"👷🏾":1024,"👷🏿":1025,"💂🏻":1052,"💂🏼":1053,"💂🏽":1054,"💂🏾":1055,"💂🏿":1056,"🎅🏻":617,"🎅🏼":618,"🎅🏽":619,"🎅🏾":620,"🎅🏿":621,"👼🏻":1036,"👼🏼":1037,"👼🏽":1038,"👼🏾":1039,"👼🏿":1040,"👸🏻":1027,"👸🏼":1028,"👸🏽":1029,"👸🏾":1030,"👸🏿":1031,"👰🏻":979,"👰🏼":980,"👰🏽":981,"👰🏾":982,"👰🏿":983,"🚶🏻":1549,"🚶🏼":1550,"🚶🏽":1551,"🚶🏾":1552,"🚶🏿":1553,"🏃🏻":679,"🏃🏼":680,"🏃🏽":681,"🏃🏾":682,"🏃🏿":683,"💃🏻":1058,"💃🏼":1059,"💃🏽":1060,"💃🏾":1061,"💃🏿":1062,"🙇🏻":1441,"🙇🏼":1442,"🙇🏽":1443,"🙇🏾":1444,"🙇🏿":1445,"💁🏻":1046,"💁🏼":1047,"💁🏽":1048,"💁🏾":1049,"💁🏿":1050,"🙅🏻":1429,"🙅🏼":1430,"🙅🏽":1431,"🙅🏾":1432,"🙅🏿":1433,"🙆🏻":1435,"🙆🏼":1436,"🙆🏽":1437,"🙆🏾":1438,"🙆🏿":1439,"🙋🏻":1450,"🙋🏼":1451,"🙋🏽":1452,"🙋🏾":1453,"🙋🏿":1454,"🙎🏻":1468,"🙎🏼":1469,"🙎🏽":1470,"🙎🏾":1471,"🙎🏿":1472,"🙍🏻":1462,"🙍🏼":1463,"🙍🏽":1464,"🙍🏾":1465,"🙍🏿":1466,"💇🏻":1077,"💇🏼":1078,"💇🏽":1079,"💇🏾":1080,"💇🏿":1081,"💆🏻":1071,"💆🏼":1072,"💆🏽":1073,"💆🏾":1074,"💆🏿":1075,"👋🏻":873,"👋🏼":874,"👋🏽":875,"👋🏾":876,"👋🏿":877,"👍🏻":885,"👍🏼":886,"👍🏽":887,"👍🏾":888,"👍🏿":889,"👎🏻":891,"👎🏼":892,"👎🏽":893,"👎🏾":894,"👎🏿":895,"👊🏻":867,"👊🏼":868,"👊🏽":869,"👊🏾":870,"👊🏿":871,"🇬🇷":311,"🇬🇮":305,"🇬🇭":304,"🇩🇪":278,"🇬🇪":301,"✌️🏻":157,"🇬🇲":307,"✌️🏼":158,"🙌🏻":1456,"🇬🇦":298,"✌️🏽":159,"🇹🇫":436,"✌️🏾":160,"🇵🇫":396,"✌️🏿":161,"🇬🇫":302,"🇾🇪":465,"🇪🇭":287,"🇼🇫":462,"🇨🇿":277,"🇻🇳":460,"🇻🇪":457,"🇻🇦":455,"🇨🇾":276,"🇻🇺":461,"🇨🇼":274,"🇺🇿":454,"🇺🇾":453,"🇺🇸":452,"🇬🇧":299,"🇦🇪":224,"🇺🇦":450,"🇺🇬":451,"🇻🇮":459,"🇹🇻":447,"🇹🇨":434,"🇹🇲":442,"🇹🇷":445,"🇹🇳":443,"🇹🇹":446,"🚣🏻":1515,"🚣🏼":1516,"🚣🏽":1517,"🚣🏾":1518,"🚣🏿":1519,"🏊🏻":701,"🏊🏼":702,"🏊🏽":703,"🏊🏾":704,"🏊🏿":705,"🏄🏻":685,"🏄🏼":686,"🏄🏽":687,"🏄🏾":688,"🏄🏿":689,"🛀🏻":1564,"🛀🏼":1565,"🛀🏽":1566,"🛀🏾":1567,"🛀🏿":1568,"🇹🇴":444,"🇨🇺":272,"🇭🇷":319,"🇨🇮":265,"🇨🇷":271,"🇨🇰":266,"🏋🏻":707,"🏋🏼":708,"🏋🏽":709,"🏋🏾":710,"🏋🏿":711,"🚴🏻":1537,"🚴🏼":1538,"🚴🏽":1539,"🚴🏾":1540,"🚴🏿":1541,"🚵🏻":1543,"🚵🏼":1544,"🚵🏽":1545,"🚵🏾":1546,"🚵🏿":1547,"🏇🏻":693,"🏇🏼":694,"🏇🏽":695,"🏇🏾":696,"🏇🏿":697,"🇹🇰":440,"🇹🇬":437,"🇹🇱":441,"🇹🇭":438,"🇹🇿":449,"🇹🇯":439,"🇹🇼":448,"🇸🇾":432,"🇨🇭":264,"🇸🇪":418,"🇸🇿":433,"🇸🇷":427,"🇸🇩":417,"🇻🇨":456,"🇵🇲":401,"🇱🇨":350,"🇰🇳":342,"🇸🇭":420,"🇧🇱":248,"🇱🇰":352,"🇪🇸":289,"🇸🇸":428,"🇰🇷":344,"🇿🇦":467,"🇸🇴":426,"🇸🇧":415,"🇬🇸":312,"🇸🇮":421,"🇸🇰":422,"🇸🇽":431,"🇸🇬":419,"🇸🇱":423,"🇸🇨":416,"🇷🇸":411,"🇸🇳":425,"🇸🇦":414,"🇸🇹":429,"🇸🇲":424,"🇼🇸":463,"🇷🇼":413,"🇷🇺":412,"🇷🇴":410,"🇷🇪":409,"🇶🇦":408,"🇵🇷":403,"🇵🇹":405,"🇵🇱":400,"🇵🇳":402,"🇵🇭":398,"🇵🇪":395,"🇵🇾":407,"🇵🇬":397,"🇵🇦":394,"🇵🇸":404,"🇵🇼":406,"🇵🇰":399,"🇴🇲":393,"🇳🇴":388,"🇨🇩":261,"🇨🇬":263,"🇰🇲":341,"🇲🇵":370,"🇰🇵":343,"🇳🇫":384,"🇨🇴":270,"🇨🇨":260,"🇨🇽":275,"🇳🇺":391,"🇳🇬":385,"🇳🇪":383,"🇳🇮":386,"🇳🇿":392,"🇳🇨":382,"🇳🇱":387,"🇳🇵":389,"🇳🇷":390,"🇳🇦":381,"🇲🇲":367,"🇲🇿":380,"🇲🇦":359,"🇲🇸":373,"🇨🇳":269,"🇨🇱":267,"🇲🇪":362,"🇲🇳":368,"🇲🇨":360,"🇲🇩":361,"🇫🇲":295,"🇲🇽":378,"🇹🇩":435,"🇾🇹":466,"🇨🇫":262,"🇰🇾":346,"🇧🇶":252,"🇨🇻":273,"🇮🇨":322,"🇨🇦":259,"🇨🇲":268,"🇰🇭":339,"🇧🇮":246,"🇧🇫":243,"🇧🇬":244,"🇧🇳":250,"🇲🇺":375,"🇲🇷":372,"🇲🇶":371,"🇲🇭":364,"🇲🇹":374,"🇲🇱":366,"🇲🇻":376,"🇲🇾":379,"🇲🇼":377,"🇲🇬":363,"🇲🇰":365,"🇲🇴":369,"🇱🇺":356,"🇱🇹":355,"🇱🇮":351,"🇱🇾":358,"🇱🇷":353,"🇱🇸":354,"🇱🇧":349,"🇱🇻":357,"🇱🇦":348,"🇰🇬":338,"🇰🇼":345,"🇽🇰":464,"🇰🇮":340,"🇰🇪":337,"🇻🇬":458,"🇮🇴":328,"🇰🇿":347,"🇯🇴":335,"🇯🇪":333,"🇯🇵":336,"🇯🇲":334,"🇮🇹":332,"🇮🇱":325,"🇮🇲":326,"🇮🇪":324,"🇮🇶":329,"🇮🇷":330,"🇮🇩":323,"🇮🇳":327,"🇮🇸":331,"🇭🇺":321,"🇭🇰":317,"🇭🇳":318,"🇭🇹":320,"🇬🇾":316,"🇬🇼":315,"🇬🇳":308,"🇬🇬":303,"🇧🇷":253,"🇧🇼":256,"🇬🇹":313,"🇬🇺":314,"🇬🇵":309,"🇬🇩":300,"🇫🇷":297,"👁🗨":827,"🇦🇫":225,"🇦🇽":237,"🇦🇱":228,"🇩🇿":283,"🇦🇸":233,"🇦🇩":223,"🇦🇴":230,"🇦🇮":227,"🇦🇶":231,"🇦🇬":226,"🇦🇷":232,"🇦🇲":229,"🇦🇼":236,"🇦🇺":235,"🇦🇹":234,"🇦🇿":238,"🇧🇸":254,"🇧🇭":245,"🇧🇩":241,"🇧🇧":240,"🇧🇾":257,"🇧🇪":242,"🇧🇿":258,"🇧🇯":247,"🇧🇲":249,"🇧🇹":255,"🇧🇴":251,"🇧🇦":239,"️🌥":520,"️♠️":91,"*️⃣":2,"#️⃣":1,"9️⃣":12,"8️⃣":11,"7️⃣":10,"6️⃣":9,"5️⃣":8,"4️⃣":7,"3️⃣":6,"2️⃣":5,"1️⃣":4,"0️⃣":3,"️🚰":1532,"🅿️":211,"🈂️":471,"️💹":1140,"🈯️":473,"🅾️":210,"🅱️":209,"🅰️":208,"🈷️":479,"️🈸":480,"🈚️":472,"⛹🏿":137,"⛹🏾":136,"⛹🏽":135,"⛹🏼":134,"⛹🏻":133,"🀄️":206,"️🌤":519,"️🌟":516,"✍🏿":167,"✍🏾":166,"✍🏽":165,"✍🏼":164,"✍🏻":163,"️👆":842,"☝🏿":68,"☝🏾":67,"☝🏽":66,"☝🏼":65,"☝🏻":64,"✋🏿":155,"✋🏾":154,"✋🏽":153,"✋🏼":152,"✋🏻":151,"️👌":878,"✌🏿":161,"✌🏾":160,"✌🏽":159,"✌🏼":158,"✌🏻":157,"✊🏿":149,"✊🏾":148,"✊🏽":147,"✊🏼":146,"✊🏻":145,"🙅":1428,"☁️":54,"👍":884,"🌧":522,"😌":1371,"🌩":524,"⚡️":107,"💂":1051,"🔥":1247,"💥":1115,"❄️":177,"👉":860,"🌨":523,"☃️":56,"😍":1372,"⛄️":114,"😘":1383,"🌬":527,"💨":1118,"🌪":525,"🌫":526,"☂️":55,"😗":1382,"☔️":60,"😙":1384,"💧":1117,"💦":1116,"🌊":495,"🍏":562,"🍎":561,"🍐":563,"🍊":557,"🍋":558,"🍌":559,"🍉":556,"🍇":554,"🍓":566,"🍈":555,"🍒":565,"🍑":564,"🍍":560,"🍅":552,"🍆":553,"🌶":537,"🌽":544,"🍠":579,"🍯":594,"🍞":577,"🧀":1610,"🍗":570,"🍖":569,"🍤":583,"🍳":598,"🍔":567,"🍟":578,"🌭":528,"🍕":568,"🍝":576,"🌮":529,"🌯":530,"🍜":575,"🍲":597,"🍥":584,"🍣":582,"🍱":596,"🍛":574,"🍙":572,"🍚":573,"🍘":571,"🍢":581,"🍡":580,"🍧":586,"🍨":587,"🍦":585,"🍰":595,"🎂":613,"🍮":593,"🍬":591,"🍭":592,"🍫":590,"🍿":610,"🍩":588,"🍪":589,"🍺":605,"🍻":606,"🍷":602,"🍸":603,"🍹":604,"🍾":609,"🍶":601,"🍵":600,"☕️":61,"🕵":1306,"🍼":607,"🍴":599,"🍽":608,"⚽️":112,"🎅":616,"🏀":675,"🏈":698,"⚾️":113,"👎":890,"🎾":673,"🏐":716,"🏉":699,"🎱":660,"⛳️":127,"🖕":1322,"🏌":712,"🏓":719,"🏸":753,"🏒":718,"🏑":717,"🏏":715,"🎿":674,"😚":1385,"🏂":677,"😜":1387,"🏹":754,"🎣":646,"🚣":1514,"😝":1388,"👼":1035,"😛":1386,"🤑":1592,"🖐":1316,"🏊":700,"👊":866,"🤓":1594,"👸":1026,"😎":1373,"🤗":1598,"🏄":684,"😏":1374,"🤘":1599,"😶":1413,"👰":978,"🏽":758,"🛀":1563,"😐":1375,"😑":1376,"😒":1377,"🖖":1328,"🚶":1548,"🙄":1427,"🤔":1595,"✌️":156,"🏼":757,"😳":1410,"🏃":678,"🏋":706,"😞":1389,"😟":1390,"😠":1391,"😡":1392,"😔":1379,"🚴":1536,"💃":1057,"😕":1380,"💅":1064,"🙁":1424,"☹️":77,"🚵":1542,"🏾":759,"👯":977,"👫":968,"👬":969,"👭":970,"🏇":692,"🙇":1440,"😣":1394,"👌":878,"👄":840,"👅":841,"🕴":1305,"🏆":691,"🎽":672,"🏅":690,"🎖":636,"🎗":637,"🏵":751,"🎫":654,"🎟":642,"🎭":656,"🎨":651,"🎪":653,"🎤":647,"🎧":650,"🎼":671,"🎹":668,"🎷":666,"🎺":669,"🎸":667,"🎻":670,"🎬":655,"🎮":657,"👾":1042,"🎯":658,"🎲":661,"🎰":659,"🎳":662,"🚗":1502,"🚕":1500,"🚙":1504,"🚌":1491,"🚎":1493,"🏎":714,"🚓":1498,"🚑":1496,"🚒":1497,"🚐":1495,"🚚":1505,"🚛":1506,"🚜":1507,"🏍":713,"🚲":1534,"🚨":1524,"🚔":1499,"🚍":1492,"🚘":1503,"🚖":1501,"🚡":1512,"🚠":1511,"🚟":1510,"🚃":1482,"🚋":1490,"🚝":1508,"🚄":1483,"🚅":1484,"🚈":1487,"🚞":1509,"🚂":1481,"🚆":1485,"🚇":1486,"🚊":1489,"🚉":1488,"🚁":1480,"🛩":1586,"✈️":142,"👂":828,"🛫":1587,"🛬":1588,"⛵️":129,"💁":1045,"🛥":1585,"🚤":1520,"😖":1381,"🛳":1590,"🚀":1479,"🛰":1589,"💺":1141,"⚓️":99,"😫":1402,"🚧":1523,"⛽️":139,"😩":1400,"🚏":1494,"🚦":1521,"🚥":1522,"🏁":676,"🚢":1513,"🎡":644,"🎢":645,"🎠":643,"🏗":723,"🌁":486,"🗼":1355,"🏭":745,"⛲️":126,"😤":1395,"🎑":633,"😮":1405,"🏔":720,"🗻":1354,"🌋":496,"🗾":1357,"🏕":721,"⛺️":138,"😬":1403,"🏞":730,"🛣":1583,"🛤":1584,"🌅":490,"🌄":489,"🏜":728,"🏖":722,"🏝":729,"🌇":492,"🌆":491,"🏙":725,"🌃":488,"🌉":494,"🌌":497,"🌠":517,"🎇":623,"🎆":622,"🌈":493,"🏘":724,"🏰":748,"🏯":747,"🏟":731,"🗽":1356,"🏠":732,"🏡":733,"🏚":726,"🏢":734,"🏬":744,"🏣":735,"🏤":736,"🏥":737,"🏦":738,"🏨":740,"🏪":742,"🏫":743,"🏩":741,"💒":1096,"🏛":727,"⛪️":123,"👃":834,"🕌":1275,"🕍":1276,"🕋":1274,"😱":1408,"⌚️":27,"😨":1399,"📱":1196,"📲":1197,"💻":1142,"😰":1407,"🖥":1334,"🖨":1335,"🖱":1336,"🖲":1337,"🕹":1310,"🗜":1345,"💽":1144,"💾":1145,"💿":1146,"📀":1147,"📼":1207,"📷":1202,"📸":1203,"📹":1204,"🎥":648,"📽":1208,"🎞":641,"📞":1177,"☎️":58,"😯":1406,"📟":1178,"📠":1179,"📺":1205,"📻":1206,"🎙":638,"🎚":639,"🎛":640,"🙆":1434,"😦":1397,"👁":826,"🕰":1303,"👀":825,"⌛️":28,"👤":927,"📡":1180,"🔋":1221,"🔌":1222,"💡":1111,"🔦":1248,"🕯":1302,"🗑":1342,"🛢":1582,"💸":1139,"💵":1136,"💴":1135,"💶":1137,"💷":1138,"💰":1131,"💳":1134,"💎":1088,"👥":928,"🔧":1249,"🔨":1250,"🙋":1449,"🛠":1580,"🗣":1349,"🔩":1251,"👶":1014,"🏻":756,"🔫":1253,"💣":1113,"🔪":1252,"🗡":1348,"😧":1398,"🛡":1581,"🚬":1528,"😢":1393,"🙎":1467,"😥":1396,"🏺":755,"🔮":1256,"📿":1209,"💈":1082,"😪":1401,"🔭":1255,"🔬":1254,"🕳":1304,"💊":1084,"💉":1083,"🌡":518,"🏷":752,"🔖":1232,"🚽":1560,"🚿":1562,"🛁":1569,"🔑":1227,"🗝":1346,"🛋":1574,"🛌":1575,"🛏":1578,"🚪":1526,"🛎":1577,"🖼":1338,"🗺":1353,"👦":929,"🗿":1358,"🛍":1576,"🎈":624,"🎏":631,"🎀":611,"🎁":612,"🎊":626,"🎉":625,"🎎":630,"🎐":632,"🎌":628,"🏮":746,"✉️":143,"😓":1378,"📩":1188,"📨":1187,"📧":1186,"💌":1086,"📮":1193,"📪":1189,"📫":1190,"📬":1191,"📭":1192,"📦":1185,"📯":1194,"📥":1184,"📤":1183,"📜":1175,"📃":1150,"📑":1164,"📊":1157,"📈":1155,"📉":1156,"📄":1151,"📅":1152,"📆":1153,"🗓":1344,"📇":1154,"🗃":1340,"🗳":1352,"🗄":1341,"📋":1158,"🗒":1343,"📁":1148,"📂":1149,"🗂":1339,"🗞":1347,"📰":1195,"📓":1166,"📕":1168,"📗":1170,"📘":1171,"📙":1172,"📔":1167,"📒":1165,"📚":1173,"📖":1169,"🔗":1233,"📎":1161,"🖇":1311,"✂️":140,"👐":902,"📐":1163,"📏":1162,"📌":1159,"📍":1160,"🚩":1525,"🏳":749,"🏴":750,"🔐":1226,"🔒":1228,"🔓":1229,"🔏":1225,"🖊":1312,"🖋":1313,"✒️":169,"🙍":1461,"📝":1176,"✏️":168,"😭":1404,"🖍":1315,"🖌":1314,"🔍":1223,"🔎":1224,"❤️":186,"😵":1409,"💛":1105,"💚":1104,"💙":1103,"💜":1106,"💔":1098,"❣️":185,"😲":1412,"💕":1099,"💞":1108,"💓":1097,"💗":1101,"💖":1100,"💘":1102,"💝":1107,"💟":1109,"👧":935,"✝️":172,"🤐":1591,"💇":1076,"🕉":1272,"😷":1414,"✡️":173,"💪":1120,"🔯":1257,"🕎":1277,"☯️":75,"🤒":1593,"🤕":1596,"🛐":1579,"👨":941,"♈️":79,"💆":1070,"♉️":80,"😴":1411,"♊️":81,"💤":1114,"♋️":82,"💩":1119,"♌️":83,"🙏":1473,"♍️":84,"😈":1367,"♎️":85,"💑":1093,"♏️":86,"👩":947,"♐️":87,"👿":1043,"♑️":88,"👹":1032,"♒️":89,"👺":1033,"♓️":90,"💏":1089,"🆔":216,"💀":1044,"🈳":475,"🈹":481,"☝️":63,"👱":984,"📴":1199,"📳":1198,"🈶":478,"👻":1034,"🈚":472,"👪":953,"🈸":480,"🈺":482,"👽":1041,"🈷":479,"✴️":176,"🤖":1597,"🆚":222,"🉑":484,"💮":1129,"🉐":483,"㊙️":205,"😺":1417,"㊗️":204,"😸":1415,"🈴":476,"🈵":477,"🈲":474,"👴":1002,"🅰":208,"😹":1416,"🅱":209,"🆎":212,"🆑":213,"😻":1418,"🅾":210,"🆘":220,"⛔️":121,"😼":1419,"📛":1174,"🚫":1527,"😽":1420,"⭕️":201,"🙀":1423,"💢":1112,"♨️":95,"👵":1008,"🚷":1554,"🚯":1531,"🚳":1535,"🚱":1533,"🔞":1240,"📵":1200,"❗️":184,"😿":1422,"😾":1421,"👆":842,"🙌":1455,"‼️":15,"😀":1359,"⁉️":16,"👲":990,"💯":1130,"🔅":1215,"🔆":1216,"🔱":1259,"😁":1360,"〽️":203,"😂":1361,"⚠️":106,"😃":1362,"🚸":1555,"🔰":1258,"♻️":96,"😄":1363,"👏":896,"🈯":473,"👳":996,"💹":1140,"❇️":178,"😅":1364,"✳️":175,"😆":1365,"😇":1366,"👇":848,"💠":1110,"🌀":485,"😉":1368,"🌐":501,"Ⓜ️":44,"👚":917,"🏧":739,"👕":912,"🈂":471,"🛂":1570,"🛃":1571,"🛄":1572,"🛅":1573,"♿️":97,"👖":913,"🚭":1529,"🚾":1561,"👔":911,"🅿":211,"👗":914,"🚰":1532,"🚹":1556,"🚺":1557,"🚼":1559,"🚻":1558,"🚮":1530,"🎦":649,"📶":1201,"🈁":470,"🆖":218,"🆗":219,"🆙":221,"🆒":214,"🆕":217,"🆓":215,"👙":916,"0⃣":3,"👘":915,"1⃣":4,"💄":1063,"2⃣":5,"💋":1085,"3⃣":6,"👣":926,"4⃣":7,"👠":923,"5⃣":8,"👡":924,"6⃣":9,"👢":925,"7⃣":10,"👞":921,"8⃣":11,"👟":922,"9⃣":12,"🔟":1241,"🔢":1244,"▶️":47,"👒":909,"🎩":652,"🎓":635,"👑":908,"👮":971,"🎒":634,"👝":920,"👛":918,"👜":919,"🔀":1210,"🔁":1211,"🔂":1212,"◀️":48,"💼":1143,"🔼":1270,"🔽":1271,"👓":910,"🕶":1307,"➡️":190,"💍":1087,"⬅️":195,"🌂":487,"⬆️":196,"🐶":815,"⬇️":197,"🐱":810,"↗️":22,"🐭":806,"↘️":23,"🐹":818,"↙️":24,"🐰":809,"↖️":21,"🐻":820,"↕️":20,"🐼":821,"↔️":19,"🐨":801,"🔄":1214,"↪️":26,"🐯":808,"↩️":25,"🦁":1606,"⤴️":193,"🐮":807,"⤵️":194,"🐷":816,"🐽":822,"#⃣":1,"🐸":817,"*⃣":2,"ℹ️":18,"🐙":786,"🔤":1246,"🔡":1243,"🔠":1242,"🔣":1245,"🎵":664,"🎶":665,"〰️":202,"🐵":814,"🙈":1446,"✔️":170,"🙉":1447,"🔃":1213,"🙊":1448,"🐒":779,"🐔":781,"✖️":171,"🐧":800,"💲":1133,"💱":1132,"©️":13,"🐦":799,"®️":14,"🐤":797,"™️":17,"🐣":796,"🔚":1236,"🔙":1235,"🔛":1237,"🔝":1239,"🔜":1238,"☑️":59,"🐥":798,"🔘":1234,"⚪️":108,"🐺":819,"⚫️":109,"🐗":784,"🔴":1262,"🔵":1263,"🔸":1266,"🔹":1267,"🔶":1264,"🔷":1265,"🔺":1268,"▪️":45,"🐴":813,"▫️":46,"🦄":1609,"⬛️":198,"🐝":790,"⬜️":199,"🐛":788,"🔻":1269,"◼️":50,"🐌":773,"◻️":49,"🐞":791,"◾️":52,"🐜":789,"◽️":51,"🕷":1308,"🔲":1260,"🔳":1261,"🔈":1218,"🔉":1219,"🔊":1220,"🔇":1217,"📣":1182,"📢":1181,"🔔":1230,"🔕":1231,"🃏":207,"🦂":1607,"🀄":206,"🦀":1605,"♠️":91,"🐍":774,"♣️":92,"🐢":795,"♥️":93,"🐠":793,"♦️":94,"🐟":792,"🎴":663,"🐡":794,"🐬":805,"💭":1128,"🗯":1351,"💬":1127,"🕐":1278,"🕑":1279,"🕒":1280,"🕓":1281,"🕔":1282,"🕕":1283,"🕖":1284,"🕗":1285,"🕘":1286,"🕙":1287,"🕚":1288,"🕛":1289,"🕜":1290,"🕝":1291,"🕞":1292,"🕟":1293,"🕠":1294,"🕡":1295,"🕢":1296,"🕣":1297,"🕤":1298,"🕥":1299,"🕦":1300,"🕧":1301,"🐳":812,"🐋":772,"🐊":771,"🐆":767,"🐅":766,"🐃":764,"🐂":763,"🐄":765,"🐪":803,"🐫":804,"🐘":785,"🐐":777,"🐏":776,"🐑":778,"🐎":775,"🐖":783,"🐀":761,"🐁":762,"🐓":780,"🦃":1608,"🕊":1273,"🐕":782,"🐩":802,"🐈":769,"🐇":768,"🐿":824,"🐾":823,"🐉":770,"🐲":811,"🌵":536,"🎄":615,"🌲":533,"🌳":534,"🌴":535,"🌱":532,"🌿":546,"😊":1369,"🍀":547,"🎍":629,"🎋":627,"🍃":550,"🍂":549,"🍁":548,"🌾":545,"🌺":541,"🌻":542,"🌹":540,"🌷":538,"🌼":543,"🌸":539,"💐":1092,"🍄":551,"🌰":531,"🎃":614,"🐚":787,"🕸":1309,"🌎":499,"🌍":498,"🌏":500,"🌕":506,"🌖":507,"🌗":508,"🌘":509,"🌑":502,"🌒":503,"🌓":504,"🌔":505,"🌚":511,"🌝":514,"🌛":512,"🌜":513,"🌞":515,"🌙":510,"⭐️":200,"👋":872,"🙂":1425,"🌟":516,"💫":1126,"🙃":1426,"👈":854,"☀️":53,"👷":1020,"☺️":78,"🌤":519,"⛅️":115,"🏿":760,"😋":1370,"🌥":520,"🌦":521,"🗨":1350,"♦":94,"♣":92,"♠":91,"◽":51,"◾":52,"◻":49,"◼":50,"⬜":199,"⬛":198,"▫":46,"▪":45,"⚫":109,"⚪":108,"☑":59,"™":17,"®":14,"©":13,"✖":171,"➗":189,"➖":188,"➕":187,"✔":170,"➰":191,"〰":202,"ℹ":18,"⤵":194,"⤴":193,"↩":25,"↪":26,"↔":19,"↕":20,"↖":21,"↙":24,"↘":23,"↗":22,"⬇":197,"⬆":196,"⬅":195,"➡":190,"⏬":33,"⏫":32,"◀":48,"⏪":31,"⏩":30,"⏮":35,"⏭":34,"⏺":43,"⏹":42,"⏯":36,"⏸":41,"▶":47,"♿":97,"Ⓜ":44,"➿":192,"✅":141,"❎":180,"✳":175,"❇":178,"♻":96,"⚠":106,"〽":203,"⚜":105,"⁉":16,"‼":15,"❔":182,"❓":181,"❕":183,"❗":184,"♨":95,"⭕":201,"❌":179,"⛔":121,"㊗":204,"㊙":205,"✴":176,"☣":71,"☢":70,"⚛":104,"♓":90,"♒":89,"♑":88,"♥":93,"♏":86,"♎":85,"♍":84,"♌":83,"♋":82,"♊":81,"♉":80,"♈":79,"⛎":117,"☦":72,"☯":75,"✡":173,"☸":76,"☪":73,"✝":172,"☮":74,"❣":185,"❤":186,"✏":168,"✒":169,"✂":140,"✉":143,"⛱":125,"⚗":102,"⚱":111,"⚰":110,"☠":69,"⚔":100,"⛓":120,"⚙":103,"⛏":118,"⚒":98,"⚖":101,"⌛":28,"⏳":40,"⏰":37,"⏲":39,"⏱":38,"☎":58,"⌨":29,"⌚":27,"⛩":122,"⛪":123,"⛺":138,"⛰":124,"⛲":126,"⛽":139,"⚓":99,"⛴":128,"⛵":129,"✈":142,"⛹":132,"⛸":131,"⛷":130,"⛳":127,"⚾":113,"⚽":112,"☕":61,"☔":60,"☂":55,"⛄":114,"☃":56,"❄":177,"⚡":107,"⛈":116,"☁":54,"⛅":115,"☀":53,"☄":57,"✨":174,"⭐":200,"☘":62,"⛑":119,"✍":162,"☝":63,"✋":150,"✌":156,"✊":144,"☹":77,"☺":78,"♐":87},c=[];for(var d in b)c.push(a(d));var e=new RegExp("("+c.join("|")+")","g");c=null;var f=function(a,c){return a.replace(e,function(a,d){var e='<img src="images/blank.gif" alt="'+d+'" data-unicode="'+d+'" class="em emj'+b[d]+'">';return c&&(e='<div class="em_wrap j-em_wrap">'+e+"</div>"),e})};window.minEmoji=f}(),define("minEmoji",function(a){return function(){var b;return b||a.minEmoji}}(this)),function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a);
};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&b<=y};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;if(d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&d!==-1)return a[d]},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)d=a[h],d<f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);g<h;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);d<e;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;g<c&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;d<b;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a||(A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length)},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}.call(this),function(a,b){"use strict";"function"==typeof define&&define.amd?define("QBNotification",[],function(){return b(a)}):"undefined"!=typeof module&&module.exports?module.exports=b(a):a.QBNotification=b(a)}("undefined"!=typeof window?window:this,function(a){function b(a){return"function"==typeof a}function c(a,d){var f=this;if(!c.isSupported())throw new Error(e.no_support);if("string"!=typeof a||""===a.trim())throw new Error(e.title);if(this.title=a,this.callbacks={},this.options={dir:"auto",lang:"en",body:"",tag:"",icon:"",requireInteraction:!1,timeout:5,closeOnClick:!1},"object"==typeof d){for(var g in d)d.hasOwnProperty(g)&&(this.options[g]=d[g]);b(this.options.onClick)&&(this.callbacks.onclick=function(a){f.options.onClick(a),f.options.closeOnClick&&f.close()}),b(this.options.onError)&&(this.callbacks.onerror=this.options.onError),b(this.options.onClose)&&(this.callbacks.onclose=this.options.onClose),b(this.options.onShow)&&(this.callbacks.onshow=this.options.onShow)}}var d=a.Notification||a.navigator.webkitNotifications,e={title:"QBNotification(): first arg (title) must be not empty string.",no_support:"This browser don't support Notification",no_access:"Before you need to get permission to display notification by QBNotification.requestPermission()",timeout:"Timeout must be integer"};return c.isSupported=function(){return!(!d||!d.requestPermission)},c.needsPermission=function(){return!d||!d.permission||"granted"!==d.permission},c.requestPermission=function(a){if(!c.isSupported())throw new Error(e.no_support);d.requestPermission(function(c){b(a)&&a(c)})},c.prototype.show=function(){var a=this;if(c.needsPermission())return void console.warn("QBNotification says: "+e.no_access);a.notify=new d(this.title,{body:this.options.body,tag:this.options.tag,icon:this.options.icon,lang:this.options.lang,requireInteraction:this.options.requireInteraction});for(var b in a.callbacks)a.callbacks.hasOwnProperty(b)&&(a.notify[b]=a.callbacks[b]);a.options.requireInteraction||!a.options.timeout||isNaN(+a.options.timeout)||setTimeout(a.close.bind(this),1e3*a.options.timeout)},c.prototype.close=function(){this.notify.close()},c}),define("Helpers",["jquery","quickblox","config","QBNotification"],function(a,b,c,d){var e={};return e.Notifications={show:function(a,b){if(a&&b){var c=new d(a,b);c.show()}},getTitle:function(a,b){var c,d=b.contacts,e=b.roomName,f=(b.roomPhoto,d[a.sender_id]);return c=e||f.full_name},getOptions:function(b,d){var f,g,h,i=d.user,j=d.contacts,k=(d.roomName,d.roomPhoto),l=j[b.sender_id],m=b.type,n="chat"===m?l.avatar_url||c.defAvatar.url_png:k||c.defAvatar.group_url_png,o=b.notification_type||b.callState&&(parseInt(b.callState)+7).toString()||"message",p=a('.dialog-item[data-dialog="'+b.dialog_id+'"] .contact'),q="";switch("images/ava-single.svg"===n&&(n=c.defAvatar.url_png),o){case"1":f=_.without(b.current_occupant_ids.split(",").map(Number),l.id),q=e.Messages.getOccupantsNames(f,i,j),h=l.full_name+" has added "+q+" to the group chat";break;case"2":h="Notification message";break;case"4":h=l.full_name+" has sent a request to you";break;case"5":h="Your request has been accepted by "+l.full_name;break;case"6":h="Your request has been rejected by "+l.full_name;break;case"7":h="You have been deleted from the contact list by "+l.full_name;break;case"8":h=b.caller===i.contact.id?"Call to "+j[b.callee].full_name+", duration "+e.getDuration(b.callDuration):"Call from "+j[b.caller].full_name+", duration "+e.getDuration(b.callDuration);break;case"9":h=b.caller===i.contact.id?"Call to "+j[b.callee].full_name+", no answer":"Missed call from "+j[b.caller].full_name;break;case"10":h=b.caller===i.contact.id?j[b.callee].full_name+" doesn't have camera and/or microphone.":"Camera and/or microphone wasn't found.";break;case"11":h="Incomming "+b.callType+" Call from "+l.full_name;break;case"12":h="The "+b.callType+" Call accepted by "+l.full_name;break;default:h="groupchat"===m?l.full_name+": "+b.body:b.body}return h&&(h=h.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&"),g={body:h,icon:n,tag:b.dialog_id,onClick:function(){window.focus(),p.click()},timeout:c.notification.timeout,closeOnClick:!0}),g}},e.Messages={getOccupantsNames:function(a,b,c){for(var d,e="",f=b.contact,g=0,h=a.length;g<h;g++)d=c[a[g]]&&c[a[g]].full_name,d?e=g+1===h?e.concat(d):e.concat(d).concat(", "):a[g]===f.id&&(e=g+1===h?e.concat(f.full_name):e.concat(f.full_name).concat(", "));return e},parser:function(a){function b(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var c,d,e=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return a=b(a),a=a.replace(/\n/g,"<br>"),a=a.replace(e,function(a){return c=/^[a-z]+:/i.test(a)?a:"http://"+a,d=a,'<a href="'+b(c)+'" target="_blank">'+b(d)+"</a>"})}},e.Dialogs={moveDialogToTop:function(b){var c=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+b+'"]');c.length>0&&(copyDialogItem=c.clone(),c.remove(),a(".j-recentList").prepend(copyDialogItem),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),this.isSectionEmpty(a("#recentList ul.j-list"))))},isSectionEmpty:function(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul.j-list").contents().length&&a("#historyList ul.j-list").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")},setScrollToNewMessages:function(){var b=a(".j-chatItem .j-scrollbar_message");a(".j-newMessages").length&&b.mCustomScrollbar("scrollTo",".j-newMessages")}},e.log=function(){if(c.debug)if(arguments.length<=1)console.group("[Q-MUNICATE debug mode]:"),console.log(arguments[0]),console.groupEnd();else{console.group("[Q-MUNICATE debug mode]:");for(var a=0;a<arguments.length;a++)"string"==typeof arguments[a]&&"string"!=typeof arguments[a+1]?(console.log(arguments[a],arguments[a+1]),a+=1):console.log(arguments[a]);console.groupEnd()}},e.isBeginOfChat=function(){if(!document.querySelector(".j-chatItem"))return null;var a,b=document.querySelector(".j-scrollbar_message"),c=document.querySelector(".j-scrollbar_message .mCSB_container"),d=b.clientHeight,e=c.offsetTop,f=c.clientHeight,g=e+f;return e<0&&(a=!1,d+350>g&&(a=!0)),a},e.getDuration=function(a,b){return b?Date.parse("Thu, 01 Jan 1970 "+b+" GMT")/1e3:new Date(1e3*a).toUTCString().split(/ /)[4]},e.getTime=function(b,c){var d=new Date(1e3*b),e=new Date;return e.setHours(0,0,0,0),d>e?d.getHours()+":"+(1===d.getMinutes().toString().length?"0"+d.getMinutes():d.getMinutes()):d.getFullYear()!==e.getFullYear()||c?d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear():a.timeago(d)},e.scaleAvatar=function(b){var c,d=b.parents(".l-chat"),e=b.data("name"),f=b.css("background-image").replace(/.*\s?url\([\'\"]?/,"").replace(/[\'\"]?\).*/,""),g=a(".j-popupAvatar");d.is(".is-group")?(c=d.data("dialog"),g.find(".j-changePic").removeClass("is-hidden").data("dialog",c)):g.find(".j-changePic").addClass("is-hidden"),g.find(".j-avatarPic").attr("src",f),g.find(".j-avatarName").text(e),g.add(".popups").addClass("is-overlay")},e.getOpenGraphInfo=function(b,c){a.ajax({url:"https://ogs.quickblox.com/?url="+b,error:function(a,b,d){c(d,null)},success:function(a,b,d){c(null,a)}})},e.isValidUrl=function(a){var b=/^(?:([a-z]+):(?:([a-z]*):)?\/\/)?(?:([^:@]*)(?::([^:@]*))?@)?((?:[a-z0-9_-]+\.)+[a-z]{2,}|localhost|(?:(?:[01]?\d\d?|2[0-4]\d|25[0-5])\.){3}(?:(?:[01]?\d\d?|2[0-4]\d|25[0-5])))(?::(\d+))?(?:([^:\?\#]+))?(?:\?([^\#]+))?(?:\#([^\s]+))?$/i;return b.test(a)},e}),function(a){var b="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(c,d,e){b.Backbone=a(b,e,c,d)});else if("undefined"!=typeof exports){var c,d=require("underscore");try{c=require("jquery")}catch(e){}a(b,exports,d,c)}else b.Backbone=a(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$)}(function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice;b.VERSION="1.3.3",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var g=function(a,b,d){switch(a){case 1:return function(){return c[b](this[d])};case 2:return function(a){return c[b](this[d],a)};case 3:return function(a,e){return c[b](this[d],i(a,this),e)};case 4:return function(a,e,f){return c[b](this[d],i(a,this),e,f)};default:return function(){var a=f.call(arguments);return a.unshift(this[d]),c[b].apply(c,a)}}},h=function(a,b,d){c.each(b,function(b,e){c[e]&&(a.prototype[e]=g(b,e,d))})},i=function(a,b){return c.isFunction(a)?a:c.isObject(a)&&!b._isModel(a)?j(a):c.isString(a)?function(b){return b.get(a)}:a},j=function(a){var b=c.matches(a);return function(a){return b(a.attributes)}},k=b.Events={},l=/\s+/,m=function(a,b,d,e,f){var g,h=0;if(d&&"object"==typeof d){void 0!==e&&"context"in f&&void 0===f.context&&(f.context=e);for(g=c.keys(d);h<g.length;h++)b=m(a,b,g[h],d[g[h]],f)}else if(d&&l.test(d))for(g=d.split(l);h<g.length;h++)b=a(b,g[h],e,f);else b=a(b,d,e,f);return b};k.on=function(a,b,c){return n(this,a,b,c)};var n=function(a,b,c,d,e){if(a._events=m(o,a._events||{},b,c,{context:d,ctx:a,listening:e}),e){var f=a._listeners||(a._listeners={});f[e.id]=e}return a};k.listenTo=function(a,b,d){if(!a)return this;var e=a._listenId||(a._listenId=c.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),g=f[e];if(!g){var h=this._listenId||(this._listenId=c.uniqueId("l"));g=f[e]={obj:a,objId:e,id:h,listeningTo:f,count:0}}return n(a,b,d,this,g),this};var o=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a};k.off=function(a,b,c){return this._events?(this._events=m(p,this._events,a,b,{context:c,listeners:this._listeners}),this):this},k.stopListening=function(a,b,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:c.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(b,d,this)}return this};var p=function(a,b,d,e){if(a){var f,g=0,h=e.context,i=e.listeners;if(b||d||h){for(var j=b?[b]:c.keys(a);g<j.length;g++){b=j[g];var k=a[b];if(!k)break;for(var l=[],m=0;m<k.length;m++){var n=k[m];d&&d!==n.callback&&d!==n.callback._callback||h&&h!==n.context?l.push(n):(f=n.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}l.length?a[b]=l:delete a[b]}return a}for(var o=c.keys(i);g<o.length;g++)f=i[o[g]],delete i[f.id],delete f.listeningTo[f.objId]}};k.once=function(a,b,d){var e=m(q,{},a,b,c.bind(this.off,this));return"string"==typeof a&&null==d&&(b=void 0),this.on(e,b,d)},k.listenToOnce=function(a,b,d){var e=m(q,{},b,d,c.bind(this.stopListening,this,a));return this.listenTo(a,e)};var q=function(a,b,d,e){if(d){var f=a[b]=c.once(function(){e(b,f),d.apply(this,arguments)});f._callback=d}return a};k.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;d<b;d++)c[d]=arguments[d+1];return m(r,this._events,a,void 0,c),this};var r=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&s(e,d),f&&s(f,[b].concat(d))}return a},s=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};k.bind=k.on,k.unbind=k.off,c.extend(b,k);var t=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId(this.cidPrefix),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{});var e=c.result(this,"defaults");d=c.defaults(c.extend({},e,d),e),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(t.prototype,k,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},matches:function(a){return!!c.iteratee(a,this)(this.attributes)},set:function(a,b,d){if(null==a)return this;var e;if("object"==typeof a?(e=a,d=b):(e={})[a]=b,d||(d={}),!this._validate(e,d))return!1;var f=d.unset,g=d.silent,h=[],i=this._changing;this._changing=!0,i||(this._previousAttributes=c.clone(this.attributes),this.changed={});var j=this.attributes,k=this.changed,l=this._previousAttributes;for(var m in e)b=e[m],c.isEqual(j[m],b)||h.push(m),c.isEqual(l[m],b)?delete k[m]:k[m]=b,f?delete j[m]:j[m]=b;if(this.idAttribute in e&&(this.id=this.get(this.idAttribute)),!g){h.length&&(this._pending=d);for(var n=0;n<h.length;n++)this.trigger("change:"+h[n],this,j[h[n]],d)}if(i)return this;if(!g)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return!!this.hasChanged()&&c.clone(this.changed);var b=this._changing?this._previousAttributes:this.attributes,d={};for(var e in a){var f=a[e];c.isEqual(b[e],f)||(d[e]=f)}return!!c.size(d)&&d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=c.extend({parse:!0},a);var b=this,d=a.success;return a.success=function(c){var e=a.parse?b.parse(c,a):c;return!!b.set(e,a)&&(d&&d.call(a.context,b,c,a),void b.trigger("sync",b,c,a))},P(this,a),this.sync("read",this,a)},save:function(a,b,d){var e;null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0,parse:!0},d);var f=d.wait;if(e&&!f){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;var g=this,h=d.success,i=this.attributes;d.success=function(a){g.attributes=i;var b=d.parse?g.parse(a,d):a;return f&&(b=c.extend({},e,b)),!(b&&!g.set(b,d))&&(h&&h.call(d.context,g,a,d),void g.trigger("sync",g,a,d))},P(this,d),e&&f&&(this.attributes=c.extend({},i,e));var j=this.isNew()?"create":d.patch?"patch":"update";"patch"!==j||d.attrs||(d.attrs=e);var k=this.sync(j,this,d);return this.attributes=i,k},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=a.wait,f=function(){b.stopListening(),b.trigger("destroy",b,b.collection,a)};a.success=function(c){e&&f(),d&&d.call(a.context,b,c,a),b.isNew()||b.trigger("sync",b,c,a)};var g=!1;return this.isNew()?c.defer(a.success):(P(this,a),g=this.sync("delete",this,a)),e||f(),g},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||O();if(this.isNew())return a;var b=this.get(this.idAttribute);return a.replace(/[^\/]$/,"$&/")+encodeURIComponent(b)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend({},a,{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return!d||(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1)}});var u={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};h(t,u,"attributes");var v=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},w={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},y=function(a,b,c){c=Math.min(Math.max(c,0),a.length);var d,e=Array(a.length-c),f=b.length;for(d=0;d<e.length;d++)e[d]=a[d+c];for(d=0;d<f;d++)a[d+c]=b[d];for(d=0;d<e.length;d++)a[d+f+c]=e[d]};c.extend(v.prototype,k,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,x))},remove:function(a,b){b=c.extend({},b);var d=!c.isArray(a);a=d?[a]:a.slice();var e=this._removeModels(a,b);return!b.silent&&e.length&&(b.changes={added:[],merged:[],removed:e},this.trigger("update",this,b)),d?e[0]:e},set:function(a,b){if(null!=a){b=c.extend({},w,b),b.parse&&!this._isModel(a)&&(a=this.parse(a,b)||[]);var d=!c.isArray(a);a=d?[a]:a.slice();var e=b.at;null!=e&&(e=+e),e>this.length&&(e=this.length),e<0&&(e+=this.length+1);var f,g,h=[],i=[],j=[],k=[],l={},m=b.add,n=b.merge,o=b.remove,p=!1,q=this.comparator&&null==e&&b.sort!==!1,r=c.isString(this.comparator)?this.comparator:null;for(g=0;g<a.length;g++){f=a[g];var s=this.get(f);if(s){if(n&&f!==s){var t=this._isModel(f)?f.attributes:f;b.parse&&(t=s.parse(t,b)),s.set(t,b),j.push(s),q&&!p&&(p=s.hasChanged(r))}l[s.cid]||(l[s.cid]=!0,h.push(s)),a[g]=s}else m&&(f=a[g]=this._prepareModel(f,b),f&&(i.push(f),this._addReference(f,b),l[f.cid]=!0,h.push(f)))}if(o){for(g=0;g<this.length;g++)f=this.models[g],l[f.cid]||k.push(f);k.length&&this._removeModels(k,b)}var u=!1,v=!q&&m&&o;if(h.length&&v?(u=this.length!==h.length||c.some(this.models,function(a,b){
return a!==h[b]}),this.models.length=0,y(this.models,h,0),this.length=this.models.length):i.length&&(q&&(p=!0),y(this.models,i,null==e?this.length:e),this.length=this.models.length),p&&this.sort({silent:!0}),!b.silent){for(g=0;g<i.length;g++)null!=e&&(b.index=e+g),f=i[g],f.trigger("add",f,this,b);(p||u)&&this.trigger("sort",this,b),(i.length||k.length||j.length)&&(b.changes={added:i,removed:k,merged:j},this.trigger("update",this,b))}return d?a[0]:a}},reset:function(a,b){b=b?c.clone(b):{};for(var d=0;d<this.models.length;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a)},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a)},slice:function(){return f.apply(this.models,arguments)},get:function(a){if(null!=a)return this._byId[a]||this._byId[this.modelId(a.attributes||a)]||a.cid&&this._byId[a.cid]},has:function(a){return null!=this.get(a)},at:function(a){return a<0&&(a+=this.length),this.models[a]},where:function(a,b){return this[b?"find":"filter"](a)},findWhere:function(a){return this.where(a,!0)},sort:function(a){var b=this.comparator;if(!b)throw new Error("Cannot sort a set without a comparator");a||(a={});var d=b.length;return c.isFunction(b)&&(b=c.bind(b,this)),1===d||c.isString(b)?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return this.map(a+"")},fetch:function(a){a=c.extend({parse:!0},a);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b.call(a.context,d,c,a),d.trigger("sync",d,c,a)},P(this,a),this.sync("read",this,a)},create:function(a,b){b=b?c.clone(b):{};var d=b.wait;if(a=this._prepareModel(a,b),!a)return!1;d||this.add(a,b);var e=this,f=b.success;return b.success=function(a,b,c){d&&e.add(a,c),f&&f.call(c.context,a,b,c)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_removeModels:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.get(a[d]);if(e){var f=this.indexOf(e);this.models.splice(f,1),this.length--,delete this._byId[e.cid];var g=this.modelId(e.attributes);null!=g&&delete this._byId[g],b.silent||(b.index=f,e.trigger("remove",e,this,b)),c.push(e),this._removeReference(e,b)}}return c},_isModel:function(a){return a instanceof t},_addReference:function(a,b){this._byId[a.cid]=a;var c=this.modelId(a.attributes);null!=c&&(this._byId[c]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){delete this._byId[a.cid];var c=this.modelId(a.attributes);null!=c&&delete this._byId[c],this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(b){if(("add"===a||"remove"===a)&&c!==this)return;if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}}this.trigger.apply(this,arguments)}});var z={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};h(v,z,"models");var A=b.View=function(a){this.cid=c.uniqueId("view"),c.extend(this,c.pick(a,C)),this._ensureElement(),this.initialize.apply(this,arguments)},B=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];c.extend(A.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(a||(a=c.result(this,"events")),!a)return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[d]),d){var e=b.match(B);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=D[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||O()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){if(a.setRequestHeader("X-HTTP-Method-Override",f),h)return h.apply(this,arguments)}}"GET"===g.type||e.emulateJSON||(g.processData=!1);var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.call(e.context,a,b,c)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var D={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var E=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,H=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(E.prototype,k,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b,c){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(I,"\\$&").replace(F,"(?:$1)?").replace(G,function(a,b){return b?a:"([^/?]+)"}).replace(H,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var J=b.History=function(){this.handlers=[],this.checkUrl=c.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},K=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,M=/#.*$/;J.started=!1,c.extend(J.prototype,k,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var a=this.decodeFragment(this.location.pathname),b=a.slice(0,this.root.length-1)+"/";return b===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===a.charAt(0)?a.slice(1):a},getFragment:function(a){return null==a&&(a=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(K,"")},start:function(a){if(J.started)throw new Error("Backbone.history has already been started");if(J.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(L,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var b=this.root.slice(0,-1)||"/";return this.location.replace(b+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var d=document.body,e=d.insertBefore(this.iframe,d.firstChild).contentWindow;e.document.open(),e.document.close(),e.location.hash="#"+this.fragment}var f=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};if(this._usePushState?f("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?f("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._usePushState?a("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),J.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getHash(this.iframe.contentWindow)),b!==this.fragment&&(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return!!this.matchRoot()&&(a=this.fragment=this.getFragment(a),c.some(this.handlers,function(b){if(b.route.test(a))return b.callback(a),!0}))},navigate:function(a,b){if(!J.started)return!1;b&&b!==!0||(b={trigger:!!b}),a=this.getFragment(a||"");var c=this.root;""!==a&&"?"!==a.charAt(0)||(c=c.slice(0,-1)||"/");var d=c+a;if(a=this.decodeFragment(a.replace(M,"")),this.fragment!==a){if(this.fragment=a,this._usePushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);if(this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe.contentWindow)){var e=this.iframe.contentWindow;b.replace||(e.document.open(),e.document.close()),this._updateHash(e.location,a,b.replace)}}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new J;var N=function(a,b){var d,e=this;return d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b),d.prototype=c.create(e.prototype,a),d.prototype.constructor=d,d.__super__=e.prototype,d};t.extend=v.extend=E.extend=A.extend=J.extend=N;var O=function(){throw new Error('A "url" property or function must be specified')},P=function(a,b){var c=b.error;b.error=function(d){c&&c.call(b.context,a,d,b),a.trigger("error",a,d,b)}};return b}),define("models/person",["jquery","underscore","quickblox","backbone","config","Helpers"],function(a,b,c,d,e,f){var g,h=d.Model.extend({defaults:{full_name:null,email:null,password:"",phone:"",facebook_id:null,twitter_digits_id:null,avatar:null,avatar_url:e.defAvatar.url,status:"",user_tags:null},validate:function(a){var b=1024*e.maxLimitFile*1024;JSON.stringify(this.previousAttributes()),JSON.stringify(a);if(!a.full_name)return"Name is required";if("Unknown user"===a.full_name)return'Your name is "Unknown user", please change';if(a.full_name.length<3)return e.errors.shortName;if(!/^[^><;]+$/.test(a.full_name))return e.errors.invalidName;if(a.password){if(!/^[A-Za-z0-9`~!@#%&=_<>;:,'\"\.\$\^\*\-\+\\\/\|\(\)\[\]\{\}\?]+$/.test(a.password))return e.errors.invalidPass;if(a.password.length<8)return e.errors.shortPass}if(a.phone&&!/^[-0-9()+*#]+$/.test(a.phone))return e.errors.invalidPhone;if(a.avatar){if(!/^image.{0,}$/.test(a.avatar.type))return e.errors.avatarType;if(a.avatar.size>b)return e.errors.fileSize;if(a.avatar.name.length>100)return e.errors.fileName}},parse:function(a,c){return"object"==typeof c&&(g=c.app),b.each(a,function(c,d){var e=b.has(this.defaults,d);"id"===d||e?"string"==typeof c&&(a[d]=c.trim()):delete a[d]},this),a},initialize:function(){},update:function(){var b=g.models.User.contact,d=g.service,e=this.toJSON(),h={},i=b.custom_data&&JSON.parse(b.custom_data)||{},j=this;0===Object.keys(e).length||1===Object.keys(e).length&&"avatar"===Object.keys(e)[0]&&!e.avatar||(e.full_name&&(h.full_name=b.full_name=e.full_name),e.phone&&(h.phone=b.phone=e.phone),e.status.length>=0&&(i.status=b.status=e.status,h.custom_data=b.custom_data=JSON.stringify(i)),e.avatar?this.uploadAvatar(e.avatar,function(e){var k=c.content.publicUrl(e.uid);j.set("avatar_url",k),h.blob_id=b.blob_id=e.id,i.avatar_url=b.avatar_url=k,h.custom_data=b.custom_data=JSON.stringify(i),a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),a('.profileUserAvatar[data-id="'+b.id+'"]').css("background-image","url("+b.avatar_url+")"),g.models.User.rememberMe(),d.updateUser(b.id,h,function(a){f.log("update of user",a)})}):(a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),g.models.User.rememberMe(),d.updateUser(b.id,h,function(a){f.log("update of user",a)})))},uploadAvatar:function(a,b){var c=g.service,d=g.models.Attach;d.crop(a,{w:1e3,h:1e3},function(a){c.createBlob({file:a,"public":!0},function(a){b(a)})})},changeQBPass:function(a,b){var c=g.models.User.contact,d=g.models.Session,e=g.service,h={},i=this;h.old_password=a.oldPass,h.password=a.newPass,e.updateUser(c.id,h,function(a,e){a?(f.log("update of user",a),d.update({authParams:d.encrypt({email:c.email,password:h.password})},!0),i.set("password",""),b(null,a)):b(e,null)})},connectFB:function(b,c){var d=g.models.User.contact,h=g.service,i=d.custom_data&&JSON.parse(d.custom_data)||{},j={},k=this;k.get("avatar_url")===e.defAvatar.url&&(i.avatar_url="https://graph.facebook.com/v2.7/"+b+"/picture?width=1200&height=1200"),i.is_import="1",j.facebook_id=b,j.custom_data=JSON.stringify(i),h.updateUser(d.id,j,function(h,l){h?(f.log("update of user",h),k.get("avatar_url")===e.defAvatar.url&&(k.set("avatar_url",i.avatar_url),d.avatar_url=i.avatar_url),k.set("facebook_id",b),d.facebook_id=b,d.custom_data=j.custom_data,a('.profileUserAvatar[data-id="'+d.id+'"]').css("background-image","url("+d.avatar_url+")"),g.models.User.rememberMe(),k.getFBFriends(),c(null,h)):c(l,null)})},getFBFriends:function(){var a=!1,b=this;FB.api("/me/permissions",function(c){f.log("FB Permissions",c);for(var d=0,e=c.data.length;d<e;d++)"user_friends"===c.data[d].permission&&"granted"===c.data[d].status&&(a=!0);a&&FB.api("/me/friends",function(a){f.log("FB friends",a);for(var c=[],d=0,e=a.data.length;d<e;d++)c.push(a.data[d].id);c.length>0&&b["import"](c)})})},"import":function(a){var b=g.models.ContactList,c=g.views.ContactList,d=g.views.FBImport;b.getFBFriends(a,function(a){for(var b=0,e=a.length;b<e;b++)c.importFBFriend(a[b]);d.render().openPopup()})}});return h}),define("views/profile",["jquery","underscore","backbone","config","Helpers"],function(a,b,c,d,e){var f=c.View.extend({className:"profileWrap",template:b.template(a("#templateProfile").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{"click .userProfile-field_phone":"editPhone",click:"editProfile","change .btn_userProfile_file":"chooseAvatar"},render:function(){var b,c=this,d=c.model.toJSON();return d.phone&&"Unknown user"===d.full_name&&(d.full_name=d.phone),b=c.$el.html(c.template(d)),a(".popups").append(b),c.delegateEvents(c.events),c},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay")},closePopup:function(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")},editPhone:function(){this.$el.find(".userProfile-phone").focus()},editProfile:function(b){var c,d,f=a(b.target);f.is("."+this.className)&&(c=this.$el.find(".userProfile-errors").text().trim(),c&&(this.remove(),this.closePopup()),d={full_name:this.$el.find(".userProfile-filename").val().trim(),phone:this.$el.find(".userProfile-phone").val().trim(),status:this.$el.find(".userProfile-status-field").val().trim(),avatar:this.$el.find(".btn_userProfile_file")[0].files[0]||null},this.model.set(d,{validate:!0}),this.model.validationError||(this.model.update(),this.remove(),this.closePopup()),e.log(this.model))},validateError:function(a,b){this.$el.find(".userProfile-errors").text(b),this.$el.find(".userProfile-success").text("")},chooseAvatar:function(){var a=window.URL,b=this.$el.find(".btn_userProfile_file")[0].files[0],c=b?a.createObjectURL(b):this.model.get("avatar_url")===d.defAvatar.url?d.defAvatar.url:this.model.get("avatar_url");this.$el.find(".userDetails-avatar").css("background-image","url("+c+")")},addFBAccount:function(a){var b=this;this.model.connectFB(a,function(a,c){a?(b.validateError(b.model,d.errors.FBAccountExists),b.$el.find(".btn_userProfile_connect").prop("disabled",!1)):(b.$el.find(".userProfile-field-facebook").html('<span class="userDetails-label">Facebook:</span><span class="userProfile-facebook">Connected</span>'),b.$el.find(".userProfile-errors, .userProfile-success").text(""))})}});return f}),define("views/change_password",["jquery","underscore","backbone","config","Helpers"],function(a,b,c,d,e){var f=c.View.extend({className:"passWrap",template:b.template(a("#templateChangePass").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{click:"cancelChange"},render:function(){var b=this.$el.html(this.template(this.model.toJSON()));return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay")},validateError:function(a,b){"Fields mustn't be empty"!==b&&b!==d.errors.oldPass&&b!==d.errors.invalidPass&&b!==d.errors.shortPass||(a.set("password",""),this.remove(),this.render().openPopup(),this.$el.find(".changePass-errors").text(b))},cancelChange:function(b){var c=a(b.target);c.is("."+this.className)&&(this.remove(),a(".profileWrap .userProfile-errors, .profileWrap .userProfile-success").text(""),a(".profileWrap").show())},submitForm:function(){this.$el.find(".btn_popup_changepass").hide(),this.createDataSpinner(),this.changePass()},createDataSpinner:function(){var a='<div class="popup-elem spinner_bounce spinner_bounce_changepass">';a+='<div class="spinner_bounce-bounce1"></div>',a+='<div class="spinner_bounce-bounce2"></div>',a+='<div class="spinner_bounce-bounce3"></div>',a+="</div>",this.$el.find(".popup-footer").append(a)},removeDataSpinner:function(){this.$el.find(".spinner_bounce").remove(),this.$el.find(".btn_popup_changepass").show()},changePass:function(){var b=this,c={oldPass:this.$el.find("#old-password").val().trim(),newPass:this.$el.find("#new-password").val().trim()};c.oldPass&&c.newPass?(this.model.set({password:c.newPass},{validate:!0}),e.log(this.model),this.model.validationError||this.model.changeQBPass(c,function(c,e){c?b.validateError(b.model,d.errors.oldPass):(b.remove(),a(".profileWrap .userProfile-errors").text(""),a(".profileWrap .userProfile-success").text("Your password has been successfully changed"),a(".profileWrap").show())})):this.validateError(this.model,"Fields mustn't be empty")}});return f}),define("views/fb_import",["jquery","underscore","backbone"],function(a,b,c){var d=c.View.extend({className:"importWrap",template:b.template(a("#templateFBImport").html()),events:{"click .returnBackToPopup":"returnToPopup"},render:function(){var b=this.$el.html(this.template());return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){a(".passWrap")[0]?a(".passWrap").addClass("tempHide"):a(".profileWrap")[0]?a(".profileWrap").addClass("tempHide"):a(".popup.is-overlay").addClass("tempHide"),a(".tempHide").hide(),this.$el.find(".popup").add(".popups").addClass("is-overlay")},returnToPopup:function(b){b.preventDefault(),this.remove(),a(".tempHide").show(),a(".tempHide").removeClass("tempHide")}});return d}),define("UserModule",["jquery","underscore","config","quickblox","Helpers","digits","models/person","views/profile","views/change_password","views/fb_import"],function(a,b,c,d,e,f,g,h,i,j){function k(a){this.app=a,this._is_import=null,this._remember=!1,this._valid=!1,p=this}function l(b,d){var e,f,g,h,i=1024*c.maxLimitFile*1024,j=b.find("input:checkbox")[0],k=b.find("input:file")[0];return o={},b.find("input:not(:file, :checkbox)").each(function(){return this.value=this.value.trim(),e=this.id.split("-")[1],f=this.placeholder,g=this.value,this.checkValidity()?(d._valid=!0,void(o[e]=g)):(this.validity.valueMissing?h=f+" is required":this.validity.typeMismatch?(this.value="",h=c.errors.invalidEmail):this.validity.patternMismatch&&"Name"===f?h=g.length<3?c.errors.shortName:g.length>50?c.errors.bigName:c.errors.invalidName:!this.validity.patternMismatch||"Password"!==f&&"New password"!==f||(h=g.length<8?c.errors.shortPass:g.length>40?c.errors.bigPass:c.errors.invalidPass),m(d,h),a(this).addClass("is-error").focus(),!1)}),d._valid&&j&&(d._remember=j.checked),d._valid&&k&&k.files[0]&&(k=k.files[0],k.type.indexOf("image/")===-1?(h=c.errors.avatarType,m(d,h)):k.name.length>100?(h=c.errors.fileName,m(d,h)):k.size>i?(h=c.errors.fileSize,m(d,h)):o.blob=k),d._valid}function m(b,c){b._valid=!1,a("section:visible .text_error").addClass("is-error").text(c),a("section:visible input:password").val(""),a("section:visible .chroma-hash label").css("background-color","rgb(255, 255, 255)")}function n(a){var b;try{b=JSON.parse(a.custom_data).is_import||null}catch(c){b=null}return b}var o,p,q;return k.prototype={initProfile:function(){var a=new g(b.clone(p.contact),{app:p.app,parse:!0}),c=new h({model:a}),d=new i({model:a}),e=new j;p.app.views.Profile=c,p.app.views.ChangePass=d,p.app.views.FBImport=e},connectTwitterDigits:function(){return!q&&(q=!0,void f.logIn().done(function(a){q=!1;var b={provider:"twitter_digits",twitter_digits:a.oauth_echo_headers};p.providerConnect(b)}).fail(function(a){q=!1,e.log("Digits failed to login: ",a)}))},connectFB:function(a){var b={provider:"facebook",keys:{token:a}};p.providerConnect(b)},providerConnect:function(a,b){function c(a){i.contact=h.create(a),i._is_import=n(a),e.log("User",i),d.connectChat(i.contact.user_jid,function(b){i.rememberMe(),f.successFormCallback(),g.prepareDownloading(b),!i._is_import&&j?i["import"](b,a):g.downloadDialogs()})}var d=this.app.service,f=this.app.views.User,g=this.app.views.Dialog,h=this.app.models.Contact,i=this,j="facebook"===a.provider;f.loginQB(),f.createSpinner(),j?d.createSession(a,function(a){d.getUser(a.user_id,function(a){c(a)})},!0):d.createSession({},function(b){d.loginUser(a,function(a){c(a)})},!0)},"import":function(a,b){var c=this.app.views.Dialog,d=!1,f=this;FB.api("/me/permissions",function(a){e.log("FB Permissions",a);for(var g=0,h=a.data.length;g<h;g++)"user_friends"===a.data[g].permission&&"granted"===a.data[g].status&&(d=!0);d?FB.api("/me/friends",function(a){e.log("FB friends",a);for(var b=[],d=0,f=a.data.length;d<f;d++)b.push(a.data[d].id);b.length>0?c.downloadDialogs(b):c.downloadDialogs()}):c.downloadDialogs(),f._is_import="1",f.updateQBUser(b)})},updateQBUser:function(a){var b,c=this.app.service;try{b=JSON.parse(a.custom_data)||{}}catch(d){b={}}b.is_import="1",b=JSON.stringify(b),c.updateUser(a.id,{custom_data:b},function(a){})},signup:function(){var b,c=this.app.service,d=this.app.views.User,f=this.app.views.Dialog,g=this.app.models.Contact,h=a("section:visible form"),i=this;l(h,this)&&(d.createSpinner(),b={full_name:o.full_name,email:o.email,password:o.password,tag_list:"web"},c.createSession({},function(){c.createUser(b,function(){delete b.full_name,delete b.tag_list,c.loginUser(b,function(a){i.contact=g.create(a),e.log("User",i),c.connectChat(i.contact.user_jid,function(a){o.blob?i.uploadAvatar(a):(d.successFormCallback(),f.prepareDownloading(a),f.downloadDialogs())})})})},!1))},uploadAvatar:function(a){var b,c=this.app.service,d=this.app.views.User,e=this.app.views.Dialog,f=this.app.models.Attach,g=this;f.crop(o.blob,{w:1e3,h:1e3},function(f){c.createBlob({file:f,"public":!0},function(f){g.contact.blob_id=f.id,g.contact.avatar_url=f.path,d.successFormCallback(),e.prepareDownloading(a),e.downloadDialogs(),b=JSON.stringify({avatar_url:f.path}),c.updateUser(g.contact.id,{blob_id:f.id,custom_data:b},function(a){})})})},login:function(){var b,c=this.app.service,d=this.app.views.User,f=this.app.views.Dialog,g=this.app.models.Contact,h=a("section:visible form"),i=this;l(h,this)&&(d.createSpinner(),b={email:o.email,password:o.password},c.createSession(b,function(a){c.getUser(a.user_id,function(a){i.contact=g.create(a),e.log("User",i),c.connectChat(i.contact.user_jid,function(a){i.rememberMe(),d.successFormCallback(),f.prepareDownloading(a),f.downloadDialogs()})})},!0))},rememberMe:function(){var a={},b=this;Object.keys(b.contact).forEach(function(c){"app"!==c&&(a[c]=b.contact[c])}),localStorage.setItem("QM.user",JSON.stringify(a))},forgot:function(){var b=this.app.service,c=this.app.views.User,d=a("section:visible form"),e=this;l(d,this)&&(c.createSpinner(),b.createSession({},function(){b.forgotPassword(o.email,function(){c.successSendEmailCallback(),e._valid=!1})},!1))},resetPass:function(){this.app.service,this.app.views.User,a("section:visible form")},autologin:function(){var a=this.app.service,b=this.app.views.User,c=this.app.views.Dialog,d=this.app.models.Contact,f=JSON.parse(localStorage["QM.user"]),g=(this.app.entities,this);b.createSpinner(),a.getUser(f.id,function(h){h?g.contact=d.create(h):this.contact=d.create(f),e.log("User",h),a.connectChat(g.contact.user_jid,function(a){g.rememberMe(),b.successFormCallback(),c.prepareDownloading(a),c.downloadDialogs()})})},logout:function(a){var b=this.app.service,c=this.app.views.Dialog,e=this.app.entities,f=this;d.chat.disconnect(),c.hideDialogs(),e.Collections.dialogs=void 0,e.active="",e.Collections.dialogs=new e.Collections.Dialogs,b.logoutUser(function(){localStorage.removeItem("QM.user"),f.contact=null,f._remember=!1,f._valid=!1,a()})}},k});var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=CryptoJS,b=a.lib.WordArray;a.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp(),a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-8*(e%4)&255)<<16|(b[e+1>>>2]>>>24-8*((e+1)%4)&255)<<8|b[e+2>>>2]>>>24-8*((e+2)%4)&255,g=0;4>g&&e+.75*g<c;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var c=a.length,d=this._map,e=d.charAt(64);e&&(e=a.indexOf(e),-1!=e&&(c=e));for(var e=[],f=0,g=0;g<c;g++)if(g%4){var h=d.indexOf(a.charAt(g-1))<<2*(g%4),i=d.indexOf(a.charAt(g))>>>6-2*(g%4);e[f>>>2]|=(h|i)<<24-8*(f%4),f++}return b.create(e,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(a){function b(a,b,c,d,e,f,g){return a=a+(b&c|~b&d)+e+g,(a<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return a=a+(b&d|c&~d)+e+g,(a<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return a=a+(b^c^d)+e+g,(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return a=a+(c^(b|~d))+e+g,(a<<f|a>>>32-f)+b}for(var f=CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,g=f.algo,j=[],k=0;64>k;k++)j[k]=4294967296*a.abs(a.sin(k+1))|0;g=g.MD5=i.extend({_doReset:function(){
this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var g=this._hash.words,h=a[f+0],i=a[f+1],k=a[f+2],l=a[f+3],m=a[f+4],n=a[f+5],o=a[f+6],p=a[f+7],q=a[f+8],r=a[f+9],s=a[f+10],t=a[f+11],u=a[f+12],v=a[f+13],w=a[f+14],x=a[f+15],y=g[0],z=g[1],A=g[2],B=g[3],y=b(y,z,A,B,h,7,j[0]),B=b(B,y,z,A,i,12,j[1]),A=b(A,B,y,z,k,17,j[2]),z=b(z,A,B,y,l,22,j[3]),y=b(y,z,A,B,m,7,j[4]),B=b(B,y,z,A,n,12,j[5]),A=b(A,B,y,z,o,17,j[6]),z=b(z,A,B,y,p,22,j[7]),y=b(y,z,A,B,q,7,j[8]),B=b(B,y,z,A,r,12,j[9]),A=b(A,B,y,z,s,17,j[10]),z=b(z,A,B,y,t,22,j[11]),y=b(y,z,A,B,u,7,j[12]),B=b(B,y,z,A,v,12,j[13]),A=b(A,B,y,z,w,17,j[14]),z=b(z,A,B,y,x,22,j[15]),y=c(y,z,A,B,i,5,j[16]),B=c(B,y,z,A,o,9,j[17]),A=c(A,B,y,z,t,14,j[18]),z=c(z,A,B,y,h,20,j[19]),y=c(y,z,A,B,n,5,j[20]),B=c(B,y,z,A,s,9,j[21]),A=c(A,B,y,z,x,14,j[22]),z=c(z,A,B,y,m,20,j[23]),y=c(y,z,A,B,r,5,j[24]),B=c(B,y,z,A,w,9,j[25]),A=c(A,B,y,z,l,14,j[26]),z=c(z,A,B,y,q,20,j[27]),y=c(y,z,A,B,v,5,j[28]),B=c(B,y,z,A,k,9,j[29]),A=c(A,B,y,z,p,14,j[30]),z=c(z,A,B,y,u,20,j[31]),y=d(y,z,A,B,n,4,j[32]),B=d(B,y,z,A,q,11,j[33]),A=d(A,B,y,z,t,16,j[34]),z=d(z,A,B,y,w,23,j[35]),y=d(y,z,A,B,i,4,j[36]),B=d(B,y,z,A,m,11,j[37]),A=d(A,B,y,z,p,16,j[38]),z=d(z,A,B,y,s,23,j[39]),y=d(y,z,A,B,v,4,j[40]),B=d(B,y,z,A,h,11,j[41]),A=d(A,B,y,z,l,16,j[42]),z=d(z,A,B,y,o,23,j[43]),y=d(y,z,A,B,r,4,j[44]),B=d(B,y,z,A,u,11,j[45]),A=d(A,B,y,z,x,16,j[46]),z=d(z,A,B,y,k,23,j[47]),y=e(y,z,A,B,h,6,j[48]),B=e(B,y,z,A,p,10,j[49]),A=e(A,B,y,z,w,15,j[50]),z=e(z,A,B,y,n,21,j[51]),y=e(y,z,A,B,u,6,j[52]),B=e(B,y,z,A,l,10,j[53]),A=e(A,B,y,z,s,15,j[54]),z=e(z,A,B,y,i,21,j[55]),y=e(y,z,A,B,q,6,j[56]),B=e(B,y,z,A,x,10,j[57]),A=e(A,B,y,z,o,15,j[58]),z=e(z,A,B,y,v,21,j[59]),y=e(y,z,A,B,m,6,j[60]),B=e(B,y,z,A,t,10,j[61]),A=e(A,B,y,z,k,15,j[62]),z=e(z,A,B,y,r,21,j[63]);g[0]=g[0]+y|0,g[1]=g[1]+z|0,g[2]=g[2]+A|0,g[3]=g[3]+B|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);for(c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words,d=0;4>d;d++)e=c[d],c[d]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8);return b},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=i._createHelper(g),f.HmacMD5=i._createHmacHelper(g)}(Math),function(){var a=CryptoJS,b=a.lib,c=b.Base,d=b.WordArray,b=a.algo,e=b.EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:b.MD5,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,e=c.hasher.create(),f=d.create(),g=f.words,h=c.keySize,c=c.iterations;g.length<h;){i&&e.update(i);var i=e.update(a).finalize(b);e.reset();for(var j=1;j<c;j++)i=e.finalize(i),e.reset();f.concat(i)}return f.sigBytes=4*h,f}});a.EvpKDF=function(a,b,c){return e.create(c).compute(a,b)}}(),CryptoJS.lib.Cipher||function(a){var b=CryptoJS,c=b.lib,d=c.Base,e=c.WordArray,f=c.BufferedBlockAlgorithm,g=b.enc.Base64,h=b.algo.EvpKDF,i=c.Cipher=f.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){return a&&this._append(a),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?o:n).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?o:n).decrypt(a,b,c,d)}}}});c.StreamCipher=i.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var j=b.mode={},k=function(b,c,d){var e=this._iv;e?this._iv=a:e=this._prevBlock;for(var f=0;f<d;f++)b[c+f]^=e[f]},l=(c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}})).extend();l.Encryptor=l.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;k.call(this,a,b,d),c.encryptBlock(a,b),this._prevBlock=a.slice(b,b+d)}}),l.Decryptor=l.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b),k.call(this,a,b,d),this._prevBlock=e}}),j=j.CBC=l,l=(b.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,f=[],g=0;g<c;g+=4)f.push(d);c=e.create(f,c),a.concat(c)},unpad:function(a){a.sigBytes-=255&a.words[a.sigBytes-1>>>2]}},c.BlockCipher=i.extend({cfg:i.cfg.extend({mode:j,padding:l}),reset:function(){i.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var m=c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),j=(b.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;return a=a.salt,(a?e.create([1398893684,1701076831]).concat(a).concat(b):b).toString(g)},parse:function(a){a=g.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=e.create(b.slice(2,4));b.splice(0,4),a.sigBytes-=16}return m.create({ciphertext:a,salt:c})}},n=c.SerializableCipher=d.extend({cfg:d.extend({format:j}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);return b=e.finalize(b),e=e.cfg,m.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),b=(b.kdf={}).OpenSSL={execute:function(a,b,c,d){return d||(d=e.random(8)),a=h.create({keySize:b+c}).compute(a,d),c=e.create(a.words.slice(b),4*c),a.sigBytes=4*b,m.create({key:a,iv:c,salt:d})}},o=c.PasswordBasedCipher=n.extend({cfg:n.cfg.extend({kdf:b}),encrypt:function(a,b,c,d){return d=this.cfg.extend(d),c=d.kdf.execute(c,a.keySize,a.ivSize),d.iv=c.iv,a=n.encrypt.call(this,a,b,c.key,d),a.mixIn(c),a},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt),d.iv=c.iv,n.decrypt.call(this,a,b,c.key,d)}})}(),function(){for(var a=CryptoJS,b=a.lib.BlockCipher,c=a.algo,d=[],e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=0;256>o;o++)n[o]=128>o?o<<1:o<<1^283;for(var p=0,q=0,o=0;256>o;o++){var r=q^q<<1^q<<2^q<<3^q<<4,r=r>>>8^255&r^99;d[p]=r,e[r]=p;var s=n[p],t=n[s],u=n[t],v=257*n[r]^16843008*r;f[p]=v<<24|v>>>8,g[p]=v<<16|v>>>16,h[p]=v<<8|v>>>24,i[p]=v,v=16843009*u^65537*t^257*s^16843008*p,j[r]=v<<24|v>>>8,k[r]=v<<16|v>>>16,l[r]=v<<8|v>>>24,m[r]=v,p?(p=s^n[n[n[u^s]]],q^=n[n[q]]):p=q=1}var w=[0,1,2,4,8,16,32,64,128,27,54],c=c.AES=b.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,a=4*((this._nRounds=c+6)+1),e=this._keySchedule=[],f=0;f<a;f++)if(f<c)e[f]=b[f];else{var g=e[f-1];f%c?6<c&&4==f%c&&(g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g]):(g=g<<8|g>>>24,g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g],g^=w[f/c|0]<<24),e[f]=e[f-c]^g}for(b=this._invKeySchedule=[],c=0;c<a;c++)f=a-c,g=c%4?e[f]:e[f-4],b[c]=4>c||4>=f?g:j[d[g>>>24]]^k[d[g>>>16&255]]^l[d[g>>>8&255]]^m[d[255&g]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,f,g,h,i,d)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,j,k,l,m,e),c=a[b+1],a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;o<i;o++)var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],m=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++],j=p,k=q,l=r;p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],m=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++],a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=m},keySize:8});a.AES=b._createHelper(c)}(),define("cryptojs",function(a){return function(){var b;return b||a.CryptoJS}}(this)),define("SessionModule",["config","cryptojs"],function(a,b){function c(a){this.app=a,this._remember=!1}return c.prototype={create:function(a,b){this.token=a.token,this.expirationTime=a.expirationTime||null,this.authParams=a.authParams,this._remember=b||!1},update:function(a){var b,c;a.token?this.token=a.token:(a.authParams&&(this.authParams=a.authParams),a.date&&(c=a.date,c.setMinutes(c.getMinutes()+5),this.expirationTime=c.toISOString()),this._remember&&(b={token:this.token,expirationTime:this.expirationTime,authParams:this.authParams},localStorage.setItem("QM.session",JSON.stringify(b))))},destroy:function(){localStorage.removeItem("QM.session"),this.token=null,this.expirationTime=null,this.authParams=null,this._remember=!1},encrypt:function(c){return c&&c.password&&(c.password=b.AES.encrypt(c.password,a.qbAccount.authSecret).toString()),c},decrypt:function(c){return c&&c.password&&(c.password=b.AES.decrypt(c.password,a.qbAccount.authSecret).toString(b.enc.Utf8)),c}},c}),define("SettingsModule",[],function(){"use strict";function a(a){function b(){return localStorage["QM.settings-"+c]?void(d=JSON.parse(localStorage["QM.settings-"+c])):(e.save(),!1)}var c,d,e=this;this.init=function(a){c=a,d={messages_notify:!0,calls_notify:!0,sounds_notify:!0},b()},this.set=function(a){for(var b in a)d[b]=a[b]},this.get=function(a){return d[a]},this.save=function(){localStorage.setItem("QM.settings-"+c,JSON.stringify(d))}}return a}),define("ContactModule",["config","quickblox"],function(a,b){function c(a){this.app=a}function d(b){var c;return c=b.custom_data&&JSON.parse(b.custom_data).avatar_url,c||(c=b.facebook_id?"https://graph.facebook.com/v2.2/"+b.facebook_id+"/picture?width=240&height=240":a.defAvatar.url),c}function e(a){return a.custom_data&&JSON.parse(a.custom_data).status||""}return c.prototype={create:function(c){return{id:c.id,full_name:c.full_name||"Unknown user",email:c.email||"",phone:c.phone||"",facebook_id:c.facebook_id||null,blob_id:c.blob_id||null,user_tags:c.tag||c.user_tags||null,avatar_url:(c.avatar_url||d(c)).replace("http://","https://")||a.defAvatar.url,status:c.status||e(c),user_jid:c.user_jid||b.chat.helpers.getUserJid(c.id,a.qbAccount.appId),custom_data:c.custom_data||null}}},c}),define("Entities",["jquery","underscore","backbone","config","quickblox","Helpers"],function(a,b,c,d,e,f){var g={Models:{},Views:{},Collections:{},Helpers:{},active:""};return g.Models.Message=c.Model.extend({defaults:{id:"",body:"",type:"",dialog_id:"",date_sent:null,notification_type:null,delivered_ids:[],read_ids:[],read:null,online:!1,status:""},initialize:function(){this.accumulateInDialogModel()},accumulateInDialogModel:function(){var a=this.get("dialog_id"),b=g.Collections.dialogs.get(a);if(!b)return!0;var c=this.get("id"),d=this.get("type"),f=this.get("sender_id"),h=this.get("read_ids"),i=b.get("opened"),j=g.app.models.User.contact.id,k=a===g.active,l=k&&!window.isQMAppActive,m=j!==f,n=h.length<2;i&&(k&&!l||!m?n&&m?e.chat.sendReadStatus({userId:f,dialogId:a,messageId:c}):"groupchat"!==d||m||e.chat.sendDeliveredStatus({userId:f,dialogId:a,messageId:c}):new g.Models.UnreadMessage({userId:f,dialogId:a,messageId:c}),this.addMessageToCollection(b.get("messages")))},addMessageToCollection:function(a){var b=this.get("online");b?a.unshift(this):a.push(this)}}),g.Collections.Messages=c.Collection.extend({model:g.Models.Message,initialize:function(){this.listenTo(this,"add",this.keepCountOfMessages)},keepCountOfMessages:function(){var a=d.stackMessages,b=this.models[0].get("dialog_id"),c=g.Collections.dialogs.get(b),e=c.get("unread_count");(this.length>a&&e<a||e>=a&&this.length>++e)&&this.pop()}}),g.Models.UnreadMessage=c.Model.extend({defaults:{messageId:"",dialogId:"",userId:null},initialize:function(){this.accumulateInDialogModel()},accumulateInDialogModel:function(){var a=this.get("dialogId"),b=(this.get("messageId"),this.get("userId"),g.Collections.dialogs.get(a)),c=b.get("unread_count"),d=b.get("unread_messages");b.set("unread_count",++c),d.add(this)}}),g.Collections.UnreadMessages=c.Collection.extend({model:g.Models.UnreadMessage}),g.Models.Dialog=c.Model.extend({defaults:{id:"",type:null,room_jid:null,room_name:null,room_photo:"",occupants_ids:[],room_updated_date:null,last_message_date_sent:null,last_message:"",last_messages:[],unread_count:"",unread_messages:[],messages:[],opened:!1,draft:""},initialize:function(){g.Collections.dialogs.push(this),this.listenTo(this,"change:unread_count",this.cutMessages),this.listenTo(this,"remove",this.setActiveDialog)},cutMessages:function(){var a=this.get("messages"),b=this.get("unread_count"),c=(this.previous("unread_count"),d.stackMessages),e=a.length;if(0===+b)for(var f=0;f<e-c;f++)a.pop()},setActiveDialog:function(){this.get("id")===g.active&&(g.active="")}}),g.Collections.Dialogs=c.Collection.extend({model:g.Models.Dialog,initialize:function(){this.listenTo(this,"reset",function(){g.active="",a(".chatView").remove()})},readAll:function(a){var b=this.get(a),c=b.get("unread_count"),d=b.get("unread_messages"),f=[];d.length>0&&(d.each(function(a){e.chat.sendReadStatus(a.toJSON()),f.push(a.get("messageId"))}),d.reset()),+c>0&&e.chat.message.update(null,{chat_dialog_id:a,read:1},function(){b.set("unread_count","")})},saveDraft:function(){var b=g.active;if(b){var c=this.get(b),d=a("#textarea_"+b).text();c.set("draft",d)}}}),g.Models.Chat=c.Model.extend({defaults:{draft:"",occupantsIds:"",status:"",dialog_id:"",location:"",type:null,user_id:null,name:"",icon:"",jid:""},initialize:function(){this.buildChatView()},buildChatView:function(){g.Views.chat=new g.Views.Chat({model:this})}}),g.Views.Chat=c.View.extend({tagName:"div",className:"chatView",template:b.template(a("#chatTpl").html()),initialize:function(){this.render()},render:function(){var b=this.template(this.model.toJSON()),c=this.$el.html(b);a("#chatWrap").removeClass("is-hidden").append(c)}}),a(".list_contextmenu").on("click",".contact",function(){var b=a(this),c=b.parent().data("dialog");if(g.active!==c){var d=g.app.views.Message,e=g.app.views.Dialog,f=g.app.models.Cursor,h=g.Collections.dialogs,i=h.get(c);i.get("opened")?e.htmlBuild(b,i.get("messages").toJSON()):(i.set("opened",!0),e.htmlBuild(b)),d.clearTheListTyping(),f.setCursorToEnd(a(".l-chat:visible .textarea")[0]),h.readAll(c)}}),a(window).focus(function(){f.Dialogs.setScrollToNewMessages();var a=g.active;a&&g.Collections.dialogs.readAll(a)}),a(".j-home").on("click",function(){g.Collections.dialogs.saveDraft(),g.active=""}),g}),define("DialogModule",["config","quickblox","underscore","Helpers","Entities"],function(a,b,c,d,e){function f(a){this.app=a}return f.prototype={download:function(a,b){var c=this.app.service;c.listDialogs(a,function(a){b(a)})},create:function(a){var b=this.app.models.User,d=Math.floor(Date.now()/1e3),f={id:a._id,type:a.type,room_jid:a.xmpp_room_jid||null,room_name:a.name||null,room_photo:a.photo&&a.photo.replace("http://","https://")||"",occupants_ids:c.uniq(c.without(a.occupants_ids,b.contact.id)),last_message:a.last_message||(2===a.type?"Notification message":"Contact request"),last_message_date_sent:a.last_message_date_sent||d,room_updated_date:Date.parse(a.updated_at)||a.room_updated_date||d,unread_count:a.unread_messages_count||"",unread_messages:new e.Collections.UnreadMessages,messages:new e.Collections.Messages,opened:a.opened||!1};return new e.Models.Dialog(f),f.id},createPrivate:function(a,c,f){function g(f,g){var h=l.create(f),m=e.Collections.dialogs,n=m.get(h);d.log("Dialog",n.toJSON()),g&&b.chat.send(a,{type:"chat",body:"Contact request",extension:{recipient_id:k,date_sent:Math.floor(Date.now()/1e3),dialog_id:n.get("id"),save_to_history:1,notification_type:"4"}}),j.add(n.get("occupants_ids"),null,function(){i.addDialogItem(n,null,c)})}var h=this.app.service,i=this.app.views.Dialog,j=this.app.models.ContactList,k=(this.app.models.User,b.chat.helpers.getIdFromNode(a)),l=this;f?b.chat.dialog.list({_id:f},function(a,b){g(b.items[0])}):h.createDialog({type:3,occupants_ids:k},function(a){g(a,!0)})},createGroup:function(a,c,f){var g=this.app.service,h=this.app.views.Dialog,i=this.app.models.ContactList,j=i.contacts,k=(this.app.models.User,this);g.createDialog(c,function(a){var g=k.create(a),i=e.Collections.dialogs,l=i.get(g),m=l.get("occupants_ids");d.log("Dialog",l.toJSON()),b.chat.muc.join(l.get("room_jid"),function(){var d=b.chat.helpers.getBsonObjectId(),e=Math.floor(Date.now()/1e3);b.chat.addListener({name:"message",type:"groupchat",id:d},function(){l.set("occupants_ids",m),h.addDialogItem(l);for(var d,g=0,i=m.length;g<i;g++)d=m[g],b.chat.sendSystemMessage(j[d].user_jid,{body:"Notification message",extension:{date_sent:e,notification_type:"1",dialog_id:l.get("id"),room_name:l.get("room_name"),room_updated_date:e,current_occupant_ids:a.occupants_ids.join(),added_occupant_ids:c.occupants_ids,type:2}});f(l)}),b.chat.send(l.get("room_jid"),{id:d,type:"groupchat",body:"Notification message",extension:{message_id:d,date_sent:e,save_to_history:1,notification_type:"2",dialog_id:l.get("id"),room_updated_date:e,current_occupant_ids:a.occupants_ids.join(),added_occupant_ids:c.occupants_ids,dialog_update_info:3}})})})},updateGroup:function(a,c,f){var g=this.app.service,h=(this.app.views.Dialog,this.app.models.ContactList),i=h.contacts,j=(this.app.models.User,this);g.updateDialog(c.dialog_id,{push_all:{occupants_ids:[c.occupants_ids]}},function(a){var g=j.create(a),h=e.Collections.dialogs,k=h.get(g);d.log("Dialog",k.toJSON());var l=b.chat.helpers.getBsonObjectId(),m=Math.floor(Date.now()/1e3);b.chat.addListener({name:"message",type:"groupchat",id:l},function(){f(k);for(var d,e=0,g=c.new_ids.length;e<g;e++)d=c.new_ids[e],b.chat.sendSystemMessage(i[d].user_jid,{body:"Notification message",extension:{date_sent:m,notification_type:"1",dialog_id:k.get("id"),room_name:k.get("room_name"),room_photo:k.get("room_photo"),room_updated_date:m,current_occupant_ids:a.occupants_ids.join(),added_occupant_ids:c.new_ids.join(),type:2}})}),b.chat.send(k.get("room_jid"),{id:l,type:"groupchat",body:"Notification message",extension:{date_sent:m,save_to_history:1,notification_type:"2",current_occupant_ids:a.occupants_ids.join(),added_occupant_ids:c.new_ids.join(),dialog_id:k.get("id"),room_updated_date:m,dialog_update_info:3}})})},changeName:function(a,c){var f=this.app.service,g=(this.app.models.ContactList,this);f.updateDialog(a,{name:c},function(a){var f=g.create(a),h=e.Collections.dialogs,i=h.get(f);d.log("Dialog",i.toJSON()),b.chat.send(i.get("room_jid"),{type:"groupchat",body:"Notification message",extension:{date_sent:Math.floor(Date.now()/1e3),save_to_history:1,notification_type:"2",room_name:c,dialog_id:i.get("id"),room_updated_date:i.get("room_updated_date"),dialog_update_info:2}})})},changeAvatar:function(c,f,g){var h,i=this.app.service,j=(this.app.models.ContactList,this.app.models.Attach),k=this.app.views.Attach,l=f[0].files[0]||null,m=this;l?(l.type.indexOf("image/")===-1?h=a.errors.avatarType:l.name.length>100&&(h=a.errors.fileName),h?(d.log("Error",h),k.pastErrorMessage(h,f,$(".l-chat:visible .l-chat-content .mCSB_container")),g(!1)):j.crop(l,{w:1e3,h:1e3},function(a){j.upload(a,function(a){var f=b.content.publicUrl(a.uid);i.updateDialog(c,{photo:f},function(a){var c=m.create(a),h=e.Collections.dialogs,i=h.get(c);d.log("Dialog",i.toJSON()),b.chat.send(i.get("room_jid"),{type:"groupchat",body:"Notification message",extension:{date_sent:Math.floor(Date.now()/1e3),save_to_history:1,notification_type:"2",room_photo:f,dialog_id:i.get("id"),room_updated_date:i.get("room_updated_date"),dialog_update_info:1}}),g(f)})})})):g(!1)},leaveChat:function(a,c){var d=this.app.service,f=this.app.models.User,g=Math.floor(Date.now()/1e3),h=a.get("id");b.chat.send(a.get("room_jid"),{type:"groupchat",body:"Notification message",extension:{date_sent:g,save_to_history:1,notification_type:"2",current_occupant_ids:a.get("occupants_ids").join(),deleted_occupant_ids:f.contact.id,dialog_id:h,room_updated_date:g,dialog_update_info:3}}),e.active===h&&(e.active=""),d.updateDialog(h,{pull_all:{occupants_ids:[f.contact.id]}},function(){c()})}},f}),define("MessageModule",["config","quickblox","Entities"],function(a,b,c){function d(a){this.app=a,this.skip=void 0,e=this}var e;return d.prototype={download:function(b,c,d,f){var g,h=this.app.service,i=this.app.views.Dialog,j=a.stackMessages;return e.skip!==d&&(f?(i.createDataSpinner(null,null,!0),g=d):j=d,void h.listMessages({chat_dialog_id:b,sort_desc:"date_sent",limit:j,skip:g||0},function(a){f&&(e.skip=g,i.removeDataSpinner()),c(a)}))},create:function(a,b){var d={id:a.extension&&a.extension.message_id||a._id||a.id||null,body:a.body||a.message||"",type:a.type||"",date_sent:a.extension&&a.extension.date_sent||a.date_sent,read_ids:a.read_ids||[],delivered_ids:a.delivered_ids||[],notification_type:a.extension&&a.extension.notification_type||a.notification_type||null,dialog_id:a.extension&&a.extension.dialog_id||a.chat_dialog_id,read:a.read||!1,attachment:a.extension&&a.extension.attachments&&a.extension.attachments[0]||a.attachments&&a.attachments[0]||a.attachment||null,sender_id:a.sender_id||a.userId||null,recipient_id:a.recipient_id||a.extension&&a.extension.recipient_id||null,current_occupant_ids:a.extension&&a.extension.current_occupant_ids||a.current_occupant_ids||null,added_occupant_ids:a.extension&&a.extension.added_occupant_ids||a.added_occupant_ids||null,deleted_occupant_ids:a.extension&&a.extension.deleted_occupant_ids||a.deleted_occupant_ids||null,room_name:a.extension&&a.extension.room_name||a.room_name||null,room_photo:a.extension&&a.extension.room_photo&&a.extension.room_photo.replace("http://","https://")||a.room_photo&&a.room_photo.replace("http://","https://")||null,room_updated_date:a.extension&&a.extension.room_updated_date||a.room_updated_date||null,dialog_update_info:a.extension&&a.extension.dialog_update_info||a.dialog_update_info||null,callType:a.extension&&a.extension.callType||a.callType||null,callState:a.extension&&a.extension.callState||a.callState||null,caller:parseInt(a.extension&&a.extension.caller)||parseInt(a.caller)||null,callee:parseInt(a.extension&&a.extension.callee)||parseInt(a.callee)||null,callDuration:a.extension&&a.extension.callDuration||a.callDuration||null,sessionID:a.extension&&a.extension.sessionID||a.sessionID||null,latitude:a.extension&&a.extension.latitude||a.latitude||null,longitude:a.extension&&a.extension.longitude||a.longitude||null,stack:!1,online:a.online||!1,status:a.extension&&a.extension.notification_type||a.notification_type?"":"Not delivered yet"};d.attachment&&d.attachment.size&&(d.attachment.size=parseInt(d.attachment.size));for(var e in d)null===d[e]&&delete d[e];return b&&!d.notification_type||new c.Models.Message(d),d},isStack:function(a,b,c){var d,e,f=!1;if(c){if(a){var g=+c.attr("data-id"),h=+c.find(".message-time").attr("data-time");d=b.sender_id===g&&!!c.attr("id"),e=Math.floor(b.date_sent/60)===Math.floor(h/60)}else d=!c.notification_type&&b.sender_id===c.sender_id,e=Math.floor(b.date_sent/60)===Math.floor(c.date_sent/60);f=!(!e||!d)}return f}},d}),function(a){"use strict";function b(a,c,d){var e,f=document.createElement("img");return f.onerror=function(e){return b.onerror(f,e,a,c,d)},f.onload=function(e){return b.onload(f,e,a,c,d)},"string"==typeof a?(b.fetchBlob(a,function(c){c?(a=c,e=b.createObjectURL(a)):(e=a,d&&d.crossOrigin&&(f.crossOrigin=d.crossOrigin)),f.src=e},d),f):b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a)?(e=f._objectURL=b.createObjectURL(a),e?(f.src=e,f):b.readFile(a,function(a){var b=a.target;b&&b.result?f.src=b.result:c&&c(a)})):void 0}function c(a,c){!a._objectURL||c&&c.noRevoke||(b.revokeObjectURL(a._objectURL),delete a._objectURL)}var d=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.fetchBlob=function(a,b,c){b()},b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transform=function(a,b,c,d,e){c(a,e)},b.onerror=function(a,b,d,e,f){c(a,f),e&&e.call(a,b)},b.onload=function(a,d,e,f,g){c(a,g),f&&b.transform(a,g,f,e,{})},b.createObjectURL=function(a){return!!d&&d.createObjectURL(a)},b.revokeObjectURL=function(a){return!!d&&d.revokeObjectURL(a)},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define("loadImage",[],function(){return b}):"object"==typeof module&&module.exports?module.exports=b:a.loadImage=b}(window),function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,g=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,g,h,i,j,k,l,m,n;if(b=a.match(f),!b)throw new Error("invalid data URI");for(g=b[2]?b[1]:"text/plain"+(b[3]||";charset=US-ASCII"),h=!!b[4],i=a.slice(b[0].length),j=h?atob(i):decodeURIComponent(i),k=new ArrayBuffer(j.length),l=new Uint8Array(k),m=0;m<j.length;m+=1)l[m]=j.charCodeAt(m);return c?new Blob([d?l:k],{type:g}):(n=new e,n.append(k),n.getBlob(g))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&g?g(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&g&&(b.toBlob=function(a,b,c){a(g(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define("canvasToBlob",[],function(){return g}):"object"==typeof module&&module.exports?module.exports=g:a.dataURLtoBlob=g}(window),define("AttachModule",["loadImage","canvasToBlob","quickblox"],function(a,b,c){function d(a){this.app=a}return d.prototype={upload:function(a,b){var c=this.app.service;c.createBlob({file:a,"public":!0},function(a){b(a)})},create:function(a,b){var d=0===a.content_type.indexOf("image/")?"image":0===a.content_type.indexOf("audio/")?"audio":0===a.content_type.indexOf("video/")?"video":"photo";return{type:d,url:c.content.publicUrl(a.uid)||null,id:a.uid,name:a.name,size:b,"content-type":a.content_type}},crop:function(b,c,d){a(b,function(e){var f={crop:!0};e.width>e.height?f.maxWidth=c.w:f.maxHeight=c.h,a(b,function(a){a.toBlob(function(a){a.name=b.name,d(a)},b.type)},f)})}},d}),define("ContactListModule",["config","underscore","Helpers"],function(a,b,c){function d(a){this.app=a,this.roster={},this.contacts=e(),f=Object.keys(this.contacts).map(Number)}function e(){var a={},b=localStorage["QM.contacts"]?localStorage["QM.contacts"].split(","):[];if(b.length>0)try{for(var d=0,e=b.length;d<e;d++)a[b[d]]="undefined"==typeof localStorage["QM.contact-"+b[d]]||JSON.parse(localStorage["QM.contact-"+b[d]]),a[b[d]]===!0&&delete a[b[d]]}catch(f){c.log("Error getting contacts from cache. Clearing..."),localStorage.clear(),a={}}return a}var f,g;return d.prototype={saveRoster:function(a){this.roster=a},saveNotConfirmed:function(a){localStorage.setItem("QM.notConfirmed",JSON.stringify(a))},saveHiddenDialogs:function(a){sessionStorage.setItem("QM.hiddenDialogs",JSON.stringify(a))},add:function(a,d,e,g){var h,i,j=this.app.service,k=this.app.models.Contact,l=this;h=[].concat(b.difference(a,f)),f=f.concat(h),localStorage.setItem("QM.contacts",f.join()),g&&(h=a),h.length>0?(i={filter:{field:"id",param:"in",value:h},per_page:100},j.listUsers(i,function(a){a.items.forEach(function(a){var b=a.user,c=k.create(b);l.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),c.log("Contact List is updated",l),e(d)})):e(d)},globalSearch:function(a){if(g)return!1;var b,d=this.app.service,e=sessionStorage["QM.search.value"],f=sessionStorage["QM.search.page"],h=this;g=!0,d.getUser({full_name:e,page:f,per_page:20},function(d){g=!1,sessionStorage.setItem("QM.search.allPages",Math.ceil(d.total_entries/d.per_page)),sessionStorage.setItem("QM.search.page",++f),b=d.items.length?h.getResults(d.items):d.items,b.sort(function(a,b){var c=a.full_name.toLowerCase(),d=b.full_name.toLowerCase();return c<d?-1:c>d?1:0}),c.log("Search results",b),a(b)})},getResults:function(a){var b,c=this.app.models.Contact,d=this.app.models.User,e=[];return a.forEach(function(a){a.user.id!==d.contact.id&&(b=c.create(a.user),e.push(b))}),e},getFBFriends:function(a,b){var d,e=this.app.service,g=this.app.models.Contact,h=this,i=[];d={filter:{field:"facebook_id",param:"in",value:a}},e.listUsers(d,function(a){a.items.forEach(function(a){var b=a.user,c=g.create(b);i.push(b.id),h.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),f=f.concat(i),localStorage.setItem("QM.contacts",f.join()),c.log("Contact List is updated",h),b(i)})}},d}),define("VideoChatModule",["jquery","config","quickblox","Helpers"],function(a,b,c,d){function e(a){this.app=a,this.session={},g=this}var f,g;return e.prototype.getUserMedia=function(b,e,h){var i=this.app.models.User,j={audio:!0,video:"video"===e,elemId:"localStream",options:{muted:!0,mirror:!0}};b.isCallee||("video"===e?g.session=c.webrtc.createNewSession([b.opponentId],c.webrtc.CallType.VIDEO):g.session=c.webrtc.createNewSession([b.opponentId],c.webrtc.CallType.AUDIO)),f=g.session,f.getUserMedia(j,function(c,j){if(c)d.log("Error",c),b.isCallee?(g.sendMessage(b.opponentId,"3",null,b.dialogId,e,!0),h(c,null)):h(c,null);else{if(d.log("Stream",j),!a('.l-chat[data-dialog="'+b.dialogId+'"]').find(".mediacall")[0])return j.stop({}),!0;b.isCallee?(f.accept({}),g.caller=b.opponentId,g.callee=i.contact.id):(f.call({}),g.caller=i.contact.id,g.callee=b.opponentId),h(null,j)}})},e.prototype.sendMessage=function(e,f,h,i,j,k,l){var m,n,o,p=c.chat.helpers.getUserJid(e,b.qbAccount.appId),q=this.app.models.User,r=this.app.models.Message,s=this.app.views.Message,t=this.app.views.VideoChat,u=Math.floor(Date.now()/1e3),v=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]'),w=a("[data-dialog = "+i+"]").is(".is-selected"),x=parseInt(v.length>0&&v.find(".unread").text().length>0?v.find(".unread").text():0);k?m={save_to_history:1,date_sent:u,callType:"video"===j?"2":"1",callState:f,caller:e,callee:q.contact.id}:(m={save_to_history:1,date_sent:u,callType:"2"===f?"video"===j?"2":"1":"video"===t.type?"2":"1",callState:"1"!==f||h?f:"2",caller:"2"===f?e:g.caller,callee:"2"===f?q.contact.id:g.callee},h&&(m.callDuration=d.getDuration(null,h))),l&&(m.sessionID=l),o={chat_dialog_id:i,date_sent:u,sender_id:q.contact.id,callType:m.callType,callState:m.callState,caller:m.caller,callee:m.callee,callDuration:m.callDuration||null,sessionID:m.sessionID||null,online:!0},o.id=c.chat.send(p,{type:"chat",body:"Call notification",extension:m}),n=r.create(o),d.log(n),s.addItem(n,!0,!0),w||(x++,v.find(".unread").text(x),DialogView.getUnreadCounter(i)),d.Dialogs.moveDialogToTop(i)},e}),define("CursorModule",[],function(){"use strict";function a(a){function b(){var a;if(document.getSelection){var b=document.getSelection();b.rangeCount>0&&(a=b.getRangeAt(0))}else a=!1;return a;
}function c(a){if(document.getSelection){var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}}var d=this;this.setCursorAfterElement=function(a){var b=document.createRange();b.setStartAfter(a),b.setEndAfter(a),c(b)},this.setCursorToEnd=function(a){var b="undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange,d="undefined"!=typeof document.body.createTextRange;if(a.focus(),b){var e=document.createRange();e.selectNodeContents(a),e.collapse(!1),c(e)}else if(d){var f=document.body.createTextRange();f.moveToElementText(a),f.collapse(!1),f.select()}},this.insertElement=function(a,c){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){var f=b(),g=a.cloneNode(!0);g.classList.add(c),f.insertNode(g),d.setCursorAfterElement(g)}}}}return a}),define("SyncTabsModule",["jquery"],function(a){"use strict";function b(b){function c(){f="QM."+e+"_countTabs",g="QM."+e+"_mainTab",h="QM."+e+"_closedTab",i="QM."+e+"_logOut",j="QM."+e+"_readBadge",localStorage[g]&&localStorage[f]?(l=+localStorage[f]+1,localStorage.setItem(f,l),localStorage.setItem(g,l)):(localStorage.setItem(f,l),localStorage.setItem(g,l))}function d(b){var c=b.originalEvent.key,d=(b.originalEvent.oldValue,b.originalEvent.newValue);c===h&&+localStorage[f]===l&&(l=+d,localStorage.setItem(f,+localStorage[f]-1),localStorage[f]<localStorage[g]&&localStorage.setItem(g,l)),c==="QM.settings-"+e&&k.app.views.Settings.setUp(e),c===i&&(localStorage.removeItem(f),localStorage.removeItem(g),localStorage.removeItem(h),localStorage.removeItem(i),localStorage.removeItem(j),window.location.reload()),c===j&&null!==d&&(a('.dialog-item[data-dialog="'+d+'"]').find(".unread").text(""),k.app.views.Dialog.decUnreadCounter(d))}var e,f,g,h,i,j,k=this,l=1;this.app=b,this.init=function(b){e=b,c(),a(window).focus(function(){localStorage.setItem(g,l)}),a(window).unload(function(){localStorage.setItem(h,l),1===+localStorage[f]&&(localStorage.removeItem(f),localStorage.removeItem(g),localStorage.removeItem(h))}),a(window).bind("storage",function(a){d(a)})},this.get=function(){return localStorage[g]==l}}return b}),define("QMHtml",["jquery","underscore","Helpers"],function(a,b,c){var d={};return d.VideoChat={onCallTpl:function(a){var c=b.template('<div class="incoming-call l-flexbox l-flexbox_column l-flexbox_flexbetween"><div class="incoming-call-info l-flexbox l-flexbox_column"><div class="message-avatar avatar info-avatar" style="background-image:url(<%= userAvatar %>)"></div><span class="info-notice"><%= callTypeUС %> Call from <%= userName %></span></div><div class="incoming-call-controls l-flexbox l-flexbox_flexcenter"><button class="btn_decline" data-callType="<%= callType %>" data-dialog="<%= dialogId %>" data-id="<%= userId %>">Decline</button><button class="btn_accept" data-callType="<%= callType %>" data-session="<%= sessionId %>" data-dialog="<%= dialogId %>" data-id="<%= userId %>">Accept</button></div></div>')(a);return c},buildTpl:function(a){var c=b.template('<div class="mediacall l-flexbox"><video id="remoteStream" class="mediacall-remote-stream is-hidden"></video><video id="localStream" class="mediacall-local mediacall-local-stream is-hidden"></video><img id="localUser" class="mediacall-local mediacall-local-avatar" src="<%=userAvatar%>" alt="avatar"><div id="remoteUser" class="mediacall-remote-user l-flexbox l-flexbox_column"><img class="mediacall-remote-avatar" src="<%=contactAvatar%>" alt="avatar"><span class="mediacall-remote-name"><%=contactName%></span></div><div class="mediacall-info l-flexbox l-flexbox_column l-flexbox_flexcenter"><img class="mediacall-info-logo" src="images/logo-qmunicate-transparent.svg" alt="Q-municate"><span class="mediacall-info-duration">connect...</span></div><div class="mediacall-controls l-flexbox l-flexbox_flexcenter"><button class="btn_mediacall btn_full-mode" data-id="<%=userId%>" data-dialog="<%=dialogId%>" disabled><div id="fullModeOn" class="btn-icon_mediacall"></div><div id="fullModeOff" class="btn-icon_mediacall"></div></button><button class="btn_mediacall btn_camera_off" data-id="<%=userId%>" data-dialog="<%=dialogId%>"><img class="btn-icon_mediacall" src="images/icon-camera-off.svg" alt="camera"></button><button class="btn_mediacall btn_mic_off" data-id="<%=userId%>" data-dialog="<%=dialogId%>"><img class="btn-icon_mediacall" src="images/icon-mic-off.svg" alt="mic"></button><button class="btn_mediacall btn_hangup" data-id="<%=userId%>" data-dialog="<%=dialogId%>"><img class="btn-icon_mediacall" src="images/icon-hangup.svg" alt="hangup"></button></div></div>')(a);return c},showError:function(){var b=c.isBeginOfChat(),d=a(".l-chat:visible"),e=a('<article class="message message_service l-flexbox l-flexbox_alignstretch"><span class="message-avatar request-button_pending"></span><div class="message-container-wrap"><div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch"><div class="message-content"><h4 class="message-author message-error">Camera and/or microphone wasn\'t found.</h4></div></div></div></article>');d.find(".mCSB_container").append(e),b&&d.find(".j-scrollbar_message").mCustomScrollbar("scrollTo","bottom")},noWebRTC:function(){var b=c.isBeginOfChat(),d=a(".l-chat:visible"),e=a('<article class="message message_service l-flexbox l-flexbox_alignstretch"><span class="message-avatar request-button_pending"></span><div class="message-container-wrap"><div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch"><div class="message-content"><h4 class="message-author message-error">Audio and Video calls aren\'t supported by your browser. Please use Google Chrome, Opera or Firefox.</h4></div></div></div></article>');d.find(".mCSB_container").append(e),b&&d.find(".j-scrollbar_message").mCustomScrollbar("scrollTo","bottom")}},d.User={contactPopover:function(c,d){var e=a('<ul class="list-actions list-actions_contacts popover"></ul>'),f="";return 3===c.dialogType&&d&&"none"!==d.subscription?f='<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="<%=ids%>" href="#">Video call</a></li><li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="<%=ids%>" href="#">Audio call</a></li><li class="list-item"><a class="list-actions-action createGroupChat" data-ids="<%=ids%>" data-private="1" href="#">Add people</a></li>':3!==c.dialogType&&(f='<li class="list-item"><a class="list-actions-action addToGroupChat" data-group="true" data-ids="<%=occupantsIds%>" data-dialog="<%=dialogId%>" href="#">Add people</a></li>'),f+=3===c.dialogType?'<li class="list-item"><a class="list-actions-action userDetails" data-id="<%=ids%>" href="#">Profile</a></li><li class="list-item"><a class="deleteContact list-actions-action" href="#">Delete contact</a></li>':'<li class="list-item"><a class="leaveChat list-actions-action" data-group="true" href="#">Leave chat</a></li>',e.append(b.template(f)(c))},occupantPopover:function(c,d){var e=a('<ul class="list-actions list-actions_occupants popover"></ul>'),f="";return f=!d||"none"===d.subscription&&!d.ask?'<li class="list-item j-listItem" data-jid="<%=jid%>"><a class="list-actions-action requestAction j-requestAction" data-id="<%=id%>" href="#">Send request</a></li>':"subscribe"!==d.ask||d.status?'<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="<%=id%>" href="#">Video call</a></li><li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="<%=id%>" href="#">Audio call</a></li><li class="list-item"><a class="list-actions-action writeMessage" data-id="<%=id%>" href="#">Write message</a></li><li class="list-item"><a class="list-actions-action userDetails" data-id="<%=id%>" href="#">Profile</a></li>':'<li class="list-item"><a class="list-actions-action userDetails" data-id="<%=id%>" href="#">Profile</a></li><li class="list-item"><a class="deleteContact list-actions-action" data-id="<%=id%>" href="#">Delete contact</a></li>',e.append(b.template(f)(c))},getControlButtonsForPopupDetails:function(c){var d=a("#popupDetails").find(".userDetails-controls"),e="",f={roster:"ask_subscription"};"none"!==c.subscription&&null===c.ask&&(f.roster="",e='<button class="btn_userDetails writeMessage videoCall"><img src="images/icon-videocall.svg" alt="videocall">Video Call</button><button class="btn_userDetails writeMessage audioCall"><img src="images/icon-audiocall.svg" alt="videocall">Call</button>'),e+='<button class="btn_userDetails <%=roster%> writeMessage"><img src="images/icon-message.png" alt="videocall">Message</button><button class="btn_userDetails <%=roster%> deleteContact"><img src="images/icon-delete.svg" alt="videocall">Delete</button>',d.empty(),d.append(b.template(e)(f))},profilePopover:function(){var b=a('<ul class="list-actions list-actions_profile popover"><li class="list-item"><a id="userProfile" class="list-actions-action" href="#">Profile</a></li><li class="list-item"><a id="userSettings" class="list-actions-action" href="#">Settings</a></li><li class="list-item"><a id="logout" class="list-actions-action" href="#">Log Out</a></li></ul>');return b}},d.Messages={setMap:function(c){var d=b.template('<a class="open_map" href="<%=mapLink%>" target="_blank"></a>')(c);a("article#"+c.id).find(".message-geo").addClass("with-geo").append(d)},urlPreview:function(a){var c=b.template('<div class="og_info"><h4 class="og_title"><%=title%></h4><span class="og_description"><%=description%></span></div><% if (picture) { %><div class="og_image"><img src="<%=picture%>" alt="og_pic"></div><% } %>')(a);return c}},d.Attach={error:function(a){var c=b.template('<article class="message message_service l-flexbox l-flexbox_alignstretch"><span class="message-avatar request-button_pending"></span><div class="message-container-wrap"><div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch"><div class="message-content"><h4 class="message-author message-error"><%= errMsg %></h4></div></div></div></article>')(a);return c},attach:function(a){var c=b.template('<article class="message message_service message_attach l-flexbox l-flexbox_alignstretch"><span class="message-avatar request-button_attach"><img src="images/icon-attach.svg" alt="attach"></span><div class="message-container-wrap"><div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch"><div class="message-content"><h4 class="message-author"><%= fileName %><div class="attach-upload"><div id="progress_<%= id %>"></div><span class="attach-size"><span class="attach-part attach-part_<%= id %>"></span> of <%= fileSizeCrop %> <%= fileSizeUnit %></span></div></h4></div><time class="message-time"><a class="attach-cancel" href="#">Cancel</a></time></div></div></article>')(a);return c}},d}),define("async",[],function(){function a(a){var b,c;b=document.createElement("script"),b.type="text/javascript",b.async=!0,b.src=a,c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(b,c)}function b(a,b){var c=/!(.+)/,e=a.replace(c,""),f=c.test(a)?a.replace(/.+!/,""):d;return e+=e.indexOf("?")<0?"?":"&",e+f+"="+b}function c(){return e+=1,"__async_req_"+e+"__"}var d="callback",e=0;return{load:function(d,e,f,g){if(g.isBuild)f(null);else{var h=c();window[h]=f,a(b(e.toUrl(d),h))}}}}),define("googlemaps",["async"],function(a){function b(){}var c=this,d={load:function(a,b,c,d){var f,g=d||{};return g.isBuild?void c(null):(f=new e(b,c,g.googlemaps||{}),void f.load())}},e=function(c,d,f){this.require_=c,this.onload_=d||b,this.baseUrl_=f.url||e.DEFAULT_BASE_URL,this.async_=f.async||a,this.params_=f.params};return e.prototype.load=function(){this.isGoogleMapsLoaded_()?this.resolveWith_(this.getGlobalGoogleMaps_()):this.loadGoogleMaps_()},e.prototype.loadGoogleMaps_=function(){var a=this,b=function(){a.resolveWithGoogleMaps_(a)};b.onerror=this.onload_.onerror,this.async_.load(this.getGoogleUrl_(),this.require_,b,{})},e.prototype.getGoogleUrl_=function(){return this.baseUrl_+"?"+this.serializeParams_()},e.prototype.resolveWithGoogleMaps_=function(){return this.isGoogleMapsLoaded_()?void this.resolveWith_(this.getGlobalGoogleMaps_()):void this.reject_()},e.prototype.serializeParams_=function(){var a=[];for(var b in this.params_)if(this.params_.hasOwnProperty(b)){var c=this.params_[b],d="object"==typeof c,e=encodeURIComponent(b)+"="+encodeURIComponent(c),f=d?this.serializeParams_(c,b):e;a.push(f)}return a.join("&")},e.prototype.isGoogleMapsLoaded_=function(){return c.google&&c.google.maps},e.prototype.getGlobalGoogleMaps_=function(){return c.google?c.google.maps:void 0},e.prototype.resolveWith_=function(a){this.onload_.apply(c,arguments)},e.prototype.reject_=function(a){var b=a||new Error("Failed to load Google Maps library.");if(!this.onload_.onerror)throw b;this.onload_.onerror.call(c,b)},e.DEFAULT_BASE_URL="https://maps.googleapis.com/maps/api/js",d}),define("LocationView",["googlemaps!","gmaps","Helpers"],function(a,b,c){google.maps===a;var d,e={};return e={getGeoCoordinates:function(a,b){function c(a){var c={};c.latitude=a.coords.latitude,c.longitude=a.coords.longitude,b(c)}function e(a){var c="ERROR("+a.code+"): "+a.message;b(null,c)}a?d=navigator.geolocation.watchPosition(c,e):navigator.geolocation.getCurrentPosition(c,e)},getStaticMapUrl:function(a,c){var d={size:c&&c.size||[200,150],lat:a.lat,lng:a.lng,zoom:c&&c.zoom||15,markers:[{lat:a.lat,lng:a.lng}]};return b.staticMapURL(d)},getMapUrl:function(a){return"https://www.google.com/maps?q="+a.lat+","+a.lng},toggleGeoCoordinatesToLocalStorage:function(a,b){var e=!(!localStorage["QM.latitude"]||!localStorage["QM.longitude"]),f=$(".j-send_location");a?this.getGeoCoordinates(!0,function(a,g){g?(c.log(g),g.indexOf("ERROR(1):")>-1&&$(".j-geoInfo").addClass("is-overlay").parent(".j-overlay").addClass("is-overlay"),e&&(navigator.geolocation.clearWatch(d),localStorage.removeItem("QM.latitude"),localStorage.removeItem("QM.longitude"),f.removeClass("btn_active")),b(null,g)):(localStorage.setItem("QM.latitude",a.latitude),localStorage.setItem("QM.longitude",a.longitude),f.addClass("btn_active"),b("Added coordinates to localStorage: latitude("+a.latitude+"), longitude("+a.longitude+")"))}):(localStorage.removeItem("QM.latitude"),localStorage.removeItem("QM.longitude"),f.removeClass("btn_active"),navigator.geolocation.clearWatch(d),b("Removed coordinates from localStorage"))},addMap:function(a){a.prepend('<div id="map" class="open_map j-open_map"></div>');var c=!(!localStorage["QM.latitude"]||!localStorage["QM.longitude"]),d={},e=new b({div:"#map",lat:c?localStorage["QM.latitude"]:0,lng:c?localStorage["QM.longitude"]:0,zoom:c?15:1});$("#map img").addClass("gooImg"),c||this.getGeoCoordinates(!1,function(a,b){a&&(e.setZoom(15),e.setCenter(a.latitude,a.longitude))}),b.on("click",e.map,function(a){d.lat=a.latLng.lat(),d.lng=a.latLng.lng(),localStorage.setItem("QM.locationAttach",JSON.stringify(d)),e.removeMarkers(),e.addMarker({lat:d.lat,lng:d.lng,title:"Marker"}),$(".j-send_map").addClass("is-active")})}}}),define("UserView",["jquery","facebook","config","quickblox","Entities","Helpers","QMHtml","LocationView","digits"],function(a,b,c,d,e,f,g,h,i){function j(a){this.app=a,k=this.app.models.User,m=this.app.models.Contact,l=this.app.models.ContactList}var k,l,m,n=null;j.prototype={signupQB:function(){p(a("#signUpPage"))},loginQB:function(){p(a("#loginPage"))},forgot:function(){p(a("#forgotPage"))},connectTwitterDigits:function(a){k.connectTwitterDigits()},connectFB:function(a){k.connectFB(a)},signupForm:function(){o(),k.signup()},loginForm:function(){o(),k.login()},forgotForm:function(){o(),k.forgot()},resetForm:function(){o(),k.resetPass()},autologin:function(){p(a("#loginPage")),k.autologin()},createSpinner:function(){a("section:visible form").addClass("is-hidden").next(".l-spinner").removeClass("is-hidden")},removeSpinner:function(){a("section:visible form").removeClass("is-hidden").next(".l-spinner").addClass("is-hidden")},successFormCallback:function(){this.removeSpinner(),a("#profile").find(".avatar").addClass("profileUserAvatar").css("background-image","url("+k.contact.avatar_url+")"),a("#profile").find(".avatar").attr("data-id",k.contact.id),p(a("#mainPage"))},successSendEmailCallback:function(){var b='<div class="j-success_callback note l-form l-flexbox l-flexbox_column">';b+='<span class="text text_alert text_alert_success">Success!</span>',b+='<span class="text">Please check your email and click a link in the letter in order to reset your password</span>',b+="</div>",this.removeSpinner(),a("section:visible form").addClass("is-hidden").after(b)},getFBStatus:function(a){return"undefined"==typeof b?(n=a,sessionStorage.setItem("QM.is_getFBStatus",!0),!1):(a=a||n,n=null,b.getLoginStatus(function(c){f.log("FB status response",c),a&&("connected"===c.status?a(c.authResponse.accessToken):b.login(function(b){f.log("FB authResponse",b),"connected"===b.status&&a(b.authResponse.accessToken)}))},!0),void 0)},profilePopover:function(a){var b=g.User.profilePopover();a.after(b),r()},contactPopover:function(b){var c,d=b.parent().data("id"),f=b.parent().data("dialog"),h=l.roster,i=e.Collections.dialogs,j=i.get(f).toJSON();c=g.User.contactPopover({dialogId:f,dialogType:j.type,occupantsIds:j.occupants_ids,ids:d},h[d]),b.after(c).parent().addClass("is-contextmenu"),r();var k=b.offset().top,m=document.querySelector(".j-scrollbar_aside"),n=m.offsetTop,o=m.offsetHeight,p=0,q=o+n,s=b.next(),t=b.next().children().length,u=q-k,v=k-n;a(".j-aside_list_item").each(function(a,b){p+=b.offsetHeight}),u<=50*t&&v>40*t&&s.addClass("margin-up"),p<=400&&(m.style.paddingBottom=40*t+"px")},occupantPopover:function(b,e){var f=b.data("id"),h=d.chat.helpers.getUserJid(f,c.qbAccount.appId),i=l.roster,j=e.currentTarget.getBoundingClientRect(),k=g.User.occupantPopover({id:f,jid:h},i[f]);a("body").append(k),r(),b.addClass("is-active"),a(".list-actions_occupants").offset({top:29+j.top,left:j.left})},buildDetails:function(b){var c=a("#popupDetails"),d=l.contacts[b],e=l.roster,f=e[b]?e[b]:null;navigator.userAgent.match(/Firefox/)&&c.find(".userDetails-controls button").css("padding","0 12px"),c.find(".userDetails-avatar").attr("data-id",b).css("background-image","url("+d.avatar_url+")"),c.find(".userDetails-filename").attr("data-id",b).text(d.full_name),c.find(".userDetails-status").attr("data-id",b).text(d.status),f&&f.status?c.find(".userDetails-chatStatus").html('<span class="status status_online"></span><span class="status_text">Online</span>'):c.find(".userDetails-chatStatus").html('<span class="status"></span><span class="status_text">Offline</span>'),c.find(".writeMessage").data("id",b),c.find(".userDetails-field").attr("data-id",b).html(d.phone?'<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+d.phone+"</span>":""),this.getNewProfile(b)},getNewProfile:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList;c.getUser(b,function(b){var c=d.create(b);e.contacts[c.id]=c,a('.profileUserName[data-id="'+c.id+'"]').text(c.full_name),a('.profileUserStatus[data-id="'+c.id+'"]').text(c.status),c.phone&&a('.profileUserPhone[data-id="'+c.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+c.phone+"</span>"),a('.profileUserAvatar[data-id="'+c.id+'"]').css("background-image","url("+c.avatar_url+")"),localStorage.setItem("QM.contact-"+c.id,JSON.stringify(c))})},logout:function(){var b=this.app.views.Dialog;a(".mediacall .btn_hangup").click(),k.logout(function(){q(),a(".j-capBox").removeClass("is-hidden"),a(".j-chatWrap").addClass("is-hidden"),a(".j-popover_const").removeClass("is-active"),a(".l-chat").remove(),f.log("current User and Session were destroyed"),b.logoutWithClearData()})},localSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase(),d=a("#searchList li.is-selected").data("dialog"),e=a("#recentList, #historyList, #requestsList");c.length>0?(a("#searchList").removeClass("is-hidden").siblings("section").addClass("is-hidden"),a("#searchList ul").html("").add("#searchList .note").removeClass("is-hidden"),a("#recentList, #historyList, #oldHistoryList").find(".dialog-item").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this).clone();b.indexOf(c)>-1&&(a("#searchList ul").append(d),a("#searchList .note").addClass("is-hidden"))}),0===a("#searchList ul").find("li").length&&a("#searchList .note").removeClass("is-hidden").siblings("ul").addClass("is-hidden")):(a("#searchList").addClass("is-hidden"),e.each(function(){var b=a(this);b.find(".list-item").length>0&&b.removeClass("is-hidden"),d&&b.find('.list-item[data-dialog="'+d+'"]').addClass("is-selected")}),0===a(".l-list-wrap section:not(#searchList) .list-item").length&&a("#emptyList").removeClass("is-hidden"))},friendsSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase(),d=b.next();d.find("ul").removeClass("is-hidden").siblings().addClass("is-hidden"),d.find("ul li").removeClass("is-hidden"),c.length>0&&(d.find("ul li").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this);b.indexOf(c)===-1&&d.addClass("is-hidden")}),0===d.find("ul li:visible").length&&d.find(".note").removeClass("is-hidden").siblings().addClass("is-hidden"))}};var o=function(){a(".is-error").removeClass("is-error")},p=function(b){a("body").removeClass("is-welcome"),b.removeClass("is-hidden").siblings("section").addClass("is-hidden"),o(),a(".no-connection").addClass("is-hidden"),b.find("input").val(""),b.is("#mainPage")||(b.find("form").removeClass("is-hidden").next(".l-form").remove(),b.find("input:file").prev().find(".avatar").css("background-image","url("+c.defAvatar.url+")").siblings("span").text(c.defAvatar.caption),b.find("input:checkbox").prop("checked",!1),localStorage["QM.latitude"]&&localStorage["QM.longitude"]&&(localStorage.removeItem("QM.latitude"),localStorage.removeItem("QM.longitude"),h.toggleGeoCoordinatesToLocalStorage(!0,function(a,b){f.log("Location: ",b?b:a)})))},q=function(){a("body").addClass("is-welcome"),a("#welcomePage").removeClass("is-hidden").siblings("section").addClass("is-hidden")},r=function(){a(".popover:not(.j-popover_const)").fadeIn(150)};return j}),define("SettingsView",["jquery"],function(a){"use strict";function b(a){this.app=a,c=this.app.models.Settings}var c;return b.prototype={setUp:function(b){c.init(b);var d=JSON.parse(localStorage["QM.settings-"+b]);for(var e in d)a("#"+e)[0].checked=d[e]},update:function(a){c.set(a),c.save()}},b}),!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("../main");"function"==typeof define&&define.amd?define("perfectscrollbar",d):(window.PerfectScrollbar=d,"undefined"==typeof window.Ps&&(window.Ps=d))},{"../main":7}],2:[function(a,b,c){"use strict";function d(a,b){var c=a.className.split(" ");c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}function e(a,b){var c=a.className.split(" "),d=c.indexOf(b);d>=0&&c.splice(d,1),a.className=c.join(" ")}c.add=function(a,b){a.classList?a.classList.add(b):d(a,b)},c.remove=function(a,b){a.classList?a.classList.remove(b):e(a,b)},c.list=function(a){return a.classList?Array.prototype.slice.apply(a.classList):a.className.split(" ")}},{}],3:[function(a,b,c){"use strict";function d(a,b){return window.getComputedStyle(a)[b]}function e(a,b,c){return"number"==typeof c&&(c=c.toString()+"px"),a.style[b]=c,a}function f(a,b){for(var c in b){var d=b[c];"number"==typeof d&&(d=d.toString()+"px"),a.style[c]=d}return a}var g={};g.e=function(a,b){var c=document.createElement(a);return c.className=b,c},g.appendTo=function(a,b){return b.appendChild(a),a},g.css=function(a,b,c){return"object"==typeof b?f(a,b):"undefined"==typeof c?d(a,b):e(a,b,c)},g.matches=function(a,b){return"undefined"!=typeof a.matches?a.matches(b):"undefined"!=typeof a.matchesSelector?a.matchesSelector(b):"undefined"!=typeof a.webkitMatchesSelector?a.webkitMatchesSelector(b):"undefined"!=typeof a.mozMatchesSelector?a.mozMatchesSelector(b):"undefined"!=typeof a.msMatchesSelector?a.msMatchesSelector(b):void 0},g.remove=function(a){"undefined"!=typeof a.remove?a.remove():a.parentNode&&a.parentNode.removeChild(a)},g.queryChildren=function(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return g.matches(a,b)})},b.exports=g},{}],4:[function(a,b,c){"use strict";var d=function(a){this.element=a,this.events={}};d.prototype.bind=function(a,b){"undefined"==typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b),this.element.addEventListener(a,b,!1)},d.prototype.unbind=function(a,b){var c="undefined"!=typeof b;this.events[a]=this.events[a].filter(function(d){return!(!c||d===b)||(this.element.removeEventListener(a,d,!1),!1)},this)},d.prototype.unbindAll=function(){for(var a in this.events)this.unbind(a)};var e=function(){this.eventElements=[]};e.prototype.eventElement=function(a){var b=this.eventElements.filter(function(b){return b.element===a})[0];return"undefined"==typeof b&&(b=new d(a),this.eventElements.push(b)),b},e.prototype.bind=function(a,b,c){this.eventElement(a).bind(b,c)},e.prototype.unbind=function(a,b,c){this.eventElement(a).unbind(b,c)},e.prototype.unbindAll=function(){for(var a=0;a<this.eventElements.length;a++)this.eventElements[a].unbindAll()},e.prototype.once=function(a,b,c){var d=this.eventElement(a),e=function(a){d.unbind(b,e),c(a)};d.bind(b,e)},b.exports=e},{}],5:[function(a,b,c){"use strict";b.exports=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()},{}],6:[function(a,b,c){"use strict";var d=a("./class"),e=a("./dom"),f=c.toInt=function(a){return parseInt(a,10)||0},g=c.clone=function(a){if(a){if(a.constructor===Array)return a.map(g);if("object"==typeof a){var b={};for(var c in a)b[c]=g(a[c]);return b}return a}return null};c.extend=function(a,b){var c=g(a);for(var d in b)c[d]=g(b[d]);return c},c.isEditable=function(a){return e.matches(a,"input,[contenteditable]")||e.matches(a,"select,[contenteditable]")||e.matches(a,"textarea,[contenteditable]")||e.matches(a,"button,[contenteditable]")},c.removePsClasses=function(a){for(var b=d.list(a),c=0;c<b.length;c++){var e=b[c];0===e.indexOf("ps-")&&d.remove(a,e)}},c.outerWidth=function(a){return f(e.css(a,"width"))+f(e.css(a,"paddingLeft"))+f(e.css(a,"paddingRight"))+f(e.css(a,"borderLeftWidth"))+f(e.css(a,"borderRightWidth"))},c.startScrolling=function(a,b){d.add(a,"ps-in-scrolling"),"undefined"!=typeof b?d.add(a,"ps-"+b):(d.add(a,"ps-x"),d.add(a,"ps-y"))},c.stopScrolling=function(a,b){d.remove(a,"ps-in-scrolling"),"undefined"!=typeof b?d.remove(a,"ps-"+b):(d.remove(a,"ps-x"),d.remove(a,"ps-y"))},c.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(a,b,c){"use strict";var d=a("./plugin/destroy"),e=a("./plugin/initialize"),f=a("./plugin/update");b.exports={initialize:e,update:f,destroy:d}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(a,b,c){"use strict";b.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances");b.exports=function(a){var b=f.get(a);b&&(b.event.unbindAll(),e.remove(b.scrollbarX),e.remove(b.scrollbarY),e.remove(b.scrollbarXRail),e.remove(b.scrollbarYRail),d.removePsClasses(a),f.remove(a))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(a,b,c){"use strict";function d(a,b){function c(a){return a.getBoundingClientRect()}var d=function(a){a.stopPropagation()};b.event.bind(b.scrollbarY,"click",d),b.event.bind(b.scrollbarYRail,"click",function(d){var e=d.pageY-window.pageYOffset-c(b.scrollbarYRail).top,h=e>b.scrollbarYTop?1:-1;g(a,"top",a.scrollTop+h*b.containerHeight),f(a),d.stopPropagation()}),b.event.bind(b.scrollbarX,"click",d),b.event.bind(b.scrollbarXRail,"click",function(d){var e=d.pageX-window.pageXOffset-c(b.scrollbarXRail).left,h=e>b.scrollbarXLeft?1:-1;g(a,"left",a.scrollLeft+h*b.containerWidth),f(a),d.stopPropagation()})}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(a,b,c){"use strict";function d(a,b){function c(c){var e=d+c*b.railXRatio,g=Math.max(0,b.scrollbarXRail.getBoundingClientRect().left)+b.railXRatio*(b.railXWidth-b.scrollbarXWidth);e<0?b.scrollbarXLeft=0:e>g?b.scrollbarXLeft=g:b.scrollbarXLeft=e;var h=f.toInt(b.scrollbarXLeft*(b.contentWidth-b.containerWidth)/(b.containerWidth-b.railXRatio*b.scrollbarXWidth))-b.negativeScrollAdjustment;j(a,"left",h)}var d=null,e=null,h=function(b){c(b.pageX-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"x"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarX,"mousedown",function(c){e=c.pageX,d=f.toInt(g.css(b.scrollbarX,"left"))*b.railXRatio,f.startScrolling(a,"x"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}function e(a,b){function c(c){var e=d+c*b.railYRatio,g=Math.max(0,b.scrollbarYRail.getBoundingClientRect().top)+b.railYRatio*(b.railYHeight-b.scrollbarYHeight);e<0?b.scrollbarYTop=0:e>g?b.scrollbarYTop=g:b.scrollbarYTop=e;var h=f.toInt(b.scrollbarYTop*(b.contentHeight-b.containerHeight)/(b.containerHeight-b.railYRatio*b.scrollbarYHeight));j(a,"top",h)}var d=null,e=null,h=function(b){c(b.pageY-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){f.stopScrolling(a,"y"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarY,"mousedown",function(c){e=c.pageY,d=f.toInt(g.css(b.scrollbarY,"top"))*b.railYRatio,f.startScrolling(a,"y"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}var f=a("../../lib/helper"),g=a("../../lib/dom"),h=a("../instances"),i=a("../update-geometry"),j=a("../update-scroll");b.exports=function(a){var b=h.get(a);d(a,b),e(a,b)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}var d=!1;b.event.bind(a,"mouseenter",function(){d=!0}),b.event.bind(a,"mouseleave",function(){d=!1});var g=!1;b.event.bind(b.ownerDocument,"keydown",function(j){if(!(j.isDefaultPrevented&&j.isDefaultPrevented()||j.defaultPrevented)){var k=f.matches(b.scrollbarX,":focus")||f.matches(b.scrollbarY,":focus");if(d||k){var l=document.activeElement?document.activeElement:b.ownerDocument.activeElement;if(l){if("IFRAME"===l.tagName)l=l.contentDocument.activeElement;else for(;l.shadowRoot;)l=l.shadowRoot.activeElement;if(e.isEditable(l))return}var m=0,n=0;switch(j.which){case 37:m=j.metaKey?-b.contentWidth:j.altKey?-b.containerWidth:-30;break;case 38:n=j.metaKey?b.contentHeight:j.altKey?b.containerHeight:30;
break;case 39:m=j.metaKey?b.contentWidth:j.altKey?b.containerWidth:30;break;case 40:n=j.metaKey?-b.contentHeight:j.altKey?-b.containerHeight:-30;break;case 33:n=90;break;case 32:n=j.shiftKey?90:-90;break;case 34:n=-90;break;case 35:n=j.ctrlKey?-b.contentHeight:-b.containerHeight;break;case 36:n=j.ctrlKey?a.scrollTop:b.containerHeight;break;default:return}i(a,"top",a.scrollTop-n),i(a,"left",a.scrollLeft+m),h(a),g=c(m,n),g&&j.preventDefault()}}})}var e=a("../../lib/helper"),f=a("../../lib/dom"),g=a("../instances"),h=a("../update-geometry"),i=a("../update-scroll");b.exports=function(a){var b=g.get(a);d(a,b)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&d<0)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&c<0||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}function d(a){var b=a.deltaX,c=-1*a.deltaY;return"undefined"!=typeof b&&"undefined"!=typeof c||(b=-1*a.wheelDeltaX/6,c=a.wheelDeltaY/6),a.deltaMode&&1===a.deltaMode&&(b*=10,c*=10),b!==b&&c!==c&&(b=0,c=a.wheelDelta),a.shiftKey?[-c,-b]:[b,c]}function e(b,c){var d=a.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(d){if(!window.getComputedStyle(d).overflow.match(/(scroll|auto)/))return!1;var e=d.scrollHeight-d.clientHeight;if(e>0&&!(0===d.scrollTop&&c>0||d.scrollTop===e&&c<0))return!0;var f=d.scrollLeft-d.clientWidth;if(f>0&&!(0===d.scrollLeft&&b<0||d.scrollLeft===f&&b>0))return!0}return!1}function h(h){var j=d(h),k=j[0],l=j[1];e(k,l)||(i=!1,b.settings.useBothWheelAxes?b.scrollbarYActive&&!b.scrollbarXActive?(l?g(a,"top",a.scrollTop-l*b.settings.wheelSpeed):g(a,"top",a.scrollTop+k*b.settings.wheelSpeed),i=!0):b.scrollbarXActive&&!b.scrollbarYActive&&(k?g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed):g(a,"left",a.scrollLeft-l*b.settings.wheelSpeed),i=!0):(g(a,"top",a.scrollTop-l*b.settings.wheelSpeed),g(a,"left",a.scrollLeft+k*b.settings.wheelSpeed)),f(a),i=i||c(k,l),i&&(h.stopPropagation(),h.preventDefault()))}var i=!1;"undefined"!=typeof window.onwheel?b.event.bind(a,"wheel",h):"undefined"!=typeof window.onmousewheel&&b.event.bind(a,"mousewheel",h)}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(a,b,c){"use strict";function d(a,b){b.event.bind(a,"scroll",function(){f(a)})}var e=a("../instances"),f=a("../update-geometry");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":18,"../update-geometry":19}],15:[function(a,b,c){"use strict";function d(a,b){function c(){var a=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===a.toString().length?null:a.getRangeAt(0).commonAncestorContainer}function d(){j||(j=setInterval(function(){return f.get(a)?(h(a,"top",a.scrollTop+k.top),h(a,"left",a.scrollLeft+k.left),void g(a)):void clearInterval(j)},50))}function i(){j&&(clearInterval(j),j=null),e.stopScrolling(a)}var j=null,k={top:0,left:0},l=!1;b.event.bind(b.ownerDocument,"selectionchange",function(){a.contains(c())?l=!0:(l=!1,i())}),b.event.bind(window,"mouseup",function(){l&&(l=!1,i())}),b.event.bind(window,"keyup",function(){l&&(l=!1,i())}),b.event.bind(window,"mousemove",function(b){if(l){var c={x:b.pageX,y:b.pageY},f={left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,top:a.offsetTop,bottom:a.offsetTop+a.offsetHeight};c.x<f.left+3?(k.left=-5,e.startScrolling(a,"x")):c.x>f.right-3?(k.left=5,e.startScrolling(a,"x")):k.left=0,c.y<f.top+3?(f.top+3-c.y<5?k.top=-5:k.top=-20,e.startScrolling(a,"y")):c.y>f.bottom-3?(c.y-f.bottom+3<5?k.top=5:k.top=20,e.startScrolling(a,"y")):k.top=0,0===k.top&&0===k.left?i():d()}})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(a,b,c){"use strict";function d(a,b,c,d){function e(c,d){var e=a.scrollTop,f=a.scrollLeft,g=Math.abs(c),h=Math.abs(d);if(h>g){if(d<0&&e===b.contentHeight-b.containerHeight||d>0&&0===e)return!b.settings.swipePropagation}else if(g>h&&(c<0&&f===b.contentWidth-b.containerWidth||c>0&&0===f))return!b.settings.swipePropagation;return!0}function i(b,c){h(a,"top",a.scrollTop-c),h(a,"left",a.scrollLeft-b),g(a)}function j(){u=!0}function k(){u=!1}function l(a){return a.targetTouches?a.targetTouches[0]:a}function m(a){return!(!a.targetTouches||1!==a.targetTouches.length)||!(!a.pointerType||"mouse"===a.pointerType||a.pointerType===a.MSPOINTER_TYPE_MOUSE)}function n(a){if(m(a)){v=!0;var b=l(a);q.pageX=b.pageX,q.pageY=b.pageY,r=(new Date).getTime(),null!==t&&clearInterval(t),a.stopPropagation()}}function o(a){if(!v&&b.settings.swipePropagation&&n(a),!u&&v&&m(a)){var c=l(a),d={pageX:c.pageX,pageY:c.pageY},f=d.pageX-q.pageX,g=d.pageY-q.pageY;i(f,g),q=d;var h=(new Date).getTime(),j=h-r;j>0&&(s.x=f/j,s.y=g/j,r=h),e(f,g)&&(a.stopPropagation(),a.preventDefault())}}function p(){!u&&v&&(v=!1,clearInterval(t),t=setInterval(function(){return f.get(a)&&(s.x||s.y)?Math.abs(s.x)<.01&&Math.abs(s.y)<.01?void clearInterval(t):(i(30*s.x,30*s.y),s.x*=.8,void(s.y*=.8)):void clearInterval(t)},10))}var q={},r=0,s={},t=null,u=!1,v=!1;c?(b.event.bind(window,"touchstart",j),b.event.bind(window,"touchend",k),b.event.bind(a,"touchstart",n),b.event.bind(a,"touchmove",o),b.event.bind(a,"touchend",p)):d&&(window.PointerEvent?(b.event.bind(window,"pointerdown",j),b.event.bind(window,"pointerup",k),b.event.bind(a,"pointerdown",n),b.event.bind(a,"pointermove",o),b.event.bind(a,"pointerup",p)):window.MSPointerEvent&&(b.event.bind(window,"MSPointerDown",j),b.event.bind(window,"MSPointerUp",k),b.event.bind(a,"MSPointerDown",n),b.event.bind(a,"MSPointerMove",o),b.event.bind(a,"MSPointerUp",p)))}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){if(e.env.supportsTouch||e.env.supportsIePointer){var b=f.get(a);d(a,b,e.env.supportsTouch,e.env.supportsIePointer)}}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/class"),f=a("./instances"),g=a("./update-geometry"),h={"click-rail":a("./handler/click-rail"),"drag-scrollbar":a("./handler/drag-scrollbar"),keyboard:a("./handler/keyboard"),wheel:a("./handler/mouse-wheel"),touch:a("./handler/touch"),selection:a("./handler/selection")},i=a("./handler/native-scroll");b.exports=function(a,b){b="object"==typeof b?b:{},e.add(a,"ps-container");var c=f.add(a);c.settings=d.extend(c.settings,b),e.add(a,"ps-theme-"+c.settings.theme),c.settings.handlers.forEach(function(b){h[b](a)}),i(a),g(a)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(a,b,c){"use strict";function d(a){function b(){i.add(a,"ps-focus")}function c(){i.remove(a,"ps-focus")}var d=this;d.settings=h.clone(j),d.containerWidth=null,d.containerHeight=null,d.contentWidth=null,d.contentHeight=null,d.isRtl="rtl"===k.css(a,"direction"),d.isNegativeScroll=function(){var b=a.scrollLeft,c=null;return a.scrollLeft=-1,c=a.scrollLeft<0,a.scrollLeft=b,c}(),d.negativeScrollAdjustment=d.isNegativeScroll?a.scrollWidth-a.clientWidth:0,d.event=new l,d.ownerDocument=a.ownerDocument||document,d.scrollbarXRail=k.appendTo(k.e("div","ps-scrollbar-x-rail"),a),d.scrollbarX=k.appendTo(k.e("div","ps-scrollbar-x"),d.scrollbarXRail),d.scrollbarX.setAttribute("tabindex",0),d.event.bind(d.scrollbarX,"focus",b),d.event.bind(d.scrollbarX,"blur",c),d.scrollbarXActive=null,d.scrollbarXWidth=null,d.scrollbarXLeft=null,d.scrollbarXBottom=h.toInt(k.css(d.scrollbarXRail,"bottom")),d.isScrollbarXUsingBottom=d.scrollbarXBottom===d.scrollbarXBottom,d.scrollbarXTop=d.isScrollbarXUsingBottom?null:h.toInt(k.css(d.scrollbarXRail,"top")),d.railBorderXWidth=h.toInt(k.css(d.scrollbarXRail,"borderLeftWidth"))+h.toInt(k.css(d.scrollbarXRail,"borderRightWidth")),k.css(d.scrollbarXRail,"display","block"),d.railXMarginWidth=h.toInt(k.css(d.scrollbarXRail,"marginLeft"))+h.toInt(k.css(d.scrollbarXRail,"marginRight")),k.css(d.scrollbarXRail,"display",""),d.railXWidth=null,d.railXRatio=null,d.scrollbarYRail=k.appendTo(k.e("div","ps-scrollbar-y-rail"),a),d.scrollbarY=k.appendTo(k.e("div","ps-scrollbar-y"),d.scrollbarYRail),d.scrollbarY.setAttribute("tabindex",0),d.event.bind(d.scrollbarY,"focus",b),d.event.bind(d.scrollbarY,"blur",c),d.scrollbarYActive=null,d.scrollbarYHeight=null,d.scrollbarYTop=null,d.scrollbarYRight=h.toInt(k.css(d.scrollbarYRail,"right")),d.isScrollbarYUsingRight=d.scrollbarYRight===d.scrollbarYRight,d.scrollbarYLeft=d.isScrollbarYUsingRight?null:h.toInt(k.css(d.scrollbarYRail,"left")),d.scrollbarYOuterWidth=d.isRtl?h.outerWidth(d.scrollbarY):null,d.railBorderYWidth=h.toInt(k.css(d.scrollbarYRail,"borderTopWidth"))+h.toInt(k.css(d.scrollbarYRail,"borderBottomWidth")),k.css(d.scrollbarYRail,"display","block"),d.railYMarginHeight=h.toInt(k.css(d.scrollbarYRail,"marginTop"))+h.toInt(k.css(d.scrollbarYRail,"marginBottom")),k.css(d.scrollbarYRail,"display",""),d.railYHeight=null,d.railYRatio=null}function e(a){return a.getAttribute("data-ps-id")}function f(a,b){a.setAttribute("data-ps-id",b)}function g(a){a.removeAttribute("data-ps-id")}var h=a("../lib/helper"),i=a("../lib/class"),j=a("./default-setting"),k=a("../lib/dom"),l=a("../lib/event-manager"),m=a("../lib/guid"),n={};c.add=function(a){var b=m();return f(a,b),n[b]=new d(a),n[b]},c.remove=function(a){delete n[e(a)],g(a)},c.get=function(a){return n[e(a)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(a,b,c){"use strict";function d(a,b){return a.settings.minScrollbarLength&&(b=Math.max(b,a.settings.minScrollbarLength)),a.settings.maxScrollbarLength&&(b=Math.min(b,a.settings.maxScrollbarLength)),b}function e(a,b){var c={width:b.railXWidth};b.isRtl?c.left=b.negativeScrollAdjustment+a.scrollLeft+b.containerWidth-b.contentWidth:c.left=a.scrollLeft,b.isScrollbarXUsingBottom?c.bottom=b.scrollbarXBottom-a.scrollTop:c.top=b.scrollbarXTop+a.scrollTop,h.css(b.scrollbarXRail,c);var d={top:a.scrollTop,height:b.railYHeight};b.isScrollbarYUsingRight?b.isRtl?d.right=b.contentWidth-(b.negativeScrollAdjustment+a.scrollLeft)-b.scrollbarYRight-b.scrollbarYOuterWidth:d.right=b.scrollbarYRight-a.scrollLeft:b.isRtl?d.left=b.negativeScrollAdjustment+a.scrollLeft+2*b.containerWidth-b.contentWidth-b.scrollbarYLeft-b.scrollbarYOuterWidth:d.left=b.scrollbarYLeft+a.scrollLeft,h.css(b.scrollbarYRail,d),h.css(b.scrollbarX,{left:b.scrollbarXLeft,width:b.scrollbarXWidth-b.railBorderXWidth}),h.css(b.scrollbarY,{top:b.scrollbarYTop,height:b.scrollbarYHeight-b.railBorderYWidth})}var f=a("../lib/helper"),g=a("../lib/class"),h=a("../lib/dom"),i=a("./instances"),j=a("./update-scroll");b.exports=function(a){var b=i.get(a);b.containerWidth=a.clientWidth,b.containerHeight=a.clientHeight,b.contentWidth=a.scrollWidth,b.contentHeight=a.scrollHeight;var c;a.contains(b.scrollbarXRail)||(c=h.queryChildren(a,".ps-scrollbar-x-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarXRail,a)),a.contains(b.scrollbarYRail)||(c=h.queryChildren(a,".ps-scrollbar-y-rail"),c.length>0&&c.forEach(function(a){h.remove(a)}),h.appendTo(b.scrollbarYRail,a)),!b.settings.suppressScrollX&&b.containerWidth+b.settings.scrollXMarginOffset<b.contentWidth?(b.scrollbarXActive=!0,b.railXWidth=b.containerWidth-b.railXMarginWidth,b.railXRatio=b.containerWidth/b.railXWidth,b.scrollbarXWidth=d(b,f.toInt(b.railXWidth*b.containerWidth/b.contentWidth)),b.scrollbarXLeft=f.toInt((b.negativeScrollAdjustment+a.scrollLeft)*(b.railXWidth-b.scrollbarXWidth)/(b.contentWidth-b.containerWidth))):b.scrollbarXActive=!1,!b.settings.suppressScrollY&&b.containerHeight+b.settings.scrollYMarginOffset<b.contentHeight?(b.scrollbarYActive=!0,b.railYHeight=b.containerHeight-b.railYMarginHeight,b.railYRatio=b.containerHeight/b.railYHeight,b.scrollbarYHeight=d(b,f.toInt(b.railYHeight*b.containerHeight/b.contentHeight)),b.scrollbarYTop=f.toInt(a.scrollTop*(b.railYHeight-b.scrollbarYHeight)/(b.contentHeight-b.containerHeight))):b.scrollbarYActive=!1,b.scrollbarXLeft>=b.railXWidth-b.scrollbarXWidth&&(b.scrollbarXLeft=b.railXWidth-b.scrollbarXWidth),b.scrollbarYTop>=b.railYHeight-b.scrollbarYHeight&&(b.scrollbarYTop=b.railYHeight-b.scrollbarYHeight),e(a,b),b.scrollbarXActive?g.add(a,"ps-active-x"):(g.remove(a,"ps-active-x"),b.scrollbarXWidth=0,b.scrollbarXLeft=0,j(a,"left",0)),b.scrollbarYActive?g.add(a,"ps-active-y"):(g.remove(a,"ps-active-y"),b.scrollbarYHeight=0,b.scrollbarYTop=0,j(a,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(a,b,c){"use strict";var d,e,f=a("./instances"),g=function(a){var b=document.createEvent("Event");return b.initEvent(a,!0,!0),b};b.exports=function(a,b,c){if("undefined"==typeof a)throw"You must provide an element to the update-scroll function";if("undefined"==typeof b)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof c)throw"You must provide a value to the update-scroll function";"top"===b&&c<=0&&(a.scrollTop=c=0,a.dispatchEvent(g("ps-y-reach-start"))),"left"===b&&c<=0&&(a.scrollLeft=c=0,a.dispatchEvent(g("ps-x-reach-start")));var h=f.get(a);"top"===b&&c>=h.contentHeight-h.containerHeight&&(c=h.contentHeight-h.containerHeight,c-a.scrollTop<=1?c=a.scrollTop:a.scrollTop=c,a.dispatchEvent(g("ps-y-reach-end"))),"left"===b&&c>=h.contentWidth-h.containerWidth&&(c=h.contentWidth-h.containerWidth,c-a.scrollLeft<=1?c=a.scrollLeft:a.scrollLeft=c,a.dispatchEvent(g("ps-x-reach-end"))),d||(d=a.scrollTop),e||(e=a.scrollLeft),"top"===b&&c<d&&a.dispatchEvent(g("ps-scroll-up")),"top"===b&&c>d&&a.dispatchEvent(g("ps-scroll-down")),"left"===b&&c<e&&a.dispatchEvent(g("ps-scroll-left")),"left"===b&&c>e&&a.dispatchEvent(g("ps-scroll-right")),"top"===b&&(a.scrollTop=d=c,a.dispatchEvent(g("ps-scroll-y"))),"left"===b&&(a.scrollLeft=e=c,a.dispatchEvent(g("ps-scroll-x")))}},{"./instances":18}],21:[function(a,b,c){"use strict";var d=a("../lib/helper"),e=a("../lib/dom"),f=a("./instances"),g=a("./update-geometry"),h=a("./update-scroll");b.exports=function(a){var b=f.get(a);b&&(b.negativeScrollAdjustment=b.isNegativeScroll?a.scrollWidth-a.clientWidth:0,e.css(b.scrollbarXRail,"display","block"),e.css(b.scrollbarYRail,"display","block"),b.railXMarginWidth=d.toInt(e.css(b.scrollbarXRail,"marginLeft"))+d.toInt(e.css(b.scrollbarXRail,"marginRight")),b.railYMarginHeight=d.toInt(e.css(b.scrollbarYRail,"marginTop"))+d.toInt(e.css(b.scrollbarYRail,"marginBottom")),e.css(b.scrollbarXRail,"display","none"),e.css(b.scrollbarYRail,"display","none"),g(a),h(a,"top",a.scrollTop),h(a,"left",a.scrollLeft),e.css(b.scrollbarXRail,"display",""),e.css(b.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),function(a){"function"==typeof define&&define.amd?define("mCustomScrollbar",["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a:a(jQuery,window,document)}(function(a){!function(b){var c="function"==typeof define&&define.amd,d="undefined"!=typeof module&&module.exports,e="https:"==document.location.protocol?"https:":"http:",f="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";c||(d?require("jquery-mousewheel")(a):a.event.special.mousewheel||a("head").append(decodeURI("%3Cscript src="+e+"//"+f+"%3E%3C/script%3E"))),b()}(function(){var b,c="mCustomScrollbar",d="mCS",e=".mCustomScrollbar",f={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},g=0,h={},i=window.attachEvent&&!window.addEventListener?1:0,j=!1,k=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],l={init:function(b){var b=a.extend(!0,{},f,b),c=m.call(this);if(b.live){var i=b.liveSelector||this.selector||e,j=a(i);if("off"===b.live)return void o(i);h[i]=setTimeout(function(){j.mCustomScrollbar(b),"once"===b.live&&j.length&&o(i)},500)}else o(i);return b.setWidth=b.set_width?b.set_width:b.setWidth,b.setHeight=b.set_height?b.set_height:b.setHeight,b.axis=b.horizontalScroll?"x":p(b.axis),b.scrollInertia=b.scrollInertia>0&&b.scrollInertia<17?17:b.scrollInertia,"object"!=typeof b.mouseWheel&&1==b.mouseWheel&&(b.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),b.mouseWheel.scrollAmount=b.mouseWheelPixels?b.mouseWheelPixels:b.mouseWheel.scrollAmount,b.mouseWheel.normalizeDelta=b.advanced.normalizeMouseWheelDelta?b.advanced.normalizeMouseWheelDelta:b.mouseWheel.normalizeDelta,b.scrollButtons.scrollType=q(b.scrollButtons.scrollType),n(b),a(c).each(function(){var c=a(this);if(!c.data(d)){c.data(d,{idx:++g,opt:b,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:c.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var e=c.data(d),f=e.opt,h=c.data("mcs-axis"),i=c.data("mcs-scrollbar-position"),j=c.data("mcs-theme");h&&(f.axis=h),i&&(f.scrollbarPosition=i),j&&(f.theme=j,n(f)),r.call(this),e&&f.callbacks.onCreate&&"function"==typeof f.callbacks.onCreate&&f.callbacks.onCreate.call(this),a("#mCSB_"+e.idx+"_container img:not(."+k[2]+")").addClass(k[2]),l.update.call(null,c)}})},update:function(b,c){var e=b||m.call(this);return a(e).each(function(){var b=a(this);if(b.data(d)){var e=b.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container"),h=a("#mCSB_"+e.idx),i=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];if(!g.length)return;e.tweenRunning&&W(b),c&&e&&f.callbacks.onBeforeUpdate&&"function"==typeof f.callbacks.onBeforeUpdate&&f.callbacks.onBeforeUpdate.call(this),b.hasClass(k[3])&&b.removeClass(k[3]),b.hasClass(k[4])&&b.removeClass(k[4]),h.css("max-height","none"),h.height()!==b.height()&&h.css("max-height",b.height()),t.call(this),"y"===f.axis||f.advanced.autoExpandHorizontalScroll||g.css("width",s(g)),e.overflowed=y.call(this),C.call(this),f.autoDraggerLength&&v.call(this),w.call(this),A.call(this);var j=[Math.abs(g[0].offsetTop),Math.abs(g[0].offsetLeft)];"x"!==f.axis&&(e.overflowed[0]?i[0].height()>i[0].parent().height()?z.call(this):(X(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}),e.contentReset.y=null):(z.call(this),"y"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[1]&&X(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==f.axis&&(e.overflowed[1]?i[1].width()>i[1].parent().width()?z.call(this):(X(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}),e.contentReset.x=null):(z.call(this),"x"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[0]&&X(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),c&&e&&(2===c&&f.callbacks.onImageLoad&&"function"==typeof f.callbacks.onImageLoad?f.callbacks.onImageLoad.call(this):3===c&&f.callbacks.onSelectorChange&&"function"==typeof f.callbacks.onSelectorChange?f.callbacks.onSelectorChange.call(this):f.callbacks.onUpdate&&"function"==typeof f.callbacks.onUpdate&&f.callbacks.onUpdate.call(this)),U.call(this)}})},scrollTo:function(b,c){if("undefined"!=typeof b&&null!=b){var e=m.call(this);return a(e).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h={trigger:"external",scrollInertia:g.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},i=a.extend(!0,{},h,c),j=S.call(this,b),k=i.scrollInertia>0&&i.scrollInertia<17?17:i.scrollInertia;j[0]=T.call(this,j[0],"y"),j[1]=T.call(this,j[1],"x"),i.moveDragger&&(j[0]*=f.scrollRatio.y,j[1]*=f.scrollRatio.x),i.dur=ea()?0:k,setTimeout(function(){null!==j[0]&&"undefined"!=typeof j[0]&&"x"!==g.axis&&f.overflowed[0]&&(i.dir="y",i.overwrite="all",X(e,j[0].toString(),i)),null!==j[1]&&"undefined"!=typeof j[1]&&"y"!==g.axis&&f.overflowed[1]&&(i.dir="x",i.overwrite="none",X(e,j[1].toString(),i))},i.timeout)}})}},stop:function(){var b=m.call(this);return a(b).each(function(){var b=a(this);b.data(d)&&W(b)})},disable:function(b){var c=m.call(this);return a(c).each(function(){var c=a(this);if(c.data(d)){c.data(d);U.call(this,"remove"),B.call(this),b&&z.call(this),C.call(this,!0),c.addClass(k[3])}})},destroy:function(){var b=m.call(this);return a(b).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx),i=a("#mCSB_"+f.idx+"_container"),j=a(".mCSB_"+f.idx+"_scrollbar");g.live&&o(g.liveSelector||a(b).selector),U.call(this,"remove"),B.call(this),z.call(this),e.removeData(d),_(this,"mcs"),j.remove(),i.find("img."+k[2]).removeClass(k[2]),h.replaceWith(i.contents()),e.removeClass(c+" _"+d+"_"+f.idx+" "+k[6]+" "+k[7]+" "+k[5]+" "+k[3]).addClass(k[4])}})}},m=function(){return"object"!=typeof a(this)||a(this).length<1?e:this},n=function(b){var c=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],d=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],e=["minimal","minimal-dark"],f=["minimal","minimal-dark"],g=["minimal","minimal-dark"];b.autoDraggerLength=!(a.inArray(b.theme,c)>-1)&&b.autoDraggerLength,b.autoExpandScrollbar=!(a.inArray(b.theme,d)>-1)&&b.autoExpandScrollbar,b.scrollButtons.enable=!(a.inArray(b.theme,e)>-1)&&b.scrollButtons.enable,b.autoHideScrollbar=a.inArray(b.theme,f)>-1||b.autoHideScrollbar,b.scrollbarPosition=a.inArray(b.theme,g)>-1?"outside":b.scrollbarPosition},o=function(a){h[a]&&(clearTimeout(h[a]),_(h,a))},p=function(a){return"yx"===a||"xy"===a||"auto"===a?"yx":"x"===a||"horizontal"===a?"x":"y"},q=function(a){return"stepped"===a||"pixels"===a||"step"===a||"click"===a?"stepped":"stepless"},r=function(){var b=a(this),e=b.data(d),f=e.opt,g=f.autoExpandScrollbar?" "+k[1]+"_expand":"",h=["<div id='mCSB_"+e.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_vertical"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+e.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_horizontal"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],i="yx"===f.axis?"mCSB_vertical_horizontal":"x"===f.axis?"mCSB_horizontal":"mCSB_vertical",j="yx"===f.axis?h[0]+h[1]:"x"===f.axis?h[1]:h[0],l="yx"===f.axis?"<div id='mCSB_"+e.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",m=f.autoHideScrollbar?" "+k[6]:"",n="x"!==f.axis&&"rtl"===e.langDir?" "+k[7]:"";f.setWidth&&b.css("width",f.setWidth),f.setHeight&&b.css("height",f.setHeight),f.setLeft="y"!==f.axis&&"rtl"===e.langDir?"989999px":f.setLeft,b.addClass(c+" _"+d+"_"+e.idx+m+n).wrapInner("<div id='mCSB_"+e.idx+"' class='mCustomScrollBox mCS-"+f.theme+" "+i+"'><div id='mCSB_"+e.idx+"_container' class='mCSB_container' style='position:relative; top:"+f.setTop+"; left:"+f.setLeft+";' dir='"+e.langDir+"' /></div>");var o=a("#mCSB_"+e.idx),p=a("#mCSB_"+e.idx+"_container");"y"===f.axis||f.advanced.autoExpandHorizontalScroll||p.css("width",s(p)),"outside"===f.scrollbarPosition?("static"===b.css("position")&&b.css("position","relative"),b.css("overflow","visible"),o.addClass("mCSB_outside").after(j)):(o.addClass("mCSB_inside").append(j),p.wrap(l)),u.call(this);var q=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];q[0].css("min-height",q[0].height()),q[1].css("min-width",q[1].width())},s=function(b){var c=[b[0].scrollWidth,Math.max.apply(Math,b.children().map(function(){return a(this).outerWidth(!0)}).get())],d=b.parent().width();return c[0]>d?c[0]:c[1]>d?c[1]:"100%"},t=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx+"_container");if(e.advanced.autoExpandHorizontalScroll&&"y"!==e.axis){f.css({width:"auto","min-width":0,"overflow-x":"scroll"});var g=Math.ceil(f[0].scrollWidth);3===e.advanced.autoExpandHorizontalScroll||2!==e.advanced.autoExpandHorizontalScroll&&g>f.parent().width()?f.css({width:g,"min-width":"100%","overflow-x":"inherit"}):f.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(f[0].getBoundingClientRect().right+.4)-Math.floor(f[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},u=function(){var b=a(this),c=b.data(d),e=c.opt,f=a(".mCSB_"+c.idx+"_scrollbar:first"),g=ca(e.scrollButtons.tabindex)?"tabindex='"+e.scrollButtons.tabindex+"'":"",h=["<a href='#' class='"+k[13]+"' "+g+" />","<a href='#' class='"+k[14]+"' "+g+" />","<a href='#' class='"+k[15]+"' "+g+" />","<a href='#' class='"+k[16]+"' "+g+" />"],i=["x"===e.axis?h[2]:h[0],"x"===e.axis?h[3]:h[1],h[2],h[3]];e.scrollButtons.enable&&f.prepend(i[0]).append(i[1]).next(".mCSB_scrollTools").prepend(i[2]).append(i[3])},v=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[e.height()/f.outerHeight(!1),e.width()/f.outerWidth(!1)],j=[parseInt(g[0].css("min-height")),Math.round(h[0]*g[0].parent().height()),parseInt(g[1].css("min-width")),Math.round(h[1]*g[1].parent().width())],k=i&&j[1]<j[0]?j[0]:j[1],l=i&&j[3]<j[2]?j[2]:j[3];g[0].css({height:k,"max-height":g[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":j[0]+"px"}),g[1].css({width:l,"max-width":g[1].parent().width()-10})},w=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[f.outerHeight(!1)-e.height(),f.outerWidth(!1)-e.width()],i=[h[0]/(g[0].parent().height()-g[0].height()),h[1]/(g[1].parent().width()-g[1].width())];c.scrollRatio={y:i[0],x:i[1]}},x=function(a,b,c){var d=c?k[0]+"_expanded":"",e=a.closest(".mCSB_scrollTools");"active"===b?(a.toggleClass(k[0]+" "+d),e.toggleClass(k[1]),a[0]._draggable=a[0]._draggable?0:1):a[0]._draggable||("hide"===b?(a.removeClass(k[0]),e.removeClass(k[1])):(a.addClass(k[0]),e.addClass(k[1])))},y=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=null==c.overflowed?f.height():f.outerHeight(!1),h=null==c.overflowed?f.width():f.outerWidth(!1),i=f[0].scrollHeight,j=f[0].scrollWidth;return i>g&&(g=i),j>h&&(h=j),[g>e.height(),h>e.width()]},z=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx),g=a("#mCSB_"+c.idx+"_container"),h=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")];if(W(b),("x"!==e.axis&&!c.overflowed[0]||"y"===e.axis&&c.overflowed[0])&&(h[0].add(g).css("top",0),X(b,"_resetY")),"y"!==e.axis&&!c.overflowed[1]||"x"===e.axis&&c.overflowed[1]){var i=dx=0;"rtl"===c.langDir&&(i=f.width()-g.outerWidth(!1),dx=Math.abs(i/c.scrollRatio.x)),g.css("left",i),h[1].css("left",dx),X(b,"_resetX")}},A=function(){function b(){g=setTimeout(function(){a.event.special.mousewheel?(clearTimeout(g),H.call(c[0])):b()},100)}var c=a(this),e=c.data(d),f=e.opt;if(!e.bindEvents){if(E.call(this),f.contentTouchScroll&&F.call(this),G.call(this),f.mouseWheel.enable){var g;b()}M.call(this),O.call(this),f.advanced.autoScrollOnFocus&&N.call(this),f.scrollButtons.enable&&P.call(this),f.keyboard.enable&&Q.call(this),e.bindEvents=!0}},B=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=".mCSB_"+c.idx+"_scrollbar",h=a("#mCSB_"+c.idx+",#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,"+g+" ."+k[12]+",#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal,"+g+">a"),i=a("#mCSB_"+c.idx+"_container");e.advanced.releaseDraggableSelectors&&h.add(a(e.advanced.releaseDraggableSelectors)),e.advanced.extraDraggableSelectors&&h.add(a(e.advanced.extraDraggableSelectors)),c.bindEvents&&(a(document).add(a(!J()||top.document)).unbind("."+f),h.each(function(){a(this).unbind("."+f)}),clearTimeout(b[0]._focusTimeout),_(b[0],"_focusTimeout"),clearTimeout(c.sequential.step),_(c.sequential,"step"),clearTimeout(i[0].onCompleteTimeout),_(i[0],"onCompleteTimeout"),c.bindEvents=!1)},C=function(b){var c=a(this),e=c.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container_wrapper"),h=g.length?g:a("#mCSB_"+e.idx+"_container"),i=[a("#mCSB_"+e.idx+"_scrollbar_vertical"),a("#mCSB_"+e.idx+"_scrollbar_horizontal")],j=[i[0].find(".mCSB_dragger"),i[1].find(".mCSB_dragger")];"x"!==f.axis&&(e.overflowed[0]&&!b?(i[0].add(j[0]).add(i[0].children("a")).css("display","block"),h.removeClass(k[8]+" "+k[10])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[0].css("display","none"),h.removeClass(k[10])):(i[0].css("display","none"),h.addClass(k[10])),h.addClass(k[8]))),"y"!==f.axis&&(e.overflowed[1]&&!b?(i[1].add(j[1]).add(i[1].children("a")).css("display","block"),h.removeClass(k[9]+" "+k[11])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[1].css("display","none"),h.removeClass(k[11])):(i[1].css("display","none"),h.addClass(k[11])),h.addClass(k[9]))),e.overflowed[0]||e.overflowed[1]?c.removeClass(k[5]):c.addClass(k[5])},D=function(b){var c=b.type,d=b.target.ownerDocument!==document&&null!==frameElement?[a(frameElement).offset().top,a(frameElement).offset().left]:null,e=J()&&b.target.ownerDocument!==top.document&&null!==frameElement?[a(b.view.frameElement).offset().top,a(b.view.frameElement).offset().left]:[0,0];switch(c){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return d?[b.originalEvent.pageY-d[0]+e[0],b.originalEvent.pageX-d[1]+e[1],!1]:[b.originalEvent.pageY,b.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var f=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],g=b.originalEvent.touches.length||b.originalEvent.changedTouches.length;return b.target.ownerDocument!==document?[f.screenY,f.screenX,g>1]:[f.pageY,f.pageX,g>1];default:return d?[b.pageY-d[0]+e[0],b.pageX-d[1]+e[1],!1]:[b.pageY,b.pageX,!1]}},E=function(){function b(a,b,d,e){if(n[0].idleTimer=k.scrollInertia<233?250:0,c.attr("id")===m[1])var f="x",i=(c[0].offsetLeft-b+e)*h.scrollRatio.x;else var f="y",i=(c[0].offsetTop-a+d)*h.scrollRatio.y;X(g,i.toString(),{dir:f,drag:!0})}var c,e,f,g=a(this),h=g.data(d),k=h.opt,l=d+"_"+h.idx,m=["mCSB_"+h.idx+"_dragger_vertical","mCSB_"+h.idx+"_dragger_horizontal"],n=a("#mCSB_"+h.idx+"_container"),o=a("#"+m[0]+",#"+m[1]),p=k.advanced.releaseDraggableSelectors?o.add(a(k.advanced.releaseDraggableSelectors)):o,q=k.advanced.extraDraggableSelectors?a(!J()||top.document).add(a(k.advanced.extraDraggableSelectors)):a(!J()||top.document);
o.bind("contextmenu."+l,function(a){a.preventDefault()}).bind("mousedown."+l+" touchstart."+l+" pointerdown."+l+" MSPointerDown."+l,function(b){if(b.stopImmediatePropagation(),b.preventDefault(),aa(b)){j=!0,i&&(document.onselectstart=function(){return!1}),K.call(n,!1),W(g),c=a(this);var d=c.offset(),h=D(b)[0]-d.top,l=D(b)[1]-d.left,m=c.height()+d.top,o=c.width()+d.left;h<m&&h>0&&l<o&&l>0&&(e=h,f=l),x(c,"active",k.autoExpandScrollbar)}}).bind("touchmove."+l,function(a){a.stopImmediatePropagation(),a.preventDefault();var d=c.offset(),g=D(a)[0]-d.top,h=D(a)[1]-d.left;b(e,f,g,h)}),a(document).add(q).bind("mousemove."+l+" pointermove."+l+" MSPointerMove."+l,function(a){if(c){var d=c.offset(),g=D(a)[0]-d.top,h=D(a)[1]-d.left;if(e===g&&f===h)return;b(e,f,g,h)}}).add(p).bind("mouseup."+l+" touchend."+l+" pointerup."+l+" MSPointerUp."+l,function(a){c&&(x(c,"active",k.autoExpandScrollbar),c=null),j=!1,i&&(document.onselectstart=null),K.call(n,!0)})},F=function(){function c(a){if(!ba(a)||j||D(a)[2])return void(b=0);b=1,w=0,x=0,k=1,y.removeClass("mCS_touch_action");var c=E.offset();l=D(a)[0]-c.top,m=D(a)[1]-c.left,L=[D(a)[0],D(a)[1]]}function e(a){if(ba(a)&&!j&&!D(a)[2]&&(A.documentTouchScroll||a.preventDefault(),a.stopImmediatePropagation(),(!x||w)&&k)){q=Z();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left,e="mcsLinearOut";if(G.push(c),H.push(d),L[2]=Math.abs(D(a)[0]-L[0]),L[3]=Math.abs(D(a)[1]-L[1]),z.overflowed[0])var f=F[0].parent().height()-F[0].height(),g=l-c>0&&c-l>-(f*z.scrollRatio.y)&&(2*L[3]<L[2]||"yx"===A.axis);if(z.overflowed[1])var h=F[1].parent().width()-F[1].width(),n=m-d>0&&d-m>-(h*z.scrollRatio.x)&&(2*L[2]<L[3]||"yx"===A.axis);g||n?(O||a.preventDefault(),w=1):(x=1,y.addClass("mCS_touch_action")),O&&a.preventDefault(),u="yx"===A.axis?[l-c,m-d]:"x"===A.axis?[null,m-d]:[l-c,null],E[0].idleTimer=250,z.overflowed[0]&&i(u[0],I,e,"y","all",!0),z.overflowed[1]&&i(u[1],I,e,"x",K,!0)}}function f(a){if(!ba(a)||j||D(a)[2])return void(b=0);b=1,a.stopImmediatePropagation(),W(y),p=Z();var c=C.offset();n=D(a)[0]-c.top,o=D(a)[1]-c.left,G=[],H=[]}function g(a){if(ba(a)&&!j&&!D(a)[2]){k=0,a.stopImmediatePropagation(),w=0,x=0,r=Z();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left;if(!(r-q>30)){t=1e3/(r-p);var e="mcsEaseOut",f=t<2.5,g=f?[G[G.length-2],H[H.length-2]]:[0,0];s=f?[c-g[0],d-g[1]]:[c-n,d-o];var l=[Math.abs(s[0]),Math.abs(s[1])];t=f?[Math.abs(s[0]/4),Math.abs(s[1]/4)]:[t,t];var m=[Math.abs(E[0].offsetTop)-s[0]*h(l[0]/t[0],t[0]),Math.abs(E[0].offsetLeft)-s[1]*h(l[1]/t[1],t[1])];u="yx"===A.axis?[m[0],m[1]]:"x"===A.axis?[null,m[1]]:[m[0],null],v=[4*l[0]+A.scrollInertia,4*l[1]+A.scrollInertia];var y=parseInt(A.contentTouchScroll)||0;u[0]=l[0]>y?u[0]:0,u[1]=l[1]>y?u[1]:0,z.overflowed[0]&&i(u[0],v[0],e,"y",K,!1),z.overflowed[1]&&i(u[1],v[1],e,"x",K,!1)}}}function h(a,b){var c=[1.5*b,2*b,b/1.5,b/2];return a>90?b>4?c[0]:c[3]:a>60?b>3?c[3]:c[2]:a>30?b>8?c[1]:b>6?c[0]:b>4?b:c[2]:b>8?b:c[3]}function i(a,b,c,d,e,f){a&&X(y,a.toString(),{dur:b,scrollEasing:c,dir:d,overwrite:e,drag:f})}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a(this),z=y.data(d),A=z.opt,B=d+"_"+z.idx,C=a("#mCSB_"+z.idx),E=a("#mCSB_"+z.idx+"_container"),F=[a("#mCSB_"+z.idx+"_dragger_vertical"),a("#mCSB_"+z.idx+"_dragger_horizontal")],G=[],H=[],I=0,K="yx"===A.axis?"none":"all",L=[],M=E.find("iframe"),N=["touchstart."+B+" pointerdown."+B+" MSPointerDown."+B,"touchmove."+B+" pointermove."+B+" MSPointerMove."+B,"touchend."+B+" pointerup."+B+" MSPointerUp."+B],O=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;E.bind(N[0],function(a){c(a)}).bind(N[1],function(a){e(a)}),C.bind(N[0],function(a){f(a)}).bind(N[2],function(a){g(a)}),M.length&&M.each(function(){a(this).bind("load",function(){J(this)&&a(this.contentDocument||this.contentWindow.document).bind(N[0],function(a){c(a),f(a)}).bind(N[1],function(a){e(a)}).bind(N[2],function(a){g(a)})})})},G=function(){function c(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function e(a,b,c){k.type=c&&f?"stepped":"stepless",k.scrollAmount=10,R(g,a,b,"mcsLinearOut",c?60:null)}var f,g=a(this),h=g.data(d),i=h.opt,k=h.sequential,l=d+"_"+h.idx,m=a("#mCSB_"+h.idx+"_container"),n=m.parent();m.bind("mousedown."+l,function(a){b||f||(f=1,j=!0)}).add(document).bind("mousemove."+l,function(a){if(!b&&f&&c()){var d=m.offset(),g=D(a)[0]-d.top+m[0].offsetTop,j=D(a)[1]-d.left+m[0].offsetLeft;g>0&&g<n.height()&&j>0&&j<n.width()?k.step&&e("off",null,"stepped"):("x"!==i.axis&&h.overflowed[0]&&(g<0?e("on",38):g>n.height()&&e("on",40)),"y"!==i.axis&&h.overflowed[1]&&(j<0?e("on",37):j>n.width()&&e("on",39)))}}).bind("mouseup."+l+" dragend."+l,function(a){b||(f&&(f=0,e("off",null)),j=!1)})},H=function(){function b(b,d){if(W(c),!L(c,b.target)){var g="auto"!==f.mouseWheel.deltaFactor?parseInt(f.mouseWheel.deltaFactor):i&&b.deltaFactor<100?100:b.deltaFactor||100,k=f.scrollInertia;if("x"===f.axis||"x"===f.mouseWheel.axis)var l="x",m=[Math.round(g*e.scrollRatio.x),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.width()?.9*h.width():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetLeft),p=j[1][0].offsetLeft,q=j[1].parent().width()-j[1].width(),r="y"===f.mouseWheel.axis?b.deltaY||d:b.deltaX;else var l="y",m=[Math.round(g*e.scrollRatio.y),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.height()?.9*h.height():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetTop),p=j[0][0].offsetTop,q=j[0].parent().height()-j[0].height(),r=b.deltaY||d;"y"===l&&!e.overflowed[0]||"x"===l&&!e.overflowed[1]||((f.mouseWheel.invert||b.webkitDirectionInvertedFromDevice)&&(r=-r),f.mouseWheel.normalizeDelta&&(r=r<0?-1:1),(r>0&&0!==p||r<0&&p!==q||f.mouseWheel.preventDefault)&&(b.stopImmediatePropagation(),b.preventDefault()),b.deltaFactor<5&&!f.mouseWheel.normalizeDelta&&(n=b.deltaFactor,k=17),X(c,(o-r*n).toString(),{dir:l,dur:k}))}}if(a(this).data(d)){var c=a(this),e=c.data(d),f=e.opt,g=d+"_"+e.idx,h=a("#mCSB_"+e.idx),j=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")],k=a("#mCSB_"+e.idx+"_container").find("iframe");k.length&&k.each(function(){a(this).bind("load",function(){J(this)&&a(this.contentDocument||this.contentWindow.document).bind("mousewheel."+g,function(a,c){b(a,c)})})}),h.bind("mousewheel."+g,function(a,c){b(a,c)})}},I=new Object,J=function(b){var c=!1,d=!1,e=null;if(void 0===b?d="#empty":void 0!==a(b).attr("id")&&(d=a(b).attr("id")),d!==!1&&void 0!==I[d])return I[d];if(b){try{var f=b.contentDocument||b.contentWindow.document;e=f.body.innerHTML}catch(g){}c=null!==e}else{try{var f=top.document;e=f.body.innerHTML}catch(g){}c=null!==e}return d!==!1&&(I[d]=c),c},K=function(a){var b=this.find("iframe");if(b.length){var c=a?"auto":"none";b.css("pointer-events",c)}},L=function(b,c){var e=c.nodeName.toLowerCase(),f=b.data(d).opt.mouseWheel.disableOver,g=["select","textarea"];return a.inArray(e,f)>-1&&!(a.inArray(e,g)>-1&&!a(c).is(":focus"))},M=function(){var b,c=a(this),e=c.data(d),f=d+"_"+e.idx,g=a("#mCSB_"+e.idx+"_container"),h=g.parent(),i=a(".mCSB_"+e.idx+"_scrollbar ."+k[12]);i.bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(c){j=!0,a(c.target).hasClass("mCSB_dragger")||(b=1)}).bind("touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(a){j=!1}).bind("click."+f,function(d){if(b&&(b=0,a(d.target).hasClass(k[12])||a(d.target).hasClass("mCSB_draggerRail"))){W(c);var f=a(this),i=f.find(".mCSB_dragger");if(f.parent(".mCSB_scrollTools_horizontal").length>0){if(!e.overflowed[1])return;var j="x",l=d.pageX>i.offset().left?-1:1,m=Math.abs(g[0].offsetLeft)-l*(.9*h.width())}else{if(!e.overflowed[0])return;var j="y",l=d.pageY>i.offset().top?-1:1,m=Math.abs(g[0].offsetTop)-l*(.9*h.height())}X(c,m.toString(),{dir:j,scrollEasing:"mcsEaseInOut"})}})},N=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=a("#mCSB_"+c.idx+"_container"),h=g.parent();g.bind("focusin."+f,function(c){var d=a(document.activeElement),f=g.find(".mCustomScrollBox").length,i=0;d.is(e.advanced.autoScrollOnFocus)&&(W(b),clearTimeout(b[0]._focusTimeout),b[0]._focusTimer=f?(i+17)*f:0,b[0]._focusTimeout=setTimeout(function(){var a=[da(d)[0],da(d)[1]],c=[g[0].offsetTop,g[0].offsetLeft],f=[c[0]+a[0]>=0&&c[0]+a[0]<h.height()-d.outerHeight(!1),c[1]+a[1]>=0&&c[0]+a[1]<h.width()-d.outerWidth(!1)],j="yx"!==e.axis||f[0]||f[1]?"all":"none";"x"===e.axis||f[0]||X(b,a[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i}),"y"===e.axis||f[1]||X(b,a[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i})},b[0]._focusTimer))})},O=function(){var b=a(this),c=b.data(d),e=d+"_"+c.idx,f=a("#mCSB_"+c.idx+"_container").parent();f.bind("scroll."+e,function(b){0===f.scrollTop()&&0===f.scrollLeft()||a(".mCSB_"+c.idx+"_scrollbar").css("visibility","hidden")})},P=function(){var b=a(this),c=b.data(d),e=c.opt,f=c.sequential,g=d+"_"+c.idx,h=".mCSB_"+c.idx+"_scrollbar",i=a(h+">a");i.bind("contextmenu."+g,function(a){a.preventDefault()}).bind("mousedown."+g+" touchstart."+g+" pointerdown."+g+" MSPointerDown."+g+" mouseup."+g+" touchend."+g+" pointerup."+g+" MSPointerUp."+g+" mouseout."+g+" pointerout."+g+" MSPointerOut."+g+" click."+g,function(d){function g(a,c){f.scrollAmount=e.scrollButtons.scrollAmount,R(b,a,c)}if(d.preventDefault(),aa(d)){var h=a(this).attr("class");switch(f.type=e.scrollButtons.scrollType,d.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===f.type)return;j=!0,c.tweenRunning=!1,g("on",h);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===f.type)return;j=!1,f.dir&&g("off",h);break;case"click":if("stepped"!==f.type||c.tweenRunning)return;g("on",h)}}})},Q=function(){function b(b){function d(a,b){g.type=f.keyboard.scrollType,g.scrollAmount=f.keyboard.scrollAmount,"stepped"===g.type&&e.tweenRunning||R(c,a,b)}switch(b.type){case"blur":e.tweenRunning&&g.dir&&d("off",null);break;case"keydown":case"keyup":var h=b.keyCode?b.keyCode:b.which,i="on";if("x"!==f.axis&&(38===h||40===h)||"y"!==f.axis&&(37===h||39===h)){if((38===h||40===h)&&!e.overflowed[0]||(37===h||39===h)&&!e.overflowed[1])return;"keyup"===b.type&&(i="off"),a(document.activeElement).is(l)||(b.preventDefault(),b.stopImmediatePropagation(),d(i,h))}else if(33===h||34===h){if((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type){W(c);var m=34===h?-1:1;if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=Math.abs(j[0].offsetLeft)-m*(.9*k.width());else var n="y",o=Math.abs(j[0].offsetTop)-m*(.9*k.height());X(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}else if((35===h||36===h)&&!a(document.activeElement).is(l)&&((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type)){if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=35===h?Math.abs(k.width()-j.outerWidth(!1)):0;else var n="y",o=35===h?Math.abs(k.height()-j.outerHeight(!1)):0;X(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}}var c=a(this),e=c.data(d),f=e.opt,g=e.sequential,h=d+"_"+e.idx,i=a("#mCSB_"+e.idx),j=a("#mCSB_"+e.idx+"_container"),k=j.parent(),l="input,textarea,select,datalist,keygen,[contenteditable='true']",m=j.find("iframe"),n=["blur."+h+" keydown."+h+" keyup."+h];m.length&&m.each(function(){a(this).bind("load",function(){J(this)&&a(this.contentDocument||this.contentWindow.document).bind(n[0],function(a){b(a)})})}),i.attr("tabindex","0").bind(n[0],function(a){b(a)})},R=function(b,c,e,f,g){function h(a){l.snapAmount&&(m.scrollAmount=l.snapAmount instanceof Array?"x"===m.dir[0]?l.snapAmount[1]:l.snapAmount[0]:l.snapAmount);var c="stepped"!==m.type,d=g?g:a?c?p/1.5:q:1e3/60,e=a?c?7.5:40:2.5,i=[Math.abs(n[0].offsetTop),Math.abs(n[0].offsetLeft)],k=[j.scrollRatio.y>10?10:j.scrollRatio.y,j.scrollRatio.x>10?10:j.scrollRatio.x],o="x"===m.dir[0]?i[1]+m.dir[1]*(k[1]*e):i[0]+m.dir[1]*(k[0]*e),r="x"===m.dir[0]?i[1]+m.dir[1]*parseInt(m.scrollAmount):i[0]+m.dir[1]*parseInt(m.scrollAmount),s="auto"!==m.scrollAmount?r:o,t=f?f:a?c?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",u=!!a;return a&&d<17&&(s="x"===m.dir[0]?i[1]:i[0]),X(b,s.toString(),{dir:m.dir[0],scrollEasing:t,dur:d,onComplete:u}),a?void(m.dir=!1):(clearTimeout(m.step),void(m.step=setTimeout(function(){h()},d)))}function i(){clearTimeout(m.step),_(m,"step"),W(b)}var j=b.data(d),l=j.opt,m=j.sequential,n=a("#mCSB_"+j.idx+"_container"),o="stepped"===m.type,p=l.scrollInertia<26?26:l.scrollInertia,q=l.scrollInertia<1?17:l.scrollInertia;switch(c){case"on":if(m.dir=[e===k[16]||e===k[15]||39===e||37===e?"x":"y",e===k[13]||e===k[15]||38===e||37===e?-1:1],W(b),ca(e)&&"stepped"===m.type)return;h(o);break;case"off":i(),(o||j.tweenRunning&&m.dir)&&h(!0)}},S=function(b){var c=a(this).data(d).opt,e=[];return"function"==typeof b&&(b=b()),b instanceof Array?e=b.length>1?[b[0],b[1]]:"x"===c.axis?[null,b[0]]:[b[0],null]:(e[0]=b.y?b.y:b.x||"x"===c.axis?null:b,e[1]=b.x?b.x:b.y||"y"===c.axis?null:b),"function"==typeof e[0]&&(e[0]=e[0]()),"function"==typeof e[1]&&(e[1]=e[1]()),e},T=function(b,c){if(null!=b&&"undefined"!=typeof b){var e=a(this),f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx+"_container"),i=h.parent(),j=typeof b;c||(c="x"===g.axis?"x":"y");var k="x"===c?h.outerWidth(!1)-i.width():h.outerHeight(!1)-i.height(),m="x"===c?h[0].offsetLeft:h[0].offsetTop,n="x"===c?"left":"top";switch(j){case"function":return b();case"object":var o=b.jquery?b:a(b);if(!o.length)return;return"x"===c?da(o)[1]:da(o)[0];case"string":case"number":if(ca(b))return Math.abs(b);if(b.indexOf("%")!==-1)return Math.abs(k*parseInt(b)/100);if(b.indexOf("-=")!==-1)return Math.abs(m-parseInt(b.split("-=")[1]));if(b.indexOf("+=")!==-1){var p=m+parseInt(b.split("+=")[1]);return p>=0?0:Math.abs(p)}if(b.indexOf("px")!==-1&&ca(b.split("px")[0]))return Math.abs(b.split("px")[0]);if("top"===b||"left"===b)return 0;if("bottom"===b)return Math.abs(i.height()-h.outerHeight(!1));if("right"===b)return Math.abs(i.width()-h.outerWidth(!1));if("first"===b||"last"===b){var o=h.find(":"+b);return"x"===c?da(o)[1]:da(o)[0]}return a(b).length?"x"===c?da(a(b))[1]:da(a(b))[0]:(h.css(n,b),void l.update.call(null,e[0]))}}},U=function(b){function c(){return clearTimeout(m[0].autoUpdate),0===h.parents("html").length?void(h=null):void(m[0].autoUpdate=setTimeout(function(){return j.advanced.updateOnSelectorChange&&(i.poll.change.n=f(),i.poll.change.n!==i.poll.change.o)?(i.poll.change.o=i.poll.change.n,void g(3)):j.advanced.updateOnContentResize&&(i.poll.size.n=h[0].scrollHeight+h[0].scrollWidth+m[0].offsetHeight+h[0].offsetHeight+h[0].offsetWidth,i.poll.size.n!==i.poll.size.o)?(i.poll.size.o=i.poll.size.n,void g(1)):!j.advanced.updateOnImageLoad||"auto"===j.advanced.updateOnImageLoad&&"y"===j.axis||(i.poll.img.n=m.find("img").length,i.poll.img.n===i.poll.img.o)?void((j.advanced.updateOnSelectorChange||j.advanced.updateOnContentResize||j.advanced.updateOnImageLoad)&&c()):(i.poll.img.o=i.poll.img.n,void m.find("img").each(function(){e(this)}))},j.advanced.autoUpdateTimeout))}function e(b){function c(a,b){return function(){return b.apply(a,arguments)}}function d(){this.onload=null,a(b).addClass(k[2]),g(2)}if(a(b).hasClass(k[2]))return void g();var e=new Image;e.onload=c(e,d),e.src=b.src}function f(){j.advanced.updateOnSelectorChange===!0&&(j.advanced.updateOnSelectorChange="*");var a=0,b=m.find(j.advanced.updateOnSelectorChange);return j.advanced.updateOnSelectorChange&&b.length>0&&b.each(function(){a+=this.offsetHeight+this.offsetWidth}),a}function g(a){clearTimeout(m[0].autoUpdate),l.update.call(null,h[0],a)}var h=a(this),i=h.data(d),j=i.opt,m=a("#mCSB_"+i.idx+"_container");return b?(clearTimeout(m[0].autoUpdate),void _(m[0],"autoUpdate")):void c()},V=function(a,b,c){return Math.round(a/b)*b-c},W=function(b){var c=b.data(d),e=a("#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal");e.each(function(){$.call(this)})},X=function(b,c,e){function f(a){return i&&j.callbacks[a]&&"function"==typeof j.callbacks[a]}function g(){return[j.callbacks.alwaysTriggerOffsets||u>=v[0]+y,j.callbacks.alwaysTriggerOffsets||u<=-z]}function h(){var a=[n[0].offsetTop,n[0].offsetLeft],c=[s[0].offsetTop,s[0].offsetLeft],d=[n.outerHeight(!1),n.outerWidth(!1)],f=[m.height(),m.width()];b[0].mcs={content:n,top:a[0],left:a[1],draggerTop:c[0],draggerLeft:c[1],topPct:Math.round(100*Math.abs(a[0])/(Math.abs(d[0])-f[0])),leftPct:Math.round(100*Math.abs(a[1])/(Math.abs(d[1])-f[1])),direction:e.dir}}var i=b.data(d),j=i.opt,k={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:j.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},e=a.extend(k,e),l=[e.dur,e.drag?0:e.dur],m=a("#mCSB_"+i.idx),n=a("#mCSB_"+i.idx+"_container"),o=n.parent(),p=j.callbacks.onTotalScrollOffset?S.call(b,j.callbacks.onTotalScrollOffset):[0,0],q=j.callbacks.onTotalScrollBackOffset?S.call(b,j.callbacks.onTotalScrollBackOffset):[0,0];if(i.trigger=e.trigger,0===o.scrollTop()&&0===o.scrollLeft()||(a(".mCSB_"+i.idx+"_scrollbar").css("visibility","visible"),o.scrollTop(0).scrollLeft(0)),"_resetY"!==c||i.contentReset.y||(f("onOverflowYNone")&&j.callbacks.onOverflowYNone.call(b[0]),i.contentReset.y=1),"_resetX"!==c||i.contentReset.x||(f("onOverflowXNone")&&j.callbacks.onOverflowXNone.call(b[0]),i.contentReset.x=1),"_resetY"!==c&&"_resetX"!==c){if(!i.contentReset.y&&b[0].mcs||!i.overflowed[0]||(f("onOverflowY")&&j.callbacks.onOverflowY.call(b[0]),i.contentReset.x=null),!i.contentReset.x&&b[0].mcs||!i.overflowed[1]||(f("onOverflowX")&&j.callbacks.onOverflowX.call(b[0]),i.contentReset.x=null),j.snapAmount){var r=j.snapAmount instanceof Array?"x"===e.dir?j.snapAmount[1]:j.snapAmount[0]:j.snapAmount;c=V(c,r,j.snapOffset)}switch(e.dir){case"x":var s=a("#mCSB_"+i.idx+"_dragger_horizontal"),t="left",u=n[0].offsetLeft,v=[m.width()-n.outerWidth(!1),s.parent().width()-s.width()],w=[c,0===c?0:c/i.scrollRatio.x],y=p[1],z=q[1],A=y>0?y/i.scrollRatio.x:0,B=z>0?z/i.scrollRatio.x:0;break;case"y":var s=a("#mCSB_"+i.idx+"_dragger_vertical"),t="top",u=n[0].offsetTop,v=[m.height()-n.outerHeight(!1),s.parent().height()-s.height()],w=[c,0===c?0:c/i.scrollRatio.y],y=p[0],z=q[0],A=y>0?y/i.scrollRatio.y:0,B=z>0?z/i.scrollRatio.y:0}w[1]<0||0===w[0]&&0===w[1]?w=[0,0]:w[1]>=v[1]?w=[v[0],v[1]]:w[0]=-w[0],b[0].mcs||(h(),f("onInit")&&j.callbacks.onInit.call(b[0])),clearTimeout(n[0].onCompleteTimeout),Y(s[0],t,Math.round(w[1]),l[1],e.scrollEasing),!i.tweenRunning&&(0===u&&w[0]>=0||u===v[0]&&w[0]<=v[0])||Y(n[0],t,Math.round(w[0]),l[0],e.scrollEasing,e.overwrite,{onStart:function(){e.callbacks&&e.onStart&&!i.tweenRunning&&(f("onScrollStart")&&(h(),j.callbacks.onScrollStart.call(b[0])),i.tweenRunning=!0,x(s),i.cbOffsets=g())},onUpdate:function(){e.callbacks&&e.onUpdate&&f("whileScrolling")&&(h(),j.callbacks.whileScrolling.call(b[0]))},onComplete:function(){if(e.callbacks&&e.onComplete){"yx"===j.axis&&clearTimeout(n[0].onCompleteTimeout);var a=n[0].idleTimer||0;n[0].onCompleteTimeout=setTimeout(function(){f("onScroll")&&(h(),j.callbacks.onScroll.call(b[0])),f("onTotalScroll")&&w[1]>=v[1]-A&&i.cbOffsets[0]&&(h(),j.callbacks.onTotalScroll.call(b[0])),f("onTotalScrollBack")&&w[1]<=B&&i.cbOffsets[1]&&(h(),j.callbacks.onTotalScrollBack.call(b[0])),i.tweenRunning=!1,n[0].idleTimer=0,x(s,"hide")},a)}}})}},Y=function(a,b,c,d,e,f,g){function h(){v.stop||(s||o.call(),s=Z()-r,i(),s>=v.time&&(v.time=s>v.time?s+m-(s-v.time):s+m-1,v.time<s+1&&(v.time=s+1)),v.time<d?v.id=n(h):q.call())}function i(){d>0?(v.currVal=l(v.time,t,w,d,e),u[b]=Math.round(v.currVal)+"px"):u[b]=c+"px",p.call()}function j(){m=1e3/60,v.time=s+m,n=window.requestAnimationFrame?window.requestAnimationFrame:function(a){return i(),setTimeout(a,.01)},v.id=n(h)}function k(){null!=v.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(v.id):clearTimeout(v.id),v.id=null)}function l(a,b,c,d,e){switch(e){case"linear":case"mcsLinear":return c*a/d+b;case"mcsLinearOut":return a/=d,a--,c*Math.sqrt(1-a*a)+b;case"easeInOutSmooth":return a/=d/2,a<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b);case"easeInOutStrong":return a/=d/2,a<1?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(-Math.pow(2,-10*a)+2)+b);case"easeInOut":case"mcsEaseInOut":return a/=d/2,a<1?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b);case"easeOutSmooth":return a/=d,a--,-c*(a*a*a*a-1)+b;case"easeOutStrong":return c*(-Math.pow(2,-10*a/d)+1)+b;case"easeOut":case"mcsEaseOut":default:var f=(a/=d)*a,g=f*a;return b+c*(.499999999999997*g*f+-2.5*f*f+5.5*g+-6.5*f+4*a)}}a._mTween||(a._mTween={top:{},left:{}});var m,n,g=g||{},o=g.onStart||function(){},p=g.onUpdate||function(){},q=g.onComplete||function(){},r=Z(),s=0,t=a.offsetTop,u=a.style,v=a._mTween[b];"left"===b&&(t=a.offsetLeft);var w=c-t;v.stop=0,"none"!==f&&k(),j()},Z=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},$=function(){var a=this;a._mTween||(a._mTween={top:{},left:{}});for(var b=["top","left"],c=0;c<b.length;c++){var d=b[c];a._mTween[d].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(a._mTween[d].id):clearTimeout(a._mTween[d].id),a._mTween[d].id=null,a._mTween[d].stop=1)}},_=function(a,b){try{delete a[b]}catch(c){a[b]=null}},aa=function(a){return!(a.which&&1!==a.which)},ba=function(a){var b=a.originalEvent.pointerType;return!(b&&"touch"!==b&&2!==b)},ca=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},da=function(a){var b=a.parents(".mCSB_container");return[a.offset().top-b.offset().top,a.offset().left-b.offset().left]},ea=function(){function a(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)if(a[b]+"Hidden"in document)return a[b]+"Hidden";return null}var b=a();return!!b&&document[b]};a.fn[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c].defaults=f,window[c]=!0,a(window).bind("load",function(){a(e)[c](),a.extend(a.expr[":"],{mcsInView:a.expr[":"].mcsInView||function(b){var c,d,e=a(b),f=e.parents(".mCSB_container");if(f.length)return c=f.parent(),d=[f[0].offsetTop,f[0].offsetLeft],d[0]+da(e)[0]>=0&&d[0]+da(e)[0]<c.height()-e.outerHeight(!1)&&d[1]+da(e)[1]>=0&&d[1]+da(e)[1]<c.width()-e.outerWidth(!1)},mcsInSight:a.expr[":"].mcsInSight||function(b,c,d){var e,f,g,h,i=a(b),j=i.parents(".mCSB_container"),k="exact"===d[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(j.length)return e=[i.outerHeight(!1),i.outerWidth(!1)],g=[j[0].offsetTop+da(i)[0],j[0].offsetLeft+da(i)[1]],f=[j.parent()[0].offsetHeight,j.parent()[0].offsetWidth],h=[e[0]<f[0]?k[0]:k[1],e[1]<f[1]?k[0]:k[1]],g[0]-f[0]*h[0][0]<0&&g[0]+e[0]-f[0]*h[0][1]>=0&&g[1]-f[1]*h[1][0]<0&&g[1]+e[1]-f[1]*h[1][1]>=0},mcsOverflow:a.expr[":"].mcsOverflow||function(b){var c=a(b).data(d);if(c)return c.overflowed[0]||c.overflowed[1]}})})})}),function(a){"function"==typeof define&&define.amd?define("nicescroll",["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=!1,c=!1,d=0,e=2e3,f=0,g=["webkit","ms","moz","o"],h=window.requestAnimationFrame||!1,i=window.cancelAnimationFrame||!1;if(!h)for(var j in g){var k=g[j];if(h=window[k+"RequestAnimationFrame"]){i=window[k+"CancelAnimationFrame"]||window[k+"CancelRequestAnimationFrame"];break}}var l=window.MutationObserver||window.WebKitMutationObserver||!1,m={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"6px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var a=document.getElementsByTagName("script"),a=a.length?a[a.length-1].src.split("?")[0]:"";return 0<a.split("/").length?a.split("/").slice(0,-1).join("/")+"/":""}(),preventmultitouchscrolling:!0,disablemutationobserver:!1},n=!1,o=function(){if(n)return n;var a=document.createElement("DIV"),b=a.style,c=navigator.userAgent,d=navigator.platform,e={haspointerlock:"pointerLockElement"in document||"webkitPointerLockElement"in document||"mozPointerLockElement"in document};e.isopera="opera"in window,e.isopera12=e.isopera&&"getUserMedia"in navigator,e.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),e.isie="all"in document&&"attachEvent"in a&&!e.isopera,e.isieold=e.isie&&!("msInterpolationMode"in b),e.isie7=e.isie&&!e.isieold&&(!("documentMode"in document)||7==document.documentMode),e.isie8=e.isie&&"documentMode"in document&&8==document.documentMode,e.isie9=e.isie&&"performance"in window&&9==document.documentMode,e.isie10=e.isie&&"performance"in window&&10==document.documentMode,e.isie11="msRequestFullscreen"in a&&11<=document.documentMode,e.isieedge12=navigator.userAgent.match(/Edge\/12\./),e.isieedge="msOverflowStyle"in a,e.ismodernie=e.isie11||e.isieedge,e.isie9mobile=/iemobile.9/i.test(c),e.isie9mobile&&(e.isie9=!1),e.isie7mobile=!e.isie9mobile&&e.isie7&&/iemobile/i.test(c),e.ismozilla="MozAppearance"in b,e.iswebkit="WebkitAppearance"in b,e.ischrome="chrome"in window,e.ischrome38=e.ischrome&&"touchAction"in b,e.ischrome22=!e.ischrome38&&e.ischrome&&e.haspointerlock,e.ischrome26=!e.ischrome38&&e.ischrome&&"transition"in b,e.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,e.hasw3ctouch=(window.PointerEvent||!1)&&(0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints),e.hasmstouch=!e.hasw3ctouch&&(window.MSPointerEvent||!1),e.ismac=/^mac$/i.test(d),e.isios=e.cantouch&&/iphone|ipad|ipod/i.test(d),e.isios4=e.isios&&!("seal"in Object),e.isios7=e.isios&&"webkitHidden"in document,e.isios8=e.isios&&"hidden"in document,e.isandroid=/android/i.test(c),e.haseventlistener="addEventListener"in a,e.trstyle=!1,e.hastransform=!1,e.hastranslate3d=!1,e.transitionstyle=!1,e.hastransition=!1,e.transitionend=!1,d=["transform","msTransform","webkitTransform","MozTransform","OTransform"];for(c=0;c<d.length;c++)if(void 0!==b[d[c]]){e.trstyle=d[c];break}e.hastransform=!!e.trstyle,e.hastransform&&(b[e.trstyle]="translate3d(1px,2px,3px)",e.hastranslate3d=/translate3d/.test(b[e.trstyle])),e.transitionstyle=!1,e.prefixstyle="",e.transitionend=!1;for(var d="transition webkitTransition msTransition MozTransition OTransition OTransition KhtmlTransition".split(" "),f=" -webkit- -ms- -moz- -o- -o -khtml-".split(" "),g="transitionend webkitTransitionEnd msTransitionEnd transitionend otransitionend oTransitionEnd KhtmlTransitionEnd".split(" "),c=0;c<d.length;c++)if(d[c]in b){e.transitionstyle=d[c],e.prefixstyle=f[c],e.transitionend=g[c];break}e.ischrome26&&(e.prefixstyle=f[1]),e.hastransition=e.transitionstyle;a:{for(c=["grab","-webkit-grab","-moz-grab"],(e.ischrome&&!e.ischrome38||e.isie)&&(c=[]),d=0;d<c.length;d++)if(f=c[d],b.cursor=f,b.cursor==f){b=f;break a}b="url(//patriciaportfolio.googlecode.com/files/openhand.cur),n-resize"}return e.cursorgrabvalue=b,e.hasmousecapture="setCapture"in a,e.hasMutationObserver=!1!==l,n=e},p=function(g,j){function k(){var a=t.doc.css(w.trstyle);return!(!a||"matrix"!=a.substr(0,6))&&a.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function n(){var a=t.win;if("zIndex"in a)return a.zIndex();for(;0<a.length&&9!=a[0].nodeType;){var b=a.css("zIndex");if(!isNaN(b)&&0!=b)return parseInt(b);a=a.parent()}return!1}function p(a,b,c){return b=a.css(b),a=parseFloat(b),isNaN(a)?(a=A[b]||0,c=3==a?c?t.win.outerHeight()-t.win.innerHeight():t.win.outerWidth()-t.win.innerWidth():1,t.isie8&&a&&(a+=1),c?a:0):a}function r(a,b,c,d){t._bind(a,b,function(d){d=d?d:window.event;var e={original:d,target:d.target||d.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==d.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return d.preventDefault?d.preventDefault():d.returnValue=!1,!1},stopImmediatePropagation:function(){d.stopImmediatePropagation?d.stopImmediatePropagation():d.cancelBubble=!0}};return"mousewheel"==b?(d.wheelDeltaX&&(e.deltaX=-.025*d.wheelDeltaX),d.wheelDeltaY&&(e.deltaY=-.025*d.wheelDeltaY),e.deltaY||e.deltaX||(e.deltaY=-.025*d.wheelDelta)):e.deltaY=d.detail,c.call(a,e)},d)}function s(a,b,c){var d,e;if(0==a.deltaMode?(d=-Math.floor(t.opt.mousescrollstep/54*a.deltaX),e=-Math.floor(t.opt.mousescrollstep/54*a.deltaY)):1==a.deltaMode&&(d=-Math.floor(a.deltaX*t.opt.mousescrollstep),e=-Math.floor(a.deltaY*t.opt.mousescrollstep)),b&&t.opt.oneaxismousemode&&0==d&&e&&(d=e,e=0,c&&(0>d?t.getScrollLeft()>=t.page.maxw:0>=t.getScrollLeft())&&(e=d,d=0)),t.isrtlmode&&(d=-d),d&&(t.scrollmom&&t.scrollmom.stop(),t.lastdeltax+=d,t.debounced("mousewheelx",function(){var a=t.lastdeltax;t.lastdeltax=0,t.rail.drag||t.doScrollLeftBy(a)},15)),e){if(t.opt.nativeparentscrolling&&c&&!t.ispage&&!t.zoomactive)if(0>e){if(t.getScrollTop()>=t.page.maxh)return!0}else if(0>=t.getScrollTop())return!0;t.scrollmom&&t.scrollmom.stop(),t.lastdeltay+=e,t.synched("mousewheely",function(){var a=t.lastdeltay;t.lastdeltay=0,t.rail.drag||t.doScrollBy(a)},15)}return a.stopImmediatePropagation(),a.preventDefault()}var t=this;if(this.version="3.6.8",this.name="nicescroll",this.me=j,this.opt={doc:a("body"),win:!1},a.extend(this.opt,m),this.opt.snapbackspeed=80,g)for(var u in t.opt)void 0!==g[u]&&(t.opt[u]=g[u]);if(t.opt.disablemutationobserver&&(l=!1),this.iddoc=(this.doc=t.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(t.opt.win?t.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==t.opt.win,this.win=t.opt.win||(this.ispage?a(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?a(window):this.win,this.body=a("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=t.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,"auto"==this.opt.rtlmode){u=this.win[0]==window?this.body:this.win;var v=u.css("writing-mode")||u.css("-webkit-writing-mode")||u.css("-ms-writing-mode")||u.css("-moz-writing-mode");"horizontal-tb"==v||"lr-tb"==v||""==v?(this.isrtlmode="rtl"==u.css("direction"),this.isvertical=!1):(this.isrtlmode="vertical-rl"==v||"tb"==v||"tb-rl"==v||"rl-tb"==v,this.isvertical="vertical-rl"==v||"tb"==v||"tb-rl"==v)}else this.isrtlmode=!0===this.opt.rtlmode,this.isvertical=!1;this.observerbody=this.observerremover=this.observer=this.scrollmom=this.scrollrunning=!1;do this.id="ascrail"+e++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=this.railslocked=!1,
this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=t.opt.overflowx,this.overflowy=t.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=o();var w=a.extend({},this.detected);this.ishwscroll=(this.canhwscroll=w.hastransform&&t.opt.hwacceleration)&&t.haswrapper,this.hasreversehr=!!this.isrtlmode&&(this.isvertical?!(w.iswebkit||w.isie||w.isie11):!(w.iswebkit||w.isie&&!w.isie10&&!w.isie11)),this.istouchcapable=!1,w.cantouch||!w.hasw3ctouch&&!w.hasmstouch?!w.cantouch||w.isios||w.isandroid||!w.iswebkit&&!w.ismozilla||(this.istouchcapable=!0):this.istouchcapable=!0,t.opt.enablemouselockapi||(w.hasmousecapture=!1,w.haspointerlock=!1),this.debounced=function(a,b,c){t&&(t.delaylist[a]||(b.call(t),t.delaylist[a]={h:h(function(){t.delaylist[a].fn.call(t),t.delaylist[a]=!1},c)}),t.delaylist[a].fn=b)};var x=!1;this.synched=function(a,b){return t.synclist[a]=b,function(){x||(h(function(){if(t){x=!1;for(var a in t.synclist){var b=t.synclist[a];b&&b.call(t),t.synclist[a]=!1}}}),x=!0)}(),a},this.unsynched=function(a){t.synclist[a]&&(t.synclist[a]=!1)},this.css=function(a,b){for(var c in b)t.saved.css.push([a,c,a.css(c)]),a.css(c,b[c])},this.scrollTop=function(a){return void 0===a?t.getScrollTop():t.setScrollTop(a)},this.scrollLeft=function(a){return void 0===a?t.getScrollLeft():t.setScrollLeft(a)};var y=function(a,b,c,d,e,f,g){this.st=a,this.ed=b,this.spd=c,this.p1=d||0,this.p2=e||1,this.p3=f||0,this.p4=g||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st};if(y.prototype={B2:function(a){return 3*a*a*(1-a)},B3:function(a){return 3*a*(1-a)*(1-a)},B4:function(a){return(1-a)*(1-a)*(1-a)},getNow:function(){var a=1-((new Date).getTime()-this.ts)/this.spd,b=this.B2(a)+this.B3(a)+this.B4(a);return 0>a?this.ed:this.st+Math.round(this.df*b)},update:function(a,b){return this.st=this.getNow(),this.ed=a,this.spd=b,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},w.hastranslate3d&&w.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(a){if(!a){if(a=k())return 16==a.length?-a[13]:-a[5];if(t.timerscroll&&t.timerscroll.bz)return t.timerscroll.bz.getNow()}return t.doc.translate.y},this.getScrollLeft=function(a){if(!a){if(a=k())return 16==a.length?-a[12]:-a[4];if(t.timerscroll&&t.timerscroll.bh)return t.timerscroll.bh.getNow()}return t.doc.translate.x},this.notifyScrollEvent=function(a){var b=document.createEvent("UIEvents");b.initUIEvent("scroll",!1,!0,window,1),b.niceevent=!0,a.dispatchEvent(b)};var z=this.isrtlmode?1:-1;w.hastranslate3d&&t.opt.enabletranslate3d?(this.setScrollTop=function(a,b){t.doc.translate.y=a,t.doc.translate.ty=-1*a+"px",t.doc.css(w.trstyle,"translate3d("+t.doc.translate.tx+","+t.doc.translate.ty+",0px)"),b||t.notifyScrollEvent(t.win[0])},this.setScrollLeft=function(a,b){t.doc.translate.x=a,t.doc.translate.tx=a*z+"px",t.doc.css(w.trstyle,"translate3d("+t.doc.translate.tx+","+t.doc.translate.ty+",0px)"),b||t.notifyScrollEvent(t.win[0])}):(this.setScrollTop=function(a,b){t.doc.translate.y=a,t.doc.translate.ty=-1*a+"px",t.doc.css(w.trstyle,"translate("+t.doc.translate.tx+","+t.doc.translate.ty+")"),b||t.notifyScrollEvent(t.win[0])},this.setScrollLeft=function(a,b){t.doc.translate.x=a,t.doc.translate.tx=a*z+"px",t.doc.css(w.trstyle,"translate("+t.doc.translate.tx+","+t.doc.translate.ty+")"),b||t.notifyScrollEvent(t.win[0])})}else this.getScrollTop=function(){return t.docscroll.scrollTop()},this.setScrollTop=function(a){return setTimeout(function(){t&&t.docscroll.scrollTop(a)},1)},this.getScrollLeft=function(){return t.hasreversehr?t.detected.ismozilla?t.page.maxw-Math.abs(t.docscroll.scrollLeft()):t.page.maxw-t.docscroll.scrollLeft():t.docscroll.scrollLeft()},this.setScrollLeft=function(a){return setTimeout(function(){if(t)return t.hasreversehr&&(a=t.detected.ismozilla?-(t.page.maxw-a):t.page.maxw-a),t.docscroll.scrollLeft(a)},1)};this.getTarget=function(a){return!!a&&(a.target?a.target:!!a.srcElement&&a.srcElement)},this.hasParent=function(a,b){if(!a)return!1;for(var c=a.target||a.srcElement||a||!1;c&&c.id!=b;)c=c.parentNode||!1;return!1!==c};var A={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},this.getOffset=function(){if(t.isfixed){var a=t.win.offset(),b=t.getDocumentScrollOffset();return a.top-=b.top,a.left-=b.left,a}return a=t.win.offset(),t.viewport?(b=t.viewport.offset(),{top:a.top-b.top,left:a.left-b.left}):a},this.updateScrollBar=function(a){var b,c,d;if(t.ishwscroll)t.rail.css({height:t.win.innerHeight()-(t.opt.railpadding.top+t.opt.railpadding.bottom)}),t.railh&&t.railh.css({width:t.win.innerWidth()-(t.opt.railpadding.left+t.opt.railpadding.right)});else{var e=t.getOffset();b=e.top,c=e.left-(t.opt.railpadding.left+t.opt.railpadding.right),b+=p(t.win,"border-top-width",!0),c+=t.rail.align?t.win.outerWidth()-p(t.win,"border-right-width")-t.rail.width:p(t.win,"border-left-width"),(d=t.opt.railoffset)&&(d.top&&(b+=d.top),d.left&&(c+=d.left)),t.railslocked||t.rail.css({top:b,left:c,height:(a?a.h:t.win.innerHeight())-(t.opt.railpadding.top+t.opt.railpadding.bottom)}),t.zoom&&t.zoom.css({top:b+1,left:1==t.rail.align?c-20:c+t.rail.width+4}),t.railh&&!t.railslocked&&(b=e.top,c=e.left,(d=t.opt.railhoffset)&&(d.top&&(b+=d.top),d.left&&(c+=d.left)),a=t.railh.align?b+p(t.win,"border-top-width",!0)+t.win.innerHeight()-t.railh.height:b+p(t.win,"border-top-width",!0),c+=p(t.win,"border-left-width"),t.railh.css({top:a-(t.opt.railpadding.top+t.opt.railpadding.bottom),left:c,width:t.railh.width}))}},this.doRailClick=function(a,b,c){var d;t.railslocked||(t.cancelEvent(a),b?(b=c?t.doScrollLeft:t.doScrollTop,d=c?(a.pageX-t.railh.offset().left-t.cursorwidth/2)*t.scrollratio.x:(a.pageY-t.rail.offset().top-t.cursorheight/2)*t.scrollratio.y,b(d)):(b=c?t.doScrollLeftBy:t.doScrollBy,d=c?t.scroll.x:t.scroll.y,a=c?a.pageX-t.railh.offset().left:a.pageY-t.rail.offset().top,c=c?t.view.w:t.view.h,b(d>=a?c:-c)))},t.hasanimationframe=h,t.hascancelanimationframe=i,t.hasanimationframe?t.hascancelanimationframe||(i=function(){t.cancelAnimationFrame=!0}):(h=function(a){return setTimeout(a,15-Math.floor(+new Date/1e3)%16)},i=clearTimeout),this.init=function(){if(t.saved.css=[],w.isie7mobile||w.isoperamini)return!0;w.hasmstouch&&t.css(t.ispage?a("html"):t.win,{_touchaction:"none"});var e=w.ismodernie||w.isie10?{"-ms-overflow-style":"none"}:{"overflow-y":"hidden"};if(t.zindex="auto",t.zindex=t.ispage||"auto"!=t.opt.zindex?t.opt.zindex:n()||"auto",!t.ispage&&"auto"!=t.zindex&&t.zindex>f&&(f=t.zindex),t.isie&&0==t.zindex&&"auto"==t.opt.zindex&&(t.zindex="auto"),!t.ispage||!w.cantouch&&!w.isieold&&!w.isie9mobile){var g=t.docscroll;t.ispage&&(g=t.haswrapper?t.win:t.doc),w.isie9mobile||t.css(g,e),t.ispage&&w.isie7&&("BODY"==t.doc[0].nodeName?t.css(a("html"),{"overflow-y":"hidden"}):"HTML"==t.doc[0].nodeName&&t.css(a("body"),e)),!w.isios||t.ispage||t.haswrapper||t.css(a("body"),{"-webkit-overflow-scrolling":"touch"});var h=a(document.createElement("div"));h.css({position:"relative",top:0,"float":"right",width:t.opt.cursorwidth,height:0,"background-color":t.opt.cursorcolor,border:t.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":t.opt.cursorborderradius,"-moz-border-radius":t.opt.cursorborderradius,"border-radius":t.opt.cursorborderradius}),h.hborder=parseFloat(h.outerHeight()-h.innerHeight()),h.addClass("nicescroll-cursors"),t.cursor=h;var i=a(document.createElement("div"));i.attr("id",t.id),i.addClass("nicescroll-rails nicescroll-rails-vr");var j,k,m,o=["left","right","top","bottom"];for(m in o)k=o[m],(j=t.opt.railpadding[k])?i.css("padding-"+k,j+"px"):t.opt.railpadding[k]=0;i.append(h),i.width=Math.max(parseFloat(t.opt.cursorwidth),h.outerWidth()),i.css({width:i.width+"px",zIndex:t.zindex,background:t.opt.background,cursor:"default"}),i.visibility=!0,i.scrollable=!0,i.align="left"==t.opt.railalign?0:1,t.rail=i,h=t.rail.drag=!1,!t.opt.boxzoom||t.ispage||w.isieold||(h=document.createElement("div"),t.bind(h,"click",t.doZoom),t.bind(h,"mouseenter",function(){t.zoom.css("opacity",t.opt.cursoropacitymax)}),t.bind(h,"mouseleave",function(){t.zoom.css("opacity",t.opt.cursoropacitymin)}),t.zoom=a(h),t.zoom.css({cursor:"pointer",zIndex:t.zindex,backgroundImage:"url("+t.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),t.opt.dblclickzoom&&t.bind(t.win,"dblclick",t.doZoom),w.cantouch&&t.opt.gesturezoom&&(t.ongesturezoom=function(a){return 1.5<a.scale&&t.doZoomIn(a),.8>a.scale&&t.doZoomOut(a),t.cancelEvent(a)},t.bind(t.win,"gestureend",t.ongesturezoom))),t.railh=!1;var p;if(t.opt.horizrailenabled&&(t.css(g,{overflowX:"hidden"}),h=a(document.createElement("div")),h.css({position:"absolute",top:0,height:t.opt.cursorwidth,width:0,backgroundColor:t.opt.cursorcolor,border:t.opt.cursorborder,backgroundClip:"padding-box","-webkit-border-radius":t.opt.cursorborderradius,"-moz-border-radius":t.opt.cursorborderradius,"border-radius":t.opt.cursorborderradius}),w.isieold&&h.css("overflow","hidden"),h.wborder=parseFloat(h.outerWidth()-h.innerWidth()),h.addClass("nicescroll-cursors"),t.cursorh=h,p=a(document.createElement("div")),p.attr("id",t.id+"-hr"),p.addClass("nicescroll-rails nicescroll-rails-hr"),p.height=Math.max(parseFloat(t.opt.cursorwidth),h.outerHeight()),p.css({height:p.height+"px",zIndex:t.zindex,background:t.opt.background}),p.append(h),p.visibility=!0,p.scrollable=!0,p.align="top"==t.opt.railvalign?0:1,t.railh=p,t.railh.drag=!1),t.ispage?(i.css({position:"fixed",top:0,height:"100%"}),i.align?i.css({right:0}):i.css({left:0}),t.body.append(i),t.railh&&(p.css({position:"fixed",left:0,width:"100%"}),p.align?p.css({bottom:0}):p.css({top:0}),t.body.append(p))):(t.ishwscroll?("static"==t.win.css("position")&&t.css(t.win,{position:"relative"}),g="HTML"==t.win[0].nodeName?t.body:t.win,a(g).scrollTop(0).scrollLeft(0),t.zoom&&(t.zoom.css({position:"absolute",top:1,right:0,"margin-right":i.width+4}),g.append(t.zoom)),i.css({position:"absolute",top:0}),i.align?i.css({right:0}):i.css({left:0}),g.append(i),p&&(p.css({position:"absolute",left:0,bottom:0}),p.align?p.css({bottom:0}):p.css({top:0}),g.append(p))):(t.isfixed="fixed"==t.win.css("position"),g=t.isfixed?"fixed":"absolute",t.isfixed||(t.viewport=t.getViewport(t.win[0])),t.viewport&&(t.body=t.viewport,0==/fixed|absolute/.test(t.viewport.css("position"))&&t.css(t.viewport,{position:"relative"})),i.css({position:g}),t.zoom&&t.zoom.css({position:g}),t.updateScrollBar(),t.body.append(i),t.zoom&&t.body.append(t.zoom),t.railh&&(p.css({position:g}),t.body.append(p))),w.isios&&t.css(t.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),w.isie&&t.opt.disableoutline&&t.win.attr("hideFocus","true"),w.iswebkit&&t.opt.disableoutline&&t.win.css("outline","none")),!1===t.opt.autohidemode?(t.autohidedom=!1,t.rail.css({opacity:t.opt.cursoropacitymax}),t.railh&&t.railh.css({opacity:t.opt.cursoropacitymax})):!0===t.opt.autohidemode||"leave"===t.opt.autohidemode?(t.autohidedom=a().add(t.rail),w.isie8&&(t.autohidedom=t.autohidedom.add(t.cursor)),t.railh&&(t.autohidedom=t.autohidedom.add(t.railh)),t.railh&&w.isie8&&(t.autohidedom=t.autohidedom.add(t.cursorh))):"scroll"==t.opt.autohidemode?(t.autohidedom=a().add(t.rail),t.railh&&(t.autohidedom=t.autohidedom.add(t.railh))):"cursor"==t.opt.autohidemode?(t.autohidedom=a().add(t.cursor),t.railh&&(t.autohidedom=t.autohidedom.add(t.cursorh))):"hidden"==t.opt.autohidemode&&(t.autohidedom=!1,t.hide(),t.railslocked=!1),w.isie9mobile)t.scrollmom=new q(t),t.onmangotouch=function(){var a=t.getScrollTop(),b=t.getScrollLeft();if(a==t.scrollmom.lastscrolly&&b==t.scrollmom.lastscrollx)return!0;var c=a-t.mangotouch.sy,d=b-t.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(d,2)+Math.pow(c,2)))){var e=0>c?-1:1,f=0>d?-1:1,g=+new Date;t.mangotouch.lazy&&clearTimeout(t.mangotouch.lazy),80<g-t.mangotouch.tm||t.mangotouch.dry!=e||t.mangotouch.drx!=f?(t.scrollmom.stop(),t.scrollmom.reset(b,a),t.mangotouch.sy=a,t.mangotouch.ly=a,t.mangotouch.sx=b,t.mangotouch.lx=b,t.mangotouch.dry=e,t.mangotouch.drx=f,t.mangotouch.tm=g):(t.scrollmom.stop(),t.scrollmom.update(t.mangotouch.sx-d,t.mangotouch.sy-c),t.mangotouch.tm=g,c=Math.max(Math.abs(t.mangotouch.ly-a),Math.abs(t.mangotouch.lx-b)),t.mangotouch.ly=a,t.mangotouch.lx=b,2<c&&(t.mangotouch.lazy=setTimeout(function(){t.mangotouch.lazy=!1,t.mangotouch.dry=0,t.mangotouch.drx=0,t.mangotouch.tm=0,t.scrollmom.doMomentum(30)},100)))}},i=t.getScrollTop(),p=t.getScrollLeft(),t.mangotouch={sy:i,ly:i,dry:0,sx:p,lx:p,drx:0,lazy:!1,tm:0},t.bind(t.docscroll,"scroll",t.onmangotouch);else{if(w.cantouch||t.istouchcapable||t.opt.touchbehavior||w.hasmstouch){t.scrollmom=new q(t),t.ontouchstart=function(b){if(b.pointerType&&2!=b.pointerType&&"touch"!=b.pointerType)return!1;if(t.hasmoving=!1,!t.railslocked){var c;if(w.hasmstouch)for(c=!!b.target&&b.target;c;){var d=a(c).getNiceScroll();if(0<d.length&&d[0].me==t.me)break;if(0<d.length)return!1;if("DIV"==c.nodeName&&c.id==t.id)break;c=!!c.parentNode&&c.parentNode}if(t.cancelScroll(),(c=t.getTarget(b))&&/INPUT/i.test(c.nodeName)&&/range/i.test(c.type))return t.stopPropagation(b);if(!("clientX"in b)&&"changedTouches"in b&&(b.clientX=b.changedTouches[0].clientX,b.clientY=b.changedTouches[0].clientY),t.forcescreen&&(d=b,b={original:b.original?b.original:b},b.clientX=d.screenX,b.clientY=d.screenY),t.rail.drag={x:b.clientX,y:b.clientY,sx:t.scroll.x,sy:t.scroll.y,st:t.getScrollTop(),sl:t.getScrollLeft(),pt:2,dl:!1},t.ispage||!t.opt.directionlockdeadzone)t.rail.drag.dl="f";else{var d=a(window).width(),e=a(window).height(),e=Math.max(0,Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-e),d=Math.max(0,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)-d);t.rail.drag.ck=!t.rail.scrollable&&t.railh.scrollable?0<e&&"v":!(!t.rail.scrollable||t.railh.scrollable)&&(0<d&&"h"),t.rail.drag.ck||(t.rail.drag.dl="f")}if(t.opt.touchbehavior&&t.isiframe&&w.isie&&(d=t.win.position(),t.rail.drag.x+=d.left,t.rail.drag.y+=d.top),t.hasmoving=!1,t.lastmouseup=!1,t.scrollmom.reset(b.clientX,b.clientY),!w.cantouch&&!this.istouchcapable&&!b.pointerType){if(!c||!/INPUT|SELECT|TEXTAREA/i.test(c.nodeName))return!t.ispage&&w.hasmousecapture&&c.setCapture(),t.opt.touchbehavior?(c.onclick&&!c._onclick&&(c._onclick=c.onclick,c.onclick=function(a){return!t.hasmoving&&void c._onclick.call(this,a)}),t.cancelEvent(b)):t.stopPropagation(b);/SUBMIT|CANCEL|BUTTON/i.test(a(c).attr("type"))&&(pc={tg:c,click:!1},t.preventclick=pc)}}},t.ontouchend=function(a){if(!t.rail.drag)return!0;if(2==t.rail.drag.pt){if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(t.scrollmom.doMomentum(),t.rail.drag=!1,t.hasmoving&&(t.lastmouseup=!0,t.hideCursor(),w.hasmousecapture&&document.releaseCapture(),!w.cantouch))return t.cancelEvent(a)}else if(1==t.rail.drag.pt)return t.onmouseup(a)};var r=t.opt.touchbehavior&&t.isiframe&&!w.hasmousecapture;t.ontouchmove=function(b,c){if(!t.rail.drag||b.targetTouches&&t.opt.preventmultitouchscrolling&&1<b.targetTouches.length||b.pointerType&&2!=b.pointerType&&"touch"!=b.pointerType)return!1;if(2==t.rail.drag.pt){if(w.cantouch&&w.isios&&void 0===b.original)return!0;if(t.hasmoving=!0,t.preventclick&&!t.preventclick.click&&(t.preventclick.click=t.preventclick.tg.onclick||!1,t.preventclick.tg.onclick=t.onpreventclick),b=a.extend({original:b},b),"changedTouches"in b&&(b.clientX=b.changedTouches[0].clientX,b.clientY=b.changedTouches[0].clientY),t.forcescreen){var d=b;b={original:b.original?b.original:b},b.clientX=d.screenX,b.clientY=d.screenY}var e,d=e=0;r&&!c&&(e=t.win.position(),d=-e.left,e=-e.top);var f=b.clientY+e;e=f-t.rail.drag.y;var g=b.clientX+d,h=g-t.rail.drag.x,i=t.rail.drag.st-e;t.ishwscroll&&t.opt.bouncescroll?0>i?i=Math.round(i/2):i>t.page.maxh&&(i=t.page.maxh+Math.round((i-t.page.maxh)/2)):(0>i&&(f=i=0),i>t.page.maxh&&(i=t.page.maxh,f=0));var j;if(t.railh&&t.railh.scrollable&&(j=t.isrtlmode?h-t.rail.drag.sl:t.rail.drag.sl-h,t.ishwscroll&&t.opt.bouncescroll?0>j?j=Math.round(j/2):j>t.page.maxw&&(j=t.page.maxw+Math.round((j-t.page.maxw)/2)):(0>j&&(g=j=0),j>t.page.maxw&&(j=t.page.maxw,g=0))),d=!1,t.rail.drag.dl)d=!0,"v"==t.rail.drag.dl?j=t.rail.drag.sl:"h"==t.rail.drag.dl&&(i=t.rail.drag.st);else{e=Math.abs(e);var h=Math.abs(h),k=t.opt.directionlockdeadzone;if("v"==t.rail.drag.ck){if(e>k&&h<=.3*e)return t.rail.drag=!1,!0;h>k&&(t.rail.drag.dl="f",a("body").scrollTop(a("body").scrollTop()))}else if("h"==t.rail.drag.ck){if(h>k&&e<=.3*h)return t.rail.drag=!1,!0;e>k&&(t.rail.drag.dl="f",a("body").scrollLeft(a("body").scrollLeft()))}}if(t.synched("touchmove",function(){t.rail.drag&&2==t.rail.drag.pt&&(t.prepareTransition&&t.prepareTransition(0),t.rail.scrollable&&t.setScrollTop(i),t.scrollmom.update(g,f),t.railh&&t.railh.scrollable?(t.setScrollLeft(j),t.showCursor(i,j)):t.showCursor(i),w.isie10&&document.selection.clear())}),w.ischrome&&t.istouchcapable&&(d=!1),d)return t.cancelEvent(b)}else if(1==t.rail.drag.pt)return t.onmousemove(b)}}if(t.onmousedown=function(a,b){if(!t.rail.drag||1==t.rail.drag.pt){if(t.railslocked)return t.cancelEvent(a);t.cancelScroll(),t.rail.drag={x:a.clientX,y:a.clientY,sx:t.scroll.x,sy:t.scroll.y,pt:1,hr:!!b};var c=t.getTarget(a);return!t.ispage&&w.hasmousecapture&&c.setCapture(),t.isiframe&&!w.hasmousecapture&&(t.saved.csspointerevents=t.doc.css("pointer-events"),t.css(t.doc,{"pointer-events":"none"})),t.hasmoving=!1,t.cancelEvent(a)}},t.onmouseup=function(a){if(t.rail.drag)return 1!=t.rail.drag.pt||(w.hasmousecapture&&document.releaseCapture(),t.isiframe&&!w.hasmousecapture&&t.doc.css("pointer-events",t.saved.csspointerevents),t.rail.drag=!1,t.hasmoving&&t.triggerScrollEnd(),t.cancelEvent(a))},t.onmousemove=function(a){if(t.rail.drag){if(1==t.rail.drag.pt){if(w.ischrome&&0==a.which)return t.onmouseup(a);if(t.cursorfreezed=!0,t.hasmoving=!0,t.rail.drag.hr){t.scroll.x=t.rail.drag.sx+(a.clientX-t.rail.drag.x),0>t.scroll.x&&(t.scroll.x=0);var b=t.scrollvaluemaxw;t.scroll.x>b&&(t.scroll.x=b)}else t.scroll.y=t.rail.drag.sy+(a.clientY-t.rail.drag.y),0>t.scroll.y&&(t.scroll.y=0),b=t.scrollvaluemax,t.scroll.y>b&&(t.scroll.y=b);return t.synched("mousemove",function(){t.rail.drag&&1==t.rail.drag.pt&&(t.showCursor(),t.rail.drag.hr?t.hasreversehr?t.doScrollLeft(t.scrollvaluemaxw-Math.round(t.scroll.x*t.scrollratio.x),t.opt.cursordragspeed):t.doScrollLeft(Math.round(t.scroll.x*t.scrollratio.x),t.opt.cursordragspeed):t.doScrollTop(Math.round(t.scroll.y*t.scrollratio.y),t.opt.cursordragspeed))}),t.cancelEvent(a)}}else t.checkarea=0},w.cantouch||t.opt.touchbehavior)t.onpreventclick=function(a){if(t.preventclick)return t.preventclick.tg.onclick=t.preventclick.click,t.preventclick=!1,t.cancelEvent(a)},t.bind(t.win,"mousedown",t.ontouchstart),t.onclick=!w.isios&&function(a){return!t.lastmouseup||(t.lastmouseup=!1,t.cancelEvent(a))},t.opt.grabcursorenabled&&w.cursorgrabvalue&&(t.css(t.ispage?t.doc:t.win,{cursor:w.cursorgrabvalue}),t.css(t.rail,{cursor:w.cursorgrabvalue}));else{var s=function(a){if(t.selectiondrag){if(a){var b=t.win.outerHeight();a=a.pageY-t.selectiondrag.top,0<a&&a<b&&(a=0),a>=b&&(a-=b),t.selectiondrag.df=a}0!=t.selectiondrag.df&&(t.doScrollBy(2*-Math.floor(t.selectiondrag.df/6)),t.debounced("doselectionscroll",function(){s()},50))}};t.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},t.onselectionstart=function(a){t.ispage||(t.selectiondrag=t.win.offset())},t.onselectionend=function(a){t.selectiondrag=!1},t.onselectiondrag=function(a){t.selectiondrag&&t.hasTextSelected()&&t.debounced("selectionscroll",function(){s(a)},250)}}w.hasw3ctouch?(t.css(t.rail,{"touch-action":"none"}),t.css(t.cursor,{"touch-action":"none"}),t.bind(t.win,"pointerdown",t.ontouchstart),t.bind(document,"pointerup",t.ontouchend),t.bind(document,"pointermove",t.ontouchmove)):w.hasmstouch?(t.css(t.rail,{"-ms-touch-action":"none"}),t.css(t.cursor,{"-ms-touch-action":"none"}),t.bind(t.win,"MSPointerDown",t.ontouchstart),t.bind(document,"MSPointerUp",t.ontouchend),t.bind(document,"MSPointerMove",t.ontouchmove),t.bind(t.cursor,"MSGestureHold",function(a){a.preventDefault()}),t.bind(t.cursor,"contextmenu",function(a){a.preventDefault()})):this.istouchcapable&&(t.bind(t.win,"touchstart",t.ontouchstart),t.bind(document,"touchend",t.ontouchend),t.bind(document,"touchcancel",t.ontouchend),t.bind(document,"touchmove",t.ontouchmove)),(t.opt.cursordragontouch||!w.cantouch&&!t.opt.touchbehavior)&&(t.rail.css({cursor:"default"}),t.railh&&t.railh.css({cursor:"default"}),t.jqbind(t.rail,"mouseenter",function(){return!(!t.ispage&&!t.win.is(":visible"))&&(t.canshowonmouseevent&&t.showCursor(),void(t.rail.active=!0))}),t.jqbind(t.rail,"mouseleave",function(){t.rail.active=!1,t.rail.drag||t.hideCursor()}),t.opt.sensitiverail&&(t.bind(t.rail,"click",function(a){t.doRailClick(a,!1,!1)}),t.bind(t.rail,"dblclick",function(a){t.doRailClick(a,!0,!1)}),t.bind(t.cursor,"click",function(a){t.cancelEvent(a)}),t.bind(t.cursor,"dblclick",function(a){t.cancelEvent(a)})),t.railh&&(t.jqbind(t.railh,"mouseenter",function(){return!(!t.ispage&&!t.win.is(":visible"))&&(t.canshowonmouseevent&&t.showCursor(),void(t.rail.active=!0))}),t.jqbind(t.railh,"mouseleave",function(){t.rail.active=!1,t.rail.drag||t.hideCursor()}),t.opt.sensitiverail&&(t.bind(t.railh,"click",function(a){t.doRailClick(a,!1,!0)}),t.bind(t.railh,"dblclick",function(a){t.doRailClick(a,!0,!0)}),t.bind(t.cursorh,"click",function(a){t.cancelEvent(a)}),t.bind(t.cursorh,"dblclick",function(a){t.cancelEvent(a)})))),w.cantouch||t.opt.touchbehavior?(t.bind(w.hasmousecapture?t.win:document,"mouseup",t.ontouchend),t.bind(document,"mousemove",t.ontouchmove),t.onclick&&t.bind(document,"click",t.onclick),t.opt.cursordragontouch?(t.bind(t.cursor,"mousedown",t.onmousedown),t.bind(t.cursor,"mouseup",t.onmouseup),t.cursorh&&t.bind(t.cursorh,"mousedown",function(a){t.onmousedown(a,!0)}),t.cursorh&&t.bind(t.cursorh,"mouseup",t.onmouseup)):(t.bind(t.rail,"mousedown",function(a){a.preventDefault()}),t.railh&&t.bind(t.railh,"mousedown",function(a){a.preventDefault()}))):(t.bind(w.hasmousecapture?t.win:document,"mouseup",t.onmouseup),t.bind(document,"mousemove",t.onmousemove),t.onclick&&t.bind(document,"click",t.onclick),t.bind(t.cursor,"mousedown",t.onmousedown),t.bind(t.cursor,"mouseup",t.onmouseup),t.railh&&(t.bind(t.cursorh,"mousedown",function(a){t.onmousedown(a,!0)}),t.bind(t.cursorh,"mouseup",t.onmouseup)),!t.ispage&&t.opt.enablescrollonselection&&(t.bind(t.win[0],"mousedown",t.onselectionstart),t.bind(document,"mouseup",t.onselectionend),t.bind(t.cursor,"mouseup",t.onselectionend),t.cursorh&&t.bind(t.cursorh,"mouseup",t.onselectionend),t.bind(document,"mousemove",t.onselectiondrag)),t.zoom&&(t.jqbind(t.zoom,"mouseenter",function(){t.canshowonmouseevent&&t.showCursor(),t.rail.active=!0}),t.jqbind(t.zoom,"mouseleave",function(){t.rail.active=!1,t.rail.drag||t.hideCursor()}))),t.opt.enablemousewheel&&(t.isiframe||t.mousewheel(w.isie&&t.ispage?document:t.win,t.onmousewheel),t.mousewheel(t.rail,t.onmousewheel),t.railh&&t.mousewheel(t.railh,t.onmousewheelhr)),t.ispage||w.cantouch||/HTML|^BODY/.test(t.win[0].nodeName)||(t.win.attr("tabindex")||t.win.attr({tabindex:d++}),t.jqbind(t.win,"focus",function(a){b=t.getTarget(a).id||!0,t.hasfocus=!0,t.canshowonmouseevent&&t.noticeCursor()}),t.jqbind(t.win,"blur",function(a){b=!1,t.hasfocus=!1}),t.jqbind(t.win,"mouseenter",function(a){c=t.getTarget(a).id||!0,t.hasmousefocus=!0,t.canshowonmouseevent&&t.noticeCursor()}),t.jqbind(t.win,"mouseleave",function(){c=!1,t.hasmousefocus=!1,t.rail.drag||t.hideCursor()}))}if(t.onkeypress=function(d){if(t.railslocked&&0==t.page.maxh)return!0;d=d?d:window.e;var e=t.getTarget(d);if(e&&/INPUT|TEXTAREA|SELECT|OPTION/.test(e.nodeName)&&(!e.getAttribute("type")&&!e.type||!/submit|button|cancel/i.tp)||a(e).attr("contenteditable"))return!0;if(t.hasfocus||t.hasmousefocus&&!b||t.ispage&&!b&&!c){if(e=d.keyCode,t.railslocked&&27!=e)return t.cancelEvent(d);var f=d.ctrlKey||!1,g=d.shiftKey||!1,h=!1;switch(e){case 38:case 63233:t.doScrollBy(72),h=!0;break;case 40:case 63235:t.doScrollBy(-72),h=!0;break;case 37:case 63232:t.railh&&(f?t.doScrollLeft(0):t.doScrollLeftBy(72),h=!0);break;case 39:case 63234:t.railh&&(f?t.doScrollLeft(t.page.maxw):t.doScrollLeftBy(-72),h=!0);break;case 33:case 63276:t.doScrollBy(t.view.h),h=!0;break;case 34:case 63277:t.doScrollBy(-t.view.h),h=!0;break;case 36:case 63273:t.railh&&f?t.doScrollPos(0,0):t.doScrollTo(0),h=!0;break;case 35:case 63275:t.railh&&f?t.doScrollPos(t.page.maxw,t.page.maxh):t.doScrollTo(t.page.maxh),h=!0;break;case 32:t.opt.spacebarenabled&&(g?t.doScrollBy(t.view.h):t.doScrollBy(-t.view.h),h=!0);break;case 27:t.zoomactive&&(t.doZoom(),h=!0)}if(h)return t.cancelEvent(d)}},t.opt.enablekeyboard&&t.bind(document,w.isopera&&!w.isopera12?"keypress":"keydown",t.onkeypress),t.bind(document,"keydown",function(a){a.ctrlKey&&(t.wheelprevented=!0)}),t.bind(document,"keyup",function(a){a.ctrlKey||(t.wheelprevented=!1)}),t.bind(window,"blur",function(a){t.wheelprevented=!1}),t.bind(window,"resize",t.lazyResize),t.bind(window,"orientationchange",t.lazyResize),t.bind(window,"load",t.lazyResize),w.ischrome&&!t.ispage&&!t.haswrapper){var u=t.win.attr("style"),i=parseFloat(t.win.css("width"))+1;t.win.css("width",i),t.synched("chromefix",function(){t.win.attr("style",u)})}t.onAttributeChange=function(a){t.lazyResize(t.isieold?250:30)},t.isie11||!1===l||(t.observerbody=new l(function(b){if(b.forEach(function(b){if("attributes"==b.type)return a("body").hasClass("modal-open")&&a("body").hasClass("modal-dialog")&&!a.contains(a(".modal-dialog")[0],t.doc[0])?t.hide():t.show()}),document.body.scrollHeight!=t.page.maxh)return t.lazyResize(30)}),t.observerbody.observe(document.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),t.ispage||t.haswrapper||(!1!==l?(t.observer=new l(function(a){a.forEach(t.onAttributeChange)}),t.observer.observe(t.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),t.observerremover=new l(function(a){a.forEach(function(a){if(0<a.removedNodes.length)for(var b in a.removedNodes)if(t&&a.removedNodes[b]==t.win[0])return t.remove()})}),t.observerremover.observe(t.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(t.bind(t.win,w.isie&&!w.isie9?"propertychange":"DOMAttrModified",t.onAttributeChange),w.isie9&&t.win[0].attachEvent("onpropertychange",t.onAttributeChange),t.bind(t.win,"DOMNodeRemoved",function(a){a.target==t.win[0]&&t.remove()}))),!t.ispage&&t.opt.boxzoom&&t.bind(window,"resize",t.resizeZoom),t.istextarea&&(t.bind(t.win,"keydown",t.lazyResize),t.bind(t.win,"mouseup",t.lazyResize)),t.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var v=function(){t.iframexd=!1;var b;try{b="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(c){t.iframexd=!0,b=!1}if(t.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(t.forcescreen=!0,t.isiframe&&(t.iframe={doc:a(b),html:t.doc.contents().find("html")[0],body:t.doc.contents().find("body")[0]},t.getContentSize=function(){return{w:Math.max(t.iframe.html.scrollWidth,t.iframe.body.scrollWidth),h:Math.max(t.iframe.html.scrollHeight,t.iframe.body.scrollHeight)}},t.docscroll=a(t.iframe.body)),!w.isios&&t.opt.iframeautoresize&&!t.isiframe){t.win.scrollTop(0),t.doc.height("");var d=Math.max(b.getElementsByTagName("html")[0].scrollHeight,b.body.scrollHeight);t.doc.height(d)}t.lazyResize(30),w.isie7&&t.css(a(t.iframe.html),e),t.css(a(t.iframe.body),e),w.isios&&t.haswrapper&&t.css(a(b.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?t.bind(this.contentWindow,"scroll",t.onscroll):t.bind(b,"scroll",t.onscroll),t.opt.enablemousewheel&&t.mousewheel(b,t.onmousewheel),t.opt.enablekeyboard&&t.bind(b,w.isopera?"keypress":"keydown",t.onkeypress),(w.cantouch||t.opt.touchbehavior)&&(t.bind(b,"mousedown",t.ontouchstart),t.bind(b,"mousemove",function(a){return t.ontouchmove(a,!0)}),t.opt.grabcursorenabled&&w.cursorgrabvalue&&t.css(a(b.body),{cursor:w.cursorgrabvalue})),t.bind(b,"mouseup",t.ontouchend),t.zoom&&(t.opt.dblclickzoom&&t.bind(b,"dblclick",t.doZoom),t.ongesturezoom&&t.bind(b,"gestureend",t.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){v.call(t.doc[0],!1)},500),t.bind(this.doc,"load",v)}},this.showCursor=function(a,b){if(t.cursortimeout&&(clearTimeout(t.cursortimeout),t.cursortimeout=0),t.rail){if(t.autohidedom&&(t.autohidedom.stop().css({opacity:t.opt.cursoropacitymax}),t.cursoractive=!0),t.rail.drag&&1==t.rail.drag.pt||(void 0!==a&&!1!==a&&(t.scroll.y=Math.round(1*a/t.scrollratio.y)),void 0!==b&&(t.scroll.x=Math.round(1*b/t.scrollratio.x))),t.cursor.css({height:t.cursorheight,top:t.scroll.y}),t.cursorh){var c=t.hasreversehr?t.scrollvaluemaxw-t.scroll.x:t.scroll.x;!t.rail.align&&t.rail.visibility?t.cursorh.css({width:t.cursorwidth,left:c+t.rail.width}):t.cursorh.css({width:t.cursorwidth,left:c}),t.cursoractive=!0}t.zoom&&t.zoom.stop().css({opacity:t.opt.cursoropacitymax})}},this.hideCursor=function(a){t.cursortimeout||!t.rail||!t.autohidedom||t.hasmousefocus&&"leave"==t.opt.autohidemode||(t.cursortimeout=setTimeout(function(){t.rail.active&&t.showonmouseevent||(t.autohidedom.stop().animate({opacity:t.opt.cursoropacitymin}),t.zoom&&t.zoom.stop().animate({opacity:t.opt.cursoropacitymin}),t.cursoractive=!1),t.cursortimeout=0},a||t.opt.hidecursordelay))},this.noticeCursor=function(a,b,c){t.showCursor(b,c),t.rail.active||t.hideCursor(a)},this.getContentSize=t.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:t.haswrapper?function(){return{w:t.doc.outerWidth()+parseInt(t.win.css("paddingLeft"))+parseInt(t.win.css("paddingRight")),h:t.doc.outerHeight()+parseInt(t.win.css("paddingTop"))+parseInt(t.win.css("paddingBottom"))}}:function(){return{w:t.docscroll[0].scrollWidth,h:t.docscroll[0].scrollHeight}},this.onResize=function(a,b){if(!t||!t.win)return!1;if(!t.haswrapper&&!t.ispage){if("none"==t.win.css("display"))return t.visibility&&t.hideRail().hideRailHr(),!1;t.hidden||t.visibility||t.showRail().showRailHr()}var c=t.page.maxh,d=t.page.maxw,e=t.view.h,f=t.view.w;if(t.view={w:t.ispage?t.win.width():parseInt(t.win[0].clientWidth),h:t.ispage?t.win.height():parseInt(t.win[0].clientHeight)},t.page=b?b:t.getContentSize(),t.page.maxh=Math.max(0,t.page.h-t.view.h),t.page.maxw=Math.max(0,t.page.w-t.view.w),t.page.maxh==c&&t.page.maxw==d&&t.view.w==f&&t.view.h==e){if(t.ispage)return t;if(c=t.win.offset(),t.lastposition&&(d=t.lastposition,d.top==c.top&&d.left==c.left))return t;t.lastposition=c}return 0==t.page.maxh?(t.hideRail(),t.scrollvaluemax=0,t.scroll.y=0,t.scrollratio.y=0,t.cursorheight=0,t.setScrollTop(0),t.rail&&(t.rail.scrollable=!1)):(t.page.maxh-=t.opt.railpadding.top+t.opt.railpadding.bottom,t.rail.scrollable=!0),0==t.page.maxw?(t.hideRailHr(),t.scrollvaluemaxw=0,t.scroll.x=0,t.scrollratio.x=0,t.cursorwidth=0,t.setScrollLeft(0),t.railh&&(t.railh.scrollable=!1)):(t.page.maxw-=t.opt.railpadding.left+t.opt.railpadding.right,t.railh&&(t.railh.scrollable=t.opt.horizrailenabled)),t.railslocked=t.locked||0==t.page.maxh&&0==t.page.maxw,t.railslocked?(t.ispage||t.updateScrollBar(t.view),!1):(t.hidden||t.visibility?!t.railh||t.hidden||t.railh.visibility||t.showRailHr():t.showRail().showRailHr(),t.istextarea&&t.win.css("resize")&&"none"!=t.win.css("resize")&&(t.view.h-=20),t.cursorheight=Math.min(t.view.h,Math.round(t.view.h/t.page.h*t.view.h)),t.cursorheight=t.opt.cursorfixedheight?t.opt.cursorfixedheight:Math.max(t.opt.cursorminheight,t.cursorheight),
t.cursorwidth=Math.min(t.view.w,Math.round(t.view.w/t.page.w*t.view.w)),t.cursorwidth=t.opt.cursorfixedheight?t.opt.cursorfixedheight:Math.max(t.opt.cursorminheight,t.cursorwidth),t.scrollvaluemax=t.view.h-t.cursorheight-t.cursor.hborder-(t.opt.railpadding.top+t.opt.railpadding.bottom),t.railh&&(t.railh.width=0<t.page.maxh?t.view.w-t.rail.width:t.view.w,t.scrollvaluemaxw=t.railh.width-t.cursorwidth-t.cursorh.wborder-(t.opt.railpadding.left+t.opt.railpadding.right)),t.ispage||t.updateScrollBar(t.view),t.scrollratio={x:t.page.maxw/t.scrollvaluemaxw,y:t.page.maxh/t.scrollvaluemax},t.getScrollTop()>t.page.maxh?t.doScrollTop(t.page.maxh):(t.scroll.y=Math.round(t.getScrollTop()*(1/t.scrollratio.y)),t.scroll.x=Math.round(t.getScrollLeft()*(1/t.scrollratio.x)),t.cursoractive&&t.noticeCursor()),t.scroll.y&&0==t.getScrollTop()&&t.doScrollTo(Math.floor(t.scroll.y*t.scrollratio.y)),t)},this.resize=t.onResize,this.hlazyresize=0,this.lazyResize=function(a){return t.haswrapper||t.hide(),t.hlazyresize&&clearTimeout(t.hlazyresize),t.hlazyresize=setTimeout(function(){t&&t.show().resize()},240),t},this.jqbind=function(b,c,d){t.events.push({e:b,n:c,f:d,q:!0}),a(b).bind(c,d)},this.mousewheel=function(a,b,c){if(a="jquery"in a?a[0]:a,"onwheel"in document.createElement("div"))t._bind(a,"wheel",b,c||!1);else{var d=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";r(a,d,b,c||!1),"DOMMouseScroll"==d&&r(a,"MozMousePixelScroll",b,c||!1)}},w.haseventlistener?(this.bind=function(a,b,c,d){t._bind("jquery"in a?a[0]:a,b,c,d||!1)},this._bind=function(a,b,c,d){t.events.push({e:a,n:b,f:c,b:d,q:!1}),a.addEventListener(b,c,d||!1)},this.cancelEvent=function(a){return!!a&&(a=a.original?a.original:a,a.cancelable&&a.preventDefault(),a.stopPropagation(),a.preventManipulation&&a.preventManipulation(),!1)},this.stopPropagation=function(a){return!!a&&(a=a.original?a.original:a,a.stopPropagation(),!1)},this._unbind=function(a,b,c,d){a.removeEventListener(b,c,d)}):(this.bind=function(a,b,c,d){var e="jquery"in a?a[0]:a;t._bind(e,b,function(a){return(a=a||window.event||!1)&&a.srcElement&&(a.target=a.srcElement),"pageY"in a||(a.pageX=a.clientX+document.documentElement.scrollLeft,a.pageY=a.clientY+document.documentElement.scrollTop),!1!==c.call(e,a)&&!1!==d||t.cancelEvent(a)})},this._bind=function(a,b,c,d){t.events.push({e:a,n:b,f:c,b:d,q:!1}),a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},this.cancelEvent=function(a){return!!(a=window.event||!1)&&(a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1)},this.stopPropagation=function(a){return!!(a=window.event||!1)&&(a.cancelBubble=!0,!1)},this._unbind=function(a,b,c,d){a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=!1}),this.unbindAll=function(){for(var a=0;a<t.events.length;a++){var b=t.events[a];b.q?b.e.unbind(b.n,b.f):t._unbind(b.e,b.n,b.f,b.b)}},this.showRail=function(){return 0==t.page.maxh||!t.ispage&&"none"==t.win.css("display")||(t.visibility=!0,t.rail.visibility=!0,t.rail.css("display","block")),t},this.showRailHr=function(){return t.railh?(0==t.page.maxw||!t.ispage&&"none"==t.win.css("display")||(t.railh.visibility=!0,t.railh.css("display","block")),t):t},this.hideRail=function(){return t.visibility=!1,t.rail.visibility=!1,t.rail.css("display","none"),t},this.hideRailHr=function(){return t.railh?(t.railh.visibility=!1,t.railh.css("display","none"),t):t},this.show=function(){return t.hidden=!1,t.railslocked=!1,t.showRail().showRailHr()},this.hide=function(){return t.hidden=!0,t.railslocked=!0,t.hideRail().hideRailHr()},this.toggle=function(){return t.hidden?t.show():t.hide()},this.remove=function(){t.stop(),t.cursortimeout&&clearTimeout(t.cursortimeout);for(var b in t.delaylist)t.delaylist[b]&&i(t.delaylist[b].h);for(t.doZoomOut(),t.unbindAll(),w.isie9&&t.win[0].detachEvent("onpropertychange",t.onAttributeChange),!1!==t.observer&&t.observer.disconnect(),!1!==t.observerremover&&t.observerremover.disconnect(),!1!==t.observerbody&&t.observerbody.disconnect(),t.events=null,t.cursor&&t.cursor.remove(),t.cursorh&&t.cursorh.remove(),t.rail&&t.rail.remove(),t.railh&&t.railh.remove(),t.zoom&&t.zoom.remove(),b=0;b<t.saved.css.length;b++){var c=t.saved.css[b];c[0].css(c[1],void 0===c[2]?"":c[2])}t.saved=!1,t.me.data("__nicescroll","");var d=a.nicescroll;d.each(function(a){if(this&&this.id===t.id){delete d[a];for(var b=++a;b<d.length;b++,a++)d[a]=d[b];d.length--,d.length&&delete d[d.length]}});for(var e in t)t[e]=null,delete t[e];t=null},this.scrollstart=function(a){return this.onscrollstart=a,t},this.scrollend=function(a){return this.onscrollend=a,t},this.scrollcancel=function(a){return this.onscrollcancel=a,t},this.zoomin=function(a){return this.onzoomin=a,t},this.zoomout=function(a){return this.onzoomout=a,t},this.isScrollable=function(b){if(b=b.target?b.target:b,"OPTION"==b.nodeName)return!0;for(;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=a(b),c=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(c))return b.clientHeight!=b.scrollHeight;b=!!b.parentNode&&b.parentNode}return!1},this.getViewport=function(b){for(b=!(!b||!b.parentNode)&&b.parentNode;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=a(b);if(/fixed|absolute/.test(c.css("position")))return c;var d=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(d)&&b.clientHeight!=b.scrollHeight||0<c.getNiceScroll().length)return c;b=!!b.parentNode&&b.parentNode}return!1},this.triggerScrollEnd=function(){if(t.onscrollend){var a=t.getScrollLeft(),b=t.getScrollTop();t.onscrollend.call(t,{type:"scrollend",current:{x:a,y:b},end:{x:a,y:b}})}},this.onmousewheel=function(a){if(!t.wheelprevented){if(t.railslocked)return t.debounced("checkunlock",t.resize,250),!0;if(t.rail.drag)return t.cancelEvent(a);if("auto"==t.opt.oneaxismousemode&&0!=a.deltaX&&(t.opt.oneaxismousemode=!1),t.opt.oneaxismousemode&&0==a.deltaX&&!t.rail.scrollable)return!t.railh||!t.railh.scrollable||t.onmousewheelhr(a);var b=+new Date,c=!1;return t.opt.preservenativescrolling&&t.checkarea+600<b&&(t.nativescrollingarea=t.isScrollable(a),c=!0),t.checkarea=b,!!t.nativescrollingarea||((a=s(a,!1,c))&&(t.checkarea=0),a)}},this.onmousewheelhr=function(a){if(!t.wheelprevented){if(t.railslocked||!t.railh.scrollable)return!0;if(t.rail.drag)return t.cancelEvent(a);var b=+new Date,c=!1;return t.opt.preservenativescrolling&&t.checkarea+600<b&&(t.nativescrollingarea=t.isScrollable(a),c=!0),t.checkarea=b,!!t.nativescrollingarea||(t.railslocked?t.cancelEvent(a):s(a,!0,c))}},this.stop=function(){return t.cancelScroll(),t.scrollmon&&t.scrollmon.stop(),t.cursorfreezed=!1,t.scroll.y=Math.round(t.getScrollTop()*(1/t.scrollratio.y)),t.noticeCursor(),t},this.getTransitionSpeed=function(a){return a=Math.min(Math.round(10*t.opt.scrollspeed),Math.round(a/20*t.opt.scrollspeed)),20<a?a:0},t.opt.smoothscroll?t.ishwscroll&&w.hastransition&&t.opt.usetransition&&t.opt.smoothscroll?(this.prepareTransition=function(a,b){var c=b?20<a?a:0:t.getTransitionSpeed(a),d=c?w.prefixstyle+"transform "+c+"ms ease-out":"";return t.lasttransitionstyle&&t.lasttransitionstyle==d||(t.lasttransitionstyle=d,t.doc.css(w.transitionstyle,d)),c},this.doScrollLeft=function(a,b){var c=t.scrollrunning?t.newscrolly:t.getScrollTop();t.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=t.scrollrunning?t.newscrollx:t.getScrollLeft();t.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){var d=t.getScrollTop(),e=t.getScrollLeft();return(0>(t.newscrolly-d)*(b-d)||0>(t.newscrollx-e)*(a-e))&&t.cancelScroll(),0==t.opt.bouncescroll&&(0>b?b=0:b>t.page.maxh&&(b=t.page.maxh),0>a?a=0:a>t.page.maxw&&(a=t.page.maxw)),(!t.scrollrunning||a!=t.newscrollx||b!=t.newscrolly)&&(t.newscrolly=b,t.newscrollx=a,t.newscrollspeed=c||!1,!t.timer&&void(t.timer=setTimeout(function(){var c=t.getScrollTop(),d=t.getScrollLeft(),e=Math.round(Math.sqrt(Math.pow(a-d,2)+Math.pow(b-c,2))),e=t.newscrollspeed&&1<t.newscrollspeed?t.newscrollspeed:t.getTransitionSpeed(e);t.newscrollspeed&&1>=t.newscrollspeed&&(e*=t.newscrollspeed),t.prepareTransition(e,!0),t.timerscroll&&t.timerscroll.tm&&clearInterval(t.timerscroll.tm),0<e&&(!t.scrollrunning&&t.onscrollstart&&t.onscrollstart.call(t,{type:"scrollstart",current:{x:d,y:c},request:{x:a,y:b},end:{x:t.newscrollx,y:t.newscrolly},speed:e}),w.transitionend?t.scrollendtrapped||(t.scrollendtrapped=!0,t.bind(t.doc,w.transitionend,t.onScrollTransitionEnd,!1)):(t.scrollendtrapped&&clearTimeout(t.scrollendtrapped),t.scrollendtrapped=setTimeout(t.onScrollTransitionEnd,e)),t.timerscroll={bz:new y(c,t.newscrolly,e,0,0,.58,1),bh:new y(d,t.newscrollx,e,0,0,.58,1)},t.cursorfreezed||(t.timerscroll.tm=setInterval(function(){t.showCursor(t.getScrollTop(),t.getScrollLeft())},60))),t.synched("doScroll-set",function(){t.timer=0,t.scrollendtrapped&&(t.scrollrunning=!0),t.setScrollTop(t.newscrolly),t.setScrollLeft(t.newscrollx),t.scrollendtrapped||t.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!t.scrollendtrapped)return!0;var a=t.getScrollTop(),b=t.getScrollLeft();return t.scrollrunning=!1,w.transitionend||clearTimeout(w.transitionend),t.scrollendtrapped=!1,t._unbind(t.doc[0],w.transitionend,t.onScrollTransitionEnd),t.prepareTransition(0),t.setScrollTop(a),t.railh&&t.setScrollLeft(b),t.timerscroll&&t.timerscroll.tm&&clearInterval(t.timerscroll.tm),t.timerscroll=!1,t.cursorfreezed=!1,t.showCursor(a,b),t},this.onScrollTransitionEnd=function(){t.scrollendtrapped&&t._unbind(t.doc[0],w.transitionend,t.onScrollTransitionEnd),t.scrollendtrapped=!1,t.prepareTransition(0),t.timerscroll&&t.timerscroll.tm&&clearInterval(t.timerscroll.tm),t.timerscroll=!1;var a=t.getScrollTop(),b=t.getScrollLeft();return t.setScrollTop(a),t.railh&&t.setScrollLeft(b),t.noticeCursor(!1,a,b),t.cursorfreezed=!1,0>a?a=0:a>t.page.maxh&&(a=t.page.maxh),0>b?b=0:b>t.page.maxw&&(b=t.page.maxw),a!=t.newscrolly||b!=t.newscrollx?t.doScrollPos(b,a,t.opt.snapbackspeed):(t.onscrollend&&t.scrollrunning&&t.triggerScrollEnd(),void(t.scrollrunning=!1))}):(this.doScrollLeft=function(a,b){var c=t.scrollrunning?t.newscrolly:t.getScrollTop();t.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=t.scrollrunning?t.newscrollx:t.getScrollLeft();t.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){function d(){if(t.cancelAnimationFrame)return!0;if(t.scrollrunning=!0,l=1-l)return t.timer=h(d)||1;var a,b,c=0,e=b=t.getScrollTop();t.dst.ay?(e=t.bzscroll?t.dst.py+t.bzscroll.getNow()*t.dst.ay:t.newscrolly,a=e-b,(0>a&&e<t.newscrolly||0<a&&e>t.newscrolly)&&(e=t.newscrolly),t.setScrollTop(e),e==t.newscrolly&&(c=1)):c=1,b=a=t.getScrollLeft(),t.dst.ax?(b=t.bzscroll?t.dst.px+t.bzscroll.getNow()*t.dst.ax:t.newscrollx,a=b-a,(0>a&&b<t.newscrollx||0<a&&b>t.newscrollx)&&(b=t.newscrollx),t.setScrollLeft(b),b==t.newscrollx&&(c+=1)):c+=1,2==c?(t.timer=0,t.cursorfreezed=!1,t.bzscroll=!1,t.scrollrunning=!1,0>e?e=0:e>t.page.maxh&&(e=Math.max(0,t.page.maxh)),0>b?b=0:b>t.page.maxw&&(b=t.page.maxw),b!=t.newscrollx||e!=t.newscrolly?t.doScrollPos(b,e):t.onscrollend&&t.triggerScrollEnd()):t.timer=h(d)||1}if(b=void 0===b||!1===b?t.getScrollTop(!0):b,t.timer&&t.newscrolly==b&&t.newscrollx==a)return!0;t.timer&&i(t.timer),t.timer=0;var e=t.getScrollTop(),f=t.getScrollLeft();(0>(t.newscrolly-e)*(b-e)||0>(t.newscrollx-f)*(a-f))&&t.cancelScroll(),t.newscrolly=b,t.newscrollx=a,t.bouncescroll&&t.rail.visibility||(0>t.newscrolly?t.newscrolly=0:t.newscrolly>t.page.maxh&&(t.newscrolly=t.page.maxh)),t.bouncescroll&&t.railh.visibility||(0>t.newscrollx?t.newscrollx=0:t.newscrollx>t.page.maxw&&(t.newscrollx=t.page.maxw)),t.dst={},t.dst.x=a-f,t.dst.y=b-e,t.dst.px=f,t.dst.py=e;var g=Math.round(Math.sqrt(Math.pow(t.dst.x,2)+Math.pow(t.dst.y,2)));t.dst.ax=t.dst.x/g,t.dst.ay=t.dst.y/g;var j=0,k=g;if(0==t.dst.x?(j=e,k=b,t.dst.ay=1,t.dst.py=0):0==t.dst.y&&(j=f,k=a,t.dst.ax=1,t.dst.px=0),g=t.getTransitionSpeed(g),c&&1>=c&&(g*=c),t.bzscroll=0<g&&(t.bzscroll?t.bzscroll.update(k,g):new y(j,k,g,0,1,0,1)),!t.timer){(e==t.page.maxh&&b>=t.page.maxh||f==t.page.maxw&&a>=t.page.maxw)&&t.checkContentSize();var l=1;t.cancelAnimationFrame=!1,t.timer=1,t.onscrollstart&&!t.scrollrunning&&t.onscrollstart.call(t,{type:"scrollstart",current:{x:f,y:e},request:{x:a,y:b},end:{x:t.newscrollx,y:t.newscrolly},speed:g}),d(),(e==t.page.maxh&&b>=e||f==t.page.maxw&&a>=f)&&t.checkContentSize(),t.noticeCursor()}},this.cancelScroll=function(){return t.timer&&i(t.timer),t.timer=0,t.bzscroll=!1,t.scrollrunning=!1,t}):(this.doScrollLeft=function(a,b){var c=t.getScrollTop();t.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=t.getScrollLeft();t.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){var d=a>t.page.maxw?t.page.maxw:a;0>d&&(d=0);var e=b>t.page.maxh?t.page.maxh:b;0>e&&(e=0),t.synched("scroll",function(){t.setScrollTop(e),t.setScrollLeft(d)})},this.cancelScroll=function(){}),this.doScrollBy=function(a,b){var c=0,c=b?Math.floor((t.scroll.y-a)*t.scrollratio.y):(t.timer?t.newscrolly:t.getScrollTop(!0))-a;if(t.bouncescroll){var d=Math.round(t.view.h/2);c<-d?c=-d:c>t.page.maxh+d&&(c=t.page.maxh+d)}return t.cursorfreezed=!1,d=t.getScrollTop(!0),0>c&&0>=d?t.noticeCursor():c>t.page.maxh&&d>=t.page.maxh?(t.checkContentSize(),t.noticeCursor()):void t.doScrollTop(c)},this.doScrollLeftBy=function(a,b){var c=0,c=b?Math.floor((t.scroll.x-a)*t.scrollratio.x):(t.timer?t.newscrollx:t.getScrollLeft(!0))-a;if(t.bouncescroll){var d=Math.round(t.view.w/2);c<-d?c=-d:c>t.page.maxw+d&&(c=t.page.maxw+d)}return t.cursorfreezed=!1,d=t.getScrollLeft(!0),0>c&&0>=d||c>t.page.maxw&&d>=t.page.maxw?t.noticeCursor():void t.doScrollLeft(c)},this.doScrollTo=function(a,b){t.cursorfreezed=!1,t.doScrollTop(a)},this.checkContentSize=function(){var a=t.getContentSize();a.h==t.page.h&&a.w==t.page.w||t.resize(!1,a)},t.onscroll=function(a){t.rail.drag||t.cursorfreezed||t.synched("scroll",function(){t.scroll.y=Math.round(t.getScrollTop()*(1/t.scrollratio.y)),t.railh&&(t.scroll.x=Math.round(t.getScrollLeft()*(1/t.scrollratio.x))),t.noticeCursor()})},t.bind(t.docscroll,"scroll",t.onscroll),this.doZoomIn=function(b){if(!t.zoomactive){t.zoomactive=!0,t.zoomrestore={style:{}};var c,d="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),e=t.win[0].style;for(c in d){var g=d[c];t.zoomrestore.style[g]=void 0!==e[g]?e[g]:""}return t.zoomrestore.style.width=t.win.css("width"),t.zoomrestore.style.height=t.win.css("height"),t.zoomrestore.padding={w:t.win.outerWidth()-t.win.width(),h:t.win.outerHeight()-t.win.height()},w.isios4&&(t.zoomrestore.scrollTop=a(window).scrollTop(),a(window).scrollTop(0)),t.win.css({position:w.isios4?"absolute":"fixed",top:0,left:0,zIndex:f+100,margin:0}),d=t.win.css("backgroundColor"),(""==d||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(d))&&t.win.css("backgroundColor","#fff"),t.rail.css({zIndex:f+101}),t.zoom.css({zIndex:f+102}),t.zoom.css("backgroundPosition","0px -18px"),t.resizeZoom(),t.onzoomin&&t.onzoomin.call(t),t.cancelEvent(b)}},this.doZoomOut=function(b){if(t.zoomactive)return t.zoomactive=!1,t.win.css("margin",""),t.win.css(t.zoomrestore.style),w.isios4&&a(window).scrollTop(t.zoomrestore.scrollTop),t.rail.css({"z-index":t.zindex}),t.zoom.css({"z-index":t.zindex}),t.zoomrestore=!1,t.zoom.css("backgroundPosition","0px 0px"),t.onResize(),t.onzoomout&&t.onzoomout.call(t),t.cancelEvent(b)},this.doZoom=function(a){return t.zoomactive?t.doZoomOut(a):t.doZoomIn(a)},this.resizeZoom=function(){if(t.zoomactive){var b=t.getScrollTop();t.win.css({width:a(window).width()-t.zoomrestore.padding.w+"px",height:a(window).height()-t.zoomrestore.padding.h+"px"}),t.onResize(),t.setScrollTop(Math.min(t.page.maxh,b))}},this.init(),a.nicescroll.push(this)},q=function(a){var b=this;this.nc=a,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+new Date},this.reset=function(a,c){b.stop();var d=b.time();b.steptime=0,b.lasttime=d,b.speedx=0,b.speedy=0,b.lastx=a,b.lasty=c,b.lastscrollx=-1,b.lastscrolly=-1},this.update=function(a,c){var d=b.time();b.steptime=d-b.lasttime,b.lasttime=d;var d=c-b.lasty,e=a-b.lastx,f=b.nc.getScrollTop(),g=b.nc.getScrollLeft(),f=f+d,g=g+e;b.snapx=0>g||g>b.nc.page.maxw,b.snapy=0>f||f>b.nc.page.maxh,b.speedx=e,b.speedy=d,b.lastx=a,b.lasty=c},this.stop=function(){b.nc.unsynched("domomentum2d"),b.timer&&clearTimeout(b.timer),b.timer=0,b.lastscrollx=-1,b.lastscrolly=-1},this.doSnapy=function(a,c){var d=!1;0>c?(c=0,d=!0):c>b.nc.page.maxh&&(c=b.nc.page.maxh,d=!0),0>a?(a=0,d=!0):a>b.nc.page.maxw&&(a=b.nc.page.maxw,d=!0),d?b.nc.doScrollPos(a,c,b.nc.opt.snapbackspeed):b.nc.triggerScrollEnd()},this.doMomentum=function(a){var c=b.time(),d=a?c+a:b.lasttime;a=b.nc.getScrollLeft();var e=b.nc.getScrollTop(),f=b.nc.page.maxh,g=b.nc.page.maxw;if(b.speedx=0<g?Math.min(60,b.speedx):0,b.speedy=0<f?Math.min(60,b.speedy):0,d=d&&60>=c-d,(0>e||e>f||0>a||a>g)&&(d=!1),a=!(!b.speedx||!d)&&b.speedx,b.speedy&&d&&b.speedy||a){var h=Math.max(16,b.steptime);50<h&&(a=h/50,b.speedx*=a,b.speedy*=a,h=50),b.demulxy=0,b.lastscrollx=b.nc.getScrollLeft(),b.chkx=b.lastscrollx,b.lastscrolly=b.nc.getScrollTop(),b.chky=b.lastscrolly;var i=b.lastscrollx,j=b.lastscrolly,k=function(){var a=600<b.time()-c?.04:.02;b.speedx&&(i=Math.floor(b.lastscrollx-b.speedx*(1-b.demulxy)),b.lastscrollx=i,0>i||i>g)&&(a=.1),b.speedy&&(j=Math.floor(b.lastscrolly-b.speedy*(1-b.demulxy)),b.lastscrolly=j,0>j||j>f)&&(a=.1),b.demulxy=Math.min(1,b.demulxy+a),b.nc.synched("domomentum2d",function(){b.speedx&&(b.nc.getScrollLeft(),b.chkx=i,b.nc.setScrollLeft(i)),b.speedy&&(b.nc.getScrollTop(),b.chky=j,b.nc.setScrollTop(j)),b.timer||(b.nc.hideCursor(),b.doSnapy(i,j))}),1>b.demulxy?b.timer=setTimeout(k,h):(b.stop(),b.nc.hideCursor(),b.doSnapy(i,j))};k()}else b.doSnapy(b.nc.getScrollLeft(),b.nc.getScrollTop())}},r=a.fn.scrollTop;a.cssHooks.pageYOffset={get:function(b,c,d){return(c=a.data(b,"__nicescroll")||!1)&&c.ishwscroll?c.getScrollTop():r.call(b)},set:function(b,c){var d=a.data(b,"__nicescroll")||!1;return d&&d.ishwscroll?d.setScrollTop(parseInt(c)):r.call(b,c),this}},a.fn.scrollTop=function(b){if(void 0===b){var c=!!this[0]&&(a.data(this[0],"__nicescroll")||!1);return c&&c.ishwscroll?c.getScrollTop():r.call(this)}return this.each(function(){var c=a.data(this,"__nicescroll")||!1;c&&c.ishwscroll?c.setScrollTop(parseInt(b)):r.call(a(this),b)})};var s=a.fn.scrollLeft;a.cssHooks.pageXOffset={get:function(b,c,d){return(c=a.data(b,"__nicescroll")||!1)&&c.ishwscroll?c.getScrollLeft():s.call(b)},set:function(b,c){var d=a.data(b,"__nicescroll")||!1;return d&&d.ishwscroll?d.setScrollLeft(parseInt(c)):s.call(b,c),this}},a.fn.scrollLeft=function(b){if(void 0===b){var c=!!this[0]&&(a.data(this[0],"__nicescroll")||!1);return c&&c.ishwscroll?c.getScrollLeft():s.call(this)}return this.each(function(){var c=a.data(this,"__nicescroll")||!1;c&&c.ishwscroll?c.setScrollLeft(parseInt(b)):s.call(a(this),b)})};var t=function(b){var c=this;if(this.length=0,this.name="nicescrollarray",this.each=function(b){return a.each(c,b),c},this.push=function(a){c[c.length]=a,c.length++},this.eq=function(a){return c[a]},b)for(var d=0;d<b.length;d++){var e=a.data(b[d],"__nicescroll")||!1;e&&(this[this.length]=e,this.length++)}return this};!function(a,b,c){for(var d=0;d<b.length;d++)c(a,b[d])}(t.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(a,b){a[b]=function(){var a=arguments;return this.each(function(){this[b].apply(this,a)})}}),a.fn.getNiceScroll=function(b){return void 0===b?new t(this):this[b]&&a.data(this[b],"__nicescroll")||!1},a.expr[":"].nicescroll=function(b){return void 0!==a.data(b,"__nicescroll")},a.fn.niceScroll=function(b,c){void 0!==c||"object"!=typeof b||"jquery"in b||(c=b,b=!1),c=a.extend({},c);var d=new t;void 0===c&&(c={}),b&&(c.doc=a(b),c.win=a(this));var e=!("doc"in c);return e||"win"in c||(c.win=a(this)),this.each(function(){var b=a(this).data("__nicescroll")||!1;b||(c.doc=e?a(this):c.doc,b=new p(c,a(this)),a(this).data("__nicescroll",b)),d.push(b)}),1==d.length?d[0]:d},window.NiceScroll={getjQuery:function(){return a}},a.nicescroll||(a.nicescroll=new t,a.nicescroll.options=m)}),function(a){"function"==typeof define&&define.amd?define("mousewheel",["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=g.detail*-1),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=g.wheelDeltaX*-1),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=m*-1,m=0),j=0===m?l:m,"deltaY"in g&&(m=g.deltaY*-1,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=l*-1)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),define("DialogView",["jquery","underscore","config","quickblox","Entities","Helpers","QMHtml","minEmoji","perfectscrollbar","mCustomScrollbar","nicescroll","mousewheel"],function(a,b,c,d,e,f,g,h,i){function j(a){t=this,this.app=a,u=this.app.models.User,v=this.app.models.Dialog,w=this.app.models.Message,x=this.app.models.ContactList,y=this.app.listeners}function k(b){a(b).mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:120},callbacks:{onTotalScrollBack:function(){n(b)},onTotalScroll:function(){var b=f.isBeginOfChat(),c=a(".dialog-item.is-selected"),d=c.data("dialog");b&&(a(".j-toBottom").hide(),c.find(".unread").text(""),t.decUnreadCounter(d))},onScroll:function(){var b=f.isBeginOfChat();b||a(".j-toBottom").show()}}})}function l(a){var b=document.getElementById("aside_container");a?i.destroy(b):(i.initialize(b,{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20}),y.listenToPsTotalEnd(!0))}function m(b){a(b).niceScroll({cursoropacitymax:.3,railpadding:{top:3,bottom:3,right:-13},smoothscroll:!1,enablemouselockapi:!1,cursorwidth:"6px",autohidemode:"scroll",enabletranslate3d:!1,enablekeyboard:!1})}function n(b){var c,d=t.app.views.Message,e=a(".j-chatItem:visible"),f=e.data("dialog"),g=e.find(".message"),h=g.first().attr("id"),i=g.length;w.download(f,function(e){for(var f=0,g=e.length;f<g;f++)c=w.create(e[f],"ajax"),c.stack=w.isStack(!1,e[f],e[f+1]),d.addItem(c,!0,null),f+1===g&&a(b).mCustomScrollbar("scrollTo","#"+h)},i,"ajax")}function o(a){a.add(".popups").addClass("is-overlay")}function p(a){var b="";return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function q(b){var c=a('.l-chat[data-dialog="'+b+'"]').find(".l-chat-content .mCSB_container"),d=a('<div class="new_messages j-newMessages" data-dialog="'+b+'"><span class="newMessages">New messages</span></div>');c.prepend(d)}function r(b){function c(c){a(b).mCustomScrollbar("scrollTo",c)}var d=a(".j-chatItem:visible"),e=f.isBeginOfChat(),g=d.find(".mCSB_draggerContainer").length;a(".j-newMessages").length?(c(".j-newMessages"),!e&&g&&a(".j-toBottom").show()):c("bottom")}function s(b,c){var d=a('.j-newMessages[data-dialog="'+b+'"]');d.length&&b!==c&&d.remove()}var t,u,v,w,x,y,z={},A="Q-municate",B="images/favicon_counter.png",C="images/favicon.png";return j.prototype={createDataSpinner:function(b,c,d){this.removeDataSpinner();var e;e=d?'<div class="message message_service msg_preloader"><div class="popup-elem j-loading spinner_bounce is-empty is-ajaxDownload">':c?'<div class="popup-elem j-loading spinner_bounce is-creating">':'<div class="popup-elem j-loading spinner_bounce is-empty">',e+='<div class="spinner_bounce-bounce1"></div>',e+='<div class="spinner_bounce-bounce2"></div>',e+='<div class="spinner_bounce-bounce3"></div>',e+="</div>",d&&(e+="</div>"),b?a(".l-chat:visible").find(".l-chat-content").append(e):c?(a("#popupContacts .btn_popup").addClass("is-hidden"),a("#popupContacts .popup-footer").append(e),a("#popupContacts .popup-footer").after('<div class="temp-box"></div>')):d?a(".l-chat:visible").find(".l-chat-content").prepend(e):a("#emptyList").after(e)},removeDataSpinner:function(){a(".spinner_bounce, .temp-box, div.message_service").remove()},prepareDownloading:function(a){f.log("QB SDK: Roster has been got",a),y.setQBHandlers(),u.initProfile(),t.createDataSpinner(),l(),x.saveRoster(a),this.app.views.Settings.setUp(u.contact.id),this.app.models.SyncTabs.init(u.contact.id)},getUnreadCounter:function(b){var c;"undefined"==typeof z[b]&&(z[b]=!0,c=Object.keys(z).length,a("title").text("("+c+") "+A),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+B+'">'))},decUnreadCounter:function(b){var c;"undefined"!=typeof z[b]&&(delete z[b],c=Object.keys(z).length,c>0?a("title").text("("+c+") "+A):(a("title").text(A),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+C+'">')))},logoutWithClearData:function(){l(!0),z={},a("title").text(A),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+C+'">'),a(".mediacall-remote-duration").text("connecting..."),a(".mediacall-info-duration").text("")},downloadDialogs:function(c,f){var g,h,i,j,k,l,m,n,p,q=this.app.views.ContactList,r=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},s=f?"old_dialog":null,u=e.Collections.dialogs,w=x.roster,y=Object.keys(w);params={sort_desc:"last_message_date_sent",skip:f||0},v.download(params,function(e){m=e.items,g=e.total_entries,h=e.limit+e.skip,m.length>0?(i=b.uniq(b.flatten(b.pluck(m,"occupants_ids"),!0)),x.add(i,null,function(){for(var b=0,c=m.length;b<c;b++)l=v.create(m[b]),n=u.get(l),p=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+n.get("id")+'"]'),p[0]&&n.get("unread_count")?(p.find(".unread").text(n.get("unread_count")),t.getUnreadCounter(n.get("id"))):(2===n.get("type")&&d.chat.muc.join(n.get("room_jid")),k=3===n.get("type")?n.get("occupants_ids")[0]:null,r[k]=n.get("id"),x.saveHiddenDialogs(r),j=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},k&&(!w[k]||w[k]&&"none"===w[k].subscription&&!w[k].ask&&j[k])||t.addDialogItem(n,!0,s));a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")})):f||a("#emptyList").removeClass("is-hidden"),c&&x.getFBFriends(c,function(b){o(a("#popupImport"));for(var c=0,d=b.length;c<d;c++)q.importFBFriend(b[c])}),t.getAllUsers(y),t.removeDataSpinner(),g>=h&&t.downloadDialogs(c,h)})},showOldHistory:function(b){var c=a("#oldHistoryList ul").children(".j-dialogItem"),d=a("#historyList ul"),e=c.length,f=e>100?100:e,g=!1;e===f&&(g=!0),d.append(c.slice(0,f)),b(g)},getAllUsers:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList,f={filter:{field:"id",param:"in",value:b},per_page:100};c.listUsers(f,function(b){b.items.forEach(function(b){var c=b.user,f=d.create(c);e.contacts[f.id]=f,a('.profileUserName[data-id="'+f.id+'"]').text(f.full_name),a('.profileUserStatus[data-id="'+f.id+'"]').text(f.status),a('.profileUserPhone[data-id="'+f.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+f.phone+"</span>"),a('.profileUserAvatar[data-id="'+f.id+'"]').css("background-image","url("+f.avatar_url+")"),localStorage.setItem("QM.contact-"+f.id,JSON.stringify(f))})})},hideDialogs:function(){a(".l-list").addClass("is-hidden"),a(".l-list ul").html("")},addDialogItem:function(b,d,e){if(!b)return f.log("Dialog is undefined"),!1;var g,i,j,k,l,m,n=x.contacts,o=x.roster,q=b.get("last_message_date_sent"),r=b.get("occupants_ids"),s=b.get("unread_count"),u=b.get("room_photo"),v=b.get("room_name"),w=b.get("type"),y=b.get("id"),z=f.getTime(q,!0),A=h(f.Messages.parser(b.get("last_message")));i=3===w?r[0]:null;try{k=i?n[i].avatar_url:u||c.defAvatar.group_url,l=i?n[i].full_name:v,j=o[i]?o[i]:null}catch(B){console.error(B)}m='<li class="list-item dialog-item j-dialogItem presence-listener" data-dialog="'+y+'" data-id="'+i+'">',m+='<div class="contact l-flexbox" href="#">',m+='<div class="l-flexbox_inline">',m+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+k+')" data-id="'+i+'"></div>',m+='<div class="dialog_body"><span class="name name_dialog profileUserName" data-id="'+i+'">'+l+"</span>",m+='<span class="last_message_preview j-lastMessagePreview">'+A+"</span></div></div>",m+=3===w?p(j):'<span class="status"></span>',m+='<span class="last_time_preview j-lastTimePreview">'+z+"</span>",m+='<span class="unread">'+s+"</span>",m+="</a></li>",g=new Date,g.setHours(0,0,0,0),!q||new Date(1e3*q)>g||"new_dialog"===e?d?a("#recentList").removeClass("is-hidden").find("ul").append(m):a("#searchList").is(":visible")?a("#recentList").removeClass("is-hidden").find("ul").prepend(m):a("#recentList").removeClass("is-hidden").find("ul").prepend(m):"old_dialog"===e?a("#oldHistoryList").find("ul").append(m):a("#searchList").is(":visible")||a("#historyList").removeClass("is-hidden").find("ul").append(m),a("#emptyList").addClass("is-hidden"),s&&t.getUnreadCounter(y)},htmlBuild:function(b,d){function f(){if(new e.Models.Chat({occupantsIds:F,status:p(i),dialog_id:z,draft:B.get("draft"),location:h,type:B.get("type"),user_id:A,name:n,icon:l,jid:o}),2===B.get("type")){j='<div class="chat-occupants">';for(var b,c=0,d=F.length;c<d;c++)b=F[c],b!=u.contact.id&&(j+='<a class="occupant l-flexbox_inline presence-listener" data-id="'+b+'" href="#">',j+=p(v[b]),j+='<span class="name name_occupant">'+q[b].full_name+"</span>",j+="</a>");j+="</div>"}a('.l-chat[data-dialog="'+z+'"] .j-chatOccupants').append(a(j)),3!==B.get("type")||i&&"none"!==i.subscription||a(".l-chat:visible").addClass("is-request")}e.Collections.dialogs.saveDraft();var g,h,i,j,l,n,o,q=(this.app.views.Message,x.contacts),r=e.Collections.dialogs,v=x.roster,y=b.parent(),z=y.data("dialog"),A=y.data("id"),B=r.get(z),C=q[A],D="QM."+u.contact.id+"_readBadge",E=Number(b.find(".unread").text()),F=B.get("occupants_ids"),G=a(".j-chatWrap"),H=a(".chatView");e.active=z,g=b.find(".icon_videocall").length||b.find(".icon_audiocall").length,
o=B.get("room_jid")||C.user_jid,l=A?C.avatar_url:B.get("room_photo")||c.defAvatar.group_url,n=B.get("room_name")||C.full_name,i=v[A]?v[A]:null,h=localStorage["QM.latitude"]&&localStorage["QM.longitude"]?"btn_active":"",w.skip=0,a(".l-workspace-wrap .l-workspace").addClass("is-hidden"),H.each(function(b,c){var d=a(c);d.hasClass("j-mediacall")?d.addClass("is-hidden"):d.remove()}),g?(G.removeClass("is-hidden"),H.removeClass("is-hidden")):f(),m("#textarea_"+z),k("#mCS_"+z),t.createDataSpinner(!0),t.showChatWithNewMessages(z,E,d),s(a(".is-selected").data("dialog"),z),a(".is-selected").removeClass("is-selected"),y.addClass("is-selected").find(".unread").text(""),t.decUnreadCounter(B.get("id")),localStorage.removeItem(D),localStorage.setItem(D,z)},createGroupChat:function(b,c){for(var d,e=x.contacts,g=a("#popupContacts .is-chosen"),h=a("#popupContacts").data("existing_ids")||[],i=h.length>0?[u.contact.full_name,e[h[0]].full_name]:[u.contact.full_name],j=!b&&h.length>0?[e[h[0]].full_name]:[],k=[],l=(x.roster,a('.l-chat[data-dialog="'+c+'"]'),0),m=g.length;l<m;l++)d=a(g[l]).find(".name").text(),i.length<3&&i.push(d),j.push(d),h.push(a(g[l]).data("id").toString()),k.push(a(g[l]).data("id").toString());i=i.join(", "),j=j.join(", "),h=h.join(),t.createDataSpinner(null,!0),b?v.updateGroup(j,{dialog_id:c,occupants_ids:h,new_ids:k},function(b){t.removeDataSpinner();var c=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+b.get("id")+'"]');c.length>0&&(copyDialogItem=c.clone(),c.remove(),a("#recentList ul.j-list").prepend(copyDialogItem),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),f.Dialogs.isSectionEmpty(a("#recentList ul.j-list")))),a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")}):v.createGroup(j,{name:i,occupants_ids:h,type:2},function(b){t.removeDataSpinner(),a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a('[data-dialog="'+c+'"] .contact').click(),a('.dialog-item[data-dialog="'+b.get("id")+'"]').find(".contact").click()})},leaveGroupChat:function(b,c){function d(){j.remove(),f.Dialogs.isSectionEmpty(l),k.is(":visible")&&(a(".j-capBox").removeClass("is-hidden").siblings().removeClass("is-active"),a(".j-chatWrap").addClass("is-hidden").children().remove())}var g=e.Collections.dialogs,h="string"==typeof b?b:b.data("dialog"),i=g.get(h),j=a('.dialog-item[data-dialog="'+h+'"]'),k=a('.l-chat[data-dialog="'+h+'"]'),l=j.parents("ul");c?d():v.leaveChat(i,function(){d()})},showChatWithNewMessages:function(d,e,f){function g(b){var c;c=a("section.l-chat-content").children("div:not(.spinner_bounce)"),c.css("opacity","0");for(var f=0,g=b.length;f<g;f++){if(i=b[f],i.stack=w.isStack(!1,b[f],b[f+1]),e)switch(f){case h-1:i.stack=!1;break;case h:q(d)}k.addItem(i,null,null)}r("#mCS_"+d),setTimeout(function(){t.removeDataSpinner(),c.css("opacity","1")},150)}var h,i,j,k=this.app.views.Message,l=c.stackMessages,m=100,n=e<l,o=e>l-1,p=e<m;n?(h=e,j=l):o&&p?(h=e,j=e+1):(h=m-1,j=m),f?g(f):(f=[],w.download(d,function(a){b.each(a,function(a){f.push(w.create(a))}),g(f)},j))}},j}),function(a){"function"==typeof define&&define.amd?define("timeago",["jquery"],a):a("object"==typeof module&&"object"==typeof module.exports?require("jquery"):jQuery)}(function(a){function b(){if(!a.contains(document.documentElement,this))return a(this).timeago("dispose"),this;var b=c(this),g=f.settings;return isNaN(b.datetime)||(0==g.cutoff||Math.abs(e(b.datetime))<g.cutoff)&&a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;if(this.settings.allowFuture&&b<0&&(e=d.prefixFromNow,f=d.suffixFromNow),!this.settings.allowPast&&b>=0)return this.settings.strings.inPast;var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=g<45&&c(d.seconds,Math.round(g))||g<90&&c(d.minute,1)||h<45&&c(d.minutes,Math.round(h))||h<90&&c(d.hour,1)||i<24&&c(d.hours,Math.round(i))||i<42&&c(d.day,1)||j<30&&c(d.days,Math.round(j))||j<45&&c(d.month,1)||j<365&&c(d.months,Math.round(j/30))||k<1.5&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),c=c.replace(/([\+\-]\d\d)$/," $100"),new Date(c)},datetime:function(b){var c=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&(this._timeagoInterval=setInterval(c,d.refreshMillis))},update:function(c){var d=f.parse(c);a(this).data("timeago",{datetime:d}),f.settings.localeTitle&&a(this).attr("title",d.toLocaleString()),b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:f.parse(f.isTime(this)?a(this).attr("datetime"):a(this).attr("title"))}),b.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),define("MessageView",["jquery","config","quickblox","underscore","minEmoji","Helpers","timeago","QBNotification","LocationView","QMHtml","Entities"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){this.app=a,E=this.app.models.Settings,SyncTabs=this.app.models.SyncTabs,A=this.app.models.User,D=this.app.models.Dialog,B=this.app.models.Message,C=this.app.models.ContactList,G=this}function m(a,b){return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function n(a){return a>1048576?(a/1048576).toFixed(1)+" MB":(a/1024).toFixed(1)+"KB"}function o(b){if(!b)return!0;var c=a(".l-chat:visible .scrollbar_message");c.mCustomScrollbar("scrollTo","bottom")}function p(b){var c=H.indexOf(b);H.splice(c,1),H.length<1?a('article.message[data-status="typing"]').remove():a('article.message[data-status="typing"] .message_typing').text(H.join(", ")),r()}function q(b){var c,d=a('article.message[data-status="typing"]').length>0;c='<article class="message typing l-flexbox l-flexbox_alignstretch" data-status="typing">',c+='<div class="message_typing"></div>',c+='<div class="is_or_are"> is typing</div>',c+='<div class="popup-elem spinner_bounce is-typing">',c+='<div class="spinner_bounce-bounce1"></div>',c+='<div class="spinner_bounce-bounce2"></div>',c+='<div class="spinner_bounce-bounce3"></div>',c+="</div></article>",H.unshift(b),a.unique(H),H.splice(3,Number.MAX_VALUE),d?a('article.message[data-status="typing"] .message_typing').text(H.join(", ")):(a(".j-typing").append(c),a('article.message[data-status="typing"] .message_typing').text(H.join(", "))),r()}function r(){H.length>1?a("div.is_or_are").text(" are typing"):a("div.is_or_are").text(" is typing")}function s(a){var d=c.chat.helpers.getRoomJidFromDialogId(a),e=d.split("");return"_"==e[0]&&(d=b.qbAccount.appId+d.toString()),d}function t(b,c){var d,e,g,i=k.Collections.dialogs,j=i.get(b.dialog_id),l=!E.get("messages_notify"),m=!SyncTabs.get(),n=b.sender_id===A.contact.id,o=a('.j-dialogItem[data-id="'+b.sender_id+'"]').length,p=7===+b.notification_type&&!o;return!(l||m||n||p)&&(g={user:A,contacts:C.contacts},j&&(g.roomName=j.get("room_name"),g.roomPhoto=j.get("room_photo")),e=f.Notifications.getTitle(b,g),d=f.Notifications.getOptions(b,g),void(h.isSupported()&&c&&(h.needsPermission()?h.requestPermission(function(a){"granted"===a&&f.Notifications.show(e,d)}):f.Notifications.show(e,d))))}function u(a){var b,c=a.data;return c?(c=c.replace(/&amp;/gi,"&").replace(/&quot;/gi,'"').replace(/&#10;/gi,""),b=JSON.parse(c)):b={lat:a.lat,lng:a.lng},b}function v(a){var b=G.app.views.ContactList,d=a.notification_type,e=a.dialog_id,g=a.recipient_jid,h=c.chat.helpers.getIdFromNode(g);switch(d){case"4":b.sendSubscribe(g,null,e),f.log("send subscribe");break;case"5":b.sendConfirm(g),f.log("send confirm");break;case"6":b.sendReject(g),f.log("send reject");break;case"7":b.sendDelete(h),f.log("delete contact")}}function w(b){var c,d=a('.dialog-item[data-dialog="'+b.dialog_id+'"]'),g=d.find(".j-lastMessagePreview"),h=d.find(".j-lastTimePreview"),i=f.getTime(b.date_sent,!0),j=b.notification_type;c=j?j<=2?"Notification message":"Contact request":b.callType?"Call notification":e(f.Messages.parser(b.body)),g.html(c),h.html(i)}function x(a,b,c){var d=k.Collections.dialogs,e=d.get(b);if(e&&e.get("opened")){var f=e.get("messages"),g=f.get(a);if(g){var h="delivered"===c?"Delivered":"Seen";g.set("status",h)}}}function y(a){return c.chat.helpers.getUserJid(a,b.qbAccount.appId)}function z(b){function c(a,b){var c=b&&b.url||"";return 0===c.indexOf("/")&&0!==c.indexOf("//")&&(c=a+c),c}var d,e,g,h,i,k=a("#"+b+".message").find(".message-body"),l=k.find("a:not(a.open_googlemaps)");if(l.length){if(i=l.first().attr("href"),d=f.isValidUrl(i),null===I[i]||!d)return!1;e=a('<a class="og_block" href="'+i+'" target="_blank"></a>'),k.append(e),I[i]?(g=j.Messages.urlPreview(I[i]),k.find(".og_block").append(g)):f.getOpenGraphInfo(i,function(a,b){b&&(b.ogTitle||b.ogDescription)?(h={title:b.ogTitle||b.ogUrl||"",description:b.ogDescription||b.ogUrl||i,picture:c(i,b.ogImage)||""},I[i]=h):(h={title:"",description:i,picture:""},I[i]=null),g=j.Messages.urlPreview(h),k.find(".og_block").append(g)})}}var A,B,C,D,E,F,G,H=[],I={};return l.prototype={checkSenderId:function(a,b){a!==A.contact.id?C.add([a],null,function(){b()}):b()},addItem:function(b,g,h,k){var l=(this.app.views.Dialog,this.app.models.ContactList),m=a('.l-chat[data-dialog="'+b.dialog_id+'"]'),p=f.isBeginOfChat(),q=b.online;return g&&h&&w(b),"undefined"==typeof m[0]||!(b.notification_type||b.callType||b.attachment||b.body)||(!(!b.sessionID||!a('.message[data-session="'+b.sessionID+'"]')[0])||void this.checkSenderId(b.sender_id,function(){var a,k,r,s=l.contacts,t=b.sender_id===A.contact.id?A.contact:s[b.sender_id],v=b.notification_type||b.callState&&(parseInt(b.callState)+7).toString()||"message",w=b.attachment&&b.attachment["content-type"]||b.attachment&&b.attachment.type||null,x=b.attachment&&(c.content.privateUrl(b.attachment.id)||b.attachment.url||null),y=b.latitude&&b.longitude?{lat:b.latitude,lng:b.longitude}:null,B=b.attachment&&"location"===b.attachment.type?u(b.attachment):null,C=B?i.getStaticMapUrl(B,{size:[380,200]}):null,D=B?i.getMapUrl(B):null,E=b.recipient_id&&s[b.recipient_id]||null,F="";switch(v){case"1":added_occupant_ids=d.without(b.added_occupant_ids.split(",").map(Number),t.id),F=f.Messages.getOccupantsNames(added_occupant_ids,A,s),r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has added "+F+" to the group chat</h4>",r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"2":r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',b.added_occupant_ids&&(a=b.added_occupant_ids.split(",").map(Number),F=f.Messages.getOccupantsNames(a,A,s),r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has added "+F+"</h4>"),b.deleted_occupant_ids&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has left</h4>"),b.room_name&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+'</span> has changed the chat name to "'+b.room_name+'"</h4>'),b.room_photo&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has changed the chat picture</h4>"),r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"4":r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===A.contact.id?'<h4 class="message-author">Your request has been sent</h4>':'<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has sent a request to you</h4>",r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"5":r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_ok j-requestConfirm">&#10003;</span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===A.contact.id?'<h4 class="message-author">You have accepted a request</h4>':'<h4 class="message-author">Your request has been accepted</h4>',r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"6":r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_cancel j-requestCancel">&#10005;</span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',b.sender_id===A.contact.id?r+='<h4 class="message-author">You have rejected a request':(r+='<h4 class="message-author">Your request has been rejected ',r+='<button class="btn btn_request_again j-requestAgain">',r+='<img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again',r+="</button></h4>"),r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"7":r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',b.sender_id===A.contact.id?r+='<h4 class="message-author">You have deleted '+E.full_name+" from your contact list":(r+='<h4 class="message-author">You have been deleted from the contact list ',r+='<button class="btn btn_request_again btn_request_again_delete j-requestAgain">',r+='<img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again</button></h4>'),r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>';break;case"8":b.caller&&(r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'" data-session="'+b.sessionID+'">',r+=b.caller===A.contact.id?'<span class="message-avatar request-call '+("2"===b.callType?"request-video_outgoing":"request-audio_outgoing")+'"></span>':'<span class="message-avatar request-call '+("2"===b.callType?"request-video_incoming":"request-audio_incoming")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===A.contact.id?'<h4 class="message-author">Outgoing '+("2"===b.callType?"Video":"")+" Call, "+f.getDuration(b.callDuration):'<h4 class="message-author">Incoming '+("2"===b.callType?"Video":"")+" Call, "+f.getDuration(b.callDuration),r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>');break;case"9":b.caller&&(r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+=b.caller===A.contact.id?'<span class="message-avatar request-call '+("2"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>':'<span class="message-avatar request-call '+("2"===b.callType?"request-video_missed":"request-audio_missed")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===A.contact.id?'<h4 class="message-author">No Answer':'<h4 class="message-author">Missed '+("2"===b.callType?"Video":"")+" Call",r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>');break;case"10":b.caller&&(r='<article id="'+b.id+'" class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<span class="message-avatar request-call '+("2"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===A.contact.id?'<h4 class="message-author">'+s[b.callee].full_name+" doesn't have camera and/or microphone.":'<h4 class="message-author">Camera and/or microphone wasn\'t found.',r+='</div><div class="message-info"><time class="message-time">'+f.getTime(b.date_sent)+"</time>",r+='<div class="info_indent"></div></div></div></div></article>');break;default:k=q?b.status:"Not delivered yet",r=b.sender_id===A.contact.id?'<article id="'+b.id+'" class="message is-own l-flexbox l-flexbox_alignstretch'+(b.stack?" without_border":"")+'" data-id="'+b.sender_id+'" data-type="'+v+'">':'<article id="'+b.id+'" class="message l-flexbox l-flexbox_alignstretch'+(b.stack?" without_border":"")+'" data-id="'+b.sender_id+'" data-type="'+v+'">',r+='<div class="message-avatar avatar profileUserAvatar'+(b.stack?" is-hidden":"")+'" style="background-image:url('+t.avatar_url+')" data-id="'+b.sender_id+'"></div>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content'+(b.stack?" indent":"")+'">',r+='<h4 class="message-author'+(b.stack?" is-hidden":"")+'"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span></h4>",w&&w.indexOf("image")>-1?(r+='<div class="message-body">',r+='<div class="preview preview-photo" data-url="'+x+'" data-name="'+b.attachment.name+'">',r+='<img id="attach_'+b.id+'" src="'+x+'" alt="attach">',r+="</div></div>",r+='</div><div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'):w&&w.indexOf("audio")>-1?(r+='<div class="message-body">',r+=b.attachment.name+"<br><br>",r+='<a class="file-download" href="'+x+'" download="'+b.attachment.name+'">Download</a>',r+='<audio id="attach_'+b.id+'" src="'+x+'" controls class="attach-audio"></audio></div>',r+='</div><div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'):w&&w.indexOf("video")>-1?(r+='<div class="message-body">',r+=b.attachment.name+"<br><br>",r+='<a class="file-download" href="'+x+'" download="'+b.attachment.name+'">Download</a>',r+='<div id="attach_'+b.id+'" class="preview preview-video" data-url="'+x+'" data-name="'+b.attachment.name+'"></div></div>',r+='</div><div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'):w&&w.indexOf("location")>-1?(r+='<div class="message-body">',r+='<a class="open_googlemaps" href="'+D+'" target="_blank">',r+='<img id="attach_'+b.id+'" src="'+C+'" alt="attach" class="attach_map"></a></div></div>',r+='<div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'):w?(r+='<div class="message-body">',r+='<a id="attach_'+b.id+'" class="attach-file" href="'+x+'" download="'+b.attachment.name+'">'+b.attachment.name+"</a>",r+='<span class="attach-size">'+n(b.attachment.size)+"</span></div></div>",r+='<div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'):(r+='<div class="message-body">'+e(f.Messages.parser(b.body))+"</div>",r+='</div><div class="message-info"><time class="message-time" data-time="'+b.date_sent+'">'+f.getTime(b.date_sent)+"</time>",r+='<div class="message-status is-hidden">'+k+"</div>",r+='<div class="message-geo j-showlocation"></div></div>'),r+="</div></div></article>"}if(g?h?(m.find(".l-chat-content .mCSB_container").append(r),z(b.id),o(p)):(m.find(".l-chat-content .mCSB_container").prepend(r),z(b.id)):(m.find(".l-chat-content .mCSB_container")[0]?m.find(".l-chat-content .mCSB_container").prepend(r):m.find(".l-chat-content").prepend(r),z(b.id),o(!0)),y){var H=i.getMapUrl(y),I=i.getStaticMapUrl(y);j.Messages.setMap({id:b.id,mapLink:H,imgUrl:I})}b.sender_id==A.contact.id&&b.delivered_ids.length>0&&G.addStatusMessages(b.id,b.dialog_id,"delivered",!1),b.sender_id==A.contact.id&&b.read_ids.length>1&&G.addStatusMessages(b.id,b.dialog_id,"displayed",!1)}))},addStatusMessages:function(b,c,d,e){var f=(this.app.views.Dialog,this.app.models.ContactList,a('.l-chat[data-dialog="'+c+'"]')),g=f.find("article#"+b+" .message-container-wrap .message-container .message-time"),h=f.find("article#"+b+" .message-container-wrap .message-container .message-status");if("displayed"===d)h.hasClass("delivered")?h.removeClass("delivered").addClass("displayed").html("Seen"):h.addClass("displayed").html("Seen");else{if(h.hasClass("displayed")&&"delivered"===d)return!0;h.hasClass("delivered")?h.html("Delivered"):h.addClass("delivered").html("Delivered")}e&&(setTimeout(function(){g.removeClass("is-hidden"),h.addClass("is-hidden")},1e3),g.addClass("is-hidden"),h.removeClass("is-hidden"))},sendMessage:function(b){var d,e,g,h=b.parents(".l-chat").data("jid"),i=b.parents(".l-chat").data("id"),j=b.parents(".l-chat").data("dialog"),k=b.find(".textarea"),l=b.find(".textarea > img"),m=k.html().trim(),n=Math.floor(Date.now()/1e3),o=b.parents(".l-chat").is(".is-group")?"groupchat":"chat",p=a('.l-chat[data-dialog="'+j+'"]'),q=a('.j-newMessages[data-dialog="'+j+'"]'),r=(a("groupchat"===o?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+j+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+i+'"]'),a(".j-send_location").hasClass("btn_active")&&localStorage["QM.latitude"]&&localStorage["QM.longitude"]);l.length>0&&(l.each(function(){a(this).after(a(this).data("unicode")).remove()}),m=k.html()),b.find(".textarea > div").length>0&&(m=k.text()),m=m.replace(/<br>/gi,"\n").trim(),m.length>0&&(g={type:o,body:m,extension:{save_to_history:1,dialog_id:j,date_sent:n},markable:1},r&&(g.extension.latitude=localStorage["QM.latitude"],g.extension.longitude=localStorage["QM.longitude"]),g.id=c.chat.send(h,g),e=B.create({chat_dialog_id:j,body:m,date_sent:n,sender_id:A.contact.id,latitude:localStorage["QM.latitude"]||null,longitude:localStorage["QM.longitude"]||null,_id:g.id,type:o,online:!0}),"chat"===o&&(f.Dialogs.moveDialogToTop(j),d=p.find('article[data-type="message"]').last(),e.stack=B.isStack(!0,e,d),G.addItem(e,!0,!0),q.length&&q.remove()))},sendTypingStatus:function(a,b){var d=c.chat.helpers.getRoomJid(a),e=d.split("/")[0];b?c.chat.sendIsTypingStatus(e):c.chat.sendIsStopTypingStatus(e)},clearTheListTyping:function(){a(".j-typing").empty(),H=[]},onMessage:function(b,c){if("error"===c.type)return!0;var e,g,h,i,j=G.app.views.Dialog,l=G.app.views.ContactList,n=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},o=k.Collections.dialogs,p=C.contacts,q=c.extension&&c.extension.notification_type,r=c.extension&&c.extension.dialog_id,u=c.recipient_id||c.extension&&c.extension.recipient_id||null,w=u?y(u):null,x=(s(r),c.extension&&c.extension.room_name),z=c.extension&&c.extension.room_photo,D=c.extension&&c.extension.deleted_occupant_ids,F=c.extension&&c.extension.added_occupant_ids,H=c.extension&&c.extension.current_occupant_ids,I=a("groupchat"===c.type?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+r+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+b+'"]'),J=a('.j-incommingContactRequest[data-jid="'+y(b)+'"]'),K=(a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+r+'"]'),a("groupchat"===c.type?'.l-chat[data-dialog="'+r+'"]':'.l-chat[data-id="'+b+'"]')),L=K.is(":hidden")||!K.length,M=!!I.length||!!J.length,N=parseInt(I.length>0&&I.find(".unread").text().length>0?I.find(".unread").text():0),O=C.roster,P=a("#newMessageSignal")[0],Q=c.delay,R=a("[data-dialog = "+r+"]").is(".is-selected"),S=f.isBeginOfChat(),T=!R&&I.length>0&&"1"!==q&&(!Q||"groupchat"===c.type),U=b!==A.contact.id,V="QM."+A.contact.id+"_readBadge",W=a('<div class="new_messages j-newMessages" data-dialog="'+r+'"><span class="newMessages">New messages</span></div>'),X=K.find(".j-newMessages"),Y=X.length,Z=o.get(r);if("string"==typeof F?F=F.split(",").map(Number):null,"string"==typeof D?D=D.split(",").map(Number):null,"string"==typeof H?H=H.split(",").map(Number):null,c.sender_id=b,c.online=!0,i=B.create(c),K.length&&!L&&window.isQMAppActive&&Y?X.remove():!L&&window.isQMAppActive||!K.length||Y||!U||K.find(".l-chat-content .mCSB_container").append(W),(T||!T&&!S&&U&&M)&&(N++,I.find(".unread").text(N),j.getUnreadCounter(r)),R&&(localStorage.removeItem(V),localStorage.setItem(V,r)),"2"===q&&(H&&(g=Z.get("occupants_ids").concat(F),Z.set("occupants_ids",g)),Z&&D&&(g=d.without(d.compact(Z.get("occupants_ids")),D[0]),Z.set("occupants_ids",g)),x&&Z.set("room_name",x),z&&Z.set("room_photo",z),F&&C.add(Z.get("occupants_ids"),null,function(){for(var a=K.find(".addToGroupChat").data("ids"),b=(a?a.toString().split(",").map(Number):[],0),c=F.length;b<c;b++)new_id=F[b].toString(),new_id!==A.contact.id.toString()&&(h='<a class="occupant l-flexbox_inline presence-listener" data-id="'+new_id+'" href="#">',h=m(O[new_id],h),h+='<span class="name name_occupant">'+p[new_id].full_name+"</span></a>",K.find(".chat-occupants-wrap .mCSB_container").append(h));K.find(".addToGroupChat").data("ids",Z.get("occupants_ids"))}),D&&i.sender_id!==A.contact.id&&(K.find('.occupant[data-id="'+b+'"]').remove(),K.find(".addToGroupChat").data("ids",Z.get("occupants_ids"))),D&&D[0]===A.contact.id&&(j.leaveGroupChat(r,!0),j.decUnreadCounter(r),o.remove(Z)),x&&(K.find(".name_chat").text(x).attr("title",x),K.find(".j-scaleAvatar").data("name",x),I.find(".name").text(x)),z&&(K.find(".avatar_chat").css("background-image","url("+z+")"),I.find(".avatar").css("background-image","url("+z+")"))),"1"!==q&&f.Dialogs.moveDialogToTop(r),e=K.find('article[data-type="message"]').last(),i.stack=B.isStack(!0,i,e),"4"==q){var $=G.app.service,_=G.app.models.Contact;n[b]=r,C.saveHiddenDialogs(n),$.getUser(b,function(a){p[b]=_.create(a)})}else G.addItem(i,!0,!0);"5"===q&&U&&M&&l.onConfirm(b),"7"===q&&l.onReject(b);var aa=!(!L&&window.isQMAppActive),ba="groupchat"!==c.type||i.sender_id!==A.contact.id,ca=E.get("sounds_notify"),da=SyncTabs.get();t(i,aa),aa&&ba&&ca&&da&&M&&P.play(),Z&&Z.set({last_message:i.body,last_message_date_sent:i.date_sent,room_updated_date:i.date_sent}),i.sender_id===A.contact.id&&w&&v({notification_type:q,recipient_jid:w,dialog_id:r})},onSystemMessage:function(b){var d,e,g=G.app.views.Dialog,h=b.extension&&b.extension.notification_type,i=b.extension&&b.extension.dialog_id,j=s(i),l=b.extension&&b.extension.room_name,m=b.extension&&b.extension.room_photo,n=b.extension&&b.extension.room_updated_date,o=b.extension&&b.extension.current_occupant_ids?b.extension.current_occupant_ids.split(",").map(Number):null,p=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]'),q=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]'),r=parseInt(p.length>0&&p.find(".unread").text().length>0?p.find(".unread").text():0),u=(a("#newMessageSignal")[0],k.Collections.dialogs);"1"===h&&0===q.length&&(D.create({_id:i,type:2,occupants_ids:o,name:l,photo:m,room_updated_date:n,xmpp_room_jid:j,unread_count:1,opened:!0}),d=u.get(i),f.log("Dialog",d.toJSON()),C.add(o,null,function(){return!!(p=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]')[0])||(c.chat.muc.join(j),g.addDialogItem(d),r++,q=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]'),b.online=!0,e=B.create(b),e.sender_id!==A.contact.id&&(q.find(".unread").text(r),g.getUnreadCounter(i)),G.addItem(e,!0,!0),void t(e,!0))}))},onMessageTyping:function(b,c,d){var e=G.app.models.ContactList,f=e.contacts,g=f[c],h=a(null===d?'.l-chat[data-id="'+c+'"]':'.l-chat[data-dialog="'+d+'"]'),i=c!==A.contact.id,j=!!h.is(":visible");i&&j&&(void 0===F?F=setTimeout(function(){
H=[],p(g.full_name)},6e3):(clearTimeout(F),F=setTimeout(function(){H=[],p(g.full_name)},6e3)),b?q(g.full_name):p(g.full_name))},onDeliveredStatus:function(a,b,c){G.addStatusMessages(a,b,"delivered",!0),x(a,b,"delivered")},onReadStatus:function(a,b,c){G.addStatusMessages(a,b,"displayed",!0),x(a,b,"displayed")}},l}),ProgressBar.OPTION_NAME={},ProgressBar.OPTION_NAME.ITEM_ID="itemID",ProgressBar.OPTION_NAME.TYPE="type",ProgressBar.OPTION_NAME.PERCENT="percent",ProgressBar.OPTION_NAME.COLOR_ID="colorID",ProgressBar.OPTION_NAME.OPACITY="opacity",ProgressBar.OPTION_NAME.ALIGN="align",ProgressBar.OPTION_NAME.SPACE="space",ProgressBar.OPTION_NAME.POSITION="position",ProgressBar.OPTION_VALUE={},ProgressBar.OPTION_VALUE.COLOR_ID={},ProgressBar.OPTION_VALUE.COLOR_ID.BLUE="blue",ProgressBar.OPTION_VALUE.COLOR_ID.GREEN="green",ProgressBar.OPTION_VALUE.COLOR_ID.YELLOW="yellow",ProgressBar.OPTION_VALUE.COLOR_ID.ORANGE="orange",ProgressBar.OPTION_VALUE.COLOR_ID.RED="red",ProgressBar.OPTION_VALUE.COLOR_ID.WHITE="white",ProgressBar.OPTION_VALUE.COLOR_ID.BLACK="black",ProgressBar.OPTION_VALUE.TYPE={},ProgressBar.OPTION_VALUE.TYPE.BAR="bar",ProgressBar.OPTION_VALUE.TYPE.LINE="line",ProgressBar.OPTION_VALUE.TYPE.TEXT="text",ProgressBar.OPTION_VALUE.ALIGN={},ProgressBar.OPTION_VALUE.ALIGN.LEFT="left",ProgressBar.OPTION_VALUE.ALIGN.RIGHT="right",ProgressBar.OPTION_VALUE.POSITION={},ProgressBar.OPTION_VALUE.POSITION.ABSOLUTE="absolute",ProgressBar.OPTION_VALUE.POSITION.RELATIVE="relative",ProgressBar.DEFAULT_VALUE={},ProgressBar.DEFAULT_VALUE.WIDTH="100px",ProgressBar.DEFAULT_VALUE.HEIGHT="6px",ProgressBar.DEFAULT_VALUE.TYPE=ProgressBar.OPTION_VALUE.TYPE.BAR,ProgressBar.DEFAULT_VALUE.PERCENT=0,ProgressBar.DEFAULT_VALUE.COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.BLUE,ProgressBar.DEFAULT_VALUE.OPACITY=1,ProgressBar.DEFAULT_VALUE.ALIGN="left",ProgressBar.DEFAULT_VALUE.SPACE=0,ProgressBar.DEFAULT_VALUE.POSITION="relative",ProgressBar.DEFAULT_VALUE.LINE_COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.RED,ProgressBar.DEFAULT_VALUE.LINE_OPACITY=.5,ProgressBar.EVENT={},ProgressBar.EVENT.STARTING="starting",ProgressBar.EVENT.CHANGED="changed",ProgressBar.EVENT.COMPLETED="completed",ProgressBar.getVersion=function(){return"1.2"},define("progressbar",function(a){return function(){var b;return b||a.ProgressBar}}(this)),define("AttachView",["jquery","config","quickblox","Helpers","QMHtml","LocationView","underscore","progressbar"],function(a,b,c,d,e,f,g,h){function i(a){this.app=a,l=this.app.models.User,m=this.app.models.Message,n=this.app.models.Attach,k=this}function j(){a(".l-chat:visible .j-scrollbar_message").mCustomScrollbar("scrollTo","bottom")}var k,l,m,n;return i.prototype={changeInput:function(c){var d,f,h=c[0].files[0]||null,i=a(".l-chat:visible .l-chat-content .mCSB_container"),l=g.uniqueId(),m=h.size,o=m>1048576?(m/1048576).toFixed(1):(m/1024).toFixed(1),p=m>1048576?"MB":"KB",q=0===h.type.indexOf("image/")?"image":0===h.type.indexOf("audio/")?"audio":0===h.type.indexOf("video/")?"video":"photo",r=1024*("video"===q?b.maxVideoSize:b.maxLimitFile)*1024;h&&(h.name.length>100?d=b.errors.fileName:h.size>r&&(d="video"===q?b.errors.videoSize:b.errors.fileSize),d?k.pastErrorMessage(d,c,i):f=e.Attach.attach({fileName:h.name,fileSizeCrop:o,fileSizeUnit:p,id:l}),i.append(f),c.val(""),j(),h.type.indexOf("image")>-1?n.crop(h,{w:1e3,h:1e3},function(a){k.createProgressBar(l,o,m,a)}):k.createProgressBar(l,o,m,h))},pastErrorMessage:function(a,b,c){var d=e.Attach.error({errMsg:a});return c.append(d),b.val(""),j(),!1},createProgressBar:function(b,c,e,f){function g(){if(p)l.setPercent(100),i=c,a(".attach-part_"+b).text(i),setTimeout(function(){a(".attach-part_"+b).parents("article").remove()},50);else{if(l.setPercent(o),i=(c*o/100).toFixed(1),a(".attach-part_"+b).text(i),o+=5,o>95)return!1;setTimeout(g,j)}}var i,j,l=new h("progress_"+b),m=a(".j-chatItem"),o=5,p=!1;e<=5242880?j=50:e>5242880?j=60:e>6291456?j=70:e>7340032?j=80:e>8388608?j=90:e>9437184&&(j=100),g(),d.log("File:",f),n.upload(f,function(c){d.log("Blob:",c),k.sendMessage(m,c,e),p=!0,a("#progress_"+b).length>0&&g()})},cancel:function(a){a.parents("article").remove()},sendMessage:function(b,e,f,g){var h,i,j,k,o,p=this.app.views.Message,q=b.data("jid"),r=b.data("id"),s=b.data("dialog"),t=b.is(".is-group")?"groupchat":"chat",u=Math.floor(Date.now()/1e3),v=a("groupchat"===t?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+s+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+r+'"]'),w=a(".j-send_location").hasClass("btn_active");k=g?{type:"location",data:g}:n.create(e,f),o={type:t,body:"location"===k.type?"Location":"Attachment",extension:{save_to_history:1,dialog_id:s,date_sent:u,attachments:[k]},markable:1},w&&(o.extension.latitude=localStorage["QM.latitude"],o.extension.longitude=localStorage["QM.longitude"]),o.id=c.chat.send(q,o),j=m.create({body:o.body,chat_dialog_id:s,date_sent:u,attachment:k,sender_id:l.contact.id,latitude:localStorage["QM.latitude"]||null,longitude:localStorage["QM.longitude"]||null,_id:o.id,online:!0}),d.log(j),"chat"===t&&(i=b.find('article[data-type="message"]').last(),j.stack=m.isStack(!0,j,i),p.addItem(j,!0,!0)),v.length>0&&(h=v.clone(),v.remove(),a("#recentList ul").prepend(h),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),d.Dialogs.isSectionEmpty(a("#recentList ul"))))}},i}),define("ContactListView",["jquery","config","quickblox","Entities","Helpers","QMHtml","underscore","mCustomScrollbar","mousewheel"],function(a,b,c,d,e,f,g){function h(a){this.app=a,o=this.app.models.Dialog,p=this.app.models.Message,q=this.app.models.ContactList,r=this.app.models.User,that=this,k()}function i(a){c.chat.send(a.jid,{type:"chat",body:"Contact request",extension:{date_sent:a.date_sent,dialog_id:a.dialog_id,save_to_history:a.save_to_history,notification_type:a.notification_type}})}function j(a,b,c){a.add(".popups").addClass("is-overlay"),b?a.addClass(b).data("dialog",c):a.removeClass("add").data("dialog","")}function k(){a(".scrollbarContacts").mCustomScrollbar({theme:"minimal-dark",scrollInertia:150,mouseWheel:{scrollAmount:60,deltaFactor:"auto"},live:!0})}function l(a,b){a.mCustomScrollbar({theme:"minimal-dark",scrollInertia:150,mouseWheel:{scrollAmount:60,deltaFactor:"auto"},callbacks:{onTotalScroll:function(){m(a,b)}},live:!0})}function m(a,b){var c=parseInt(sessionStorage["QM.search.page"]),d=parseInt(sessionStorage["QM.search.allPages"]);c<=d&&(b.createDataSpinner(a),q.globalSearch(function(c){n(a,c,b)}))}function n(a,b,c){var d,e=q.roster,f=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};b.length>0?b.forEach(function(b){var c=e[b.id];d='<li class="list-item j-listItem" data-jid="'+b.user_jid+'">',d+='<a class="contact l-flexbox" href="#">',d+='<div class="l-flexbox_inline">',d+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+b.avatar_url+')" data-id="'+b.id+'"></div>',d+='<span class="name profileUserName" data-id="'+b.id+'">'+b.full_name+"</span>",d+="</div>",c&&(!c||"none"!==c.subscription||c.ask||f[b.id])||(d+='<button class="send-request j-sendRequest"><img class="icon-normal" src="images/icon-request.svg" alt="request">',d+='<img class="icon-active" src="images/icon-request_active.svg" alt="request"></button>'),c&&"none"===c.subscription&&c.ask&&(d+='<span class="send-request l-flexbox">Request Sent</span>'),d+="</a></li>",a.find(".mCSB_container").append(d),a.removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden")}):a.parents(".popup_search").find(".note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),c.removeDataSpinner()}var o,p,q,r;return h.prototype={createDataSpinner:function(a){this.removeDataSpinner();var b='<div class="popup-elem spinner_bounce">';b+='<div class="spinner_bounce-bounce1"></div>',b+='<div class="spinner_bounce-bounce2"></div>',b+='<div class="spinner_bounce-bounce3"></div>',b+="</div>",a.after(b)},removeDataSpinner:function(){a(".popup:visible .spinner_bounce").remove(),a(".popup:visible input").prop("disabled",!1)},globalPopup:function(){var b=a("#popupSearch");j(b),b.find(".popup-elem").addClass("is-hidden").siblings("form").find("input").val(""),b.find(".mCSB_container").empty()},globalSearch:function(b){var c=this,d=b.parent(),e=d.find("ul:first.list_contacts"),f=b.find('input[type="search"]').val().trim(),g=f.length;g>0&&(g<3?(d.find(".popup-elem .not_found").addClass("is-hidden"),d.find(".popup-elem .short_length").removeClass("is-hidden")):(d.find(".popup-elem .not_found").removeClass("is-hidden"),d.find(".popup-elem .short_length").addClass("is-hidden")),l(e,c),c.createDataSpinner(e),sessionStorage.setItem("QM.search.value",f),sessionStorage.setItem("QM.search.page",1),q.globalSearch(function(a){n(e,a,c)})),b.find("input").prop("disabled",!1).val(f),d.find(".popup-elem").addClass("is-hidden"),d.find(".mCSB_container").empty(),a(".popup:visible .spinner_bounce").removeClass("is-hidden").addClass("is-empty")},addContactsToChat:function(b,c,d,f){var h,i,k,l,m,n=b.data("ids")?b.data("ids").toString().split(","):[],o=a("#popupContacts"),p=q.contacts,r=q.roster;if(j(o,c,d),o.addClass("not-selected").removeClass("is-addition"),o.find(".note").addClass("is-hidden").siblings("ul").removeClass("is-hidden"),o.find(".popup-nofriends").addClass("is-hidden").siblings().removeClass("is-hidden"),o.find("form")[0].reset(),o.find(".list_contacts").mCustomScrollbar("scrollTo","top"),o.find(".mCSB_container").empty(),o.find(".btn").removeClass("is-hidden"),h=g.pluck(g.sortBy(p,function(a){return a.full_name?a.full_name.toLowerCase():a.full_name}),"id").map(String),l=g.filter(h,function(a){return r[a]&&"none"!==r[a].subscription}),e.log("Friends",l),0===l.length)return o.children(":not(.popup-header)").addClass("is-hidden"),o.find(".popup-nofriends").removeClass("is-hidden"),!0;l=g.difference(l,n);for(var s=0,t=l.length;s<t;s++)k=l[s],m="",m+='<li class="list-item" data-id="'+k+'">',m+='<a class="contact l-flexbox" href="#">',m+='<div class="l-flexbox_inline">',m+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+p[k].avatar_url+')" data-id="'+k+'"></div>',m+='<span class="name profileUserName" data-id="'+k+'">'+p[k].full_name+"</span>",m+='</div><input class="form-checkbox" type="checkbox">',m+="</a></li>",o.find(".mCSB_container").append(m);c||f?(i=n.length>0?n:null,o.addClass("is-addition").data("existing_ids",i)):o.data("existing_ids",null)},importFBFriend:function(a){var d=c.chat.helpers.getUserJid(a,b.qbAccount.appId),e=q.roster;c.chat.roster.add(d,function(){e[a]={subscription:"none",ask:"subscribe"},q.saveRoster(e),o.createPrivate(d)})},sendSubscribe:function(b,d,f){function g(a){var b=l.find(".j-sendRequest");b.after('<span class="send-request l-flexbox">'+a+"</span>"),b.remove()}var h,j,k=this.app.views.Message,l=a('.list-item[data-jid="'+b+'"]'),m=q.roster,n=c.chat.helpers.getIdFromNode(b),s=a('.dialog-item[data-id="'+n+'"]'),t=s[0],u=a('#requestsList .list-item[data-jid="'+b+'"]'),v=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},w=Math.floor(Date.now()/1e3),x=this;v[n]&&u.length?(g("Request accepted"),x.sendConfirm(b,"new_dialog")):(d||g("Request Sent"),f?s.length||o.createPrivate(b,"new_dialog",f):c.chat.roster.add(b,function(){s.length?(i({jid:b,date_sent:w,dialog_id:t.getAttribute("data-dialog"),save_to_history:1,notification_type:"4"}),j=p.create({date_sent:w,chat_dialog_id:t.getAttribute("data-dialog"),sender_id:r.contact.id,notification_type:"4",online:!0}),k.addItem(j,!0,!0)):o.createPrivate(b,!0)})),m[n]={subscription:"none",ask:"subscribe"},q.saveRoster(m),t=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+n+'"]'),h=t.clone(),t.remove(),a("#recentList ul").prepend(h),a("#searchList").is(":hidden")&&(a("#recentList").removeClass("is-hidden"),e.Dialogs.isSectionEmpty(a(".j-recentList")))},sendConfirm:function(b,f){var g,h,j,k,l,m,n=this.app.views.Dialog,s=(this.app.views.Message,a('.j-incommingContactRequest[data-jid="'+b+'"]')),t=c.chat.helpers.getIdFromNode(b),u=a('.l-chat[data-id="'+t+'"]'),v=s.parents("ul.j-requestsList"),w=q.roster,x=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},y=JSON.parse(sessionStorage["QM.hiddenDialogs"]),z=Math.floor(Date.now()/1e3),A=d.Collections.dialogs;s.remove(),e.Dialogs.isSectionEmpty(v),u.length&&u.removeClass("is-request"),w[t]={subscription:"from",ask:"subscribe"},q.saveRoster(w),delete x[t],q.saveNotConfirmed(x),k=o.create({_id:y[t],type:3,occupants_ids:[t],unread_count:""}),l=A.get(k),e.log("Dialog",l.toJSON()),f&&c.chat.roster.confirm(b,function(){i({jid:b,date_sent:z,dialog_id:y[t],save_to_history:1,notification_type:"5"}),j=p.create({chat_dialog_id:y[t],notification_type:"5",date_sent:z,sender_id:r.contact.id,online:!0})}),m=a('.dialog-item[data-id="'+t+'"]'),v=m.parents("ul"),m.remove(),e.Dialogs.isSectionEmpty(v),n.addDialogItem(l),h=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+t+'"]'),g=h.clone(),h.remove(),a("#recentList ul").prepend(g),a("#searchList").is(":hidden")&&(a("#recentList").removeClass("is-hidden"),e.Dialogs.isSectionEmpty(a(".j-recentList"))),h=a('.presence-listener[data-id="'+t+'"]'),h.find(".status").removeClass("status_request")},sendReject:function(b,d){var f=c.chat.helpers.getIdFromNode(b),g=a('.j-incommingContactRequest[data-jid="'+b+'"]'),h=g.parents("ul.j-requestsList"),j=q.roster,k=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},l=JSON.parse(sessionStorage["QM.hiddenDialogs"]),m=Math.floor(Date.now()/1e3);g.remove(),e.Dialogs.isSectionEmpty(h),j[f]={subscription:"none",ask:null},q.saveRoster(j),delete k[f],q.saveNotConfirmed(k),d&&c.chat.roster.reject(b,function(){i({jid:b,date_sent:m,dialog_id:l[f],save_to_history:1,notification_type:"6"})})},sendDelete:function(f,g){var h=(q.contacts,d.Collections.dialogs),j=c.chat.helpers.getUserJid(f,b.qbAccount.appId),k=a('.dialog-item[data-id="'+f+'"]'),l=a('.l-chat[data-id="'+f+'"]'),m=k.parents("ul.j-list"),n=k.data("dialog"),o=q.roster,p=Math.floor(Date.now()/1e3);delete o[f],q.saveRoster(o),g&&c.chat.roster.remove(j,function(){i({jid:j,date_sent:p,dialog_id:n,save_to_history:1,notification_type:"7"})}),k.remove(),e.Dialogs.isSectionEmpty(m),l.is(":visible")&&(a(".j-capBox").removeClass("is-hidden").siblings().removeClass("is-active"),a(".j-chatWrap").addClass("is-hidden").children().remove()),l.length>0&&l.remove(),d.active===n&&(d.active=""),h.remove(n),that.app.views.Dialog.decUnreadCounter(n)},onSubscribe:function(d){var f,g=q.contacts,h=c.chat.helpers.getUserJid(d,b.qbAccount.appId),i=(q.roster,a('#requestsList .list-item[data-jid="'+h+'"]')),j=a('#recentList .list-item[data-id="'+d+'"]'),k=j.parents("ul.j-recentList"),l=(j.data("dialog"),localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{});return!!i.length||(l[d]=!0,q.saveNotConfirmed(l),q.add([d],null,function(){f='<li class="list-item j-incommingContactRequest" data-jid="'+h+'">',f+='<a class="contact l-flexbox" href="#">',f+='<div class="l-flexbox_inline">',f+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+("undefined"!=typeof g[d]?g[d].avatar_url:"")+')" data-id="'+d+'"></div>',f+='<span class="name profileUserName" data-id="'+d+'">'+("undefined"!=typeof g[d]?g[d].full_name:"")+"</span>",f+='</div><div class="request-controls l-flexbox">',f+='<button class="request-button request-button_cancel j-requestCancel">&#10005;</button>',f+='<button class="request-button request-button_ok j-requestConfirm">&#10003;</button>',f+="</div></a></li>",a("#requestsList").removeClass("is-hidden").find("ul").prepend(f),a("#emptyList").addClass("is-hidden")},"subscribe"),void(j.length&&(j.remove(),e.Dialogs.isSectionEmpty(k))))},onConfirm:function(b){var c=q.roster,d=a('.presence-listener[data-id="'+b+'"]'),e=a('.l-chat[data-id="'+b+'"]');c[b]={subscription:"to",ask:null},q.saveRoster(c),d.find(".status").removeClass("status_request"),d.removeClass("is-request"),e.removeClass("is-request")},onReject:function(d){var f=a('.presence-listener[data-id="'+d+'"]'),g=c.chat.helpers.getUserJid(d,b.qbAccount.appId),h=a('#requestsList .list-item[data-jid="'+g+'"]'),i=h&&h.parents("ul"),j=q.roster,k=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};j[d]={subscription:"none",ask:null},q.saveRoster(j),delete k[d],q.saveNotConfirmed(k),f.find(".status").removeClass("status_online").addClass("status_request"),f.is(".l-chat")&&f.addClass("is-request"),h.length>0&&c.chat.roster.remove(g,function(){h.remove(),e.Dialogs.isSectionEmpty(i)}),f.addClass("is-request")},onPresence:function(b,c){var d=a('.presence-listener[data-id="'+b+'"]'),e=q.roster;return"undefined"==typeof e[b]||(e[b].status=!c,q.saveRoster(e),void(c?(d.find(".status").removeClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Offline")):(d.find(".status").addClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Online"))))}},h}),define("VideoChatView",["jquery","quickblox","Entities","config","Helpers","QBNotification","QMHtml"],function(a,b,c,d,e,f,g){function h(a){this.app=a,v=this,x=this.app.models.Settings,SyncTabs=this.app.models.SyncTabs,w=this.app.models.User,z=this.app.models.ContactList,y=this.app.models.VideoChat}function i(b){var c,d=a('li.list-item.dialog-item[data-id="'+b+'"]').data("dialog"),e=a('.l-chat[data-dialog="'+d+'"]'),f=a('.btn_decline[data-dialog="'+d+'"]'),g=document.getElementById("callingSignal"),h=document.getElementById("endCallSignal"),i=document.getElementById("ringtoneSignal");e[0]&&e.find(".mediacall")[0]?(x.get("sounds_notify")&&SyncTabs.get()&&(g.pause(),h.play()),clearTimeout(A),F={},y.session=null,y.caller=null,y.callee=null,v.type=null,D=null,e.parent(".chatView").removeClass("j-mediacall"),e.find(".mediacall").remove(),e.find(".l-chat-header").show(),e.find(".l-chat-content").css({height:"calc(100% - 165px)"})):f[0]&&(c=f.parents(".incoming-call"),c.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(p(),x.get("sounds_notify")&&i.pause())),l(b,null)}function j(b){var c=a(b.target).data("id")?a(b.target):a(b.target).parent(),d=(c.data("id"),c.data("dialog")),e=c.attr("class").match(/btn_camera_off/)?"video":"audio",f="video"===e?"Camera":"Mic";return v.type!==e&&"audio"===v.type?(c.addClass("off"),c.attr("title",f+" is off"),!0):(c.is(".off")?(v.unmute(e),"video"===e&&F.update({dialog_id:d,unmute:e}),c.removeClass("off"),c.removeAttr("title")):(v.mute(e),"video"===e&&F.update({dialog_id:d,mute:e}),c.addClass("off"),c.attr("title",f+" is off")),!1)}function k(a){var b=!x.get("calls_notify"),g=!SyncTabs.get();if(b||g)return!1;var h={callState:a.callState,dialog_id:a.dialogId,sender_id:a.id,caller:a.id,type:"chat",callType:t(a.callType)},i={user:w,dialogs:c.Collections.dialogs,contacts:z.contacts},j=e.Notifications.getTitle(h,i),k=e.Notifications.getOptions(h,i);d.notification&&f.isSupported()&&!window.isQMAppActive&&(f.needsPermission()?f.requestPermission(function(a){"granted"===a&&e.Notifications.show(j,k)}):e.Notifications.show(j,k))}function l(b,c){var d=a('li.dialog-item[data-id="'+b+'"]').find("span.status");"video"===c?d.addClass("icon_videocall"):"audio"===c?d.addClass("icon_audiocall"):d.hasClass("icon_videocall")?d.removeClass("icon_videocall"):d.removeClass("icon_audiocall")}function m(a,b){var c=!0,d=b.bytesReceived;return void 0===E[a]?E[a]={bytesReceived:d}:E[a].bytesReceived===d?c=!1:E[a]={bytesReceived:d},c}function n(b){var c=a('li.list-item.dialog-item[data-id="'+b+'"]').data("dialog"),d=a('.btn_decline[data-dialog="'+c+'"]');return clearTimeout(C),C=void 0,d.parents(".incoming-call").remove(),0===a("#popupIncoming .mCSB_container").children().length&&(p(),x.get("sounds_notify")&&document.getElementById("ringtoneSignal").pause()),F={},y.session=null,y.caller=null,y.callee=null,v.type=null,!1}function o(a){a.add(".popups").addClass("is-overlay")}function p(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a(".temp-box").remove(),a(".attach-video video")[0]&&a(".attach-video video")[0].pause()}function q(b){var c=b||0;a(".mediacall-info-duration").text(r(c)),A=setTimeout(function(){c++,q(c)},1e3)}function r(a){var b,c,d;return b=Math.floor(a/3600),b=b>=10?b:"0"+b,c=Math.floor(a/60),c=c>=10?c:"0"+c,d=Math.floor(a%60),d=d>=10?d:"0"+d,b+":"+c+":"+d}function s(){var b=a(".l-chat:visible"),c=b.find(".l-chat-content .mCSB_container").height(),d=b.find(".l-chat-content").height(),e=b.find(".l-chat-content .mCSB_draggerContainer").height(),f=b.find(".l-chat-content .mCSB_dragger").height();b.find(".l-chat-content .mCSB_container").css({top:d-c+"px"}),b.find(".l-chat-content .mCSB_dragger").css({top:e-f+"px"})}function t(a){return a.charAt(0).toUpperCase()+a.slice(1)}function u(){a(".mediacall").outerHeight()<=260?a(".mediacall").addClass("small_screen"):a(".mediacall").removeClass("small_screen")}var v,w,x,y,z,A,B,C,D,E={},F={},G=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;return h.prototype.cancelCurrentCalls=function(){var b=a(".mediacall");b.length>0&&b.find(".btn_hangup").click()},h.prototype.clearChat=function(){var b=a(".chatView");b.length>1&&b.first().remove()},h.prototype.init=function(){var c=this.app.views.Dialog;a("body").on("click",".videoCall, .audioCall",function(){if(b.webrtc){var c=a(this).attr("class");v.cancelCurrentCalls(),v.startCall(c),F=v.app.models.VideoChat.session}else g.VideoChat.noWebRTC();return!1}),a("#popupIncoming").on("click",".btn_decline",function(){var b=a(this),c=b.parents(".incoming-call"),d=b.data("id"),e=b.data("dialog"),f=b.data("calltype"),g=document.getElementById("ringtoneSignal");return F.reject({}),y.sendMessage(d,"2",null,e,f),c.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(p(),x.get("sounds_notify")&&g.pause()),!1}),a("#popupIncoming").on("click",".btn_accept",function(){v.cancelCurrentCalls(),clearTimeout(C),C=void 0;var b=a(this),d=b.data("id"),e=a('.dialog-item[data-id="'+d+'"]').find(".contact");c.htmlBuild(e);var f=(b.data("id"),b.data("dialog")),g=b.data("session"),h=b.data("calltype"),i=a("#ringtoneSignal")[0],j=v.build(f),k=a('.l-chat[data-dialog="'+f+'"]');return b.parents(".incoming-call").remove(),a("#popupIncoming .mCSB_container").children().each(function(){b.find(".btn_decline").click()}),p(),x.get("sounds_notify")&&i.pause(),j.isCallee=!0,y.getUserMedia(j,h,function(b,c){return b?(k.find(".mediacall .btn_hangup").data("errorMessage",1),k.find(".mediacall .btn_hangup").click(),s(),!0):("audio"===h?(v.type="audio",a(".btn_camera_off").click()):(v.type="video",v.unmute("video")),v.sessionID=g,void l(d,h))}),!1}),a("body").on("click",".btn_hangup",function(){v.clearChat();var b=a(this),c=b.parents(".l-chat"),d=b.data("id"),e=b.data("dialog"),f=1===F.callType?"video":"audio",g=b.parents(".mediacall").find(".mediacall-info-duration").text(),h=a("#callingSignal")[0],i=a("#endCallSignal")[0],j=b.data("errorMessage");return y.caller&&(j||"connect..."===g?(y.sendMessage(d,"1",null,e,f),b.removeAttr("data-errorMessage")):y.sendMessage(d,"1",g,e,null,null,v.sessionID)),x.get("sounds_notify")&&SyncTabs.get()&&(h.pause(),i.play()),clearTimeout(A),F.stop({}),v.type=null,c.find(".mediacall").remove(),c.find(".l-chat-header").show(),c.find(".l-chat-content").css({height:"calc(100% - 165px)"}),l(d,null),!1}),a("body").on("click",".btn_camera_off, .btn_mic_off",j),a("body").on("click",".btn_full-mode",function(){var b=document.getElementsByClassName("mediacall")[0],c=!1;return b.requestFullscreen?document.fullScreenElement?(document.cancelFullScreen(),c=!1):(b.requestFullscreen(),c=!0):b.mozRequestFullScreen?document.mozFullScreenElement?(document.mozCancelFullScreen(),c=!1):(b.mozRequestFullScreen(),c=!0):b.webkitRequestFullscreen&&(document.webkitFullscreenElement?(document.webkitCancelFullScreen(),c=!1):(b.webkitRequestFullscreen(),c=!0)),c?(a("#fullModeOn").hide(),a("#fullModeOff").show()):(a("#fullModeOn").show(),a("#fullModeOff").hide()),!1}),a(window).on("resize",function(){u()})},h.prototype.onCall=function(b,c){if(w.contact.id===b.initiatorID)return!1;a("div.popups.is-overlay").length&&a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay");var e,f,h=document.getElementById("ringtoneSignal"),i=a("#popupIncoming"),j=b.initiatorID,l=z.contacts[j],m=(1===b.callType?"video":"audio")||c.call_type,n=l.full_name||c.full_name,p=l.avatar_url||c.avatar,q=a('li.list-item.dialog-item[data-id="'+j+'"]').data("dialog"),r=1e3*d.QBconf.webrtc.answerTimeInterval;f={userAvatar:p,"callTypeUС":t(m),callType:m,userName:n,dialogId:q,sessionId:b.ID,userId:j},e=g.VideoChat.onCallTpl(f),i.find(".mCSB_container").prepend(e),o(i),x.get("sounds_notify")&&SyncTabs.get()&&h.play(),y.session=b,F=y.session,k({id:j,dialogId:q,callState:"4",callType:m}),C=setTimeout(function(){a(".btn_decline").click()},r)},h.prototype.onIgnored=function(b,c,d,e){if("onAccept"===b&&w.contact.id===d&&n(c.initiatorID),"onStop"===b&&w.contact.id===d&&i(d),"onCall"===b&&w.contact.id!==d){var f=a('li.list-item.dialog-item[data-id="'+d+'"]').data("dialog");callType=("1"===e.callType?"video":"audio")||e.call_type,y.sendMessage(d,"2",null,f,callType)}},h.prototype.onAccept=function(b,c,d){var e=document.getElementById("callingSignal"),f=a('li.list-item.dialog-item[data-id="'+c+'"]').data("dialog"),g=v.type;w.contact.id===c;x.get("sounds_notify")&&e.pause(),v.sessionID=b.ID,l(c,g),k({id:c,dialogId:f,callState:"5",callType:g})},h.prototype.onRemoteStream=function(b,c,d){var e=document.getElementById("remoteStream");F.attachMediaStream("remoteStream",d),a(".mediacall .btn_full-mode").prop("disabled",!1),"video"===v.type?(e.addEventListener("timeupdate",function(){D=e.currentTime;var b=r(Math.floor(e.currentTime));a(".mediacall-info-duration").text(b)}),a("#remoteUser").addClass("is-hidden"),a("#remoteStream").removeClass("is-hidden")):setTimeout(function(){q(),a("#remoteStream").addClass("is-hidden"),a("#remoteUser").removeClass("is-hidden")},2700)},h.prototype.onReject=function(b,c,d){var e=(document.getElementById("callingSignal"),a('li.list-item.dialog-item[data-id="'+c+'"]').data("dialog")),f=a('.l-chat[data-dialog="'+e+'"]'),g=w.contact.id===c;x.get("sounds_notify")&&document.getElementById("callingSignal").pause(),g&&n(b.initiatorID),F={},y.session=null,y.caller=null,y.callee=null,v.type=null,f.parent(".chatView").removeClass("j-mediacall"),f.find(".mediacall-info-duration").text(""),f.find(".mediacall").remove(),f.find(".l-chat-header").show(),f.find(".l-chat-content").css({height:"calc(100% - 165px)"}),l(c,null)},h.prototype.onStop=function(a,b,c){i(b)},h.prototype.onUpdateCall=function(b,c,d){var e=a('li.list-item.dialog-item[data-id="'+c+'"]').data("dialog"),f=a('.l-chat[data-dialog="'+e+'"]'),g=a(window.document.body);f[0]&&f.find(".mediacall")[0]&&("video"===d.mute&&(g.find("#remoteStream").addClass("is-hidden"),g.find("#remoteUser").removeClass("is-hidden")),"video"===d.unmute&&(g.find("#remoteStream").removeClass("is-hidden"),g.find("#remoteUser").addClass("is-hidden")))},h.prototype.onCallStatsReport=function(b,c,d){if(G){var e=_.findWhere(d,{type:"inboundrtp"});e&&m(c,e)?(clearTimeout(B),B=void 0):B||(B=setTimeout(function(){console.warn("This is Firefox and user "+c+" has lost his connection."),_.isEmpty(F)||(F.closeConnection(c),a(".btn_hangup").click())},3e4))}},h.prototype.onSessionCloseListener=function(a){var b=w.contact.id===y.callee?y.caller:y.callee;i(b)},h.prototype.onUserNotAnswerListener=function(b,c){a(".btn_hangup").click()},h.prototype.startCall=function(b){var c=document.getElementById("callingSignal"),d=v.build(),e=a(".l-chat:visible"),f=b.match(/audioCall/)?"audio":"video",h=this.app.service,i=d.opponentId,j=w.contact.full_name,k=e.data("id");y.getUserMedia(d,f,function(b,d){return s(),b?(e.find(".mediacall .btn_hangup").click(),g.VideoChat.showError(),!0):(h.sendPushNotification(i,j),x.get("sounds_notify")&&c.play(),"audio"===f?(v.type="audio",a(".btn_camera_off").click()):(v.type="video",v.unmute("video")),l(k,f),void a(".chatView").addClass("j-mediacall"))})},h.prototype.build=function(b){var c,d,e=a(b?'.l-chat[data-dialog="'+b+'"]':".l-chat:visible"),f=e.data("id"),h=e.data("dialog"),i=z.contacts[f];return d={userAvatar:w.contact.avatar_url,contactAvatar:i.avatar_url,contactName:i.full_name,dialogId:h,userId:f},c=g.VideoChat.buildTpl(d),e.parent(".chatView").addClass("j-mediacall"),e.prepend(c),e.find(".l-chat-header").hide(),e.find(".l-chat-content").css({height:"calc(50% - 90px)"}),u(),{opponentId:f,dialogId:h}},h.prototype.mute=function(b){F.mute(b),"video"===b&&(a("#localStream").addClass("is-hidden"),a("#localUser").removeClass("is-hidden"))},h.prototype.unmute=function(b){F.unmute(b),"video"===b&&(a("#localStream").removeClass("is-hidden"),a("#localUser").addClass("is-hidden"))},h}),define("Events",["jquery","config","Helpers","QMHtml","LocationView","minEmoji","perfectscrollbar","mCustomScrollbar","mousewheel"],function(a,b,c,d,e,f,g){function h(a){F=a,this.app=a,r=this.app.models.Dialog,s=this.app.models.Cursor,User=this.app.models.User,t=this.app.views.User,ContactList=this.app.models.ContactList,u=this.app.views.ContactList,v=this.app.views.Dialog,w=this.app.views.Message,x=this.app.views.Attach,y=this.app.views.VideoChat,z=this.app.views.Settings}function i(){a(".chat-occupants, #popupIncoming").mCustomScrollbar({theme:"minimal-dark",scrollInertia:500,mouseWheel:{scrollAmount:"auto",deltaFactor:"auto"},live:!0})}function j(b){var c=a(b.target),d="#profile, #profile *, .occupant, .occupant *, .j-btn_input_smile, .j-btn_input_smile *, .textarea, .textarea *, .j-popover_smile, .j-popover_smile *, .j-popover_gmap, .j-popover_gmap *, .j-btn_input_location, .j-btn_input_location *",e=c.context.src&&c.context.src.indexOf("/maps.gstatic.com/mapfiles/api-3/images/mapcnt6.png")||null;return!c.is(d)&&3!==b.which&&7!==e&&void l()}function k(a){var c=window.URL,d=a[0].files[0],e=d?c.createObjectURL(d):b.defAvatar.url,f=d?d.name:b.defAvatar.caption;a.prev().find(".avatar").css("background-image","url("+e+")").siblings("span").text(f)}function l(){var b=a(".j-open_map");a(".is-contextmenu").removeClass("is-contextmenu"),a(".is-active").removeClass("is-active"),a(".popover").remove(),b.length&&b.remove(),a("#mCSB_8_container").is(":visible")&&(a("#mCSB_8_container")[0].style.paddingBottom="0")}function m(a,b,c,d){b&&(a.attr("data-id",b),a.find("#deleteConfirm").data("id",b)),c&&a.find("#leaveConfirm").data("dialog",c),d&&a.find(".popup-control-button_cancel").attr("data-isprofile",!0),a.add(".popups").addClass("is-overlay")}function n(a,b,c,d){"video"===d?a.find("video.attach-video").attr("src",c):a.find(".attach-photo").attr("src",c),a.find(".attach-name").text(b),a.find(".attach-download").attr("href",c).attr("download",b),a.add(".popups").addClass("is-overlay")}function o(){a(".j-popupDelete.is-overlay").removeData("id"),a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a(".temp-box").remove(),a("video.attach-video")[0]&&a("video.attach-video")[0].pause(),a("img.attach-photo")[0]&&a("img.attach-photo").attr("src","images/photo_preloader.gif")}function p(b){var c="photo"===b?"video":"photo";a(".attach-"+b).removeClass("is-hidden").siblings(".attach-"+c).addClass("is-hidden")}function q(b){var c=a(".l-chat:visible"),d=c.find(".triangle_"+b);d.removeClass("is-hidden").siblings(".triangle").addClass("is-hidden"),c.find(".chat-occupants-wrap").toggleClass("is-overlay"),c.find(".l-chat-content").toggleClass("l-chat-content_min")}var r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a(".l-workspace-wrap");return h.prototype={init:function(){window.isQMAppActive=!0,a(window).focus(function(){window.isQMAppActive=!0;var b=a(".l-list-wrap section:not(#searchList) .is-selected"),c=b[0]&&b.data("dialog");c&&(b.find(".unread").text(""),v.decUnreadCounter(c))}),a(window).blur(function(){var b=a(".l-chat:visible"),c=a(".l-chat:visible").find(".j-newMessages");
b.length&&c.length&&c.remove(),window.isQMAppActive=!1}),a(document).on("click",function(a){j(a)}),a(".popups").on("click",function(b){var c=a(b.target);c.is(".popups")&&!c.find(".popup.is-overlay").is(".is-open")&&o()}),a("#signup-avatar:file").on("change",function(){k(a(this))}),a("body").on("click",".userDetails",function(){l();var b=a(this).data("id"),c=ContactList.roster[b];return d.User.getControlButtonsForPopupDetails(c),m(a("#popupDetails"),b),t.buildDetails(b),!1}),a("body").on("click","#userProfile",function(a){var b=F.views.Profile;a.preventDefault(),l(),b.render().openPopup()}),a("body").on("click",".btn_changePassword",function(a){var b=F.views.ChangePass,c=F.views.Profile;a.preventDefault(),c.$el.hide(),b.render().openPopup()}),a("body").on("click",".btn_popup_changepass",function(a){var b=(F.views.Profile,F.views.ChangePass);a.preventDefault(),b.submitForm()}),a("body").on("click",".btn_userProfile_connect",function(){var d=F.views.Profile,e=a(this);e.prop("disabled",!0),FB.login(function(a){c.log("FB authResponse",a),"connected"===a.status?d.addFBAccount(a.authResponse.userID):e.prop("disabled",!1)},{scope:b.fbAccount.scope})}),a(".smiles-tab").on("click",function(){var b=a(this),c=document.querySelector(".smiles-wrap"),d=b.data("group");b.addClass("is-actived").siblings().removeClass("is-actived"),a(".smiles-group_"+d).removeClass("is-hidden").siblings().addClass("is-hidden"),c.scrollTop=0,g.update(c),s.setCursorToEnd(a(".l-chat:visible .textarea")[0])}),g.initialize(document.querySelector(".smiles-wrap"),{wheelSpeed:1,wheelPropagation:!0,minScrollbarLength:20}),G.on("click",".j-em",function(){return s.setCursorAfterElement(a(this)[0]),!1}),a(".j-em_wrap").on("click",function(b){var c=a(this).children()[0],d=a(".l-chat:visible .textarea")[0];return c===b.target?(d.focus(),s.insertElement(c,"j-em")):s.setCursorToEnd(d),!1}),G.on("click",".j-btn_input_attach",function(){a(this).parents(".l-chat-footer").find(".attachment").click()}),G.on("change",".attachment",function(){x.changeInput(a(this))}),G.on("click",".attach-cancel",function(b){b.preventDefault(),x.cancel(a(this))}),G.on("click",".preview",function(){var b,c=a(this),d=c.data("name"),e=c.data("url");c.is(".preview-photo")?(b="photo",p(b)):(b="video",p(b)),n(a("#popupAttach"),d,e,b)}),G.on("click",".j-send_location",function(){localStorage["QM.latitude"]&&localStorage["QM.longitude"]?e.toggleGeoCoordinatesToLocalStorage(!1,function(a,b){c.log(b?b:a)}):e.toggleGeoCoordinatesToLocalStorage(!0,function(a,b){c.log(b?b:a)})}),G.on("click",".j-btn_input_location",function(){var b=a(this),c=a(".j-popover_gmap"),d=b.is(".is-active");l(),d||(b.addClass("is-active"),c.addClass("is-active"),e.addMap(c))}),G.on("click",".j-send_map",function(){var b=localStorage["QM.locationAttach"];b&&(x.sendMessage(a(".l-chat:visible"),null,null,b),localStorage.removeItem("QM.locationAttach"),l())}),a("body").on("keypress",function(b){13===b.keyCode&&a(".j-open_map").length&&a(".j-send_map").click()}),a("body").on("click","#userSettings",function(){return l(),a(".j-settings").addClass("is-overlay").parent(".j-overlay").addClass("is-overlay"),!1}),a("body").on("click",".j-close_settings",function(){return o(),!1}),a(".j-toogle_settings").click(function(){var b=a(this).find(".j-setings_notify")[0],c={};return b.checked=b.checked!==!0,c[b.id]=b.checked,z.update(c),!1}),G.on("click",".groupTitle",function(){$scroll=a(".l-chat:visible").find(".j-scrollbar_message"),a(".l-chat:visible").find(".triangle_up").is(".is-hidden")?($scroll.mCustomScrollbar("scrollTo","-=94"),q("up")):($scroll.mCustomScrollbar("scrollTo","+=94"),q("down"))}),G.on("click",".groupTitle .addToGroupChat",function(b){b.stopPropagation();var d=a(this),e=d.data("dialog");c.log("add people to groupchat"),u.addContactsToChat(d,"add",e)}),G.on("click",".groupTitle .leaveChat, .groupTitle .avatar",function(a){a.stopPropagation()}),G.on("mouseenter focus",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");b.find(".triangle:visible").addClass("is-hover").siblings(".pencil").removeClass("is-hidden")}),G.on("mouseleave",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");a(this).is(".is-focus")||b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden")}),a(document.body).on("click",function(){var b=a(".l-chat:visible");b.find(".groupTitle .name_chat").is(".is-focus")&&(b.find(".groupTitle .name_chat").removeClass("is-focus"),b.find(".groupTitle .name_chat")[0].scrollLeft=0,b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden"),B&&!B.name?b.find(".name_chat").text(A.name):B&&B.name!==A.name&&B.created_at>A.created_at?(b.find(".name_chat").text(B.name).attr("title",B.name),r.changeName(b.data("dialog"),B.name)):b.find(".name_chat").text(b.find(".name_chat").text().trim()))}),a("body").on("click",".groupTitle .name_chat",function(b){b.stopPropagation();var c=a(this);c.addClass("is-focus"),A={name:c.text().trim(),created_at:Date.now()},l()}),a("body").on("keypress",".groupTitle .name_chat",function(b){var c=a(this),d=b.keyCode;B={name:c.text().trim(),created_at:Date.now()},13===d?(a(document.body).click(),c.blur()):27===d&&(B=null,c.text(A.name),a(document.body).click(),c.blur())}),a("body").on("click",".j-changePic",function(){var b=a(this).data("dialog");a('input:file[data-dialog="'+b+'"]').click()}),G.on("change",".groupTitle .avatar_file",function(){var b=a(".l-chat:visible");r.changeAvatar(b.data("dialog"),a(this),function(c){return!!c&&(b.find(".avatar_chat").css("background-image","url("+c+")"),void a(".j-popupAvatar .j-avatarPic").attr("src",c))})}),G.on("click",".j-scaleAvatar",function(){c.scaleAvatar(a(this))}),i(),a("#signupFB, #loginFB").on("click",function(a){c.log("connect with FB"),a.preventDefault(),FB.login(function(a){c.log("FB authResponse",a),"connected"===a.status&&t.connectFB(a.authResponse.accessToken)},{scope:b.fbAccount.scope})}),a(".j-twitterDigits").on("click",function(){return t.connectTwitterDigits(),c.log("connecting with twitterDigits"),!1}),a("#signupQB").on("click",function(){c.log("signup with QB"),t.signupQB()}),a(".j-login_QB").on("click",function(){return c.log("login wih QB"),a("#loginPage .j-prepare_inputs").removeClass("active"),t.loginQB(),!1}),a(".j-back_to_login_page").on("click",function(){t.loginQB(),a(".j-success_callback").remove()}),a("#signupForm").on("click submit",function(a){c.log("create user"),a.preventDefault(),t.signupForm()}),a("#forgot").on("click",function(a){c.log("forgot password"),a.preventDefault(),t.forgot()}),a("#loginForm").on("click submit",function(a){c.log("authorize user"),a.preventDefault(),t.loginForm()}),a("#forgotForm").on("click submit",function(a){c.log("send letter"),a.preventDefault(),t.forgotForm()}),a("#resetForm").on("click submit",function(a){c.log("reset password"),a.preventDefault(),t.resetForm()}),a("#profile").on("click",function(b){b.preventDefault(),l(),a(".l-chat:visible").find(".triangle_down").is(".is-hidden")&&q("down"),t.profilePopover(a(this))}),a(".list_contextmenu").on("contextmenu",".contact",function(b){b.preventDefault(),l(),t.contactPopover(a(this))}),G.on("click",".occupant",function(b){b.preventDefault(),l(),t.occupantPopover(a(this),b)}),G.on("click",".j-btn_input_smile",function(){var b=a(this),c=b.is(".is-active");l(),c||(b.addClass("is-active"),a(".j-popover_smile").addClass("is-active")),s.setCursorToEnd(a(".l-chat:visible .textarea")[0])}),a(".header-links-item").on("click","#logout",function(b){b.preventDefault(),m(a("#popupLogout"))}),a("body").on("click",".deleteContact",function(b){b.preventDefault(),o();var c=a(this),d=c.parents(".presence-listener"),e=d.data("id")||c.data("id");d.is(".popup_details")?m(a("#popupDelete"),e,null,!0):m(a("#popupDelete"),e)}),a(".list, .l-workspace-wrap").on("click",".leaveChat",function(b){b.preventDefault();var c=a(this),d=c.parents(".presence-listener")[0]?c.parents(".presence-listener"):c.parents(".is-group"),e=d.data("dialog");m(a("#popupLeave"),null,e)}),a("#logoutConfirm").on("click",function(){localStorage.setItem("QM."+User.contact.id+"_logOut",!0),t.logout()}),a(".j-deleteConfirm").on("click",function(){var b=a(this).parents(".j-popupDelete").data("id");u.sendDelete(b,!0),c.log("delete contact")}),a("#leaveConfirm").on("click",function(){c.log("leave chat"),v.leaveGroupChat(a(this))}),a(".popup-control-button, .btn_popup_private").on("click",function(b){b.preventDefault();var c=a(this),d=c.data("isprofile");c.is(".returnBackToPopup")||o(),d&&m(a("#popupDetails"))}),a(".search").on("click",function(){c.log("global search"),o(),u.globalPopup()}),a(".btn_search").on("click",function(b){b.preventDefault();var c=a("#searchContacts input"),d=a("#globalSearch input");d.val(c.val()),a("#globalSearch").submit()}),a("#mainPage").on("click",".createGroupChat",function(b){b.preventDefault(),c.log("add people to groupchat");var d=a(this),e=d.data("private");u.addContactsToChat(d,null,null,e)}),a(".l-sidebar").on("click",".addToGroupChat",function(b){b.preventDefault();var d=a(this),e=d.data("dialog");c.log("add people to groupchat"),u.addContactsToChat(d,"add",e)}),a(".j-globalSearch").on("keyup search submit",function(b){function c(){E=void 0,u.globalSearch(d)}var d=a(this),e=b.keyCode,f=d.find(".form-input-search").val().length,g=d.find(".j-clean-button"),h=g.is(":hidden");return 13===e?(clearTimeout(E),c()):void 0===E?E=setTimeout(function(){c()},8===e?0:1e3):(clearTimeout(E),E=setTimeout(function(){c()},1e3)),f&&h?g.show():f||g.hide(),!1}),a(".localSearch").on("keyup search submit",function(b){var c=a(this),d=document.querySelector(".j-scrollbar_aside"),e=c.find(".form-input-search").val().length,f=c.find(".j-clean-button"),h=f.is(":hidden"),i=b.type,j=b.keyCode;return("keyup"===i&&27!==j&&13!==j||"search"===i)&&("searchContacts"===this.id?t.localSearch(c):t.friendsSearch(c),g.update(d)),e&&h?f.show():e||f.hide(),!1}),a(".j-clean-button").on("click",function(b){var c=a(this),d=c.parent("form.formSearch");return c.hide(),d.find("input.form-input-search").val("").focus(),d.is(".j-globalSearch")?u.globalSearch(d):d.is(".j-localSearch")?t.localSearch(d):t.friendsSearch(d),!1}),a(".list_contacts").on("click",".j-sendRequest",function(){var b=a(this).parents(".j-listItem").data("jid");u.sendSubscribe(b),c.log("send subscribe")}),G.on("click",".j-requestAgain",function(){var b=a(this).parents(".j-chatItem").data("jid");u.sendSubscribe(b,!0),c.log("send subscribe")}),a("body").on("click",".j-requestAction",function(){var b=a(this).parents(".j-listItem").data("jid");u.sendSubscribe(b),c.log("send subscribe")}),a(".list").on("click",".j-requestConfirm",function(){var b=a(this).parents(".j-incommingContactRequest").data("jid");u.sendConfirm(b,!0),c.log("send confirm")}),a(".list").on("click",".j-requestCancel",function(){var b=a(this).parents(".j-incommingContactRequest").data("jid");u.sendReject(b,!0),c.log("send reject")}),a(".list").on("click",".contact",function(a){"INPUT"!==a.target.tagName&&a.preventDefault()}),a("#popupContacts").on("click",".contact",function(){var b,c=a(this).parent(),d=c.parents(".popup");c.is(".is-chosen")?c.removeClass("is-chosen").find("input").prop("checked",!1):c.addClass("is-chosen").find("input").prop("checked",!0),b=c.parent().find("li.is-chosen").length,1!==b||d.is(".is-addition")?b>=1?(d.removeClass("not-selected"),d.is(".add")?d.find(".btn_popup_add").removeClass("is-hidden").siblings().addClass("is-hidden"):d.find(".btn_popup_group").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom")):d.addClass("not-selected"):(d.removeClass("not-selected"),d.find(".btn_popup_private").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom"))}),a("#popupContacts .btn_popup_private").on("click",function(){var b=a("#popupContacts .is-chosen").data("id"),c=a('.dialog-item[data-id="'+b+'"]').find(".contact");v.htmlBuild(c)}),a("body").on("click",".writeMessage",function(b){b.preventDefault();var c=a(this).data("id"),d=a('.dialog-item[data-id="'+c+'"]').find(".contact");o(),v.htmlBuild(d)}),a("#popupContacts .btn_popup_group").on("click",function(){v.createGroupChat()}),a("#popupContacts .btn_popup_add").on("click",function(){var b=a(this).parents(".popup").data("dialog");v.createGroupChat("add",b)}),G.on("click",".j-btn_input_send",function(){var b=a(".j-message:visible"),c=a(".j-loading").length;return c||(w.sendMessage(b),b.find(".textarea").empty()),l(),s.setCursorToEnd(a(".l-chat:visible .textarea")[0]),!1}),a("body").on("mouseenter","article.message.is-own",function(){var b=a(this),c=b.find(".message-time"),d=b.find(".message-status");c.addClass("is-hidden"),d.removeClass("is-hidden")}),a("body").on("mouseleave","article.message.is-own",function(){var b=a(this),c=b.find(".message-time"),d=b.find(".message-status");d.addClass("is-hidden"),c.removeClass("is-hidden")}),G.on("click",".j-toBottom",function(){a(".j-scrollbar_message").mCustomScrollbar("scrollTo","bottom"),a(this).hide()}),G.on("keypress",".j-message",function(b){function c(){w.sendTypingStatus(i,!0)}function d(){clearTimeout(C),C=void 0,clearInterval(D),D=void 0,w.sendTypingStatus(i,!1)}var e=a(this),f=13===b.keyCode,g=b.shiftKey,h=e.parents(".l-chat"),i=h.data("jid"),j=h.find(".j-loading").length,k=!h.find(".textarea").html().length;return(!f||!j&&!k)&&(f&&!g?(d(),w.sendMessage(e),e.find(".textarea").empty(),l(),!1):void(void 0===C?(c(),C=setTimeout(d,4e3),D=setInterval(c,4e3)):(clearTimeout(C),C=setTimeout(d,4e3))))}),G.on("submit",".j-message",function(a){return!1}),G.on("keypress",".j-message",function(){var b=a(".l-chat:visible .textarea"),c=b.find(".j-em"),d=b.text().trim();d.length||c.length?b.addClass("contenteditable"):(b.removeClass("contenteditable").empty(),s.setCursorToEnd(b[0]))}),a("body").on("paste",".j-message",function(a){var b=(a.originalEvent||a).clipboardData.getData("text/plain");return document.execCommand("insertText",!1,b),!1}),a(".j-home").on("click",function(){var b=a(".is-selected"),c=b.data("dialog"),d=a('.j-newMessages[data-dialog="'+c+'"]');return a(".j-capBox").removeClass("is-hidden").siblings().removeClass("is-active"),a(".j-chatWrap").addClass("is-hidden"),d.length&&d.remove(),b.removeClass("is-selected"),!1}),a("#share").on("click",function(a){a.preventDefault()}),y.init()}},h}),define("QBApiCalls",["jquery","config","quickblox","Entities","Helpers","LocationView"],function(a,b,c,d,e,f){function g(a){this.app=a,p=this,j=this.app.models.Session,k=this.app.views.User,DialogView=this.app.views.Dialog,l=this.app.views.ContactList,m=this.app.models.User,n=this.app.listeners}function h(){o=setTimeout(function(){c.getSession(function(a,b){return a?e.log("recovery session error",a):(j.update({date:new Date}),void h())})},36e5)}function i(){var a={chat_endpoint:c.auth.service.qbInst.config.endpoints.chat,app_id:b.qbAccount.appId.toString()};FlurryAgent.logEvent("Connect_to_chat",a)}var j,k,l,m,n,o,p;g.prototype={init:function(a){"undefined"==typeof a?c.init(b.qbAccount.appId,b.qbAccount.authKey,b.qbAccount.authSecret,b.QBconf):(c.init(a,b.qbAccount.appId,null,b.QBconf),c.service.qbInst.session.application_id=b.qbAccount.appId,c.service.qbInst.config.creds=b.qbAccount,j.create(JSON.parse(localStorage["QM.session"]),!0),k.autologin()),e.log("QB init",this),d.Collections.dialogs=new d.Collections.Dialogs},checkSession:function(a){(new Date).toISOString()>j.expirationTime?"facebook"===j.authParams.provider?k.getFBStatus(function(b){j.authParams.keys.token=b,p.createSession(j.authParams,function(b){a(b)},j._remember)}):"twitter_digits"===j.authParams.provider?p.getTwitterDigits(function(b){a(b)}):(p.createSession(j.decrypt(j.authParams),function(b){a(b)},j._remember),j.encrypt(j.authParams)):a()},createSession:function(d,g,h){f.toggleGeoCoordinatesToLocalStorage(!1,function(a,b){e.log(b?b:a)}),c.createSession(d,function(c,f){if(c){e.log(c.detail);var i,l=JSON.parse(c.detail);401===c.code?(i=b.errors.unauthorized,a("section:visible input:not(:checkbox)").addClass("is-error")):(i=l.errors.email?l.errors.email[0]:l.errors.base?l.errors.base[0]:l.errors[0],i.indexOf("Authentication")>=0?(i=b.errors.crashFBToken,k.getFBStatus()):i.indexOf("already")>=0?(i=b.errors.emailExists,k.getFBStatus()):i=b.errors.session),q(i)}else e.log("QB SDK: Session is created",f),j.token?j.update({token:f.token}):j.create({token:f.token,authParams:j.encrypt(d)},h),j.update({date:new Date}),g(f)})},loginUser:function(a,b){this.checkSession(function(d){c.login(a,function(c,d){c?e.log(c.detail):(e.log("QB SDK: User has logged",d),j.update({date:new Date,authParams:j.encrypt(a)}),b(d))})})},getTwitterDigits:function(a){p.createSession({},function(b){c.login(j.authParams,function(c,d){c?e.log(c.detail):(j.update({date:new Date,authParams:j.encrypt(j.authParams)}),a(b))})},j._remember)},logoutUser:function(a){e.log("QB SDK: User has exited"),c.service.qbInst.config.creds=b.qbAccount,clearTimeout(o),j.destroy(),a()},forgotPassword:function(a,b){this.checkSession(function(d){c.users.resetPassword(a,function(a){404===a.code?(e.log(a.message),s()):(e.log("QB SDK: Instructions have been sent"),j.destroy(),b())})})},listUsers:function(a,b){this.checkSession(function(d){c.users.listUsers(a,function(a,c){a?e.log(a.detail):(e.log("QB SDK: Users is found",c),j.update({date:new Date}),b(c))})})},getUser:function(a,b){this.checkSession(function(d){c.users.get(a,function(a,c){a&&404===a.code?(e.log(a.message),t(),b({current_page:1,items:[]})):(e.log("QB SDK: Users is found",c),j.update({date:new Date}),b(c))})})},createUser:function(a,b){this.checkSession(function(d){c.users.create(a,function(a,c){if(a){e.log(a.detail);var d=JSON.parse(a.detail).errors.email[0];r(d)}else e.log("QB SDK: User is created",c),j.update({date:new Date}),b(c)})})},updateUser:function(a,b,d){this.checkSession(function(f){c.users.update(a,b,function(a,b){if(a){e.log(a.detail);var c=JSON.parse(a.detail).errors.email;c?r(c[0]):d(null,a)}else e.log("QB SDK: User is updated",b),j.update({date:new Date}),d(b)})})},createBlob:function(a,b){this.checkSession(function(d){c.content.createAndUpload(a,function(a,c){a?e.log(a.detail):(e.log("QB SDK: Blob is uploaded",c),j.update({date:new Date}),b(c))})})},connectChat:function(a,b){this.checkSession(function(d){var f=j.token;c.chat.connect({jid:a,password:f},function(a,c){a?(e.log(a),k.logout(),window.location.reload(),q(a.detail)):(n.setChatState(!0),i(),j.update({date:new Date}),h(),b(c),"Unknown user"===m.contact.full_name&&p.app.views.Profile.render().openPopup())})})},reconnectChat:function(){p.connectChat(m.contact.user_jid,function(a){n.setQBHandlers(),n.onReconnected(),d.Collections.dialogs.each(function(a){2===a.get("type")&&c.chat.muc.join(a.get("room_jid"))})})},listDialogs:function(a,b){this.checkSession(function(d){c.chat.dialog.list(a,function(a,c){a?e.log(a.detail):(e.log("QB SDK: Dialogs is found",c),j.update({date:new Date}),b(c))})})},createDialog:function(a,b){this.checkSession(function(d){c.chat.dialog.create(a,function(a,c){a?e.log(a.detail):(e.log("QB SDK: Dialog is created",c),j.update({date:new Date}),b(c))})})},updateDialog:function(a,b,d){this.checkSession(function(f){c.chat.dialog.update(a,b,function(a,b){a?e.log(a.detail):(e.log("QB SDK: Dialog is updated",b),j.update({date:new Date}),d(b))})})},listMessages:function(a,b){this.checkSession(function(d){c.chat.message.list(a,function(a,c){a?e.log(a.detail):(e.log("QB SDK: Messages is found",c),j.update({date:new Date}),b(c.items))})})},deleteMessage:function(a,b){this.checkSession(function(d){c.chat.message["delete"](a,function(a){404===a.code?e.log(a.message):(e.log("QB SDK: Message is deleted"),j.update({date:new Date}),b())})})},sendPushNotification:function(a,b){var d={notification_type:"push",environment:"production",message:c.pushnotifications.base64Encode(b+" is calling you."),user:{ids:[a]},ios_badge:"1",ios_sound:"default"};c.pushnotifications.events.create(d,function(a,b){a?e.log("Create event error: ",a):e.log("Create event: ",b)})}};var q=function(b){k.removeSpinner(),a("section:visible .text_error").addClass("is-error").text(b),a("section:visible input:password").val("")},r=function(c){var d;c.indexOf("already")>=0?d=b.errors.emailExists:c.indexOf("look like")>=0&&(d=b.errors.invalidEmail),a('section:visible input[type="email"]').addClass("is-error"),q(d)},s=function(){var c=b.errors.notFoundEmail;a('section:visible input[type="email"]').addClass("is-error"),q(c)},t=function(){a(".popup:visible .note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),l.removeDataSpinner()};return g}),define("Listeners",["jquery","config","quickblox","Helpers","perfectscrollbar"],function(a,b,c,d,e){function f(a){i=this,this.app=a;var b=navigator.onLine;this.setChatState=function(a){b="boolean"==typeof a?a:navigator.onLine},this.getChatState=function(){return b}}function g(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a(".j-disconnect").addClass("is-overlay").parent(".j-overlay").addClass("is-overlay")}function h(){a(".j-disconnect").removeClass("is-overlay").parent(".j-overlay").removeClass("is-overlay")}var i;return f.prototype={init:function(){window.addEventListener("online",i._onNetworkStatusListener),window.addEventListener("offline",i._onNetworkStatusListener)},setQBHandlers:function(){var a=i.app.views.ContactList,b=i.app.views.Message,d=i.app.views.VideoChat;c.chat.onMessageListener=b.onMessage,c.chat.onMessageTypingListener=b.onMessageTyping,c.chat.onSystemMessageListener=b.onSystemMessage,c.chat.onDeliveredStatusListener=b.onDeliveredStatus,c.chat.onReadStatusListener=b.onReadStatus,c.chat.onContactListListener=a.onPresence,c.chat.onSubscribeListener=a.onSubscribe,c.chat.onConfirmSubscribeListener=a.onConfirm,c.chat.onRejectSubscribeListener=a.onReject,c.chat.onDisconnectedListener=i.onDisconnected,c.chat.onReconnectListener=i.onReconnected,c.chat.onReconnectFailedListener=i.onReconnectFailed,c.webrtc&&(c.webrtc.onCallListener=d.onCall,c.webrtc.onAcceptCallListener=d.onAccept,c.webrtc.onRejectCallListener=d.onReject,c.webrtc.onInvalidEventsListener=d.onIgnored,c.webrtc.onStopCallListener=d.onStop,c.webrtc.onUpdateCallListener=d.onUpdateCall,c.webrtc.onRemoteStreamListener=d.onRemoteStream,c.webrtc.onCallStatsReport=d.onCallStatsReport,c.webrtc.onSessionCloseListener=d.onSessionCloseListener,c.webrtc.onUserNotAnswerListener=d.onUserNotAnswerListener)},listenToPsTotalEnd:function(a){var b=document.querySelector(".j-scrollbar_aside");a?b.addEventListener("ps-y-reach-end",i._onNextDilogsList):b.removeEventListener("ps-y-reach-end",i._onNextDilogsList)},onDisconnected:function(){g(),i.setChatState(!1)},onReconnected:function(){h(),i.setChatState(!0)},onReconnectFailed:function(a){a&&(i.app.service.reconnectChat(),i.setChatState(!1))},_onNetworkStatusListener:function(){var a=navigator.onLine?"online":"offline";"function"==typeof i.onNetworkStatus&&a&&i.onNetworkStatus(a)},_onNextDilogsList:function(){i.activePsListener?(i.listenToPsTotalEnd(!1),i.app.views.Dialog.showOldHistory(function(a){i._onUpdatePerfectScroll(),a||i.listenToPsTotalEnd(!0)})):i.activePsListener=!0},_onUpdatePerfectScroll:function(){e.update(document.querySelector(".j-scrollbar_aside"))},onNetworkStatus:function(a){i.getChatState()&&("online"===a?h():g())}},f}),define("MainModule",["jquery","UserModule","SessionModule","SettingsModule","ContactModule","DialogModule","MessageModule","AttachModule","ContactListModule","VideoChatModule","CursorModule","SyncTabsModule","UserView","SettingsView","DialogView","MessageView","AttachView","ContactListView","VideoChatView","Events","Helpers","QBApiCalls","config","Entities","QMHtml","Listeners"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){function A(){this.listeners=new z(this),this.models={User:new b(this),Session:new c(this),Settings:new d(this),Contact:new e(this),Dialog:new f(this),Message:new g(this),Attach:new h(this),ContactList:new i(this),VideoChat:new j(this),Cursor:new k(this),SyncTabs:new l(this)},this.views={User:new m(this),Settings:new n(this),Dialog:new o(this),Message:new p(this),Attach:new q(this),ContactList:new r(this),VideoChat:new s(this)},this.events=new t(this),this.service=new v(this),this.entities=x,this.entities.app=this}return A.prototype={init:function(){var a;this.setHtml5Patterns(),this.preloader(),localStorage["QM.session"]&&localStorage["QM.user"]&&localStorage["QM.isReleaseQBAccount"]?(a=JSON.parse(localStorage["QM.session"]).token,this.service.init(a)):localStorage["QM.isReleaseQBAccount"]?this.service.init():(localStorage.clear(),localStorage.setItem("QM.isReleaseQBAccount","1"),this.service.init()),this.events.init(),this.listeners.init(),u.log("App init",this)},preloader:function(){var b=a("#welcomePage .l-spinner");b.addClass("is-hidden"),b.prevAll().removeClass("is-hidden")},setHtml5Patterns:function(){a(".pattern-name").attr("pattern",w.patterns.name),a(".pattern-pass").attr("pattern",w.patterns.password)}},A}),requirejs.config({googlemaps:{params:{key:"AIzaSyAhduIkJbVdtRm0Hz6XpkihGt8h_R8cZds",libraries:"geometry"}},baseUrl:"scripts",shim:{facebook:{exports:"FB"},gmaps:{deps:["googlemaps"],exports:"GMaps"},handlebars:{exports:"Handlebars"},cryptojs:{exports:"CryptoJS"},progressbar:{exports:"ProgressBar"},minEmoji:{exports:"minEmoji"}},paths:{facebook:"https://connect.facebook.net/en_US/sdk",googlemaps:"../bower_components/googlemaps-amd/src/googlemaps",async:"../bower_components/requirejs-plugins/src/async",gmaps:"https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.24/gmaps.min",digits:"https://cdn.digits.com/1/sdk",cryptojs:"../bower_components/crypto-js-lib/rollups/aes",videojs:"https://vjs.zencdn.net/5.11.6/video",jquery:"../bower_components/jquery/dist/jquery",underscore:"../bower_components/underscore/underscore",backbone:"../bower_components/backbone/backbone",handlebars:"../bower_components/handlebars/handlebars",quickblox:"https://cdnjs.cloudflare.com/ajax/libs/quickblox/2.5.0/quickblox.min",progressbar:"../bower_components/progressbar.js/lib/control/progressbar",loadImage:"../bower_components/blueimp-load-image/js/load-image",canvasToBlob:"../bower_components/blueimp-canvas-to-blob/js/canvas-to-blob",mCustomScrollbar:"../bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar",mousewheel:"../bower_components/jquery-mousewheel/jquery.mousewheel",timeago:"../bower_components/jquery-timeago/jquery.timeago",minEmoji:"../vendor/emoji/js/minEmoji",nicescroll:"../bower_components/jquery.nicescroll/jquery.nicescroll.min",perfectscrollbar:"../bower_components/perfect-scrollbar/js/perfect-scrollbar.min",QBNotification:"../bower_components/web-notifications/qbNotification",config:"../configs/main_config",MainModule:"app",UserModule:"models/user",SessionModule:"models/session",SettingsModule:"models/settings",ContactModule:"models/contact",DialogModule:"models/dialog",MessageModule:"models/message",AttachModule:"models/attach",ContactListModule:"models/contact_list",VideoChatModule:"models/videochat",CursorModule:"models/custom_cursor",SyncTabsModule:"models/sync_tabs",UserView:"views/user",SettingsView:"views/settings",DialogView:"views/dialog",MessageView:"views/message",AttachView:"views/attach",ContactListView:"views/contact_list",VideoChatView:"views/videochat",LocationView:"views/location",QBApiCalls:"qbApiCalls",Events:"events",Helpers:"helpers",Listeners:"listeners",QMHtml:"qmhtml",Entities:"entities"}}),requirejs(["jquery","facebook","config","minEmoji","MainModule","backbone","QBNotification","Helpers","digits"],function(a,b,c,d,e,f,g,h,i){var j;a(function(){a(".j-appVersion").html("v. 1.10.0"),b.init({appId:c.fbAccount.appId,version:"v2.7"}),i.init({consumerKey:"KCcPaHrIgJ44gs3kwJuIbLaad"}).done(function(){h.log("Digits initialized.")}).fail(function(a){h.log("Digits failed to initialize: ",a)}),a.ajaxSetup({cache:!0}),a.getScript("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js",function(){h.log("Materialize connected")}),a(".smiles-group").each(function(){var b=a(this);b.html(d(b.text(),!0))}),c.notification&&g.isSupported()&&g.requestPermission(),j=new e,j.init(),a.getScript("https://cdn.flurry.com/js/flurry.js",function(){FlurryAgent.startSession("P8NWM9PBFCK2CWC8KZ59")})})}),define("main",function(){});